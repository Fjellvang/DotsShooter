import{d as re,z as V,x as D,A as U,c as u,f as j,ad as G,O as le,M as de,q as ce,s as ue,v as ge,a8 as pe,L as me,ae as q,bK as be,b as T,o as l,e as b,w as o,k as g,a as h,t as p,l as f,p as c,a2 as J,n as _,bd as he,_ as fe}from"./index-B7jvAjdE.js";import{a as A}from"./numberUtils-CkF0oMe2.js";import{b as R,c as Y}from"./metaListUtils-B-xQ0HnD.js";import{p as ve,a as H,b as ye,c as Se,A as Pe,M as _e}from"./MetaActivablePhaseBadge-DS0XHNhH.js";import{b as Q}from"./activables-DQj9-VnO.js";import{a as W}from"./players-CydHenLG.js";const Ce=re({__name:"MetaActivablesBaseCard",props:{activables:{default:void 0},hideDisabled:{type:Boolean},hideConversion:{type:Boolean},playerId:{default:void 0},category:{},longList:{type:Boolean},emptyMessage:{},title:{},hideCollapse:{type:Boolean},linkUrlPrefix:{default:void 0},searchFields:{default:void 0},filterSets:{default:void 0},sortOptions:{default:void 0},defaultSortOption:{default:1}},emits:["refreshActivables"],setup(C,{expose:r,emit:n}){r();const e=C,M=G(),F=V(),B=n,{data:w}=D(U()),{data:x,refresh:v}=D(Q()),{data:t}=D(()=>e.playerId?W(e.playerId):void 0),y=u(()=>{if(e.activables&&S.value){const a=S.value.categories[e.category],i=[];for(const s of a.kinds){const P=S.value.kinds[s];i.push(...Object.values(e.activables?.[s].activables).map(d=>{const m=d.scheduleStatus,k=d.statistics;return{activable:d,kindId:s,linkUrl:(e.linkUrlPrefix??`/activables/${P.category}`)+`/${s}/${d.config.activableId}`,linkText:a.shortSingularDisplayName,nextPhase:m?.nextPhase?m.nextPhase.phase:void 0,nextPhaseStartTime:m?.nextPhase?m.nextPhase.startTime:void 0,phaseSortOrder:ve(d,null,t.value),phaseDisplayString:H(d,null,t.value),conversion:e.hideConversion?0:K(k.numConsumedForFirstTime,k.numActivatedForFirstTime),conversionTooltip:e.hideConversion?0:E(k.numConsumedForFirstTime,k.numActivatedForFirstTime),debugPhaseTooltip:I(d)}}))}return i.filter(s=>!e.hideDisabled||s.activable.config.activableParams.isEnabled===!0)}else return}),S=u(()=>w.value?.activablesMetadata),X=u(()=>x.value?.forcePlayerActivablePhaseEnabled||!1),O=j({}),Z=u(()=>{const i=["Preview","Active","EndingSoon","Review","Inactive"].map(s=>({value:s,id:ye(s)}));return i.unshift({value:"undefined",id:"Select a phase"}),i});function $(a,i){return H(a,i,t.value)}function I(a){if(a.debugState)return`${a.config.activableId} is in debug-forced phase '${a.debugState.phase}'`}function N(a){return a.kindId+"/"+a.activable.config.activableId}function ee(a){const i=O.value[N(a)];return i&&i!=="undefined"}const{showSuccessNotification:L}=q();async function te(a){const i=O.value[N(a)];if(!i||i==="undefined")return;const s=a.kindId,P=a.activable.config.activableId,d=a.activable.config.displayName,m=i===null?"none":i;await M.post(`/activables/${e.playerId}/forcePhase/${s}/${P}/${m}`),v(),L(`'${d}' debug-forced to phase '${i}'.`)}async function ae(a){const i=a.kindId,s=a.activable.config.activableId,P=a.activable.config.displayName;await M.post(`/activables/${e.playerId}/forcePhase/${i}/${s}/none`),v(),L(`'${P}' reset to its original phase.`)}const ie=u(()=>{let a=Se(t.value!==null);return e.hideDisabled&&(a=a.filter(i=>i!=="Disabled")),[new R("status",a.map(i=>new Y(i,s=>s.phaseDisplayString===i)))]}),se=u(()=>F.gameSpecific.activableCustomization[e.category]?.icon||"calendar-alt"),ne=u(()=>S.value?.categories[e.category].shortSingularDisplayName);function K(a,i){return i===0?0:a/i*100}function E(a,i){return i===0?"Not activated by any players yet.":`Activated by ${A(i)} players and consumed by ${A(a)}.`}function oe(a){return a.activable.config.activableId}const z={props:e,gameServerApi:M,coreStore:F,emits:B,staticConfigData:w,activablesForcePhaseEnabled:x,refreshActivablesForcePhaseEnabled:v,playerData:t,decoratedActivables:y,activablesMetadata:S,enableDevelopmentFeatures:X,selectedDebugPhase:O,debugPhaseOptions:Z,getPhaseDisplayString:$,debugPhaseTooltip:I,activableKey:N,hasValidSelectedDebugPhase:ee,showSuccessNotification:L,forceSelectedPhase:te,clearDebugPhase:ae,defaultFilterSets:ie,categoryIcon:se,categoryDisplayName:ne,conversion:K,conversionTooltip:E,getItemKey:oe,computed:u,ref:j,get useGameServerApi(){return G},get MetaListFilterOption(){return Y},get MetaListFilterSet(){return R},get MButton(){return le},get MBadge(){return de},get MCollapse(){return ce},get MList(){return ue},get MListItem(){return ge},get MTextButton(){return pe},get MTooltip(){return me},get useNotifications(){return q},get abbreviateNumber(){return A},get camelCaseToKebabCase(){return be},get useSubscription(){return D},get Activables(){return Pe},get useCoreStore(){return V},get getIsActivableForcePhaseEnabledSubscriptionOptions(){return Q},get getStaticConfigSubscriptionOptions(){return U},get getSinglePlayerSubscriptionOptions(){return W},MetaActivablePhaseBadge:_e};return Object.defineProperty(z,"__isScriptSetup",{enumerable:!1,value:!0}),z}}),Me={key:0,class:"tw-text-neutral-500"},we={key:0,class:"text-warning"},xe={key:1},ke={key:2},De={key:1,class:"border rounded-sm bg-light tw-mx-5 tw-my-2 tw-px-5 tw-py-3"},Te={class:"font-weight-bold tw-mb-1"},Fe={class:"d-sm-flex justify-content-between align-content-center"},Be={key:2,class:"tw-my-3 tw-text-center tw-italic tw-text-neutral-400"};function Oe(C,r,n,e,M,F){const B=T("meta-time"),w=T("fa-icon"),x=T("meta-input-select"),v=T("meta-list-card");return l(),b(v,{title:n.title,icon:e.categoryIcon,itemList:e.decoratedActivables,getItemKey:e.getItemKey,pageSize:n.longList?50:void 0,searchFields:n.searchFields,filterSets:n.filterSets||e.defaultFilterSets,sortOptions:n.sortOptions,defaultSortOption:n.defaultSortOption,emptyMessage:n.emptyMessage,"data-testid":`${e.camelCaseToKebabCase(e.props.category)}-list-card`},{"item-card":o(({item:t})=>[g(e.MCollapse,{id:n.hideCollapse?"":t.activable.config.activableId,"extra-m-list-item-margin":"","hide-collapse":n.hideCollapse},{header:o(()=>[g(e.MListItem,{"no-left-padding":""},{badge:o(()=>[t.activable.config.displayShortInfo?(l(),h("span",Me,"("+p(t.activable.config.displayShortInfo)+")",1)):f("",!0)]),"top-right":o(()=>[n.playerId&&t.activable.debugState?(l(),b(e.MBadge,{key:0,tooltip:t.debugPhaseTooltip,variant:"warning"},{default:o(()=>[c(p(e.getPhaseDisplayString(t.activable)),1)],void 0,!0),_:2},1032,["tooltip"])):(l(),b(e.MetaActivablePhaseBadge,{key:1,activable:t.activable,playerId:e.props.playerId,typeName:`${e.categoryDisplayName?.toLocaleLowerCase()}`},null,8,["activable","playerId","typeName"]))]),"bottom-left":o(()=>[c(p(t.activable.config.description),1)]),"bottom-right":o(()=>[t.activable.debugState?(l(),h("div",we,"Debug override!")):t.nextPhase?(l(),h("div",xe,[c(p(e.getPhaseDisplayString(t.activable,t.nextPhase))+" ",1),g(B,{date:String(t.nextPhaseStartTime)},null,8,["date"])])):f("",!0),J(C.$slots,"additionalTexts",{item:t,index:`${t.activable.activableId}`}),e.props.hideConversion?f("",!0):(l(),h("div",ke,[g(e.MTooltip,{content:String(t.conversionTooltip)},{default:o(()=>[c(p(t.conversion.toFixed())+"% conversion",1)],void 0,!0),_:2},1032,["content"])])),t.linkUrl?(l(),b(e.MTextButton,{key:3,to:t.linkUrl,"data-testid":`view-${e.camelCaseToKebabCase(e.props.category)}`},{default:o(()=>[c("View "+p(`${t.linkText.toLocaleLowerCase()}`),1)],void 0,!0),_:2},1032,["to","data-testid"])):f("",!0)]),default:o(()=>[c(p(t.activable.config.displayName),1)],void 0,!0),_:2},1024)]),default:o(()=>[n.hideCollapse?f("",!0):(l(),b(e.MList,{key:0,class:"tw-mx-5",showBorder:""},{default:o(()=>[J(C.$slots,"collapseContents",{item:t,index:`${t.activable.activableId}`})],void 0,!0),_:2},1024)),n.playerId&&e.enableDevelopmentFeatures?(l(),h("div",De,[_("div",Te,[g(w,{icon:"wrench"}),r[0]||(r[0]=c(" Debug Controls"))]),r[4]||(r[4]=_("div",{class:"small text-muted mb-2"},"You can force this player into different activation states to test the feature easier. Just remember to clear the debug state afterwards!",-1)),_("div",Fe,[r[3]||(r[3]=_("label",{class:"sr-only",for:"inline-form-debug-controls"},"Debug Phase",-1)),g(x,{id:"inline-form-debug-controls",value:e.selectedDebugPhase[e.activableKey(t)]??"undefined",options:e.debugPhaseOptions,"no-clear":"",onInput:y=>e.selectedDebugPhase[e.activableKey(t)]=y},null,8,["value","options","onInput"]),_("div",{class:"tw-relative tw-top-1 tw-mr-2 tw-text-right",style:he(t.activable.debugState?"min-width: 16rem":"min-width: 7rem")},[g(e.MButton,{variant:"warning",size:"small","disabled-tooltip":e.hasValidSelectedDebugPhase(t)?void 0:"Select a phase.",permission:"api.players.force_activable_phase",onClick:y=>e.forceSelectedPhase(t)},{default:o(()=>r[1]||(r[1]=[c("Set Phase")]),void 0,!0),_:2},1032,["disabled-tooltip","onClick"]),t.activable.debugState?(l(),b(e.MButton,{key:0,size:"small",permission:"api.players.force_activable_phase",onClick:y=>e.clearDebugPhase(t)},{default:o(()=>r[2]||(r[2]=[c("Clear Debug Phase")]),void 0,!0),_:2},1032,["onClick"])):f("",!0)],4)])])):(l(),h("div",Be,"Debug controls disabled in current environment."))],void 0,!0),_:2},1032,["id","hide-collapse"])]),_:3},8,["title","icon","itemList","pageSize","searchFields","filterSets","sortOptions","defaultSortOption","emptyMessage","data-testid"])}const ze=fe(Ce,[["render",Oe],["__file","MetaActivablesBaseCard.vue"]]);export{ze as M};
