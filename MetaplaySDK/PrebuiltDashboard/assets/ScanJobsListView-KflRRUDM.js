import{d as K,x as m,c as f,f as w,ad as v,ae as S,b as j,o as P,e as x,w as l,k as n,n as s,a as O,t as D,l as I,_ as N}from"./index-B7jvAjdE.js";import{M as T}from"./MActionModalButton-CvWVuTB-.js";import{M as V,a as B}from"./MViewContainer-BTeE2xDT.js";import{M as E}from"./MInputSwitch-C-Z-JJsG.js";import{C as L}from"./CoreUiPlacement-CPf1fwrN.js";import{a as A,g as y}from"./scanJobs-A4fyB_UL.js";import"./MActionModal-coQLkvWs.js";import"./index-fVjXqxSF.js";import"./index-B_QkKjtG.js";const G=K({__name:"ScanJobsListView",setup(M,{expose:a}){a();const r=v(),{data:e}=m(A()),{data:b,error:J,refresh:i}=m(y()),u=f(()=>{const t=[{value:"none",id:"Select a job type..."}];if(e.value?.supportedJobKinds)for(const d of Object.values(e.value.supportedJobKinds))t.push({value:d.id,id:d.spec.jobTitle});return t}),o=w(null);function k(t){o.value=e.value.supportedJobKinds.find(d=>d.id===t)}const{showSuccessNotification:c}=S();async function _(){const t=(await r.post("/maintenanceJobs",{jobKindId:o.value.id})).data;c(`New job '${t.spec.jobTitle}' enqueued.`),i()}const p=w(!1);async function h(){await r.post("databaseScanJobs/setGlobalPause",{isPaused:p.value}),c(`All scan jobs ${p.value?"paused":"resumed"}.`),i()}const C=f(()=>{const t=[];return b.value?.globalPauseIsEnabled===!0&&t.push({title:"All Scan Jobs Paused",message:"All database scan jobs are currently paused. You can resume them by clicking the Resume Jobs button.",variant:"warning",dataTest:"all-jobs-paused-alert"}),t}),g={gameServerApi:r,allMainentenanceJobTypesData:e,allScanJobsData:b,allScanJobsError:J,allScanJobsRefresh:i,jobKindOptions:u,selectedJobKind:o,selectJobKind:k,showSuccessNotification:c,onNewScanJobOk:_,willPauseAllJobs:p,onPauseAllJobsOk:h,alerts:C,computed:f,ref:w,get useGameServerApi(){return v},get MActionModalButton(){return T},get MInputSwitch(){return E},get MPageOverviewCard(){return V},get MViewContainer(){return B},get useNotifications(){return S},get useSubscription(){return m},CoreUiPlacement:L,get getAllMaintenanceJobTypesSubscriptionOptions(){return A},get getAllScanJobsSubscriptionOptions(){return y}};return Object.defineProperty(g,"__isScriptSetup",{enumerable:!1,value:!0}),g}}),R={class:"tw-flex tw-justify-between"},U={key:0,class:"tw-mt-2 tw-text-xs tw-text-neutral-500"};function Y(M,a,r,e,b,J){const i=j("meta-input-select"),u=j("meta-raw-data");return P(),x(e.MViewContainer,{permission:"api.scan_jobs.view","is-loading":!e.allScanJobsData,error:e.allScanJobsError,alerts:e.alerts},{overview:l(()=>[n(e.MPageOverviewCard,{title:"Database Scan Jobs","data-testid":"scan-jobs-overview-card"},{buttons:l(()=>[n(e.MActionModalButton,{"modal-title":"Pause All Database Scan Jobs",action:e.onPauseAllJobsOk,"trigger-button-label":e.allScanJobsData?.globalPauseIsEnabled?"Resume Jobs":"Pause Jobs","ok-button-label":"Apply","ok-button-disabled-tooltip":e.willPauseAllJobs===e.allScanJobsData?.globalPauseIsEnabled?`Toggle the switch to ${e.allScanJobsData?.globalPauseIsEnabled?"resume":"pause"} the scan jobs.`:void 0,variant:"warning",permission:"api.scan_jobs.manage",onShow:a[1]||(a[1]=o=>e.willPauseAllJobs=e.allScanJobsData?.globalPauseIsEnabled),"data-testid":"pause-all-jobs"},{default:l(()=>[s("div",R,[a[3]||(a[3]=s("span",{class:"tw-font-semibold"},"Scan Jobs Paused",-1)),n(e.MInputSwitch,{class:"tw-relative tw-top-1 tw-mr-2","model-value":e.willPauseAllJobs,name:"pauseAllScanJobs",size:"small","onUpdate:modelValue":a[0]||(a[0]=o=>e.willPauseAllJobs=o),"data-testid":"pause-jobs-toggle"},null,8,["model-value"])]),a[4]||(a[4]=s("p",{class:"tw-my-2"},"You can pause the execution of all database scan jobs. This can be helpful to debug the performance of slow-running jobs.",-1))],void 0,!0),_:1},8,["trigger-button-label","ok-button-disabled-tooltip"]),n(e.MActionModalButton,{"modal-title":"Create a New Maintenance Scan Job",action:e.onNewScanJobOk,"trigger-button-label":"Create Job","ok-button-label":"Create Job","ok-button-disabled-tootlip":e.selectedJobKind?void 0:"Select a job type to proceed.",variant:"primary",permission:"api.scan_jobs.manage",onShow:a[2]||(a[2]=o=>e.selectedJobKind=null),"data-testid":"new-scan-job"},{default:l(()=>[a[5]||(a[5]=s("p",null,"Database maintenance jobs handle routine operations such as deleting players. They are safe to use in production, but it is still a good idea to try them once is staging to verify that the various jobs do what you expect them to to!",-1)),a[6]||(a[6]=s("div",{class:"tw-font-semibold"},"Scan Job Type",-1)),n(i,{value:e.selectedJobKind?.id??"none",options:e.jobKindOptions,variant:e.selectedJobKind?"success":"default",onInput:e.selectJobKind,"data-testid":"job-kind-select"},null,8,["value","options","variant"]),e.selectedJobKind?(P(),O("div",U,D(e.selectedJobKind.spec.jobDescription),1)):I("",!0)],void 0,!0),_:1},8,["ok-button-disabled-tootlip"])]),default:l(()=>[a[7]||(a[7]=s("p",null,"Scan jobs are slow-running workers that crawl the database and perform operations on its data.",-1)),a[8]||(a[8]=s("div",{class:"tw-text-xs+ tw-text-neutral-500"},"You can create your own scan jobs and tune the performance of the job runners to perform complicated operations on live games for hundreds of millions of players.",-1))],void 0,!0),_:1})]),default:l(()=>[n(e.CoreUiPlacement,{"placement-id":"ScanJobs/List"}),n(u,{kvPair:e.allScanJobsData,name:"scanJobs"},null,8,["kvPair"])],void 0,!0),_:1},8,["is-loading","error","alerts"])}const ee=N(G,[["render",Y],["__file","ScanJobsListView.vue"]]);export{ee as default};
