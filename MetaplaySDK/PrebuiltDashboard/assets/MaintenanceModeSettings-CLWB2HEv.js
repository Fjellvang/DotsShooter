import{d as L,x as B,a3 as E,f as S,N as v,c as M,ad as _,M as R,ac as z,ae as T,b as A,o as a,e as p,w as r,a as s,n as u,p as o,k as d,t as w,F as C,r as N,l as W,_ as q}from"./index-B7jvAjdE.js";import{M as H}from"./MActionModalButton-CvWVuTB-.js";import{M as J}from"./MInputDateTime-DL6Zd7-d.js";import{M as K}from"./MInputNumber-BOzPEn49.js";import{M as Q}from"./MInputSwitch-C-Z-JJsG.js";import{M as X}from"./MInputMultiSelectCheckbox-D_9f7ub1.js";import"./MActionModal-coQLkvWs.js";import"./index-fVjXqxSF.js";import"./MInputHintMessage-DbuBS4Kn.js";import"./index-DZuvHjnn.js";import"./index-B_QkKjtG.js";import"./MInputCheckbox-BqateWtE.js";const Y=L({__name:"MaintenanceModeSettings",props:{platforms:{default:()=>["iOS","Android","WebGL","UnityEditor"]}},setup(h,{expose:t}){t();const f=h,e=_(),{data:i,refresh:D,error:c}=B(E()),m=S(!1),n=S(v.now()),b=S(),g=S(null),O=M(()=>f.platforms.filter(l=>!i.value.maintenanceStatus.scheduledMaintenanceMode.platformExclusions.includes(l))),V=M(()=>{if(!m.value&&!(i.value.maintenanceStatus.isInMaintenance||i.value.maintenanceStatus.scheduledMaintenanceMode))return"Toggle the switch to enable maintenance mode.";if(g.value?.length===0)return"Select at least one platform to enable maintenance mode."});function P(l){l&&(n.value=l)}const y=M(()=>n.value.diff(v.now()).toMillis()>=0),{showSuccessNotification:k}=T();async function U(){if(m.value){const l={StartAt:n.value.toISO(),EstimatedDurationInMinutes:b.value?b.value:0,EstimationIsValid:!!b.value,PlatformExclusions:f.platforms.filter(I=>!g.value.includes(I))};await e.put("maintenanceMode",l),y.value?k("Maintenance mode enabled."):k("Maintenance mode scheduled.")}else await e.delete("maintenanceMode"),k("Maintenance mode disabled.");D()}const j=M(()=>m.value?y.value?{text:"Schedule",icon:"calendar-alt"}:{text:"Set Immediately",icon:["far","window-close"]}:{text:"Save Settings"});function F(){b.value=i.value.maintenanceStatus.scheduledMaintenanceMode?.estimationIsValid?i.value.maintenanceStatus.scheduledMaintenanceMode?.estimatedDurationInMinutes:void 0,n.value=i.value.maintenanceStatus.scheduledMaintenanceMode?v.fromISO(i.value.maintenanceStatus.scheduledMaintenanceMode?.startAt):v.now().plus({minutes:60}),m.value=!!(i.value.maintenanceStatus.isInMaintenance||i.value.maintenanceStatus.scheduledMaintenanceMode),g.value=f.platforms.filter(l=>!i.value.maintenanceStatus.scheduledMaintenanceMode?.platformExclusions.includes(l))}const G=M(()=>i.value?i.value.maintenanceStatus.isInMaintenance?{text:"On",variant:"success"}:i.value.maintenanceStatus.scheduledMaintenanceMode?{text:"Scheduled",variant:"primary"}:{text:"Off",variant:"neutral"}:{text:"Loading",variant:"neutral"}),x={props:f,gameServerApi:e,backendStatusData:i,backendStatusTriggerRefresh:D,backendStatusError:c,maintenanceEnabled:m,maintenanceDateTime:n,maintenanceDuration:b,maintenancePlatforms:g,maintenancePlatformsOnServer:O,okButtonDisabledReason:V,onMaintenanceDateTimeChange:P,isMaintenanceDateTimeInFuture:y,showSuccessNotification:k,setMaintenance:U,okButtonDetails:j,resetModal:F,cardBadge:G,get DateTime(){return v},computed:M,ref:S,get useGameServerApi(){return _},get MActionModalButton(){return H},get MBadge(){return R},get MCard(){return z},get MInputDateTime(){return J},get MInputMultiSelectCheckbox(){return X},get MInputNumber(){return K},get MInputSwitch(){return Q},get useNotifications(){return T},get useSubscription(){return B},get getBackendStatusSubscriptionOptions(){return E}};return Object.defineProperty(x,"__isScriptSetup",{enumerable:!1,value:!0}),x}}),Z={key:0,class:"tw-mb-4"},$={key:0},ee={key:1},te={key:1},ne={key:0,class:"m-0"},ae={key:1,class:"m-0"},ie={key:2},oe={class:"tw-flex tw-justify-end"},se={class:"tw-flex tw-justify-between tw-font-semibold"},de={class:"tw-font-xs tw-mt-1 tw-text-neutral-400"},le={key:0},re={key:1},ue={key:2};function me(h,t,f,e,i,D){const c=A("meta-time"),m=A("fa-icon");return a(),p(e.MCard,{title:"Maintenance Mode","is-loading":!e.backendStatusData,error:e.backendStatusError,badge:e.cardBadge.text,"badge-variant":e.cardBadge.variant,"data-testid":"system-maintenance-mode-card"},{subtitle:r(()=>[e.backendStatusData.maintenanceStatus.isInMaintenance?(a(),s("div",Z,[u("div",null,[t[3]||(t[3]=o("Maintenance mode started ")),d(c,{date:e.backendStatusData.maintenanceStatus.scheduledMaintenanceMode.startAt},null,8,["date"]),t[4]||(t[4]=o("."))]),e.backendStatusData.maintenanceStatus.scheduledMaintenanceMode.estimationIsValid?(a(),s("div",$,"Estimated duration: "+w(e.backendStatusData.maintenanceStatus.scheduledMaintenanceMode.estimatedDurationInMinutes)+" minutes",1)):(a(),s("div",ee,[t[6]||(t[6]=o("Duration: ")),d(e.MBadge,null,{default:r(()=>t[5]||(t[5]=[o("None")]),void 0,!0),_:1})])),u("div",null,[t[7]||(t[7]=o("Affected platforms: ")),(a(!0),s(C,null,N(e.maintenancePlatformsOnServer,n=>(a(),p(e.MBadge,{class:"tw-mr-1",key:n},{default:r(()=>[o(w(n),1)],void 0,!0),_:2},1024))),128))])])):e.backendStatusData.maintenanceStatus.scheduledMaintenanceMode?(a(),s("div",te,[u("p",null,[t[8]||(t[8]=o("Maintenance mode has been scheduled to start ")),d(c,{date:e.backendStatusData.maintenanceStatus.scheduledMaintenanceMode.startAt},null,8,["date"]),t[9]||(t[9]=o(" on ")),d(c,{date:e.backendStatusData.maintenanceStatus.scheduledMaintenanceMode.startAt,showAs:"datetime"},null,8,["date"])]),e.backendStatusData.maintenanceStatus.scheduledMaintenanceMode.estimationIsValid?(a(),s("p",ne,"Estimated duration: "+w(e.backendStatusData.maintenanceStatus.scheduledMaintenanceMode.estimatedDurationInMinutes)+" minutes",1)):(a(),s("p",ae,[t[11]||(t[11]=o("Duration: ")),d(e.MBadge,null,{default:r(()=>t[10]||(t[10]=[o("Off")]),void 0,!0),_:1})])),u("p",null,[t[12]||(t[12]=o("Affected platforms: ")),(a(!0),s(C,null,N(e.maintenancePlatformsOnServer,n=>(a(),p(e.MBadge,{class:"tw-mr-1",key:n},{default:r(()=>[o(w(n),1)],void 0,!0),_:2},1024))),128))])])):(a(),s("div",ie,t[13]||(t[13]=[u("p",null,"Maintenance mode will prevent players from logging into the game. Use it to make backend downtime more graceful for players.",-1)])))]),default:r(()=>[u("div",oe,[d(e.MActionModalButton,{"modal-title":"Update Maintenance Mode Settings",action:e.setMaintenance,"trigger-button-label":"Edit Settings","ok-button-label":e.okButtonDetails.text,"ok-button-disabled-tooltip":e.okButtonDisabledReason,permission:"api.system.edit_maintenance",onShow:e.resetModal,"data-testid":"maintenance-mode"},{"ok-button-icon":r(()=>[e.okButtonDetails.icon?(a(),p(m,{key:0,class:"tw-mb-[0.05rem] tw-h-3.5 tw-w-4",icon:e.okButtonDetails.icon},null,8,["icon"])):W("",!0)]),default:r(()=>[u("div",se,[t[14]||(t[14]=o("Maintenance Mode Enabled")),d(e.MInputSwitch,{class:"tw-relative tw-top-1 tw-mr-1","model-value":e.maintenanceEnabled,name:"maintenanceModeEnabled",size:"small","onUpdate:modelValue":t[0]||(t[0]=n=>e.maintenanceEnabled=n),"data-testid":"maintenance-enabled"},null,8,["model-value"])]),d(e.MInputDateTime,{"model-value":e.maintenanceDateTime,disabled:!e.maintenanceEnabled,"min-date-time":"utcNow",label:"Start Time (UTC)","onUpdate:modelValue":e.onMaintenanceDateTimeChange},null,8,["model-value","disabled"]),u("p",de,[!e.isMaintenanceDateTimeInFuture&&e.maintenanceEnabled?(a(),s("span",le,"Maintenance mode will start immediately.")):e.maintenanceEnabled?(a(),s("span",re,[t[15]||(t[15]=o("Maintenance mode will start ")),d(c,{date:e.maintenanceDateTime},null,8,["date"]),t[16]||(t[16]=o("."))])):(a(),s("span",ue,"Maintenance mode off."))]),d(e.MInputMultiSelectCheckbox,{class:"tw-mb-4","model-value":e.maintenancePlatforms,options:e.props.platforms.map(n=>({label:n,value:n})),label:"Platforms",disabled:!e.maintenanceEnabled,"hint-message":"Maintenance mode will only affect the selected platforms.","onUpdate:modelValue":t[1]||(t[1]=n=>e.maintenancePlatforms=n)},null,8,["model-value","options","disabled"]),d(e.MInputNumber,{label:"Estimated Duration","model-value":e.maintenanceDuration,disabled:!e.maintenanceEnabled,variant:e.maintenanceEnabled&&e.maintenanceDuration&&e.maintenanceDuration>0?"success":"default","hint-message":"This is just a number you can display on the client to the players. Maintenance mode will not turn off automatically based on duration.",min:0,"onUpdate:modelValue":t[2]||(t[2]=n=>e.maintenanceDuration=n)},null,8,["model-value","disabled","variant"])],void 0,!0),_:1},8,["ok-button-label","ok-button-disabled-tooltip"])])],void 0,!0),_:1},8,["is-loading","error","badge","badge-variant"])}const Ie=q(Y,[["render",me],["__file","MaintenanceModeSettings.vue"]]);export{Ie as default};
