import{d as E,z as C,x as D,f as M,c as y,cI as h,ad as _,M as G,s as H,v as q,ac as z,a0 as J,ae as B,b as O,o as a,a as n,k as i,w as r,n as u,e as v,F as A,r as S,t as d,p as l,b5 as K,b6 as Q,l as T,_ as U}from"./index-B7jvAjdE.js";import{M as X}from"./MActionModalButton-CvWVuTB-.js";import{p as k}from"./utils-Dwlepb3M.js";import{a as I}from"./players-CydHenLG.js";import{O as Y}from"./OverviewList-9VTc2d9x.js";import"./MActionModal-coQLkvWs.js";import"./index-fVjXqxSF.js";import"./MetaCountryCode-OZPd0ilg.js";import"./MetaTime-D0iYB_lr.js";import"./MetaLanguageLabel-CAF0iIvu.js";const Z=E({__name:"PlayerActionReconnectAccounts",props:{playerId:{}},setup(P,{expose:t}){t();const w=P,e=C(),{data:f,refresh:b}=D(I(w.playerId)),c=M(),s=M(),o=y(()=>!!s.value?.model),R=y(()=>!(!o.value||Object.keys(s.value?.model.attachedAuthMethods).length===0)),N=y(()=>s.value?.model?k(s.value.model.attachedAuthMethods,s.value.model.deviceHistory):[]),V=y(()=>k(f.value.model.attachedAuthMethods,f.value.model.deviceHistory));function F(){c.value=void 0,s.value=void 0}let m=h.CancelToken.source();async function j(p){c.value=p,s.value=null;try{m&&m.cancel("Request cancelled by user interaction."),m=h.CancelToken.source();const g=(await _().get(`/players/${p.id}`,{cancelToken:m.token})).data;g&&(s.value=g)}catch(g){h.isCancel(g)}}const{showSuccessNotification:x}=B();async function W(){if(c.value&&s.value)await _().post(`/players/${c.value.id}/moveAuthTo/${f.value.id}`),x(`Login methods from '${c.value.id}' moved to the current player.`),b();else throw new Error('Trying to trigger "moveAuth" without a source player!')}const L={props:w,coreStore:e,playerData:f,playerRefresh:b,selectedPlayer:c,selectedPlayerData:s,isSourcePlayerFetched:o,isFormValid:R,sourceAuthMethods:N,targetAuthMethods:V,resetModal:F,get cancelTokenSource(){return m},set cancelTokenSource(p){m=p},updateSourcePlayer:j,showSuccessNotification:x,moveAuth:W,get axios(){return h},computed:y,ref:M,get useGameServerApi(){return _},get parseAuthMethods(){return k},get MBadge(){return G},get MList(){return H},get MListItem(){return q},get MActionModalButton(){return X},get MCard(){return z},get MCallout(){return J},get useNotifications(){return B},get useSubscription(){return D},get useCoreStore(){return C},get getSinglePlayerSubscriptionOptions(){return I},OverviewList:Y};return Object.defineProperty(L,"__isScriptSetup",{enumerable:!1,value:!0}),L}}),$={key:0},ee={key:0},te={key:0,class:"font-weight-bold text-danger"},oe={key:1,class:"font-weight-bold text-danger"},ae={class:"text-truncate"},re={key:1,class:"tw-mt-2 tw-italic tw-text-neutral-500"},ne={key:1},se={class:"tw-mb-1 tw-mt-1"},ie={key:0,class:"font-weight-bold"},le={key:1,class:"font-weight-bold"},de={class:"text-truncate"},ce={key:0,class:"font-weight-bold text-success"},ue={key:1,class:"font-weight-bold text-success"},me={class:"text-truncate"},ve={key:1,class:"tw-mt-2 tw-italic tw-text-neutral-500"};function fe(P,t,w,e,f,b){const c=O("meta-input-player-select"),s=O("meta-no-seatbelts");return e.playerData?(a(),n("div",$,[i(e.MActionModalButton,{"modal-title":"Move Devices from Another Account",action:e.moveAuth,"trigger-button-label":"Reconnect Devices",variant:"warning","ok-button-label":"Reconnect Devices","ok-button-disabled-tooltip":e.isFormValid?void 0:"Select a valid player account to proceed.",permission:"api.players.reconnect_account",onShow:e.resetModal,"data-testid":"action-merge-accounts"},{default:r(()=>[t[3]||(t[3]=u("h6",{class:"tw-mb-1 tw-font-semibold"},"Move Devices & Social Auths from this account..",-1)),i(c,{value:e.selectedPlayer,ignorePlayerIds:[e.playerData.id],onInput:e.updateSourcePlayer},null,8,["value","ignorePlayerIds"]),i(e.MCard,{class:"tw-mt-3",title:"Source Account Preview"},{default:r(()=>[e.selectedPlayerData?.model?(a(),n("div",ee,[i(e.OverviewList,{class:"tw-mb-4",listTitle:"Overview",icon:"chart-bar",sourceObject:e.selectedPlayerData,items:e.coreStore.overviewLists.playerReconnectPreview},null,8,["sourceObject","items"]),t[2]||(t[2]=u("span",{class:"font-weight-bold"},"Login Methods",-1)),e.sourceAuthMethods&&e.sourceAuthMethods.length>0?(a(),v(e.MList,{key:0},{default:r(()=>[(a(!0),n(A,null,S(e.sourceAuthMethods,o=>(a(),v(e.MListItem,{class:"tw-pb-0 tw-pl-0",key:o.id},{"bottom-left":r(()=>[u("p",ae,d(o.id),1)]),default:r(()=>[o.type==="device"?(a(),n("span",te,[l("ðŸ“± "+d(o.displayString)+" ",1),i(e.MBadge,{variant:"danger"},{default:r(()=>t[0]||(t[0]=[l("Will be removed")]),void 0,!0),_:1})])):(a(),n("span",oe,[l("ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦ "+d(o.displayString)+" ",1),i(e.MBadge,{variant:"danger"},{default:r(()=>t[1]||(t[1]=[l("Will be removed")]),void 0,!0),_:1})]))],void 0,!0),_:2},1024))),128))],void 0,!0),_:1})):(a(),n("p",re,"This account has no credentials attached."))])):(a(),n("div",ne,"Type in a valid player ID to preview what device reconnecting would do."))],void 0,!0),_:1})]),"right-panel":r(()=>[t[9]||(t[9]=u("span",{class:"tw-mb-1 tw-font-semibold"},"...to the current account",-1)),u("p",se,d(e.playerData.id),1),i(e.MCard,{class:"tw-mt-6",title:"Current Account Preview"},{default:r(()=>[i(e.OverviewList,{class:"tw-mb-4",listTitle:"Overview",icon:"chart-bar",sourceObject:e.playerData,items:e.coreStore.overviewLists.playerReconnectPreview},null,8,["sourceObject","items"]),t[8]||(t[8]=u("span",{class:"font-weight-bold"},"Login Methods",-1)),e.targetAuthMethods&&e.targetAuthMethods.length>0?(a(),v(e.MList,{key:0},{default:r(()=>[(a(!0),n(A,null,S(e.targetAuthMethods,o=>(a(),v(e.MListItem,{class:"tw-pb-0 tw-pl-0",key:o.id},{"bottom-left":r(()=>[u("p",de,d(o.id),1)]),default:r(()=>[o.type==="device"?(a(),n("span",ie,[l("ðŸ“± "+d(o.displayString)+" ",1),K(i(e.MBadge,null,{default:r(()=>t[4]||(t[4]=[l("Will remain")]),void 0,!0),_:1},512),[[Q,e.isFormValid]])])):(a(),n("span",le,[l("ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦ "+d(o.displayString)+" ",1),i(e.MBadge,null,{default:r(()=>t[5]||(t[5]=[l("Will remain")]),void 0,!0),_:1})]))],void 0,!0),_:2},1024))),128)),(a(!0),n(A,null,S(e.sourceAuthMethods,o=>(a(),v(e.MListItem,{class:"tw-pb-0 tw-pl-0",key:o.id},{"bottom-left":r(()=>[u("p",me,d(o.id),1)]),default:r(()=>[o.type==="device"?(a(),n("span",ce,[l("ðŸ“± "+d(o.displayString)+" ",1),i(e.MBadge,{variant:"success"},{default:r(()=>t[6]||(t[6]=[l("Will be added")]),void 0,!0),_:1})])):(a(),n("span",ue,[l("ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦ "+d(o.displayString)+" ",1),i(e.MBadge,{variant:"success"},{default:r(()=>t[7]||(t[7]=[l("Will be added")]),void 0,!0),_:1})]))],void 0,!0),_:2},1024))),128))],void 0,!0),_:1})):(a(),n("p",ve,"This account has no credentials attached."))],void 0,!0),_:1})]),"bottom-panel":r(()=>[e.isFormValid?(a(),v(s,{key:0,class:"tw-mx-auto tw-w-7/12",name:e.selectedPlayerData.model.playerName||"n/a"},null,8,["name"])):T("",!0)]),_:1},8,["ok-button-disabled-tooltip"])])):T("",!0)}const ke=U(Z,[["render",fe],["__file","PlayerActionReconnectAccounts.vue"]]);export{ke as default};
