import{d as H,a6 as M,f as T,N as k,h as y,bf as O,c as s,bi as h,ck as L,ad as S,ac as R,ae as D,b as E,o as p,e as V,w as l,p as r,k as f,n as i,t as m,a as b,l as Y,_ as j}from"./index-B7jvAjdE.js";import{M as P}from"./MActionModalButton-CvWVuTB-.js";import{M as q}from"./MInputDurationOrEndDateTime-CP-rRAVP.js";import z from"./MetaNoSeatbelts-DAInMY6Y.js";import"./MActionModal-coQLkvWs.js";import"./index-fVjXqxSF.js";import"./MInputDateTime-DL6Zd7-d.js";import"./MInputHintMessage-DbuBS4Kn.js";import"./MInputSwitch-C-Z-JJsG.js";import"./index-B_QkKjtG.js";import"./index-DZuvHjnn.js";import"./MInputDuration-C704TlZG.js";import"./MInputNumber-BOzPEn49.js";const J=H({__name:"TimeSkipCard",setup(C,{expose:e}){e();const c=M(),t=S(),{gameTimeOffset:n,hasGameTimeOffset:v}=h(),{showSuccessNotification:u}=D(),a=T(g());function g(){return k.fromMillis(Date.now()).startOf("minute")}y(()=>{const o=setInterval(()=>{a.value=g()},3e3);O(()=>{clearInterval(o)})});const x=s(()=>{const o=a.value.offset?a.value.offset/60:0;return Intl.NumberFormat(void 0,{signDisplay:"always"}).format(o)}),_=s(()=>a.value.toUTC().toFormat("yyyy-MM-dd HH:mm")),I=s(()=>a.value.toFormat("yyyy-MM-dd HH:mm")),N=s(()=>{const o=n.value;return a.value.plus(o).toUTC().toFormat("yyyy-MM-dd HH:mm")}),U=s(()=>{const o=n.value;return a.value.plus(o).toFormat("yyyy-MM-dd HH:mm")}),d=T(n.value);function G(){d.value=n.value}async function A(){const o={offsetMilliseconds:d.value.toMillis()};await t.put("/gameTimeOffset",o),u("Time skip updated.")}const B=s(()=>{const o=d.value.toMillis()-n.value.toMillis();return o<0?"The time skip can only be increased; it cannot go backwards from its current value.":o===0&&n.value.toMillis()===0?"Enter a time skip value.":d.value.toMillis()===n.value.toMillis()?"Enter a new time skip value.":void 0}),F=s(()=>v.value?{text:"Active",variant:"danger"}:c.featureFlags.gameTimeSkip?{text:"Off",variant:"neutral"}:{text:"Disabled",variant:"neutral"}),w={staticInfos:c,gameServerApi:t,gameTimeOffset:n,hasGameTimeOffset:v,showSuccessNotification:u,realNowLocal:a,getRealLocalDateTime:g,localUtcOffset:x,currentRealTimeUtc:_,currentRealTimeLocal:I,currentGameTimeUtc:N,currentGameTimeLocal:U,offsetInput:d,resetModal:G,submitGameTimeOffset:A,offsetDisabledReason:B,cardBadge:F,get DateTime(){return k},get Duration(){return L},computed:s,onMounted:y,onUnmounted:O,ref:T,get useGameServerApi(){return S},get useStaticInfos(){return M},get MetaNoSeatbelts(){return z},get MActionModalButton(){return P},get MCard(){return R},get MInputDurationOrEndDateTime(){return q},get useGameTimeOffset(){return h},get useNotifications(){return D}};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}}),K={key:0},Q={class:"tw-mt-1 tw-rounded-md tw-border tw-border-neutral-300 tw-p-2"},W={key:0},X={class:"tw-mt-2"},Z={class:"tw-mt-1 tw-rounded-md tw-border tw-border-neutral-300 tw-p-2"},$={key:1,class:"tw-mt-2"},ee={class:"tw-mt-4"};function te(C,e,c,t,n,v){const u=E("meta-duration");return p(),V(t.MCard,{title:"Time Skip",badge:t.cardBadge.text,"badge-variant":t.cardBadge.variant,"data-testid":"system-game-time-settings-card"},{subtitle:l(()=>e[1]||(e[1]=[r("Set the game server's time to a future date to test complex LiveOps setups.")])),buttons:l(()=>[f(t.MActionModalButton,{"modal-title":"Change Game Server Time Skip",action:t.submitGameTimeOffset,"trigger-button-label":"Open Time Skip Menu","trigger-button-disabled-tooltip":t.staticInfos.featureFlags.gameTimeSkip?void 0:"Time skipping is disabled in this environment.","ok-button-label":"Apply Time Skip","ok-button-disabled-tooltip":t.offsetDisabledReason,permission:"api.game_time_offset.edit",variant:"danger",onShow:t.resetModal},{default:l(()=>[e[5]||(e[5]=i("p",null,"Time skipping is a way to set the game server's time to a future date. The game server time is directly set to the time you specify without simulating all the ticks in between.",-1)),e[6]||(e[6]=i("p",{class:"tw-mt-2 tw-text-sm tw-text-neutral-400"},"Time skipping is a useful tool for testing how the game would feel like at a future date. For example, you might want to test how the game server behaves when a certain scheduled event happens in the future.",-1)),f(t.MetaNoSeatbelts,{class:"tw-mx-auto tw-mt-4 tw-max-w-xl"},{default:l(()=>e[4]||(e[4]=[r("Time skipping only goes one way. You will be able to skip further into the future, but can never time travel backwards. You will have to reset your database to disable time skipping.")]),void 0,!0),_:1})]),"right-panel":l(()=>[e[11]||(e[11]=i("div",null,[r("Current "),i("span",{class:"tw-font-bold"},"real"),r(" time is:")],-1)),i("div",Q,[i("div",null,"UTC: "+m(t.currentRealTimeUtc),1),i("div",null,"UTC"+m(t.localUtcOffset)+": "+m(t.currentRealTimeLocal),1)]),t.hasGameTimeOffset?(p(),b("div",W,[i("div",X,[e[7]||(e[7]=r("Current ")),e[8]||(e[8]=i("span",{class:"tw-font-bold"},"game server",-1)),e[9]||(e[9]=r(" time is ")),f(u,{class:"tw-font-bold",duration:t.gameTimeOffset,showAs:"exactDuration",disableTooltip:""},null,8,["duration"]),e[10]||(e[10]=r(" ahead of real time:"))]),i("div",Z,[i("div",null,"UTC: "+m(t.currentGameTimeUtc),1),i("div",null,"UTC"+m(t.localUtcOffset)+": "+m(t.currentGameTimeLocal),1)])])):(p(),b("div",$,"No time skip has been applied yet.")),i("div",ee,[f(t.MInputDurationOrEndDateTime,{"model-value":t.offsetInput,"reference-date-time":t.realNowLocal,"input-mode":"endDateTime","duration-title":"Offset From Real Time","dateTime-title":"Target Time","onUpdate:modelValue":e[0]||(e[0]=a=>t.offsetInput=a)},{"duration-hint-message":l(a=>[r("The skipped time will be "+m(a.dateTime)+".",1)]),"end-time-hint-message":l(a=>[r("The skipped time will be "+m(a.duration)+" ahead of real time.",1)]),_:1},8,["model-value","reference-date-time"])])]),_:1},8,["trigger-button-disabled-tooltip","ok-button-disabled-tooltip"])]),default:l(()=>[t.hasGameTimeOffset?(p(),b("p",K,[e[2]||(e[2]=r("Current game server time is ")),f(u,{duration:t.gameTimeOffset,showAs:"exactDuration",disableTooltip:""},null,8,["duration"]),e[3]||(e[3]=r(" ahead of real time."))])):Y("",!0)],void 0,!0),_:1},8,["badge","badge-variant"])}const ve=j(J,[["render",te],["__file","TimeSkipCard.vue"]]);export{ve as default};
