import{d as C,x as _,f as L,c as h,a9 as r,ci as a,ad as y,ac as T,ae as k,e0 as A,b as N,o as d,e as B,w as f,a as p,p as P,t as g,l as I,n as l,k as b,_ as U}from"./index-B7jvAjdE.js";import{M as V}from"./MActionModalButton-CvWVuTB-.js";import{M as D}from"./MInputSwitch-C-Z-JJsG.js";import{g as M}from"./localization-Z8p1s5Vr.js";import"./MActionModal-coQLkvWs.js";import"./index-fVjXqxSF.js";import"./index-B_QkKjtG.js";const O=C({__name:"RemoveArchivedLocalizations",setup(R,{expose:t}){t();const{data:s,refresh:e}=_(M()),c=y(),u=L(!1);function m(){u.value=!1}const{showSuccessNotification:n,showErrorNotification:v}=k();async function x(){const o=await c.delete("localization/deleteArchived");let i;do await A(1e3),i=(await c.get("backgroundTasks?taskId="+o.data)).data;while(i!=null&&!i.completed);i!=null?i.failure===void 0||i.failure==null?n(w.value.removed):(console.error(i.failure),v("Failed to remove archived localizations, see logs for more information.")):v("We lost track of the archived localization removal, likely due to the server restarting."),e()}const z=h(()=>{if(s.value)return s.value.reduce((o,i)=>i.isArchived?o+1:o,0)}),w=h(()=>{const o=z.value??0;return{subtitle:`You have ${r(o,"archived localization",!0)} that ${a(o,"is","are")} not being used.`,prune:`You can prune ${a(o,"it","them")} here to keep your server running smoothly.`,modalDescription:`You currently have ${r(o,"archived localization",!0)}. ${a(o,"This localization is","These localizations are")} not being used and can be safely removed. Removing ${a(o,"this localization","these localizations")} will improve your server performance.`,noSeatbelts:`Removing ${a(o,"this","these")} ${r(o,"archived localization",!0)} from the server is permanent - ${a(o,"it","they")} can not be recovered.`,removed:`Removed ${r(o,"archived localization",!0)}.`}}),S={allLocalizationsData:s,allLocalizationsTriggerRefresh:e,gameServerApi:c,confirmRemoval:u,onShow:m,showSuccessNotification:n,showErrorNotification:v,removeArchived:x,archivedLocalizationCount:z,archivedLocalizationUiTexts:w,computed:h,ref:L,get useGameServerApi(){return y},get MActionModalButton(){return V},get MCard(){return T},get MInputSwitch(){return D},get useNotifications(){return k},get maybePluralPrefixString(){return a},get maybePluralString(){return r},get useSubscription(){return _},get sleep(){return A},get getAllLocalizationsSubscriptionOptions(){return M}};return Object.defineProperty(S,"__isScriptSetup",{enumerable:!1,value:!0}),S}}),Y={key:0},j={key:1},E={key:0,class:"tw-ml-1"},G={class:"tw-flex tw-justify-end"},F={class:"tw-flex tw-justify-between"};function W(R,t,s,e,c,u){const m=N("MetaNoSeatbelts");return d(),B(e.MCard,{title:"Remove Archived Localizations","is-loading":e.archivedLocalizationCount===void 0},{subtitle:f(()=>[e.archivedLocalizationCount===0?(d(),p("p",Y,"You have no archived localizations to remove.")):(d(),p("p",j,[P(g(e.archivedLocalizationUiTexts.subtitle),1),e.archivedLocalizationCount&&e.archivedLocalizationCount>0?(d(),p("span",E,g(e.archivedLocalizationUiTexts.prune),1)):I("",!0)]))]),default:f(()=>[l("div",G,[b(e.MActionModalButton,{"modal-title":"Remove Archived Localizations",action:e.removeArchived,"trigger-button-label":"Open Removal Menu","trigger-button-disabled-tooltip":e.archivedLocalizationCount===0?"There are no archived localizations to remove.":void 0,"ok-button-label":"Remove","ok-button-disabled-tooltip":e.confirmRemoval?void 0:"Toggle the confirmation switch to enable.",permission:"api.localization.delete",onShow:t[1]||(t[1]=n=>e.onShow())},{default:f(()=>[l("p",null,g(e.archivedLocalizationUiTexts.modalDescription),1),t[3]||(t[3]=l("h6",{class:"tw-mt-4"},"Confirm",-1)),l("div",F,[t[2]||(t[2]=l("span",null,"I know what I am doing",-1)),b(e.MInputSwitch,{"model-value":e.confirmRemoval,name:"confirmRemoval",size:"small","onUpdate:modelValue":t[0]||(t[0]=n=>e.confirmRemoval=n)},null,8,["model-value"])]),b(m,{class:"tw-mt-4",message:e.archivedLocalizationUiTexts.noSeatbelts},null,8,["message"])]),_:1},8,["trigger-button-disabled-tooltip","ok-button-disabled-tooltip"])])],void 0,!0),_:1},8,["is-loading"])}const $=U(O,[["render",W],["__file","RemoveArchivedLocalizations.vue"]]);export{$ as default};
