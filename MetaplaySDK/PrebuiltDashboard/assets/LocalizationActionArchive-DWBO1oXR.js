import{d as I,f,x as S,c as A,ad as y,M as B,bN as V,O as x,ae as C,a9 as W,b as O,o,a as d,e as b,w as u,n as e,p as r,t as v,k as z,l as H,F as N,$ as P,_ as U}from"./index-B7jvAjdE.js";import{M as T}from"./MActionModal-coQLkvWs.js";import{M as j}from"./MInputSwitch-C-Z-JJsG.js";import{g as k}from"./localization-Z8p1s5Vr.js";const D=I({__name:"LocalizationActionArchive",props:{localizationId:{},triggerStyle:{}},setup(p,{expose:t}){t();const s=y(),i=p,g=f(!1),w=f(),{data:n,refresh:c}=S(k()),L=A(()=>{if(n.value)return n.value.find(l=>l.id===i.localizationId)}),h=A(()=>{const l=n.value?.find(a=>a.id===i.localizationId);return l?(n.value??[]).filter(a=>!a.isArchived&&!(a.publishedAt!==null||a.unpublishedAt!==null||a.isActive)&&a.buildStartedAt<l.buildStartedAt).map(a=>a.id):[]}),{showSuccessNotification:m}=C();async function _(){const l={isArchived:!L.value?.isArchived};await s.post(`/localization/${i.localizationId}`,l),g.value&&h.value.length>0?(await s.post("/localization/archive",h.value),m(`Archived ${h.value.length+1} localizations.`)):m(`Localization ${l.isArchived?"archived":"unarchived"}.`),c()}const M={gameServerApi:s,props:i,archiveOlderLocalizationsState:g,localizationArchiveModal:w,allLocalizationsData:n,allLocalizationsRefresh:c,singleLocalizationWithoutContents:L,archivableLocalizationIds:h,showSuccessNotification:m,onOk:_,computed:A,ref:f,get useGameServerApi(){return y},get MActionModal(){return T},get MBadge(){return B},get MIconButton(){return V},get MInputSwitch(){return j},get MButton(){return x},get useNotifications(){return C},get maybePluralString(){return W},get useSubscription(){return S},get getAllLocalizationsSubscriptionOptions(){return k}};return Object.defineProperty(M,"__isScriptSetup",{enumerable:!1,value:!0}),M}}),F={key:1,class:"tw-inline-flex tw-h-4 tw-w-5",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 640 512"},G={key:0},Y={key:1},E={key:2,class:P(["tw-mt-4 tw-border tw-rounded-md tw-py-2 tw-px-3 tw-border-neutral-200 tw-bg-neutral-100 tw-text-neutral-600"])},R={class:"tw-flex tw-justify-between"},q={class:"tw-font-semibold"},J={class:"small text-muted"};function K(p,t,s,i,g,w){const n=O("fa-icon");return o(),d(N,null,[s.triggerStyle=="icon"?(o(),b(i.MIconButton,{key:0,permission:"api.localization.edit","aria-label":i.singleLocalizationWithoutContents?.isArchived?"Unarchive this localization":"Archive this localization.","disabled-tooltip":i.singleLocalizationWithoutContents?.isActive?"Cannot archive the active localization.":void 0,onClick:t[0]||(t[0]=c=>i.localizationArchiveModal?.open()),"data-testid":"`archive-localization-${localizationId}`"},{default:u(()=>[i.singleLocalizationWithoutContents?.isArchived?(o(),d("svg",F,t[3]||(t[3]=[e("path",{d:"M256 48c0-26.5 21.5-48 48-48H592c26.5 0 48 21.5 48 48V464c0 26.5-21.5 48-48 48H381.3c1.8-5 2.7-10.4 2.7-16V253.3c18.6-6.6 32-24.4 32-45.3V176c0-26.5-21.5-48-48-48H256V48zM571.3 347.3c6.2-6.2 6.2-16.4 0-22.6l-64-64c-6.2-6.2-16.4-6.2-22.6 0l-64 64c-6.2 6.2-6.2 16.4 0 22.6s16.4 6.2 22.6 0L480 310.6V432c0 8.8 7.2 16 16 16s16-7.2 16-16V310.6l36.7 36.7c6.2 6.2 16.4 6.2 22.6 0zM0 176c0-8.8 7.2-16 16-16H368c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H16c-8.8 0-16-7.2-16-16V176zm352 80V480c0 17.7-14.3 32-32 32H64c-17.7 0-32-14.3-32-32V256H352zM144 320c-8.8 0-16 7.2-16 16s7.2 16 16 16h96c8.8 0 16-7.2 16-16s-7.2-16-16-16H144z"},null,-1)]))):(o(),b(n,{key:0,class:"tw-relative -tw-bottom-[3px] tw-h-4 tw-w-4",icon:"box-archive"}))],void 0,!0),_:1},8,["aria-label","disabled-tooltip"])):(o(),b(i.MButton,{key:1,permission:"api.localization.edit","disabled-tooltip":i.singleLocalizationWithoutContents?.isActive?"Cannot archive the active localization.":void 0,onClick:t[1]||(t[1]=c=>i.localizationArchiveModal?.open())},{default:u(()=>[r(v(i.singleLocalizationWithoutContents?.isArchived?"Unarchive":"Archive"),1)],void 0,!0),_:1},8,["disabled-tooltip"])),z(i.MActionModal,{ref:"localizationArchiveModal",title:i.singleLocalizationWithoutContents?.isArchived?"Unarchive Localization":"Archive Localization",action:i.onOk,"ok-button-label":i.singleLocalizationWithoutContents?.isArchived?"Unarchive":"Archive","data-testid":"`archive-localization-${localizationId}`"},{default:u(()=>[i.singleLocalizationWithoutContents?.isArchived?(o(),d("div",Y,[e("span",null,[t[7]||(t[7]=r("You are about to unarchive the localization ")),z(i.MBadge,null,{default:u(()=>[r(v(i.singleLocalizationWithoutContents?.name),1)],void 0,!0),_:1}),t[8]||(t[8]=r(". "))]),t[9]||(t[9]=e("span",null,"This will make the localization visible in the list of available localizations again.",-1))])):(o(),d("div",G,[e("span",null,[t[4]||(t[4]=r("You are about to archive the localization ")),z(i.MBadge,null,{default:u(()=>[r(v(i.singleLocalizationWithoutContents?.name),1)],void 0,!0),_:1}),t[5]||(t[5]=r(". "))]),t[6]||(t[6]=e("span",null,"Archiving a localization will hide it from the list of available localizations. An archived localization can be unarchived at any time.",-1))])),!i.singleLocalizationWithoutContents?.isArchived&&i.archivableLocalizationIds?.length>0?(o(),d("div",E,[e("div",R,[e("div",q,"Also archive "+v(i.maybePluralString(i.archivableLocalizationIds?.length,"older localization")),1),z(i.MInputSwitch,{"model-value":i.archiveOlderLocalizationsState,name:"archiveAllOlderState",size:"small","onUpdate:modelValue":t[2]||(t[2]=c=>i.archiveOlderLocalizationsState=c),"data-testid":"localization-archive-all-older-toggle"},null,8,["model-value"])]),e("div",J,"At the same time as archiving this localization, you can also automatically archive "+v(i.maybePluralString(i.archivableLocalizationIds?.length,"older, unpublished localization"))+". This is useful in keeping your localization history manageable.",1)])):H("",!0)],void 0,!0),_:1},8,["title","ok-button-label"])],64)}const ii=U(D,[["render",K],["__file","LocalizationActionArchive.vue"]]);export{ii as L};
