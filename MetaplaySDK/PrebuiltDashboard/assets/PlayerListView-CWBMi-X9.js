import{d as L,aa as C,x as S,c as h,ab as x,f as D,a0 as V,ac as R,L as F,b as s,o as n,e as c,w as a,k as r,n as w,p as g,a as k,l as m,t as T,_ as U}from"./index-B7jvAjdE.js";import{M as B}from"./MSingleColumnLayout-B4K0ZAFA.js";import{a as E}from"./MViewContainer-BTeE2xDT.js";import W from"./MetaRawData-CedjqGjJ.js";import O from"./MetaTime-D0iYB_lr.js";import{g as I}from"./players-CydHenLG.js";import"./utils-Dwlepb3M.js";const j=L({__name:"PlayerListView",setup(N,{expose:i}){i();const M=C(),{data:e,error:P}=S(I()),A=h(()=>{const l=[{key:"entityId",label:"ID"},{key:"displayName",label:"Name"},"level",{key:"createdAt",label:"Joined"}];return Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)<576?o(l,["entityId","displayName"]):l});function o(l,_){return l.filter(v=>{let b;return typeof v=="string"?b=v:b=v.key,_.includes(b)})}const d=x(),u=D();async function y(l){u.value=l,await d.push(`/players/${l.id}`)}async function p(l){await d.push(`/players/${l.entityId}`)}function f(l,_){return!l||_!=="row"?"":l.deletionStatus.startsWith("Deleted")?"text-danger table-row-link":"table-row-link"}const t={uiStore:M,allActivePlayersData:e,allActivePlayersError:P,recentlyActiveTableFields:A,filterTableFields:o,router:d,selectedPlayer:u,onPlayerSelected:y,rowClicked:p,rowClass:f,computed:h,ref:D,get useRouter(){return x},get MetaRawData(){return W},get MetaTime(){return O},get useUiStore(){return C},get MCallout(){return V},get MCard(){return R},get MSingleColumnLayout(){return B},get MTooltip(){return F},get MViewContainer(){return E},get useSubscription(){return S},get getAllActivePlayersSubscriptionOptions(){return I}};return Object.defineProperty(t,"__isScriptSetup",{enumerable:!1,value:!0}),t}}),z={class:"tw-mb-1 tw-ml-2","data-testid":"player-search"},J={key:0},q={key:0,class:"pt-5 tw-w-full tw-text-center"},G={key:1};function H(N,i,M,e,P,A){const o=s("fa-icon"),d=s("meta-input-player-select"),u=s("b-col"),y=s("b-row"),p=s("b-spinner"),f=s("b-table");return n(),c(e.MViewContainer,{"is-loading":!e.allActivePlayersData,error:e.allActivePlayersError},{default:a(()=>[r(y,{class:"justify-content-center",style:{"margin-top":"8rem","margin-bottom":"7rem"}},{default:a(()=>[r(u,{md:"10",lg:"7",xl:"5"},{default:a(()=>[w("h4",z,[r(o,{icon:"search"}),i[0]||(i[0]=g(" Find a player"))]),r(d,{value:e.selectedPlayer,onInput:e.onPlayerSelected},null,8,["value"])],void 0,!0),_:1})],void 0,!0),_:1}),e.uiStore.showDeveloperUi?(n(),k("div",J,[e.allActivePlayersData?(n(),k("div",G,[r(e.MSingleColumnLayout,null,{default:a(()=>[r(e.MCard,{title:"Recently Active Players","data-testid":"active-players-list"},{default:a(()=>[e.allActivePlayersData.length===0?(n(),c(e.MCallout,{key:0,title:"No recently active players",variant:"neutral"},{default:a(()=>i[1]||(i[1]=[g("No players have logged in since last server reboot.")]),void 0,!0),_:1})):(n(),c(f,{key:1,class:"table-fixed-column",small:"",striped:"",hover:"",responsive:"",items:e.allActivePlayersData,fields:e.recentlyActiveTableFields,"primary-key":"entityId","sort-by":"startAt","sort-desc":"","tbody-tr-class":e.rowClass,onRowClicked:e.rowClicked},{"cell(entityId)":a(t=>[t.item.deletionStatus.startsWith("Deleted")?(n(),c(e.MTooltip,{key:0,class:"tw-mr-1",content:"Player has been deleted"},{default:a(()=>i[2]||(i[2]=[g("☠️")]),void 0,!0),_:1})):m("",!0),w("span",null,T(t.item.entityId),1)]),"cell(displayName)":a(t=>[w("span",null,T(t.item.displayName),1),t.item.totalIapSpend>0?(n(),c(e.MTooltip,{key:0,class:"tw-ml-2",content:"Total IAP spend: $"+t.item.totalIapSpend.toFixed(2,2),noUnderline:""},{default:a(()=>[r(o,{class:"text-muted",icon:"money-check-alt"})],void 0,!0),_:2},1032,["content"])):m("",!0),t.item.isDeveloper?(n(),c(e.MTooltip,{key:1,class:"tw-ml-2",content:"This player is a developer.",noUnderline:""},{default:a(()=>[r(o,{class:"text-muted",icon:"user-astronaut",size:"sm"})],void 0,!0),_:1})):m("",!0)]),"cell(createdAt)":a(t=>[r(e.MetaTime,{date:t.item.createdAt},null,8,["date"])]),"cell(lastLoginAt)":a(t=>[r(e.MetaTime,{date:t.item.lastLoginAt},null,8,["date"])]),_:1},8,["items","fields"]))],void 0,!0),_:1})],void 0,!0),_:1})])):(n(),k("div",q,[r(p,{class:"mt-5",label:"Loading..."})]))])):m("",!0),r(e.MetaRawData,{kvPair:e.allActivePlayersData,name:"activePlayers"},null,8,["kvPair"])],void 0,!0),_:1},8,["is-loading","error"])}const te=U(j,[["render",H],["__file","PlayerListView.vue"]]);export{te as default};
