import{d as U,x as P,af as A,c as h,cM as S,f as k,ad as E,a8 as R,L,ae as B,b as f,o as m,e as _,w as n,k as a,n as o,p as i,t as c,a as v,_ as G}from"./index-B7jvAjdE.js";import{M as W}from"./MActionModalButton-CvWVuTB-.js";import{M as j,a as Y}from"./MViewContainer-BTeE2xDT.js";import q from"./AuditLogCard-DZ2AYrj2.js";import{M as H}from"./MetaGeneratedForm-BcVgOIy3.js";import{b as C}from"./web3-D0eBpdhj.js";import"./MActionModal-coQLkvWs.js";import"./index-fVjXqxSF.js";import"./MetaEventStreamCard-D_xDm3jw.js";import"./MInputMultiSelectCheckbox-D_9f7ub1.js";import"./MInputCheckbox-BqateWtE.js";import"./index-B_QkKjtG.js";import"./MInputHintMessage-DbuBS4Kn.js";import"./MInputSingleSelectSwitch-CuptGC6e.js";import"./index-CDBqmjrS.js";import"./MInputSimpleSelectDropdown-DIlBEFcs.js";import"./index-qTA83-by.js";import"./MInputText-CzhsT8yb.js";import"./debounce-B8gTqdZO.js";import"./isSymbol-B7ZrWRtH.js";import"./auditLogs-Cml5ZKP5.js";import"./GeneratedUiFormDynamicComponent-DrqrTIRR.js";const z=U({__name:"Web3NftDetailView",props:{collectionId:{},tokenId:{}},setup(D,{expose:e}){e();const d=E(),t=D,{data:u,error:F,refresh:g}=P(C(t.collectionId,t.tokenId));A().setDynamicTitle(u,s=>`Manage ${s.value?.name||`Unnamed ${s.value?.typeName}`||"NFT"}`);const r=h(()=>{const s=[];return S(u.value)&&(u.value.queryError?.length>0&&s.push({variant:"danger",title:"Failed to load NFT",message:`Failed to restore the persisted NFT: ${u.value.queryError}`}),u.value.hasPendingMetadataWrite===!0&&s.push({title:"Metadata write pending",message:"This NFT is currently waiting to have its metadata written to S3. If this NFT was just initialized, you should wait for the write to complete before minting the NFT."})),s}),l=k({}),M=k(!1),y=h(()=>u.value.metadataManagementMode==="Authoritative"),b=h(()=>{const s=u.value.metadataManagementMode;if(s!=="Authoritative")return`To write metadata, the collection must have metadata management mode Authoritative. This collection has mode ${s}.`}),{showSuccessNotification:N}=B();async function T(){await d.post(`nft/${t.collectionId}/${t.tokenId}/refresh`),N("NFT ledger status updated!"),g()}async function w(){await d.post(`nft/${t.collectionId}/${t.tokenId}/republishMetadata`),N("NFT metadata republished!"),g()}async function x(){await d.post(`nft/${t.collectionId}/${t.tokenId}/edit`,l.value),N("NFT game state edited!"),g()}function p(){l.value={nft:u.value.model}}function O(s,V){return s==="None"?V?"The NFT has no owning player because its owning address is not known to the game backend.":"The NFT has no owning player because it hasn't yet been minted.":"The NFT has no owning player because its owning address is not linked to any existing player account in the game."}const I={gameServerApi:d,props:t,singleNftData:u,singleNftError:F,singleNftRefresh:g,alerts:r,nftEditParams:l,nftEditParamsValid:M,canPublishMetadata:y,cannotPublishMetadataExplanation:b,showSuccessNotification:N,refreshFromLedger:T,republishMetadata:w,editNft:x,prefillNftEditParams:p,getNoOwningPlayerTooltip:O,computed:h,ref:k,get useGameServerApi(){return E},get MActionModalButton(){return W},get MPageOverviewCard(){return j},get MTextButton(){return R},get MTooltip(){return L},get MViewContainer(){return Y},get useHeaderbar(){return A},get useNotifications(){return B},get useSubscription(){return P},AuditLogCard:q,MetaGeneratedForm:H,get isNullOrUndefined(){return S},get getSingleNftSubscriptionOptions(){return C}};return Object.defineProperty(I,"__isScriptSetup",{enumerable:!1,value:!0}),I}}),J={class:"font-weight-bold tw-mb-1"},K={key:0},Q={key:1},X={key:2,style:{"word-break":"break-all"}},Z={key:1},$={class:"tw-flex tw-justify-end tw-gap-x-2"},tt={class:"code-box border rounded bg-light tw-mt-4"};function et(D,e,d,t,u,F){const g=f("fa-icon"),r=f("b-td"),l=f("b-tr"),M=f("b-tbody"),y=f("b-table-simple"),b=f("b-row"),N=f("b-card-title"),T=f("b-card"),w=f("b-col"),x=f("meta-raw-data");return m(),_(t.MViewContainer,{variant:t.singleNftData?.isMinted?void 0:"warning","is-loading":!t.singleNftData,error:t.singleNftError,alerts:t.alerts},{overview:n(()=>[a(t.MPageOverviewCard,{id:d.tokenId,title:t.singleNftData.name||`Unnamed ${t.singleNftData.typeName}`,subtitle:t.singleNftData.description,avatar:t.singleNftData.imageUrl,"data-testid":"nft-overview-card"},{buttons:n(()=>[o("div",$,[a(t.MActionModalButton,{"modal-title":"Refresh External Ownership Status",action:t.refreshFromLedger,"trigger-button-label":"Refresh Ownership","trigger-button-disabled-tooltip":t.singleNftData.hasLedger?void 0:`${t.singleNftData.ledger} mode has no ledger to refresh from.`,"ok-button-label":"Refresh",permission:"api.nft.refresh_from_ledger","data-testid":"refresh-nft"},{default:n(()=>e[13]||(e[13]=[o("p",null,"You can immediately re-fetch this NFT's ownership from the ledger.",-1),o("div",{class:"tw-text-xs+ tw-text-neutral-500"},"This happens automatically in the background, so manual refreshing is not needed in daily operations.",-1)]),void 0,!0),_:1},8,["trigger-button-disabled-tooltip"]),a(t.MActionModalButton,{"modal-title":"Force Re-save NFT's Public Metadata",action:t.republishMetadata,"trigger-button-label":"Re-save Metadata","trigger-button-disabled-tooltip":t.cannotPublishMetadataExplanation,"ok-button-label":"Republish",permission:"api.nft.republish_metadata","data-testid":"republish-nft-metadata"},{default:n(()=>e[14]||(e[14]=[o("p",null,"You can immediately regenerate the NFT's public metadata that gets saved in the NFT collection's S3 bucket.",-1),o("div",{class:"tw-text-xs+ tw-text-neutral-500"},"This happens automatically in the background, so manual re-saving is not needed in daily operations.",-1)]),void 0,!0),_:1},8,["trigger-button-disabled-tooltip"]),a(t.MActionModalButton,{"modal-title":"Edit the NFT",action:t.editNft,"trigger-button-label":"Edit","ok-button-label":"Edit",variant:"danger",permission:"api.nft.edit",onShow:t.prefillNftEditParams,"data-testid":"edit-nft"},{default:n(()=>[e[15]||(e[15]=o("p",null,"You can manually edit the NFT's state. This also updates the NFT's metadata.",-1)),e[16]||(e[16]=o("p",{class:"tw-text-xs+ tw-text-red-400"},"This is an advanced developer feature and should be used carefully. If concurrent edits happen from elsewhere in the backend, some of the changes may be lost!",-1)),a(t.MetaGeneratedForm,{modelValue:t.nftEditParams,"onUpdate:modelValue":e[0]||(e[0]=p=>t.nftEditParams=p),typeName:"Metaplay.Server.AdminApi.Controllers.NftController.NftEditParams",onStatus:e[1]||(e[1]=p=>t.nftEditParamsValid=p)},null,8,["modelValue"])],void 0,!0),_:1})])]),default:n(()=>[o("div",J,[a(g,{icon:"chart-bar"}),e[2]||(e[2]=i(" Overview"))]),a(y,{small:"",responsive:""},{default:n(()=>[a(M,null,{default:n(()=>[a(l,null,{default:n(()=>[a(r,null,{default:n(()=>e[3]||(e[3]=[i("Mint Status")]),void 0,!0),_:1}),a(r,{class:"text-right"},{default:n(()=>[t.singleNftData.isMinted?(m(),_(t.MTooltip,{key:0,class:"text-success",content:"The NFT has been minted in the ledger."},{default:n(()=>e[4]||(e[4]=[i("Minted")]),void 0,!0),_:1})):(m(),_(t.MTooltip,{key:1,class:"text-warning",content:"The NFT hasn't yet been seen in the ledger and for now only exists within the game."},{default:n(()=>e[5]||(e[5]=[i("Not minted")]),void 0,!0),_:1}))],void 0,!0),_:1})],void 0,!0),_:1}),a(l,null,{default:n(()=>[a(r,null,{default:n(()=>e[6]||(e[6]=[i("C# type name")]),void 0,!0),_:1}),a(r,{class:"text-right"},{default:n(()=>[i(c(t.singleNftData.typeName),1)],void 0,!0),_:1})],void 0,!0),_:1}),a(l,null,{default:n(()=>[a(r,null,{default:n(()=>e[7]||(e[7]=[i("Collection")]),void 0,!0),_:1}),a(r,{class:"text-right"},{default:n(()=>[a(t.MTextButton,{permission:"api.nft.view",to:`/web3/nft/${d.collectionId}`},{default:n(()=>[i(c(d.collectionId),1)],void 0,!0),_:1},8,["to"])],void 0,!0),_:1})],void 0,!0),_:1}),a(l,null,{default:n(()=>[a(r,null,{default:n(()=>e[8]||(e[8]=[i("Image URL")]),void 0,!0),_:1}),a(r,{class:"tw-text-right"},{default:n(()=>[a(t.MTextButton,{to:t.singleNftData.imageUrl},{default:n(()=>[i(c(t.singleNftData.imageUrl),1)],void 0,!0),_:1},8,["to"])],void 0,!0),_:1})],void 0,!0),_:1}),a(l,null,{default:n(()=>[a(r,null,{default:n(()=>e[9]||(e[9]=[i("Owning Address")]),void 0,!0),_:1}),a(r,{class:"text-right"},{default:n(()=>[t.singleNftData.ownerAddress==="None"&&!t.singleNftData.isMinted?(m(),v("span",K,"None (not minted)")):t.singleNftData.ownerAddress==="None"&&t.singleNftData.isMinted?(m(),v("span",Q,"Unknown")):(m(),v("span",X,c(t.singleNftData.ownerAddress),1))],void 0,!0),_:1})],void 0,!0),_:1}),a(l,null,{default:n(()=>[a(r,null,{default:n(()=>e[10]||(e[10]=[i("Owning Player")]),void 0,!0),_:1}),a(r,{class:"text-right"},{default:n(()=>[t.singleNftData.owner==="None"?(m(),_(t.MTooltip,{key:0,class:"text-muted tw-italic",content:t.getNoOwningPlayerTooltip(t.singleNftData.ownerAddress,t.singleNftData.isMinted)},{default:n(()=>e[11]||(e[11]=[i("None")]),void 0,!0),_:1},8,["content"])):(m(),v("span",Z,[a(t.MTextButton,{to:`/players/${t.singleNftData.owner}`,permission:"api.players.view"},{default:n(()=>[i(c(t.singleNftData.owner),1)],void 0,!0),_:1},8,["to"])]))],void 0,!0),_:1})],void 0,!0),_:1}),a(l,null,{default:n(()=>[a(r,null,{default:n(()=>e[12]||(e[12]=[i("Metadata URL")]),void 0,!0),_:1}),a(r,{class:"tw-text-right"},{default:n(()=>[a(t.MTextButton,{to:t.singleNftData.metadataUrl},{default:n(()=>[i(c(t.singleNftData.metadataUrl),1)],void 0,!0),_:1},8,["to"])],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1},8,["id","title","subtitle","avatar"])]),default:n(()=>[a(b,{class:"mb-2","no-gutters":"","align-v":"center"},{default:n(()=>e[17]||(e[17]=[o("h3",null,"NFT Data",-1)]),void 0,!0),_:1}),a(b,{"align-h":"center"},{default:n(()=>[a(w,{class:"mt-4",lg:"6"},{default:n(()=>[a(T,{class:"h-100","data-testid":"nft-public-data-preview-card"},{default:n(()=>[a(N,null,{default:n(()=>[a(g,{class:"mr-2",icon:"code"}),e[18]||(e[18]=i("Public Data Preview"))],void 0,!0),_:1}),e[19]||(e[19]=o("div",null,"This is a preview of the NFT's current metadata as sent to 3rd party stores.",-1)),e[20]||(e[20]=o("div",{class:"text-muted small"},"Note: There may be some latency in how often 3rd party sites re-fetch this data.",-1)),o("pre",tt,c(t.singleNftData.metadata),1)],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1}),a(b,{class:"mb-2 tw-mt-4","no-gutters":"","align-v":"center"},{default:n(()=>e[21]||(e[21]=[o("h3",null,"Admin",-1)]),void 0,!0),_:1}),a(b,{"align-h":"center"},{default:n(()=>[a(w,{class:"mt-4",lg:"6"},{default:n(()=>[a(t.AuditLogCard,{class:"h-100",targetType:"$Nft",targetId:`${d.collectionId}/${d.tokenId}`,"data-testid":"nft-audit-log-card"},null,8,["targetId"])],void 0,!0),_:1})],void 0,!0),_:1}),a(x,{kvPair:{collectionId:d.collectionId,tokenId:d.tokenId,singleNftData:t.singleNftData},name:"data"},null,8,["kvPair"])],void 0,!0),_:1},8,["variant","is-loading","error","alerts"])}const Tt=G(z,[["render",et],["__file","Web3NftDetailView.vue"]]);export{Tt as default};
