import{d as k,a6 as S,x as D,f as g,N as a,c as o,ad as v,ae as T,cK as b,o as s,e as N,w as U,a as p,l as d,t as L,k as O,_ as P}from"./index-B7jvAjdE.js";import{M as E}from"./MActionModalButton-CvWVuTB-.js";import{M as V}from"./MInputDateTime-DL6Zd7-d.js";import{a as _}from"./players-CydHenLG.js";import"./MActionModal-coQLkvWs.js";import"./index-fVjXqxSF.js";import"./MInputHintMessage-DbuBS4Kn.js";import"./MInputSwitch-C-Z-JJsG.js";import"./index-B_QkKjtG.js";import"./index-DZuvHjnn.js";const q=k({__name:"PlayerActionDelete",props:{playerId:{}},setup(m,{expose:r}){r();const u=m,e=v(),c=S(),{data:l,refresh:i}=D(_(u.playerId)),t=g(a.now().plus({days:7})),n=o(()=>l.value.model.deletionStatus!=="None"),w=o(()=>l.value.model.isBanned),C=o(()=>!!t.value!==n.value?!0:!!(t.value&&!t.value.equals(a.fromISO(l.value.model.scheduledForDeletionAt)))),M=o(()=>t.value?t.value.diff(a.now()).toMillis()>=0:!1),I=o(()=>{switch(l.value.model.deletionStatus){case"ScheduledByAdmin":return"The deletion was scheduled by a dashboard user.";case"ScheduledByUser":return"The deletion was requested in-game by the player.";case"ScheduledBySystem":return"The deletion was scheduled by an automated system.";default:return"Unexpected deletion status."}}),A=o(()=>!n.value&&!t.value?"This player is not currently scheduled for deletion.":!n.value&&t.value?`This player will be deleted on ${t.value.toUTC().toLocaleString(a.DATETIME_FULL_WITH_SECONDS)}.`:n.value&&!t.value?"This player will no longer be deleted.":t.value?`This player is scheduled for deletion on ${t.value.toUTC().toLocaleString(a.DATETIME_FULL_WITH_SECONDS)}.`:"Unexpected deletion status.");function F(){if(n.value)t.value=a.fromISO(l.value.model.scheduledForDeletionAt);else{const h=b(c.liveOpsDashboardInfo.playerDeletionDefaultDelay),x=a.now().plus(h);t.value=x}}const{showSuccessNotification:y}=T();async function B(){const h=`${l.value.model.playerName||"n/a"} ${t.value?"scheduled for deletion":"is no longer scheduled for deletion"}.`;t.value?await e.put(`/players/${l.value.id}/scheduledDeletion`,{scheduledForDeleteAt:t.value}):await e.delete(`/players/${l.value.id}/scheduledDeletion`),y(h),i()}const f={props:u,gameServerApi:e,staticInfos:c,playerData:l,playerRefresh:i,scheduledDateTime:t,isCurrentlyScheduledForDeletion:n,isCurrentlyBanned:w,isFormChanged:C,isScheduledDateTimeInTheFuture:M,deletionStatusText:I,hintMessage:A,resetModal:F,showSuccessNotification:y,updateDeletionSchedule:B,get DateTime(){return a},computed:o,ref:g,get useGameServerApi(){return v},get useStaticInfos(){return S},get MActionModalButton(){return E},get MInputDateTime(){return V},get useNotifications(){return T},get useSubscription(){return D},get parseDotnetTimeSpanToLuxon(){return b},get getSinglePlayerSubscriptionOptions(){return _}};return Object.defineProperty(f,"__isScriptSetup",{enumerable:!1,value:!0}),f}}),G={key:0,class:"tw-mb-4"},H={key:1},W={key:2};function j(m,r,u,e,c,l){return e.playerData?(s(),N(e.MActionModalButton,{key:0,"modal-title":"Schedule Player for Deletion",action:e.updateDeletionSchedule,"trigger-button-label":e.isCurrentlyScheduledForDeletion?"Cancel Deletion":"Delete Player",variant:"danger","ok-button-label":"Save","ok-button-disabled-Tooltip":e.isFormChanged?void 0:`Toggle the switch to ${e.isCurrentlyScheduledForDeletion?"cancel the deletion of":"delete"} this player.`,permission:"api.players.edit_scheduled_deletion",onShow:e.resetModal,"data-testid":"action-delete-player"},{default:U(()=>[!e.isCurrentlyBanned&&!e.isCurrentlyScheduledForDeletion?(s(),p("p",G,"Scheduling a player for deletion does not prevent the player from playing the game. The player can still connect and play the game until the deletion has completed. If you wish to stop the player from connecting you should also ban them.")):d("",!0),e.isCurrentlyBanned&&e.isCurrentlyScheduledForDeletion?(s(),p("p",H,"The player is currently banned and will not be able to play the game, even if you cancel the scheduled deletion. To allow the player to play the game you must also un-ban them.")):d("",!0),e.isCurrentlyScheduledForDeletion?(s(),p("p",W,"The player is currently scheduled for deletion. "+L(e.deletionStatusText),1)):d("",!0),O(e.MInputDateTime,{label:"Scheduled Deletion Time (UTC)","model-value":e.scheduledDateTime,"min-date-time":"utcNow","allow-empty":"",hintMessage:e.hintMessage,"onUpdate:modelValue":r[0]||(r[0]=i=>e.scheduledDateTime=i),"data-testid":"scheduled-date-time"},null,8,["model-value","hintMessage"])],void 0,!0),_:1},8,["trigger-button-label","ok-button-disabled-Tooltip"])):d("",!0)}const te=P(q,[["render",j],["__file","PlayerActionDelete.vue"]]);export{te as default};
