import{d as A,x as L,c,N as C,ck as P,M as F,v as z,a8 as Y,cK as D,b as g,o as h,e as H,w as o,k as i,n as v,p as r,t as M,a as O,l as U,_ as j}from"./index-B7jvAjdE.js";import{M as q,a as K}from"./MViewContainer-BTeE2xDT.js";import{M as R}from"./MSingleColumnLayout-B4K0ZAFA.js";import{M as u,a as d,c as x,b as B}from"./metaListUtils-B-xQ0HnD.js";import{g as V}from"./experiments-phlJ4_07.js";const G=A({__name:"ExperimentListView",setup(N,{expose:e}){e();const{data:m,error:n}=L(V()),w=c(()=>m.value?.experiments),T=c(()=>w.value.map(t=>({...t,phaseInfo:y(t.experimentId),totalTimeOngoing:b(t.experimentId)}))),p=c(()=>m.value?.experiments.filter(t=>t.phase==="Ongoing")),S=c(()=>{const t=[];return m.value?.combinations.exceedsThreshold===!0&&t.push({title:"High number of combinations",variant:"warning",message:`You currently have ${p.value.length} experiments running with a total of ${m.value.combinations.currentCombinations} possible combinations. This may cause a high memory use on your game servers. Consider pausing or concluding some experiments.`}),t});function y(t){const l=[{id:"Testing",displayName:"Testing",titleVariant:"primary",sortOrder:1},{id:"Ongoing",displayName:"Active",titleVariant:"success",sortOrder:2},{id:"Paused",displayName:"Paused",titleVariant:"warning",sortOrder:3},{id:"Concluded",displayName:"Concluded",titleVariant:"neutral",sortOrder:4}],s=String(f(t).phase),I=l.find(k=>k.id===s);if(!I)throw new Error(`Unknown phase: ${s}`);return I}function f(t){return w.value.find(l=>l.experimentId===t)}function b(t){const l=f(t);let s=null;return l.ongoingDurationBeforeCurrentSpan!==null&&(s=D(l.ongoingDurationBeforeCurrentSpan)),l.phase==="Ongoing"&&(s=s??P.fromMillis(0),s=s.plus(C.now().diff(C.fromISO(l.phaseStartedAt)))),s}const _=[u.asUnsorted(),new u("Phase","phaseInfo.sortOrder",d.Ascending),new u("Phase","phaseInfo.sortOrder",d.Descending),new u("Name","experimentId",d.Ascending),new u("Name","experimentId",d.Descending),new u("Total player count","totalPlayerCount",d.Ascending),new u("Total player count","totalPlayerCount",d.Descending)],a=[new B("phase",[new x("Testing",t=>t.phaseInfo.id==="Testing",!0),new x("Active",t=>t.phaseInfo.id==="Ongoing",!0),new x("Paused",t=>t.phaseInfo.id==="Paused",!0),new x("Concluded",t=>t.phaseInfo.id==="Concluded")])],E={allExperimentsData:m,allExperimentsError:n,experimentInfos:w,decoratedExperimentInfos:T,runningExperimentInfos:p,headerAlerts:S,getExperimentPhaseInfoById:y,getExperimentInfoById:f,getTotalTimeOngoingById:b,sortOptions:_,filterSets:a,get DateTime(){return C},get Duration(){return P},computed:c,get MetaListFilterOption(){return x},get MetaListFilterSet(){return B},get MetaListSortDirection(){return d},get MetaListSortOption(){return u},get MBadge(){return F},get MListItem(){return z},get MPageOverviewCard(){return q},get MSingleColumnLayout(){return R},get MTextButton(){return Y},get MViewContainer(){return K},get useSubscription(){return L},get parseDotnetTimeSpanToLuxon(){return D},get getAllExperimentsSubscriptionOptions(){return V}};return Object.defineProperty(E,"__isScriptSetup",{enumerable:!1,value:!0}),E}}),J={class:"tw-mb-4 tw-text-xs tw-text-neutral-500"},Q={class:"tw-text-xs"},W={key:0,class:"tw-ml-1"},X={key:0},Z={key:1};function $(N,e,m,n,w,T){const p=g("meta-plural-label"),S=g("meta-time"),y=g("meta-duration"),f=g("meta-abbreviate-number"),b=g("meta-list-card"),_=g("meta-raw-data");return h(),H(n.MViewContainer,{permission:"api.experiments.view","is-loading":!n.allExperimentsData,alerts:n.headerAlerts,error:n.allExperimentsError},{overview:o(()=>[i(n.MPageOverviewCard,{title:"View Experiments","data-testid":"experiment-list-overview-card"},{default:o(()=>[e[8]||(e[8]=v("p",{class:"tw-mb-1"},"Experiments allow you to test out variants of your game config on your players.",-1)),v("p",J,[e[1]||(e[1]=r("Experiments deliver variations of your game configs to a subset of your player base. You can then use your analytics to discover which variant performs the best. Define experiments and their variants in your ")),i(n.MTextButton,{to:"/gameConfigs"},{default:o(()=>e[0]||(e[0]=[r("game configs")]),void 0,!0),_:1}),e[2]||(e[2]=r(" and then configure and administer them from here."))]),e[9]||(e[9]=v("div",{class:"tw-mb-1 tw-font-semibold"},"Performance Tip",-1)),v("p",Q,[e[4]||(e[4]=r("Rolling out experiments introduces new combinations of your game configs that require memory on the game servers. You currently have ")),i(p,{value:n.runningExperimentInfos.length,label:"experiment"},null,8,["value"]),e[5]||(e[5]=r(" running with a total of ")),i(p,{value:n.allExperimentsData.combinations.currentCombinations,label:"possible combination"},null,8,["value"]),e[6]||(e[6]=r(". Have a look at the ")),i(n.MTextButton,{to:"https://docs.metaplay.io/feature-cookbooks/experiments-a-b-testing/working-with-experiments.html#technical-details-of-specialized-game-config-delivery"},{default:o(()=>e[3]||(e[3]=[r("experiments documentation")]),void 0,!0),_:1}),e[7]||(e[7]=r(" to learn more."))])],void 0,!0),_:1})]),default:o(()=>[i(n.MSingleColumnLayout,null,{default:o(()=>[i(b,{title:"All Experiments",itemList:n.decoratedExperimentInfos,searchFields:["experimentId","displayName","description"],sortOptions:n.sortOptions,filterSets:n.filterSets,defaultSortOption:1,pageSize:10,emptyMessage:"No player experiments. Set them up in your game configs to start using the feature!","data-testid":"all-experiments-list-card"},{"item-card":o(({item:a})=>[i(n.MListItem,null,{"top-right":o(()=>[i(n.MBadge,{variant:a.phaseInfo.titleVariant},{default:o(()=>[r(M(a.phaseInfo.displayName),1)],void 0,!0),_:2},1032,["variant"]),a.phaseStartedAt?(h(),O("span",W,[e[10]||(e[10]=r("since ")),i(S,{date:a.phaseStartedAt},null,8,["date"])])):U("",!0)]),"bottom-left":o(()=>[r(M(a.description),1)]),"bottom-right":o(()=>[["Ongoing","Paused"].includes(a.phase)?(h(),O("div",X,[e[11]||(e[11]=r("Total runtime: ")),i(y,{duration:a.totalTimeOngoing,showAs:"humanizedSentenceCase"},null,8,["duration"])])):(h(),O("div",Z,"Not started yet")),v("div",null,[i(f,{value:a.totalPlayerCount},null,8,["value"]),e[12]||(e[12]=r()),i(p,{value:a.totalPlayerCount,label:"participant",hideCount:""},null,8,["value"])]),i(n.MTextButton,{to:`/experiments/${a.experimentId}`,"data-testid":"view-experiment"},{default:o(()=>e[13]||(e[13]=[r("View experiment")]),void 0,!0),_:2},1032,["to"])]),default:o(()=>[r(M(a.displayName)+" / "+M(a.experimentId),1)],void 0,!0),_:2},1024)]),_:1},8,["itemList"])],void 0,!0),_:1}),i(_,{kvPair:n.experimentInfos,name:"experimentInfos"},null,8,["kvPair"])],void 0,!0),_:1},8,["is-loading","alerts","error"])}const ae=j(G,[["render",$],["__file","ExperimentListView.vue"]]);export{ae as default};
