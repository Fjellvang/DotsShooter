import{d as H,aj as k,z as x,al as B,x as S,c as v,ak as L,af as T,f as I,ad as P,M as j,O as G,L as K,ae as V,P as W,b,o,e as s,w as i,k as a,n as f,p as l,l as _,a as h,t as A,$ as q,_ as J}from"./index-B7jvAjdE.js";import{M as Q}from"./MActionModalButton-CvWVuTB-.js";import{M as X,a as Y}from"./MViewContainer-BTeE2xDT.js";import{M as Z}from"./MInputSwitch-C-Z-JJsG.js";import{M as $}from"./MInputText-CzhsT8yb.js";import{M as tt}from"./MInputTextArea-BMdoSBpm.js";import{M as et}from"./MTabLayout-CxB_BuXt.js";import at from"./MetaRawData-CedjqGjJ.js";import{L as it}from"./LocalizationActionArchive-DWBO1oXR.js";import{L as nt}from"./LocalizationActionPublish--nJzps7S.js";import{C as lt}from"./CoreUiPlacement-CPf1fwrN.js";import{g as E}from"./localization-Z8p1s5Vr.js";import"./MActionModal-coQLkvWs.js";import"./index-fVjXqxSF.js";import"./index-B_QkKjtG.js";import"./MInputHintMessage-DbuBS4Kn.js";import"./debounce-B8gTqdZO.js";import"./isSymbol-B7ZrWRtH.js";import"./MInputSimpleSelectDropdown-DIlBEFcs.js";import"./index-qTA83-by.js";import"./MSingleColumnLayout-B4K0ZAFA.js";import"./utils-Dwlepb3M.js";const ot=H({__name:"LocalizationDetailView",setup(N,{expose:e}){e();const w=P(),t=k(),D=x(),z=B(t.params.id),{data:m,refresh:n,error:u}=S(E()),r=v(()=>m.value?.find(d=>d.id===z)),p=v(()=>{if(!m.value?.find(d=>d.id===z))return new L("Localization Not Found",`The localization with the ID '${z}' does not exist. Are you looking in the right deployment?.`)});T().setDynamicTitle(r,d=>`View ${d.value?.name??"Localization"}`);const g=v(()=>{const d=[];return r.value?.publishBlockingErrors.length&&d.push({title:"Build Cannot Be Published",message:"This build contains errors and cannot be published.",variant:"danger",dataTest:"cannot-publish-alert"}),r.value?.bestEffortStatus==="Building"&&d.push({title:"Config building...",message:"This localization is still building and has no content to view for now.",variant:"warning",dataTest:"building-alert"}),d}),M=v(()=>g.value.find(d=>d.variant==="danger")?"danger":g.value.find(d=>d.variant==="warning")?"warning":void 0),c=I({name:"",description:"",isArchived:!1});function U(){c.value={name:r.value?.name??"",description:r.value?.description??"",isArchived:r.value?.isArchived??!1}}const{showSuccessNotification:C}=V();async function O(){const d={name:c.value.name,description:c.value.description,isArchived:c.value.isArchived};await w.post(`/localization/${z}`,d),C("Localization updated."),n()}const R=v(()=>r.value?.isActive?"Cannot diff this localization against itself.":r.value?.bestEffortStatus!=="Success"?"Cannot diff a localization that is not in a valid state.":void 0),F=v(()=>!r.value?.isActive),y={gameServerApi:w,route:t,coreStore:D,localizationId:z,allLocalizationsData:m,allLocalizationsRefresh:n,allLocalizationsError:u,localizationData:r,localizationMissingError:p,alerts:g,errorVariant:M,editModalConfig:c,resetForm:U,showSuccessNotification:C,sendUpdatedLocalizationDataToServer:O,disallowDiffToActiveReason:R,canArchive:F,tabOptions:[{label:"Details"},{label:"Audit Log"}],tabUiPlacements:["Localizations/Details/Tab0","Localizations/Details/Tab1"],computed:v,ref:I,get useRoute(){return k},get useGameServerApi(){return P},get MetaRawData(){return at},get MActionModalButton(){return Q},get MBadge(){return j},get MButton(){return G},get MInputSwitch(){return Z},get MInputText(){return $},get MInputTextArea(){return tt},get MTooltip(){return K},get useHeaderbar(){return T},get MPageOverviewCard(){return X},get MViewContainer(){return Y},get DisplayError(){return L},get useNotifications(){return V},get MTabLayout(){return et},get sentenceCaseToKebabCase(){return W},get useSubscription(){return S},LocalizationActionArchive:it,LocalizationActionPublish:nt,CoreUiPlacement:lt,get useCoreStore(){return x},get routeParamToSingleValue(){return B},get getAllLocalizationsSubscriptionOptions(){return E}};return Object.defineProperty(y,"__isScriptSetup",{enumerable:!1,value:!0}),y}}),rt={class:"font-weight-bold"},dt={key:1,class:"text-muted tw-italic"},st={key:2,class:"text-muted tw-italic"},ut={key:1,class:"text-muted tw-italic"},ct={class:"font-weight-bold"},ft={key:0},mt={key:1,class:"text-muted tw-italic"},gt={class:"font-weight-bold"},vt={class:"text-monospace small"},bt={class:"tw-inline-flex tw-w-full tw-items-center tw-justify-between"};function zt(N,e,w,t,D,z){const m=b("fa-icon"),n=b("b-td"),u=b("b-tr"),r=b("meta-time"),p=b("b-tbody"),g=b("b-table-simple"),M=b("meta-username");return o(),s(t.MViewContainer,{variant:t.errorVariant,"is-loading":!t.localizationData,error:t.allLocalizationsError??t.localizationMissingError,"full-width":"",alerts:t.alerts,permission:"api.localization.view"},{overview:i(()=>[t.localizationData?(o(),s(t.MPageOverviewCard,{key:0,title:t.localizationData.name,subtitle:t.localizationData.description,id:t.localizationId,"data-testid":"localization-detail-overview-card"},{buttons:i(()=>[a(t.LocalizationActionArchive,{localizationId:t.localizationId,"trigger-style":"button"},null,8,["localizationId"]),a(t.MActionModalButton,{"modal-title":"Edit Localization Archive",action:t.sendUpdatedLocalizationDataToServer,"trigger-button-label":"Edit","ok-button-label":"Update",permission:"api.localization.edit",onShow:t.resetForm,"data-testid":"edit-config"},{default:i(()=>[a(t.MInputText,{class:"tw-mb-2",label:"Name","model-value":t.editModalConfig.name,variant:t.editModalConfig.name.length>0?"success":"default",placeholder:"For example: 1.0.4 release candidate","onUpdate:modelValue":e[0]||(e[0]=c=>t.editModalConfig.name=c)},null,8,["model-value","variant"]),a(t.MInputTextArea,{label:"Description","model-value":t.editModalConfig.description,variant:t.editModalConfig.description.length>0?"success":"default",placeholder:"What is unique about this config build that will help you find it later?",rows:3,"onUpdate:modelValue":e[1]||(e[1]=c=>t.editModalConfig.description=c)},null,8,["model-value","variant"]),f("div",bt,[e[20]||(e[20]=f("span",{class:"tw-font-semibold"},"Archived",-1)),a(t.MTooltip,{content:t.canArchive?void 0:"This config cannot be archived as it is currently active.","no-underline":""},{default:i(()=>[a(t.MInputSwitch,{"model-value":t.editModalConfig.isArchived,disabled:!t.canArchive,name:"isConfigBuildArchived",size:"small","onUpdate:modelValue":e[2]||(e[2]=c=>t.editModalConfig.isArchived=c)},null,8,["model-value","disabled"])],void 0,!0),_:1},8,["content"])]),e[21]||(e[21]=f("span",{class:"small text-muted"},"Archived localization builds are hidden from the localizations list by default. Localization builds that are active cannot be archived.",-1))],void 0,!0),_:1}),a(t.MButton,{"disabled-tooltip":t.disallowDiffToActiveReason,to:`diff?newRoot=${t.localizationId}`},{default:i(()=>e[22]||(e[22]=[l("Diff to Active")]),void 0,!0),_:1},8,["disabled-tooltip","to"]),a(t.LocalizationActionPublish,{localizationId:t.localizationId,publishBlocked:t.localizationData?.publishBlockingErrors.length>0},null,8,["localizationId","publishBlocked"])]),default:i(()=>[f("span",rt,[a(m,{icon:"chart-bar"}),e[3]||(e[3]=l(" Overview"))]),a(g,{small:"",responsive:""},{default:i(()=>[a(p,null,{default:i(()=>[a(u,null,{default:i(()=>[a(n,null,{default:i(()=>e[4]||(e[4]=[l("Status")]),void 0,!0),_:1}),a(n,{class:"text-right"},{default:i(()=>[t.localizationData.isArchived?(o(),s(t.MBadge,{key:0,class:"tw-mr-1",variant:"neutral"},{default:i(()=>e[5]||(e[5]=[l("Archived")]),void 0,!0),_:1})):_("",!0),t.localizationData.isActive?(o(),s(t.MBadge,{key:1,class:"tw-mr-1",variant:"success"},{default:i(()=>e[6]||(e[6]=[l("Active")]),void 0,!0),_:1})):(o(),s(t.MBadge,{key:2},{default:i(()=>e[7]||(e[7]=[l("Not active")]),void 0,!0),_:1}))],void 0,!0),_:1})],void 0,!0),_:1}),a(u,null,{default:i(()=>[a(n,null,{default:i(()=>e[8]||(e[8]=[l("Last Published At")]),void 0,!0),_:1}),a(n,{class:"text-right"},{default:i(()=>[t.localizationData?.publishedAt?(o(),s(r,{key:0,date:t.localizationData?.publishedAt,showAs:"timeagoSentenceCase"},null,8,["date"])):t.localizationData?.isActive?(o(),h("span",dt,"No time recorded")):(o(),h("span",st,"Never"))],void 0,!0),_:1})],void 0,!0),_:1}),a(u,null,{default:i(()=>[a(n,null,{default:i(()=>e[9]||(e[9]=[l("Last Unpublished At")]),void 0,!0),_:1}),a(n,{class:"text-right"},{default:i(()=>[t.localizationData?.unpublishedAt?(o(),s(r,{key:0,date:t.localizationData?.unpublishedAt,showAs:"timeagoSentenceCase"},null,8,["date"])):(o(),h("span",ut,"Never"))],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1}),f("span",ct,[a(m,{icon:"chart-bar"}),e[10]||(e[10]=l(" Build Status"))]),a(g,{small:"",responsive:""},{default:i(()=>[a(p,null,{default:i(()=>[a(u,null,{default:i(()=>[a(n,null,{default:i(()=>e[11]||(e[11]=[l("Build Status")]),void 0,!0),_:1}),a(n,{class:"text-right"},{default:i(()=>[f("div",null,A(t.localizationData?.bestEffortStatus),1)],void 0,!0),_:1})],void 0,!0),_:1}),a(u,null,{default:i(()=>[a(n,null,{default:i(()=>e[12]||(e[12]=[l("Built By")]),void 0,!0),_:1}),a(n,{class:"text-right"},{default:i(()=>[t.localizationData.source==="disk"?(o(),s(t.MBadge,{key:0},{default:i(()=>e[13]||(e[13]=[l("Built-in with the server")]),void 0,!0),_:1})):(o(),s(M,{key:1,username:t.localizationData.source},null,8,["username"]))],void 0,!0),_:1})],void 0,!0),_:1}),a(u,{class:q({"text-danger":t.localizationData.publishBlockingErrors.length>0})},{default:i(()=>[a(n,null,{default:i(()=>e[14]||(e[14]=[l("Publish Blocking Errors")]),void 0,!0),_:1}),a(n,{class:"text-right"},{default:i(()=>[t.localizationData.publishBlockingErrors.length?(o(),h("span",ft,A(t.localizationData.publishBlockingErrors.length),1)):(o(),h("span",mt,"None"))],void 0,!0),_:1})],void 0,!0),_:1},8,["class"])],void 0,!0),_:1})],void 0,!0),_:1}),f("span",gt,[a(m,{icon:"chart-bar"}),e[15]||(e[15]=l(" Technical Details"))]),a(g,{small:"",responsive:""},{default:i(()=>[a(p,null,{default:i(()=>[a(u,null,{default:i(()=>[a(n,null,{default:i(()=>e[16]||(e[16]=[l("Built At")]),void 0,!0),_:1}),a(n,{class:"text-right"},{default:i(()=>[a(r,{date:t.localizationData?.buildStartedAt,showAs:"timeagoSentenceCase"},null,8,["date"])],void 0,!0),_:1})],void 0,!0),_:1}),a(u,null,{default:i(()=>[a(n,null,{default:i(()=>e[17]||(e[17]=[l("Last Modified At")]),void 0,!0),_:1}),a(n,{class:"text-right"},{default:i(()=>[t.localizationData?(o(),s(r,{key:0,date:t.localizationData?.lastModifiedAt,showAs:"timeagoSentenceCase"},null,8,["date"])):_("",!0)],void 0,!0),_:1})],void 0,!0),_:1}),a(u,null,{default:i(()=>[a(n,null,{default:i(()=>e[18]||(e[18]=[l("Version Hash")]),void 0,!0),_:1}),t.localizationData?(o(),s(n,{key:1,class:"text-right"},{default:i(()=>[f("div",vt,A(t.localizationData.versionHash),1)],void 0,!0),_:1})):(o(),s(n,{key:0,class:"text-right text-muted tw-italic"},{default:i(()=>e[19]||(e[19]=[l("Loading...")]),void 0,!0),_:1}))],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1},8,["title","subtitle","id"])):_("",!0)]),default:i(()=>[a(t.MTabLayout,{tabs:t.tabOptions},{"tab-0":i(()=>[a(t.CoreUiPlacement,{placementId:t.tabUiPlacements[0],localizationId:t.localizationId,alwaysFullWidth:""},null,8,["placementId","localizationId"])]),"tab-1":i(()=>[a(t.CoreUiPlacement,{placementId:t.tabUiPlacements[1],localizationId:t.localizationId},null,8,["placementId","localizationId"])]),_:1}),a(t.MetaRawData,{kvPair:t.localizationData,name:"localizationData"},null,8,["kvPair"])]),_:1},8,["variant","is-loading","error","alerts"])}const Ht=J(ot,[["render",zt],["__file","LocalizationDetailView.vue"]]);export{Ht as default};
