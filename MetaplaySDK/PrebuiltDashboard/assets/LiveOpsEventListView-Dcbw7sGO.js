import{d as N,c as T,ak as C,N as Y,s as z,v as q,M as J,q as Q,a8 as X,ai as G,b as Z,o as i,e as d,w as r,k as o,B as $,p as m,t as L,a as I,l as y,n as f,_ as V,f as D,C as A,ad as F,ci as R,a9 as U,x}from"./index-B7jvAjdE.js";import{M as ee,a as te}from"./MViewContainer-BTeE2xDT.js";import ne from"./MetaRawData-CedjqGjJ.js";import{L as re,a as ie}from"./LiveOpsEventFormModalButton-B_dbraRU.js";import{M as oe}from"./MActionModalButton-CvWVuTB-.js";import{M as ae}from"./MInputSingleFileContents-tOi-WM9p.js";import{M as se}from"./MInputSingleSelectSwitch-CuptGC6e.js";import{M as le}from"./MDateTime-BN0QPwIm.js";import de from"./MetaListCard-CSSWUW2Z.js";import{d as k}from"./debounce-B8gTqdZO.js";import{C as ue}from"./CoreUiPlacement-CPf1fwrN.js";import{b as K,a as j}from"./liveOpsEvents-jq8FGsN5.js";import"./utils-Dwlepb3M.js";import"./MInputTextArea-BMdoSBpm.js";import"./MInputHintMessage-DbuBS4Kn.js";import"./actionDebouncer-CJRtFyZn.js";import"./axiosActionHandler-rx_q8iFy.js";import"./MInputDateTime-DL6Zd7-d.js";import"./MInputSwitch-C-Z-JJsG.js";import"./index-B_QkKjtG.js";import"./index-DZuvHjnn.js";import"./MInputDuration-C704TlZG.js";import"./MInputNumber-BOzPEn49.js";import"./MInputSingleSelectDropdown-D7-YpE7w.js";import"./index-qTA83-by.js";import"./MInputText-CzhsT8yb.js";import"./MetaGeneratedForm-BcVgOIy3.js";import"./MInputMultiSelectCheckbox-D_9f7ub1.js";import"./MInputCheckbox-BqateWtE.js";import"./GeneratedUiFormDynamicComponent-DrqrTIRR.js";import"./MessageAudienceForm-Bn0DOLdW.js";import"./numberUtils-CkF0oMe2.js";import"./_arrayIncludes-B3ShBz6l.js";import"./MActionModal-coQLkvWs.js";import"./index-fVjXqxSF.js";import"./MInputSingleFile-Dbi3mt5D.js";import"./index-CDBqmjrS.js";import"./MInputSimpleSelectDropdown-DIlBEFcs.js";import"./MInputSingleSelectRadio-BukGu4ZH.js";import"./metaListUtils-B-xQ0HnD.js";import"./_baseIteratee-BXhw53re.js";import"./isSymbol-B7ZrWRtH.js";import"./toString-DMHXP3G8.js";import"./identity-DKeuBCMA.js";import"./button-group-BUOztpby.js";var h=(s=>(s.Disallow="Disallow",s.Overwrite="Overwrite",s.KeepOld="KeepOld",s))(h||{}),P=(s=>(s.ConflictError="ConflictError",s.GeneralError="GeneralError",s.CreateNew="CreateNew",s.OverwriteExisting="OverwriteExisting",s.IgnoreDueToExisting="IgnoreDueToExisting",s))(P||{});const me=N({__name:"LiveOpsEventImportListCard",props:{listMode:{},isImportValid:{type:Boolean},importResults:{}},setup(s,{expose:t}){t();const l=s,e=T(()=>{if(l.importResults===void 0)return;if(l.importResults.length===0)return[];const w=l.importResults.map(a=>{const p=u(a.diagnostics);return{...a,badgeVariant:v(a.outcome,p),badgeText:M[a.outcome].badgeName,displayError:n(a.outcome,p)}}),g={danger:0,warning:1,success:2,primary:3,neutral:4};return w.sort((a,p)=>g[a.badgeVariant]-g[p.badgeVariant])});function u(w){return Object.values(w).flatMap(g=>g)}const M={ConflictError:{message:"The event cannot be imported because an event already exists with the same ID.",variant:"danger",badgeName:"Conflict"},GeneralError:{message:"The event cannot be imported due to an error. More details can be found below.",variant:"danger",badgeName:"Error"},CreateNew:{message:"The import will cause a new event to be created in this environment, but there are warnings that you might want to take into consideration.",variant:"success",badgeName:"Create New"},OverwriteExisting:{message:"The import will overwrite the existing event in this environment.",variant:"warning",badgeName:"Overwrite"},IgnoreDueToExisting:{message:"The import will be ignored because the event already exists in this environment.",variant:"warning",badgeName:"Keep Old"}};function v(w,g){return w===P.CreateNew&&g.some(a=>a.level==="Warning")?"warning":M[w].variant}function n(w,g){if(g.length>0){const b=new C(M[w].badgeName,M[w].message),a={Error:0,Warning:1,Info:2,Uneditable:3};return g.sort((p,E)=>a[p.level]-a[E.level]).forEach(p=>{b.addDetail(p.level,p.message??"No reason provided.")}),b}else return}const S={props:l,decoratedImportResults:e,flattenDiagnosticsToArray:u,outcomeToOutcomeInfoMap:M,getBadgeVariant:v,createDisplayError:n,get DateTime(){return Y},computed:T,get MetaListCard(){return de},get MList(){return z},get MListItem(){return q},get MBadge(){return J},get MCollapse(){return Q},get MDateTime(){return le},get MTextButton(){return X},get MErrorCallout(){return G},get DisplayError(){return C},get LiveOpsEventImportOutcome(){return P}};return Object.defineProperty(S,"__isScriptSetup",{enumerable:!1,value:!0}),S}}),pe={key:0},ve={key:1,class:"tw-italic tw-text-neutral-500"},ce={key:0},fe={key:1,class:"tw-italic tw-text-neutral-500"},ge={key:0},we={key:1,class:"tw-italic tw-text-neutral-500"},be={key:0},ye={key:1,class:"tw-italic tw-text-neutral-500"};function Me(s,t,l,e,u,M){const v=Z("meta-duration");return i(),d(e.MetaListCard,{title:l.listMode==="preview"?"Import Preview":"Import Results",dangerous:!l.isImportValid,"item-list":e.decoratedImportResults,"page-size":l.listMode==="preview"?4:6,"empty-message":"No results available to preview yet."},{"item-card":r(({item:n})=>[o(e.MCollapse,{"extra-m-list-item-margin":"","hide-collapse":l.listMode==="result"},{header:r(()=>[o(e.MListItem,{"no-left-padding":""},$({"bottom-left":r(()=>[m(L(n.eventId),1)]),"top-right":r(()=>[o(e.MBadge,{variant:n.badgeVariant},{default:r(()=>[m(L(n.badgeText),1)],void 0,!0),_:2},1032,["variant"])]),default:r(()=>[n?.eventInfo?.displayName?(i(),I("span",pe,L(n?.eventInfo?.displayName),1)):(i(),I("span",ve,"No name available"))],void 0,!0),_:2},[l.listMode==="result"&&l.isImportValid?{name:"bottom-right",fn:r(()=>[o(e.MTextButton,{to:`/liveOpsEvents/${n.eventId}`},{default:r(()=>t[0]||(t[0]=[m("View event")]),void 0,!0),_:2},1032,["to"])]),key:"0"}:void 0]),1024)]),default:r(()=>[n.displayError?(i(),d(e.MErrorCallout,{key:0,class:"tw-mb-3",error:n.displayError},null,8,["error"])):y("",!0),n.eventInfo?(i(),d(e.MList,{key:1,"show-border":"",striped:""},{default:r(()=>[o(e.MListItem,{condensed:""},{"top-right":r(()=>[o(e.MDateTime,{instant:e.DateTime.fromISO(n.eventInfo.createdAt)},null,8,["instant"])]),default:r(()=>[t[1]||(t[1]=m("Created At"))],void 0,!0),_:2},1024),o(e.MListItem,{condensed:""},{"top-right":r(()=>[m(L(n.eventInfo.eventTypeName),1)]),default:r(()=>[t[2]||(t[2]=m("Event Type"))],void 0,!0),_:2},1024),n.eventInfo.useSchedule?y("",!0):(i(),d(e.MListItem,{key:0,condensed:""},{"top-right":r(()=>t[3]||(t[3]=[f("span",{class:"tw-italic tw-text-neutral-500"},"None",-1)])),default:r(()=>[t[4]||(t[4]=m("Schedule"))],void 0,!0),_:1})),n.eventInfo.useSchedule?(i(),d(e.MListItem,{key:1,condensed:""},{"top-right":r(()=>[o(e.MBadge,null,{default:r(()=>[m(L(n.eventInfo.schedule?.isPlayerLocalTime?"Player Local":"UTC"),1)],void 0,!0),_:2},1024)]),default:r(()=>[t[5]||(t[5]=m("Time Mode"))],void 0,!0),_:2},1024)):y("",!0),n.eventInfo.useSchedule?(i(),d(e.MListItem,{key:2,condensed:""},{"top-right":r(()=>[n.eventInfo.schedule?.enabledStartTime?(i(),d(e.MDateTime,{key:0,instant:e.DateTime.fromISO(n.eventInfo.schedule.enabledStartTime),"disable-tooltip":n.eventInfo.schedule?.isPlayerLocalTime},null,8,["instant","disable-tooltip"])):y("",!0)]),default:r(()=>[t[6]||(t[6]=m("Start Time"))],void 0,!0),_:2},1024)):y("",!0),n.eventInfo.useSchedule?(i(),d(e.MListItem,{key:3,condensed:""},{"top-right":r(()=>[n.eventInfo.schedule?.enabledEndTime?(i(),d(e.MDateTime,{key:0,instant:e.DateTime.fromISO(n.eventInfo.schedule.enabledEndTime),"disable-tooltip":n.eventInfo.schedule?.isPlayerLocalTime},null,8,["instant","disable-tooltip"])):y("",!0)]),default:r(()=>[t[7]||(t[7]=m("End Time"))],void 0,!0),_:2},1024)):y("",!0),n.eventInfo.useSchedule?(i(),d(e.MListItem,{key:4,condensed:""},{"top-right":r(()=>[n.eventInfo.schedule?.previewDuration!=="P0Y0M0DT0H0M0S"?(i(),I("span",ce,[o(v,{duration:n.eventInfo.schedule?.previewDuration},null,8,["duration"])])):(i(),I("span",fe,"None"))]),default:r(()=>[t[8]||(t[8]=m("Preview duration"))],void 0,!0),_:2},1024)):y("",!0),n.eventInfo?.useSchedule?(i(),d(e.MListItem,{key:5,condensed:""},{"top-right":r(()=>[n.eventInfo.schedule?.endingSoonDuration!=="P0Y0M0DT0H0M0S"?(i(),I("span",ge,[o(v,{duration:n.eventInfo.schedule?.endingSoonDuration},null,8,["duration"])])):(i(),I("span",we,"None"))]),default:r(()=>[t[9]||(t[9]=m("Ending Soon Duration"))],void 0,!0),_:2},1024)):y("",!0),n.eventInfo.useSchedule?(i(),d(e.MListItem,{key:6,condensed:""},{"top-right":r(()=>[n.eventInfo.schedule?.reviewDuration!=="P0Y0M0DT0H0M0S"?(i(),I("span",be,[o(v,{duration:n.eventInfo?.schedule?.reviewDuration},null,8,["duration"])])):(i(),I("span",ye,"None"))]),default:r(()=>[t[10]||(t[10]=m("Review Duration"))],void 0,!0),_:2},1024)):y("",!0)],void 0,!0),_:2},1024)):(i(),d(e.MList,{key:2,"show-border":"",striped:""},{default:r(()=>[o(e.MListItem,{condensed:""},{default:r(()=>t[11]||(t[11]=[f("span",{class:"tw-italic tw-text-neutral-500"},"No event info available",-1)]),void 0,!0),_:1})],void 0,!0),_:1}))],void 0,!0),_:2},1032,["hide-collapse"])]),_:1},8,["title","dangerous","item-list","page-size"])}const Ie=V(me,[["render",Me],["__file","LiveOpsEventImportListCard.vue"]]),he=N({__name:"LiveOpsEventActionImport",setup(s,{expose:t}){t();const l=F();async function e(){u.value=void 0,n.value=h.Disallow,b.value=[]}const u=D();function M(c){v(c),b.value=void 0,a.value=[],p.value=!1}const v=k(c=>{u.value===c&&(u.value=void 0),u.value=c},300),n=D(h.Disallow),S=[{value:h.Disallow,label:"Disallow"},{value:h.Overwrite,label:"Overwrite"},{value:h.KeepOld,label:"Keep Old"}];function w(c){g(c),b.value=void 0,a.value=[],p.value=!1}const g=k(c=>{n.value=c},300);A([u,n],async()=>{await E(!0)},{deep:!0});const b=D([]),a=D([]),p=D(!1);async function E(c){if(u.value){const _={validateOnly:c,conflictPolicy:n.value,package:u.value},O=(await l.post("/importLiveOpsEvents",_)).data;b.value=O.eventResults,a.value=O.generalDiagnostics,p.value=O.isValid}else b.value=[],a.value=[]}const H=T(()=>{if(a.value.length>0){const c=a.value.length,_=new C("Validation Failed",`There ${R(c,"was","were")} ${U(c,"error")} while validating the import file.`,"Error");return a.value.forEach(O=>{_.addDetail(O.level,O.message??"No reason provided.")}),_}else return}),W=new C("Import Failed",`This is most likely because the server state changed between validation and import.
  The events listed below have not been imported and no server state was changed by this operation.`,"Error"),B={gameServerApi:l,onShow:e,liveOpsEventFileContents:u,onLiveOpsEventFileContentsChange:M,debounceLiveOpsEventFileContentsChange:v,conflictPolicy:n,conflictPolicyOptions:S,onConflictPolicyChange:w,debounceConflictPolicyChange:g,importResults:b,importDiagnostics:a,isImportValid:p,importLiveOpsEvent:E,generalDiagnosticsDisplayError:H,importFailureDisplayError:W,get debounce(){return k},ref:D,watch:A,computed:T,get useGameServerApi(){return F},get MActionModalButton(){return oe},get MInputSingleSelectSwitch(){return se},get MInputSingleFileContents(){return ae},get MErrorCallout(){return G},get DisplayError(){return C},get maybePluralString(){return U},get maybePluralPrefixString(){return R},get LiveOpsEventImportConflictPolicy(){return h},LiveOpsEventImportListCard:Ie};return Object.defineProperty(B,"__isScriptSetup",{enumerable:!1,value:!0}),B}});function Oe(s,t,l,e,u,M){return i(),d(e.MActionModalButton,{"modal-title":"Import LiveOps Events",action:()=>e.importLiveOpsEvent(!1),"trigger-button-label":"Import","ok-button-label":"Import Events","ok-button-disabled-tooltip":e.isImportValid?void 0:"Upload a valid file to proceed.",permission:"api.liveops_events.import","trigger-button-full-width":"",onShow:e.onShow},{default:r(()=>[t[2]||(t[2]=f("div",{class:"tw-mb-3 tw-text-sm"},"You can import LiveOps Events into this environment by uploading a LiveOps Event JSON file. This allows you to move events between environments.",-1)),o(e.MInputSingleFileContents,{"model-value":e.liveOpsEventFileContents,label:"Upload a File","accepted-file-types":".json","onUpdate:modelValue":t[0]||(t[0]=v=>e.onLiveOpsEventFileContentsChange(v))},null,8,["model-value"]),o(e.MInputSingleSelectSwitch,{class:"tw-mt-3","model-value":e.conflictPolicy,label:"Conflict Policy",options:e.conflictPolicyOptions,"onUpdate:modelValue":t[1]||(t[1]=v=>e.onConflictPolicyChange(v))},null,8,["model-value"]),t[3]||(t[3]=f("div",{class:"tw-mt-2 tw-text-xs tw-text-neutral-500"},[f("p",null,"Conflict policy determines how to deal with conflicting events during import:"),f("p",{class:"tw-m-0.5 tw-mb-1"},[f("span",{class:"tw-font-semibold"},"Disallow"),m(" - Duplicate events will not be allowed.")]),f("p",{class:"tw-m-0.5 tw-mb-1"},[f("span",{class:"tw-font-semibold"},"Overwrite"),m(" - Duplicate events will overwrite existing ones.")]),f("p",{class:"tw-m-0.5"},[f("span",{class:"tw-font-semibold"},"Keep Old"),m(" - Duplicate events will be ignored.")])],-1))]),"right-panel":r(()=>[e.generalDiagnosticsDisplayError?(i(),d(e.MErrorCallout,{key:0,error:e.generalDiagnosticsDisplayError},null,8,["error"])):(i(),d(e.LiveOpsEventImportListCard,{key:1,"list-mode":"preview","is-import-valid":e.isImportValid,"import-results":e.importResults},null,8,["is-import-valid","import-results"]))]),"result-panel":r(()=>[e.isImportValid?y("",!0):(i(),d(e.MErrorCallout,{key:0,class:"tw-mb-3",error:e.importFailureDisplayError},null,8,["error"])),o(e.LiveOpsEventImportListCard,{"list-mode":"result","is-import-valid":e.isImportValid,"import-results":e.importResults},null,8,["is-import-valid","import-results"])]),_:1},8,["action","ok-button-disabled-tooltip"])}const De=V(he,[["render",Oe],["__file","LiveOpsEventActionImport.vue"]]),Le=N({__name:"LiveOpsEventListView",setup(s,{expose:t}){t();const{data:l}=x(K()),{data:e}=x(j()),u={liveOpsEventsData:l,liveOpsEventTypesData:e,get MetaRawData(){return ne},get MPageOverviewCard(){return ee},get MViewContainer(){return te},get useSubscription(){return x},LiveOpsEventActionExport:re,LiveOpsEventActionImport:De,LiveOpsEventFormModalButton:ie,CoreUiPlacement:ue,get getAllLiveOpsEventsSubscriptionOptions(){return K},get getLiveOpsEventTypesSubscriptionOptions(){return j}};return Object.defineProperty(u,"__isScriptSetup",{enumerable:!1,value:!0}),u}});function Ce(s,t,l,e,u,M){return i(),d(e.MViewContainer,{permission:"api.liveops_events.view"},{overview:r(()=>[o(e.MPageOverviewCard,{title:"LiveOps Events","data-testid":"live-ops-event-list-overview-card"},{buttons:r(()=>[o(e.LiveOpsEventFormModalButton,{"form-mode":"create"}),o(e.LiveOpsEventActionImport),o(e.LiveOpsEventActionExport)]),default:r(()=>[t[0]||(t[0]=f("p",{class:"tw-mb-1"},"LiveOps Events are dynamic in-game events that you can create and manage on this page.",-1)),t[1]||(t[1]=f("p",{class:"tw-text-xs tw-text-neutral-500"},"LiveOps Events are under active development and not yet feature-complete. They are safe to use in production but the UI and underlying API will change over the next few releases as we continue to work on them.",-1))],void 0,!0),_:1})]),default:r(()=>[o(e.CoreUiPlacement,{class:"tw-mb-3",placementId:"LiveOpsEvents/List"}),o(e.MetaRawData,{kvPair:e.liveOpsEventsData,name:"liveOpsEventsData"},null,8,["kvPair"]),o(e.MetaRawData,{kvPair:e.liveOpsEventTypesData,name:"liveOpsEventTypesData"},null,8,["kvPair"])]),_:1})}const bt=V(Le,[["render",Ce],["__file","LiveOpsEventListView.vue"]]);export{bt as default};
