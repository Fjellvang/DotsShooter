import{d as M,ac as Q,b as D,o as l,e as y,w as n,k as i,n as o,_ as C,x as v,c,N as F,M as J,v as X,a8 as k,p as s,t as I,a as g,l as b,z as U,ad as V,ae as R,a6 as j,af as z,ag as G,A as W,ah as Z,a0 as $,ai as ee,B as te,F as ae,r as re}from"./index-B7jvAjdE.js";import{M as ie}from"./MTabLayout-CxB_BuXt.js";import{M as ne,a as le}from"./MViewContainer-BTeE2xDT.js";import se from"./MetaRawData-CedjqGjJ.js";import{M as oe}from"./MetaGenericActivablesCard-B0ifo0sg.js";import{O as de}from"./OfferGroupsCard-DDUoV9fW.js";import{C as B}from"./CoreUiPlacement-CPf1fwrN.js";import ue from"./MetaListCard-CSSWUW2Z.js";import{M as E,a as L}from"./metaListUtils-B-xQ0HnD.js";import{m as q,l as me,g as ce}from"./liveOpsEventUtils-DTi4aG6g.js";import{g as H,a as Y}from"./liveOpsEvents-jq8FGsN5.js";import{a as P}from"./players-CydHenLG.js";import{O as pe}from"./OverviewList-9VTc2d9x.js";import ye from"./PlayerActionExport-CKDM9Cx6.js";import{M as fe}from"./MActionModalButton-CvWVuTB-.js";import"./MInputSimpleSelectDropdown-DIlBEFcs.js";import"./index-qTA83-by.js";import"./MInputHintMessage-DbuBS4Kn.js";import"./MSingleColumnLayout-B4K0ZAFA.js";import"./utils-Dwlepb3M.js";import"./activables-DQj9-VnO.js";import"./MetaActivablePhaseBadge-DS0XHNhH.js";import"./MetaActivablesBaseCard-4tvZk2v-.js";import"./numberUtils-CkF0oMe2.js";import"./offers-DYY0Z2EJ.js";import"./MInputMultiSelectCheckbox-D_9f7ub1.js";import"./MInputCheckbox-BqateWtE.js";import"./index-B_QkKjtG.js";import"./MInputSingleSelectRadio-BukGu4ZH.js";import"./index-CDBqmjrS.js";import"./MInputText-CzhsT8yb.js";import"./debounce-B8gTqdZO.js";import"./isSymbol-B7ZrWRtH.js";import"./_baseIteratee-BXhw53re.js";import"./toString-DMHXP3G8.js";import"./identity-DKeuBCMA.js";import"./button-group-BUOztpby.js";import"./MetaCountryCode-OZPd0ilg.js";import"./MetaTime-D0iYB_lr.js";import"./MetaLanguageLabel-CAF0iIvu.js";import"./MActionModal-coQLkvWs.js";import"./index-fVjXqxSF.js";const ve=M({__name:"PlayerAdminActionsCard",props:{playerId:{}},setup(f,{expose:t}){t();const a={get MCard(){return Q},CoreUiPlacement:B};return Object.defineProperty(a,"__isScriptSetup",{enumerable:!1,value:!0}),a}}),ge={class:"tw-flex tw-flex-wrap tw-justify-center tw-gap-y-3 tw-@container"},be={class:"tw-basis-full tw-pr-1.5 tw-@container @sm:tw-basis-1/2 @xl:tw-basis-1/3"},he={class:"tw-basis-full tw-px-1.5 tw-@container @sm:tw-basis-1/2 @xl:tw-basis-1/3"},we={class:"tw-basis-full tw-pl-1.5 tw-@container @sm:tw-basis-1/2 @xl:tw-basis-1/3"};function Pe(f,t,a,e,u,m){const d=D("fa-icon");return l(),y(e.MCard,{title:"Admin Tools","data-testid":"player-admin-actions-card"},{icon:n(()=>[i(d,{icon:"wrench"})]),default:n(()=>[o("div",ge,[o("div",be,[t[0]||(t[0]=o("div",{class:"tw-mb-1 tw-font-bold tw-leading-6"},"Gentle Actions",-1)),i(e.CoreUiPlacement,{placementId:"Players/Details/AdminActions:Gentle",playerId:a.playerId,"always-full-width":"",smallBottomMargin:""},null,8,["playerId"])]),o("div",he,[t[1]||(t[1]=o("div",{class:"tw-mb-1 tw-font-bold tw-leading-6"},"Disruptive Actions",-1)),i(e.CoreUiPlacement,{placementId:"Players/Details/AdminActions:Disruptive",playerId:a.playerId,"always-full-width":"",smallBottomMargin:""},null,8,["playerId"])]),o("div",we,[t[2]||(t[2]=o("div",{class:"tw-mb-1 tw-font-bold tw-leading-6"},"Dangerous Actions",-1)),i(e.CoreUiPlacement,{placementId:"Players/Details/AdminActions:Dangerous",playerId:a.playerId,"always-full-width":"",smallBottomMargin:""},null,8,["playerId"])])])],void 0,!0),_:1})}const Se=C(ve,[["render",Pe],["__file","PlayerAdminActionsCard.vue"]]),_e=M({__name:"PlayerLiveOpsEventCard",props:{playerId:{}},setup(f,{expose:t}){t();const a=f,{data:e}=v(H(a.playerId)),{data:u}=v(Y()),{data:m}=v(P(a.playerId)),d=c(()=>e.value?.events??[]),r=c(()=>u.value?.map(O=>O.eventTypeName)??[]),h=c(()=>d.value.length>0?` 
    ${m.value?.model.playerName||"This player"} is participating in or eligible for the LiveOps Events below.
    The current and next phases displayed were last refreshed ${F.fromISO(e.value?.lastRefreshedAt??"").toRelative()} and may be out of date.`:""),_=c(()=>q(r.value,["NotYetStarted","InPreview","Active","EndingSoon","InReview"],!1));function S(O){return["Ended","NotYetStarted","InReview","InPreview","EndingSoon","Active"].indexOf(O.currentPhase)}const w=[new E("Current phase",S,L.Descending),new E("Current phase",S,L.Ascending)],T={props:a,playerLiveOpsEventsData:e,liveOpsEventTypesData:u,playerData:m,playerEvents:d,eventTypeNames:r,playerLiveOpsEventDescription:h,eventFilterSets:_,currentPhaseEventSortFunction:S,sortOptions:w,get DateTime(){return F},computed:c,get MetaListCard(){return ue},get MetaListSortDirection(){return L},get MetaListSortOption(){return E},get MBadge(){return J},get MListItem(){return X},get MTextButton(){return k},get useSubscription(){return v},get liveOpsEventPhaseInfos(){return me},get makeListViewFilterSets(){return q},get getDurationFormat(){return ce},get getLiveOpsEventsForPlayerSubscriptionOptions(){return H},get getLiveOpsEventTypesSubscriptionOptions(){return Y},get getSinglePlayerSubscriptionOptions(){return P}};return Object.defineProperty(T,"__isScriptSetup",{enumerable:!1,value:!0}),T}}),Ie={key:0},Oe={key:1};function De(f,t,a,e,u,m){const d=D("meta-duration");return l(),y(e.MetaListCard,{title:"LiveOps Events",icon:"calendar-alt",itemList:e.playerEvents,searchFields:["displayName","description"],filterSets:e.eventFilterSets,sortOptions:e.sortOptions,emptyMessage:`${e.playerData.model.playerName||"This player"} is not eligible for any events.`,description:e.playerLiveOpsEventDescription,permission:"api.liveops_events.view","data-testid":"player-liveops-events-card"},{"item-card":n(({item:r})=>[i(e.MListItem,null,{"top-right":n(()=>[i(e.MBadge,{variant:e.liveOpsEventPhaseInfos[r.currentPhase].badgeVariant},{default:n(()=>[s(I(e.liveOpsEventPhaseInfos[r.currentPhase].displayString),1)],void 0,!0),_:2},1032,["variant"])]),"bottom-left":n(()=>[s(I(r.description),1)]),"bottom-right":n(()=>[r.nextPhase&&r.nextPhaseTime&&e.DateTime.fromISO(r.nextPhaseTime).diffNow().milliseconds>0?(l(),g("div",Ie,[s(I(e.liveOpsEventPhaseInfos[r.nextPhase].displayString)+" in ",1),i(d,{duration:e.DateTime.fromISO(r.nextPhaseTime).diffNow(),showAs:e.getDurationFormat(r.nextPhaseTime),hideMilliseconds:""},null,8,["duration","showAs"]),t[0]||(t[0]=s("."))])):r.nextPhase&&r.nextPhaseTime&&e.DateTime.fromISO(r.nextPhaseTime).diffNow().milliseconds<=0?(l(),g("div",Oe,[s(I(e.liveOpsEventPhaseInfos[r.nextPhase].displayString)+" has started ",1),i(d,{duration:e.DateTime.now().diff(e.DateTime.fromISO(r.nextPhaseTime)),showAs:e.getDurationFormat(r.nextPhaseTime),hideMilliseconds:""},null,8,["duration","showAs"]),t[1]||(t[1]=s(" ago."))])):b("",!0),i(e.MTextButton,{to:`/liveOpsEvents/${r.eventId}`},{default:n(()=>t[2]||(t[2]=[s("View event")]),void 0,!0),_:2},1032,["to"])]),default:n(()=>[s(I(r.displayName),1)],void 0,!0),_:2},1024)]),_:1},8,["itemList","filterSets","emptyMessage","description"])}const Me=C(_e,[["render",De],["__file","PlayerLiveOpsEventCard.vue"]]),Ce=M({__name:"PlayerOverviewCard",props:{playerId:{}},setup(f,{expose:t}){t();const a=f,e=U(),{data:u}=v(P(a.playerId)),m=c(()=>e.uiComponents["Players/Details/Overview:LeftPanel"]?e.uiComponents["Players/Details/Overview:LeftPanel"].length>0:!1),d=c(()=>u.value?.model.playerName?u.value?.model.playerId:""),r={props:a,coreStore:e,playerData:u,showLeftPanel:m,displayPlayerId:d,computed:c,get MPageOverviewCard(){return ne},get MTextButton(){return k},get useSubscription(){return v},get useCoreStore(){return U},get getSinglePlayerSubscriptionOptions(){return P},OverviewList:pe,CoreUiPlacement:B};return Object.defineProperty(r,"__isScriptSetup",{enumerable:!1,value:!0}),r}}),Te={class:"tw-grid tw-grid-cols-1 tw-gap-4 @lg:tw-grid-cols-2"};function xe(f,t,a,e,u,m){const d=D("meta-abbreviate-number");return l(),y(e.MPageOverviewCard,{title:"Player Overview",id:e.displayPlayerId,"data-testid":"player-overview-card"},{title:n(()=>[i(e.CoreUiPlacement,{alwaysFullWidth:"",smallBottomMargin:"",placementId:"Players/Details/Overview:Title",playerId:a.playerId},null,8,["playerId"])]),subtitle:n(()=>[i(e.CoreUiPlacement,{alwaysFullWidth:"",placementId:"Players/Details/Overview:Subtitle",playerId:a.playerId},null,8,["playerId"])]),caption:n(()=>[t[0]||(t[0]=s("Save file size: ")),i(e.MTextButton,{permission:"api.database.inspect_entity",to:`/entities/${e.playerData.model.playerId}/dbinfo`,"data-testid":"model-size-link"},{default:n(()=>[i(d,{value:e.playerData.persistedSize,unit:"byte"},null,8,["value"])],void 0,!0),_:1},8,["to"])]),default:n(()=>[o("div",Te,[e.showLeftPanel?(l(),y(e.CoreUiPlacement,{key:0,alwaysFullWidth:"",placementId:"Players/Details/Overview:LeftPanel",playerId:a.playerId},null,8,["playerId"])):b("",!0),i(e.OverviewList,{listTitle:"Overview",icon:"chart-bar",sourceObject:e.playerData,items:e.coreStore.overviewLists.player},null,8,["sourceObject","items"])])],void 0,!0),_:1},8,["id"])}const Ae=C(Ce,[["render",xe],["__file","PlayerOverviewCard.vue"]]),Ee=M({__name:"PlayerActionForceReset",props:{playerId:{}},setup(f,{expose:t}){t();const a=f,e=V(),{refresh:u}=v(P(a.playerId)),{showSuccessNotification:m}=R();async function d(){await e.post(`/players/${a.playerId}/forceResetState`),m("Player state force reset to defaults."),u()}const r={props:a,gameServerApi:e,playerRefresh:u,showSuccessNotification:m,resetPlayerState:d,get useGameServerApi(){return V},get MActionModalButton(){return fe},get useNotifications(){return R},get useSubscription(){return v},get getSinglePlayerSubscriptionOptions(){return P}};return Object.defineProperty(r,"__isScriptSetup",{enumerable:!1,value:!0}),r}});function Le(f,t,a,e,u,m){return l(),y(e.MActionModalButton,{"modal-title":"Reset Player State",action:e.resetPlayerState,"trigger-button-label":"Force Reset Player",variant:"danger","ok-button-label":"Force Reset Player",permission:"api.players.reset_player","data-testid":"action-force-reset-player-state"},{default:n(()=>t[0]||(t[0]=[o("p",null,"Force resetting the player will re-initialize the entire player state, including important things like purchases and connected devices.",-1),o("p",null,"The authentication records are preserved, so it will be possible for the player to re-attach to the player after reset.",-1)])),_:1})}const ke=C(Ee,[["render",Le],["__file","PlayerActionForceReset.vue"]]),Be=M({__name:"PlayerDetailView",props:{id:{}},setup(f,{expose:t}){t();const a=f,{data:e,error:u}=v(P(a.id)),m=c(()=>e.value?.model?.playerName||"n/a"),d=j(),r=c(()=>{if(u.value){const p=u.value;return p.response?.status===400?"error-bad-id":p.response?.status===404?"error-not-found":"error-unknown"}else return e.value?.isInitialized===!1?"error-entity-uninitialized":e.value?"success":"loading"}),h=c(()=>{if(r.value!=="loading")return r.value.startsWith("error")||e.value?.model&&!e.value.model.deletionStatus.startsWith("None")?"danger":void 0});z().setDynamicTitle(m,p=>`Manage ${p.value||"Player"}`);const _=c(()=>{const p=[];if(e.value?.model){if(e.value.model.deletionStatus.startsWith("DeletedBy")){const x=e.value.model.deletionStatus.substring(9);p.push({title:`☠️ Player Deleted by ${x}`,message:"This player is no more. They have ceased to be and the account had been scrubbed of personal data.",variant:"danger",dataTest:"player-deleted-alert"})}else e.value.model.attachedAuthMethods&&Object.keys(e.value.model.attachedAuthMethods).length===0&&p.push({title:"Orphan Account",message:"This account has no login methods attached. Nobody can currently connect to play as this player.",variant:"warning",dataTest:"player-orphaned-alert"});e.value.model.isBanned===!0&&p.push({title:"Banned",message:"This player is currently banned. That'll teach them!",variant:"warning",dataTest:"player-banned-alert"}),e.value.logicVersionMismatched===!0&&e.value.model&&p.push({title:"Logic Version Mismatched",message:`This player's logic version was expected to be ${e.value.model.logicVersion} but was ${e.value.logicVersion} instead. The player's logic version will automatically be updated next time the player is persisted. As a result this player might behave unexpectedly.`,variant:"warning",dataTest:"logic-version-mismatch-alert"})}return p}),S=v(G()).data;function w(p){if(!S.value)throw new Error("Trying to find a display name for a tab before dashboard options have loaded!");return S.value[`playerDetailsTab${p}DisplayName`]}const T=c(()=>[{label:w(0)},{label:w(1)},{label:w(2)},{label:w(3)},{label:w(4)}]),O=["Players/Details/Tab0","Players/Details/Tab1","Players/Details/Tab2","Players/Details/Tab3","Players/Details/Tab4"],{data:A}=v(W()),K=c(()=>{const p=Object.entries(A.value?.activablesMetadata.categories??{});return Object.fromEntries(p.map(x=>[x[0],x[1].displayName]))}),N={props:a,singlePlayerData:e,singlePlayerError:u,playerName:m,staticInfos:d,fetchStatus:r,viewVariant:h,alerts:_,dashboardOptionsData:S,getDisplayNameForTabByIndex:w,tabOptions:T,tabUiPlacements:O,staticConfigData:A,activableCategories:K,get AxiosError(){return Z},computed:c,get useStaticInfos(){return j},get MetaRawData(){return se},get MBadge(){return J},get MCallout(){return $},get MErrorCallout(){return ee},get MTextButton(){return k},get MViewContainer(){return le},get useHeaderbar(){return z},get MTabLayout(){return ie},get useSubscription(){return v},MetaGenericActivablesCard:oe,OfferGroupsCard:de,PlayerAdminActionsCard:Se,PlayerLiveOpsEventCard:Me,PlayerOverviewCard:Ae,PlayerActionExport:ye,PlayerActionForceReset:ke,CoreUiPlacement:B,get getDashboardOptionsSubscriptionOptions(){return G},get getStaticConfigSubscriptionOptions(){return W},get getSinglePlayerSubscriptionOptions(){return P}};return Object.defineProperty(N,"__isScriptSetup",{enumerable:!1,value:!0}),N}}),Ne={class:"d-flex justify-content-end tw-mt-4"},Fe={class:"font-weight-bold"},Ue={key:0},Ve={key:1},Re={key:2},je={key:0,class:"mt-2 small text-muted tw-italic"},ze={key:0,class:"tw-mx-auto tw-mb-10 tw-max-w-3xl tw-@container"},Ge={key:1,class:"mb-5"},We={class:"tw-my-3 tw-grid tw-grid-cols-1 tw-gap-3 lg:tw-grid-cols-2"};function qe(f,t,a,e,u,m){const d=D("meta-time"),r=D("meta-alert");return l(),y(e.MViewContainer,{"full-width":"",variant:e.viewVariant,alerts:e.alerts,"is-loading":e.fetchStatus==="loading"||!e.dashboardOptionsData},te({alerts:n(()=>[e.singlePlayerData?.model.deletionStatus.startsWith("ScheduledBy")?(l(),y(r,{key:0,variant:"danger",title:"Scheduled for Deletion","data-testid":"player-deletion-alert"},{default:n(()=>[o("div",null,[i(e.MBadge,{variant:"danger"},{default:n(()=>[s(I(e.playerName),1)],void 0,!0),_:1}),o("span",null,[t[9]||(t[9]=s("is scheduled to be deleted")),o("span",Fe,[i(d,{date:e.singlePlayerData.model.scheduledForDeletionAt,showAs:"timeago"},null,8,["date"])]),t[10]||(t[10]=s(" at ")),i(d,{date:e.singlePlayerData.model.scheduledForDeletionAt,showAs:"time",disableTooltip:""},null,8,["date"]),t[11]||(t[11]=s(" on ")),i(d,{date:e.singlePlayerData.model.scheduledForDeletionAt,showAs:"date",disableTooltip:""},null,8,["date"]),t[12]||(t[12]=s("."))]),t[13]||(t[13]=o("span",null,"Deletion was",-1)),e.singlePlayerData.model.deletionStatus==="ScheduledByAdmin"?(l(),g("span",Ue,"scheduled by an admin.")):e.singlePlayerData.model.deletionStatus==="ScheduledByUser"?(l(),g("span",Ve,"requested in-game by the player.")):(l(),g("span",Re,"scheduled by an automated system."))]),new Date(e.singlePlayerData.model.scheduledForDeletionAt)<new Date?(l(),g("div",je,"Note: Players are deleted with batch jobs that run every now and then. It is normal for players to get deleted up to a day after their due date!")):b("",!0)],void 0,!0),_:1})):b("",!0)]),overview:n(()=>[i(e.PlayerOverviewCard,{playerId:a.id},null,8,["playerId"])]),default:n(()=>[e.singlePlayerData?.model.deletionStatus.startsWith("Deleted")?b("",!0):(l(),g("div",ze,[i(e.PlayerAdminActionsCard,{playerId:a.id},null,8,["playerId"])])),e.singlePlayerData&&e.dashboardOptionsData&&!e.singlePlayerData.model.deletionStatus.startsWith("Deleted")?(l(),g("div",Ge,[i(e.MTabLayout,{tabs:e.tabOptions},{"tab-0":n(()=>[i(e.CoreUiPlacement,{placementId:e.tabUiPlacements[0],playerId:a.id},null,8,["placementId","playerId"])]),"tab-1":n(()=>[i(e.CoreUiPlacement,{placementId:e.tabUiPlacements[1],playerId:a.id},null,8,["placementId","playerId"])]),"tab-2":n(()=>[i(e.CoreUiPlacement,{placementId:e.tabUiPlacements[2],playerId:a.id},null,8,["placementId","playerId"])]),"tab-3":n(()=>[i(e.CoreUiPlacement,{placementId:e.tabUiPlacements[3],playerId:a.id},null,8,["placementId","playerId"]),o("div",We,[e.staticInfos.featureFlags.liveOpsEvents?(l(),y(e.PlayerLiveOpsEventCard,{key:0,playerId:a.id},null,8,["playerId"])):b("",!0),(l(!0),g(ae,null,re(e.activableCategories,(h,_)=>(l(),g("div",{key:h},[_==="OfferGroup"?(l(),y(e.OfferGroupsCard,{key:0,class:"tw-h-full",hideDisabled:"",hideConversion:"",playerId:a.id,title:h,emptyMessage:`${e.playerName} doesn't have any offers available.`,defaultSortOption:3,hidePriority:"",hideRevenue:""},null,8,["playerId","title","emptyMessage"])):(l(),y(e.MetaGenericActivablesCard,{key:1,class:"tw-h-full",hideDisabled:"",hideConversion:"",playerId:a.id,category:String(_),title:h,emptyMessage:`There are no ${h} defined.`},null,8,["playerId","category","title","emptyMessage"]))]))),128))])]),"tab-4":n(()=>[i(e.CoreUiPlacement,{placementId:e.tabUiPlacements[4],playerId:a.id},null,8,["placementId","playerId"]),i(e.MetaRawData,{kvPair:e.singlePlayerData,name:"singlePlayerData"},null,8,["kvPair"]),i(e.MetaRawData,{kvPair:e.dashboardOptionsData},null,8,["kvPair"])]),_:1},8,["tabs"])])):b("",!0)],void 0,!0),_:2},[e.fetchStatus.includes("error")?{name:"errors",fn:n(()=>[e.fetchStatus==="error-bad-id"||e.fetchStatus==="error-unknown"?(l(),y(e.MErrorCallout,{key:0,error:e.singlePlayerError},null,8,["error"])):e.fetchStatus==="error-not-found"?(l(),y(e.MCallout,{key:1,title:"Player Not Found",variant:"danger"},{default:n(()=>t[0]||(t[0]=[s("This player does not exist. Are you looking in the correct deployment?")]),void 0,!0),_:1})):e.fetchStatus==="error-entity-uninitialized"?(l(),y(e.MCallout,{key:2,title:"Player Not Initialized",variant:"danger"},{default:n(()=>t[1]||(t[1]=[s("This player has not yet been initialized. This is likely a temporary state for a new player, but indicates a problem if the state persists.")]),void 0,!0),_:1})):b("",!0),e.fetchStatus==="error-unknown"||e.fetchStatus==="error-entity-uninitialized"?(l(),y(e.MCallout,{key:3,class:"tw-mt-3",title:"Debugging",variant:"danger"},{default:n(()=>[t[8]||(t[8]=o("p",null,"The following tools may be able to give you more information about this error:",-1)),o("ul",null,[o("li",null,[t[3]||(t[3]=s("Use ")),i(e.MTextButton,{to:`/players/${a.id}/raw`},{default:n(()=>t[2]||(t[2]=[s("raw query debugger")]),void 0,!0),_:1},8,["to"]),t[4]||(t[4]=s(" to inspect data retrieval phases."))]),o("li",null,[t[6]||(t[6]=s("Use ")),i(e.MTextButton,{to:`/entities/${a.id}/dbinfo`,permission:"api.database.inspect_entity","data-testid":"model-size-link"},{default:n(()=>t[5]||(t[5]=[s("save file inspector")]),void 0,!0),_:1},8,["to"]),t[7]||(t[7]=s(" to inspect entity data saved on the database."))])]),o("div",Ne,[i(e.PlayerActionForceReset,{playerId:a.id},null,8,["playerId"]),i(e.PlayerActionExport,{class:"ml-2",playerId:a.id,"allow-debug-export":""},null,8,["playerId"])])],void 0,!0),_:1})):b("",!0)]),key:"0"}:void 0]),1032,["variant","alerts","is-loading"])}const kt=C(Be,[["render",qe],["__file","PlayerDetailView.vue"]]);export{kt as default};
