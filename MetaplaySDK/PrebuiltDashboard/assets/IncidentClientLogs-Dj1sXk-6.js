import{d as A,x as B,f as P,c as x,N as F,L as j,M as U,bb as H,ac as W,a9 as Z,b as q,o as r,e as G,w as y,k as b,n as w,p as J,a as o,F as N,r as O,$ as E,t as C,bd as K,l as V,_ as Q}from"./index-B7jvAjdE.js";import{M as X}from"./MInputSwitch-C-Z-JJsG.js";import{g as z}from"./incidents-CceQLPcP.js";import"./index-B_QkKjtG.js";const Y=A({__name:"IncidentClientLogs",props:{incidentId:{},playerId:{}},setup(I,{expose:s}){s();const S=I,{data:e}=B(z(S.playerId,S.incidentId)),_=P(!0),k=x(()=>e.value?.clientLogEntries.map(t=>{const d=F.fromISO(t.timestamp).toFormat("HH:mm:ss"),n=t.level;let p;_.value?p=M(t.message,{enableColor:!1}).map(l=>l.text).join(""):p=t.message;const h=t.stackTrace?`
`+t.stackTrace:"";return`${d} ${n}: ${p}${h}`.trimEnd()}).join(`
`)),T=x(()=>(e.value?.clientLogEntries||[]).reduce((d,n)=>d+(n.level==="Warning"?1:0),0)),a=x(()=>(e.value?.clientLogEntries||[]).reduce((d,n)=>d+(n.level==="Exception"||n.level==="Error"?1:0),0));function v(t){return t.level==="Warning"?"text-warning":t.level==="Exception"||t.level==="Error"?"text-danger":""}const u=[{open:/<color=(#[0-9a-fA-F]+|[a-zA-Z]+)>/,close:/<\/color>/,getStyle:t=>({color:t[1]})},{open:/<b>/,close:/<\/b>/,getStyle:t=>({"font-weight":"bold"})},{open:/<i>/,close:/<\/i>/,getStyle:t=>({"font-style":"italic"})}];function M(t,d){const n=[],p={},h=[];let g=t;for(;;){let l=null;for(const c of u){const m=c.open.exec(g);m&&(!l||m.index<l.match.index)&&(l={match:m,elementSpec:c})}let f=null;if(n.length!==0){const c=n[n.length-1].elementSpec,m=c.close.exec(g);m&&(f={match:m,elementSpec:c})}let i;l&&f?i=l.match.index<f.match.index?l:f:i=l??f;const L=i?i.match.index:g.length,D=n.length===0?p:n[n.length-1].accumulatedStyle;if(L!==0&&h.push({text:g.slice(0,L),style:D}),!i)break;if(i===l){const c={...D,...l.elementSpec.getStyle(l.match)};d.enableColor||delete c.color,n.push({elementSpec:l.elementSpec,accumulatedStyle:c})}else n.pop();g=g.slice(i.match.index+i.match[0].length)}return h}const R={props:S,playerIncidentData:e,enableRichTextStyling:_,formatClientLogsForClipboard:k,warningCount:T,errorCount:a,getRowStyle:v,richTextElementSpecs:u,parseRichText:M,get DateTime(){return F},computed:x,ref:P,get MTooltip(){return j},get MBadge(){return U},get MClipboardCopy(){return H},get MInputSwitch(){return X},get MCard(){return W},get maybePluralString(){return Z},get useSubscription(){return B},get getPlayerIncidentSubscriptionOptions(){return z}};return Object.defineProperty(R,"__isScriptSetup",{enumerable:!1,value:!0}),R}}),$={key:0,class:"tw-m-0 tw-text-center tw-italic tw-text-neutral-500"},ee={key:1,class:"log border rounded bg-light tw-w-full",style:{"max-height":"30rem"}},te={class:"text-muted"},ne={key:0},ae={key:2,class:"ml-5"};function le(I,s,S,e,_,k){const T=q("meta-time");return e.playerIncidentData.clientLogEntries?(r(),G(e.MCard,{key:0,variant:e.playerIncidentData.clientLogEntries?"primary":"neutral",title:"Client Logs",badge:e.errorCount>0?e.maybePluralString(e.errorCount,"error"):e.warningCount>0?e.maybePluralString(e.warningCount,"warning"):void 0,"badge-variant":e.errorCount>0?"danger":e.warningCount>0?"warning":void 0},{"header-right":y(()=>[b(e.MInputSwitch,{class:"tw-relative tw-mr-1.5","model-value":e.enableRichTextStyling,name:"richTextStylingEnabled",size:"extraSmall","onUpdate:modelValue":s[0]||(s[0]=a=>e.enableRichTextStyling=a)},null,8,["model-value"]),s[2]||(s[2]=w("span",{class:"tw-mr-1 tw-text-xs+"},"Rich Text Styling",-1)),b(e.MTooltip,{content:"Unity logs contain styling elements. These can either be interpreted or displayed raw.",noUnderline:""},{default:y(()=>[b(e.MBadge,{shape:"pill"},{default:y(()=>s[1]||(s[1]=[J("?")]),void 0,!0),_:1})],void 0,!0),_:1})]),default:y(()=>[!e.playerIncidentData.clientLogEntries||e.playerIncidentData.clientLogEntries.length===0?(r(),o("p",$,"Client logs not included in this incident report.")):(r(),o("pre",ee,[(r(!0),o(N,null,O(e.playerIncidentData.clientLogEntries,(a,v)=>(r(),o("div",{class:"tw-m-0 tw-space-x-1",key:v},[w("span",te,[b(T,{date:a.timestamp,showAs:"time"},null,8,["date"])]),w("span",{class:E(e.getRowStyle(a))},C(a.level)+":",3),e.enableRichTextStyling?(r(),o("span",ne,[(r(!0),o(N,null,O(e.parseRichText(a.message,{enableColor:!1}),u=>(r(),o("span",{style:K(u.style),class:E(e.getRowStyle(a))},C(u.text),7))),256))])):(r(),o("span",{key:1,class:E(e.getRowStyle(a))},C(a.message),3)),a.stackTrace?(r(),o("div",ae,[w("span",null,C(a.stackTrace),1)])):V("",!0)]))),128))]))],void 0,!0),_:1},8,["variant","badge","badge-variant"])):V("",!0)}const ce=Q(Y,[["render",le],["__file","IncidentClientLogs.vue"]]);export{ce as default};
