import{d as z,x as C,A as x,f as m,c as r,ad as N,a0 as H,a8 as Q,ae as D,aU as k,a9 as J,o as v,e as h,w as i,n,t as w,k as l,l as M,a as K,p as G,_ as W}from"./index-B7jvAjdE.js";import{M as X}from"./MActionModalButton-CvWVuTB-.js";import{M as Z,a as $}from"./MViewContainer-BTeE2xDT.js";import{M as ee}from"./MInputText-CzhsT8yb.js";import{M as ae}from"./MInputTextArea-BMdoSBpm.js";import te from"./MetaRawData-CedjqGjJ.js";import{M as ie}from"./MetaGeneratedForm-BcVgOIy3.js";import{C as ne}from"./CoreUiPlacement-CPf1fwrN.js";import{g as I}from"./gameConfigs-DlpfRS5r.js";import"./MActionModal-coQLkvWs.js";import"./index-fVjXqxSF.js";import"./MInputHintMessage-DbuBS4Kn.js";import"./debounce-B8gTqdZO.js";import"./isSymbol-B7ZrWRtH.js";import"./utils-Dwlepb3M.js";import"./MInputMultiSelectCheckbox-D_9f7ub1.js";import"./MInputCheckbox-BqateWtE.js";import"./index-B_QkKjtG.js";import"./GeneratedUiFormDynamicComponent-DrqrTIRR.js";const oe=z({__name:"GameConfigListView",setup(U,{expose:a}){a();const g=N(),e=k(),{data:f}=C(x()),{data:s,error:o,refresh:y}=C(I()),u=m(),d=m(),b=m();function _(){b.value=null,u.value="",d.value=""}function O(t){return t==="Metaplay.Core.Config.GameConfigBuildParameters"&&f.value!=null&&f.value.gameConfigBuildInfo.buildParametersNamespaceQualifiedName!=="Metaplay.Core.Config.DefaultGameConfigBuildParameters"?q=>q.typeName!=="Metaplay.Core.Config.DefaultGameConfigBuildParameters":()=>!0}const A=r(()=>!!(u.value&&u.value.length>0)),P=r(()=>d.value&&d.value.length>0?!0:null),S=m(),F=r(()=>A.value===!0&&P.value!==!1&&S.value),{showSuccessNotification:p}=D();async function R(){const t={SetAsActive:!1,Properties:{Name:u.value,Description:d.value},BuildParams:b.value};await g.post("/gameConfig/build",t),p("Game config build started."),y()}const c=r(()=>(s.value??[]).filter(t=>!t.isArchived&&!(t.publishedAt!==null||t.unpublishedAt!==null||t.isActive)).map(t=>t.id)),Y=r(()=>c.value.length>100);async function L(){await g.post("/gameConfig/archive",c.value),p(`Archived ${c.value.length} unpublished game configs.`)}const B=r(()=>{if(s.value)return s.value.reduce((t,V)=>V.isArchived?t+1:t,0)}),j=r(()=>(B.value??0)>200),E=r(()=>e.doesHavePermission("api.game_config.delete")),T={gameServerApi:g,permissions:e,staticConfigData:f,allGameConfigsData:s,allGameConfigsError:o,allGameConfigsTriggerRefresh:y,gameConfigName:u,gameConfigDescription:d,buildParams:b,resetBuildNewConfigModal:_,buildParamsTypeFilter:O,nameValidationState:A,descriptionValidationState:P,buildParamsValidationState:S,formValidationState:F,showSuccessNotification:p,buildGameConfig:R,archivableGameConfigIds:c,hasTooManyUnpublishedGameConfigs:Y,archiveAllUnpublished:L,archivedGameConfigCount:B,hasTooManyArchivedGameConfigs:j,hasPermissionToDelete:E,computed:r,ref:m,get useGameServerApi(){return N},get MetaRawData(){return te},get MActionModalButton(){return X},get MCallout(){return H},get MInputText(){return ee},get MInputTextArea(){return ae},get MPageOverviewCard(){return Z},get MTextButton(){return Q},get MViewContainer(){return $},get useNotifications(){return D},get usePermissions(){return k},get maybePluralString(){return J},get useSubscription(){return C},MetaGeneratedForm:ie,CoreUiPlacement:ne,get getAllGameConfigsSubscriptionOptions(){return I},get getStaticConfigSubscriptionOptions(){return x}};return Object.defineProperty(T,"__isScriptSetup",{enumerable:!1,value:!0}),T}}),re={class:"tw-mt-4 tw-flex tw-justify-end"},le={class:"tw-mb-3"},se={key:0},ue={class:"tw-rounded-md tw-border tw-border-neutral-200 tw-bg-neutral-100 tw-p-4"};function de(U,a,g,e,f,s){return v(),h(e.MViewContainer,{"is-loading":!e.allGameConfigsData,error:e.allGameConfigsError,variant:e.hasTooManyUnpublishedGameConfigs||e.hasTooManyArchivedGameConfigs?"warning":void 0,permission:"api.game_config.view"},{alerts:i(()=>[e.hasTooManyUnpublishedGameConfigs?(v(),h(e.MCallout,{key:0,class:"tw-mb-3",title:"Many Unpublished Game Configs",variant:"warning"},{default:i(()=>[n("div",null,"You have "+w(e.maybePluralString(e.archivableGameConfigIds.length,"unpublished game config"))+". Consider archiving or publishing them to reduce clutter.",1),n("div",re,[l(e.MActionModalButton,{"modal-title":"Archive All Unpublished Game Configs",action:e.archiveAllUnpublished,"trigger-button-label":"Archive All Unpublished","trigger-button-size":"small"},{default:i(()=>[n("div",null,"You are about to archive "+w(e.archivableGameConfigIds.length)+" unpublished game configs. Archiving a game config will hide it from the list of available game configs. An archived game config can be unarchived at any time.",1)]),_:1})])],void 0,!0),_:1})):M("",!0),e.hasTooManyArchivedGameConfigs?(v(),h(e.MCallout,{key:1,title:"Many Archived Game Configs",variant:"warning"},{default:i(()=>[n("div",le,"You have "+w(e.archivedGameConfigCount)+" archived game configs. These configs are not being used and can be safely removed. Removing these configs will improve your server performance.",1),e.hasPermissionToDelete?(v(),K("div",se,[a[5]||(a[5]=G("Archived game configs can be removed from the ")),l(e.MTextButton,{to:"/system"},{default:i(()=>a[4]||(a[4]=[G("settings")]),void 0,!0),_:1}),a[6]||(a[6]=G(" page."))])):M("",!0)],void 0,!0),_:1})):M("",!0)]),overview:i(()=>[l(e.MPageOverviewCard,{title:"View Game Configs","data-testid":"game-config-list-overview-card"},{buttons:i(()=>[l(e.MActionModalButton,{"modal-title":"Build New Game Config",action:e.buildGameConfig,"trigger-button-label":"New Build","trigger-button-disabled-tooltip":e.staticConfigData?.gameConfigBuildInfo.buildSupported?void 0:"Game config builds have not been enabled for this environment.","ok-button-label":"Build Config","ok-button-disabled-tooltip":e.formValidationState?void 0:"Fill out all required fields to proceed.",permission:"api.game_config.edit",onShow:e.resetBuildNewConfigModal,"data-testid":"build-game-config-form"},{default:i(()=>[a[7]||(a[7]=n("p",null,"You can configure and trigger a new game configs build to happen directly on the game server. It may take a few minutes for large projects.",-1)),l(e.MInputText,{class:"tw-mb-2",label:"Game Config Name","model-value":e.gameConfigName,variant:e.nameValidationState!==null?e.nameValidationState?"success":"danger":"default",placeholder:"For example: 1.3.2","onUpdate:modelValue":a[0]||(a[0]=o=>e.gameConfigName=o)},null,8,["model-value","variant"]),l(e.MInputTextArea,{class:"tw-mb-1",label:"Game Config Description","model-value":e.gameConfigDescription,variant:e.descriptionValidationState!==null?e.descriptionValidationState?"success":"danger":"default",placeholder:"For example: Reduced the difficulty of levels between 5 and 10.",rows:3,"onUpdate:modelValue":a[1]||(a[1]=o=>e.gameConfigDescription=o)},null,8,["model-value","variant"])]),"right-panel":i(()=>[n("div",ue,[a[8]||(a[8]=n("div",{class:"tw-mb-2 tw-font-semibold"},"Build Parameters",-1)),a[9]||(a[9]=n("div",{class:"tw-text-sm"},"Optional configuration for how the game config should be built. You can, for example, pull data from a different source or only build a subset of the configs.",-1)),n("div",null,[l(e.MetaGeneratedForm,{class:"tw-mt-2",typeName:"Metaplay.Core.Config.GameConfigBuildParameters",abstractTypeFilter:e.buildParamsTypeFilter,value:e.buildParams,page:"GameConfigBuildCard",onInput:a[2]||(a[2]=o=>e.buildParams=o),onStatus:a[3]||(a[3]=o=>e.buildParamsValidationState=o)},null,8,["value"])])])]),_:1},8,["trigger-button-disabled-tooltip","ok-button-disabled-tooltip"])]),default:i(()=>[a[10]||(a[10]=n("p",{class:"tw-mb-1"},"Game configs contain all your game data, such as the economy balancing.",-1)),a[11]||(a[11]=n("div",{class:"tw-text-sm tw-text-neutral-500"},"You can make new game configs builds and review them before publishing. Published game configs will be delivered over-the-air and do not require players to update their clients.",-1))],void 0,!0),_:1})]),default:i(()=>[l(e.CoreUiPlacement,{placementId:"GameConfigs/List"}),l(e.MetaRawData,{"kv-pair":e.allGameConfigsData,name:"allGameConfigsData"},null,8,["kv-pair"])]),_:1},8,["is-loading","error","variant"])}const xe=W(oe,[["render",de],["__file","GameConfigListView.vue"]]);export{xe as default};
