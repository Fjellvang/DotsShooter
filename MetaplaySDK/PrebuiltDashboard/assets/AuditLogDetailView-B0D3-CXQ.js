import{d as V,v as S,a8 as O,b as g,o as d,e as f,w as a,k as n,n as v,t as m,a as _,p as i,l as x,_ as R,aj as I,f as b,c as C,h as A,ad as B,dA as P,M as G,O as j,ac as U,bb as F,s as q,r as h,F as N}from"./index-B7jvAjdE.js";import{M as z,a as H}from"./MViewContainer-BTeE2xDT.js";const J=V({__name:"AuditLogEntry",props:{item:{},showTarget:{type:Boolean}},setup(E,{expose:t}){t();const o={get MListItem(){return S},get MTextButton(){return O}};return Object.defineProperty(o,"__isScriptSetup",{enumerable:!1,value:!0}),o}}),K={class:"small text-muted tw-ml-1"},Q={key:0};function W(E,t,o,e,T,s){const p=g("meta-username"),c=g("meta-country-code"),l=g("meta-time");return d(),f(e.MListItem,null,{"top-right":a(()=>[n(l,{date:o.item.createdAt},null,8,["date"])]),"bottom-left":a(()=>[v("div",null,m(o.item.displayDescription),1),o.showTarget?(d(),_("div",Q,[t[2]||(t[2]=i("Target: ")),n(e.MTextButton,{permission:"api.audit_logs.search",to:`/auditLogs?targetType=${o.item.target.targetType}&targetId=${o.item.target.targetId}`,"data-testid":"view-event-link"},{default:a(()=>[i(m(o.item.target.targetType.replace(/\$/,""))+":"+m(o.item.target.targetId),1)],void 0,!0),_:1},8,["to"])])):x("",!0)]),"bottom-right":a(()=>[n(e.MTextButton,{to:`/auditLogs/${o.item.eventId}`,permission:"api.audit_logs.view"},{default:a(()=>t[3]||(t[3]=[i("View log event")]),void 0,!0),_:1},8,["to"])]),default:a(()=>[i(m(o.item.displayTitle),1),v("span",K,[t[0]||(t[0]=i("by ")),n(p,{username:o.item.source.sourceId},null,8,["username"]),t[1]||(t[1]=i()),n(c,{isoCode:o.item.sourceCountryIsoCode?o.item.sourceCountryIsoCode:void 0},null,8,["isoCode"])])],void 0,!0),_:1})}const X=R(J,[["render",W],["__file","AuditLogEntry.vue"]]),Y=V({__name:"AuditLogDetailView",props:{id:{}},setup(E,{expose:t}){t();const o=E,e=B(),T=I(),s=b(),p=b([]),c=b(),l=C(()=>{if(!s.value)return;const r=s.value.target.targetType,u=s.value.target.targetId;if(r==="Player")return`/players/Player:${u}`;if(r==="Guild")return`/guilds/Guild:${u}`;if(r==="$Broadcast")return`/Broadcasts/${u}`;if(r==="$Notification")return`/Notifications/${u}`;if(r==="$Experiment")return`/Experiments/${u}`;if(r==="$GameConfig")return`/GameConfigs/${u}`;if(r==="AsyncMatchmaker")return`/matchmakers/AsyncMatchmaker:${u}`;if(r==="$Nft")return`/web3/nft/${u}`;if(r==="$NftCollection")return`/web3/nft/${u}`;if(r==="LeagueManager")return`/leagues/LeagueManager:${u}`});A(async()=>{try{s.value=(await e.get(`/auditLog/${o.id}`)).data;for(const r of s.value.relatedEventIds){const u=(await e.get(`/auditLog/${r}`)).data;p.value.push(u)}}catch(r){c.value=r}});const y=C(()=>{if(!s.value)return;const r=P(s.value.payload);return delete r.eventTitle,delete r.eventDescription,delete r.relatedEventIds,delete r.subsystemName,delete r.$type,r}),D=C(()=>{if(s.value)return s.value.target.targetType.replace(/^\$/,"")}),M={props:o,gameServerApi:e,route:T,logEventData:s,relatedLogEventsData:p,logEventError:c,targetLink:l,eventPayload:y,humanReadableTargetType:D,get cloneDeep(){return P},computed:C,ref:b,onMounted:A,get useRoute(){return I},get useGameServerApi(){return B},get MBadge(){return G},get MButton(){return j},get MCard(){return U},get MClipboardCopy(){return F},get MList(){return q},get MListItem(){return S},get MPageOverviewCard(){return z},get MTextButton(){return O},get MViewContainer(){return H},AuditLogEntry:X};return Object.defineProperty(M,"__isScriptSetup",{enumerable:!1,value:!0}),M}}),Z={class:"tw-text-black"},$={key:1,class:"text-muted tw-italic"},ee={class:"tw-mb-1 tw-font-semibold"},te={key:1,class:"tw-text-xs tw-text-neutral-600"},ae={key:1};function ne(E,t,o,e,T,s){const p=g("meta-username"),c=g("meta-time"),l=g("b-td"),y=g("b-tr"),D=g("meta-ip-address"),M=g("meta-country-code"),r=g("b-tbody"),u=g("b-table-simple"),L=g("meta-raw-data");return d(),f(e.MViewContainer,{permission:"api.audit_logs.view","is-loading":!e.logEventData,error:e.logEventError},{overview:a(()=>[e.logEventData?(d(),f(e.MPageOverviewCard,{key:0,title:`Event: ${e.logEventData.displayTitle}`,"data-testid":"audit-log-detail-overview-card"},{subtitle:a(()=>[v("div",null,[i("ID: "+m(e.route.params.id)+" ",1),n(e.MClipboardCopy,{contents:`${e.route.params.id}`},null,8,["contents"])]),v("div",Z,m(e.logEventData.displayDescription),1),v("div",null,[t[0]||(t[0]=i("By ")),n(p,{username:e.logEventData.source.sourceId},null,8,["username"]),t[1]||(t[1]=i()),n(c,{date:e.logEventData.createdAt},null,8,["date"]),t[2]||(t[2]=i("."))])]),buttons:a(()=>[e.targetLink?(d(),f(e.MButton,{key:0,to:e.targetLink,permission:"api.players.view"},{default:a(()=>[i("View Target "+m(e.humanReadableTargetType),1)],void 0,!0),_:1},8,["to"])):x("",!0)]),default:a(()=>[t[10]||(t[10]=v("h6",null,"Event Data",-1)),n(u,{small:"",responsive:""},{default:a(()=>[n(r,null,{default:a(()=>[n(y,null,{default:a(()=>[n(l,null,{default:a(()=>t[3]||(t[3]=[i("Target Type")]),void 0,!0),_:1}),n(l,{class:"tw-text-right"},{default:a(()=>[n(e.MTextButton,{to:`/auditLogs/?targetType=${e.logEventData.target.targetType}`,permission:"api.audit_logs.search"},{default:a(()=>[i(m(e.humanReadableTargetType),1)],void 0,!0),_:1},8,["to"])],void 0,!0),_:1})],void 0,!0),_:1}),n(y,null,{default:a(()=>[n(l,null,{default:a(()=>t[4]||(t[4]=[i("Target ID")]),void 0,!0),_:1}),n(l,{class:"tw-text-right"},{default:a(()=>[n(e.MTextButton,{to:`/auditLogs/?targetType=${e.logEventData.target.targetType}&targetId=${e.logEventData.target.targetId}`,permission:"api.audit_logs.search"},{default:a(()=>[i(m(e.humanReadableTargetType)+":"+m(e.logEventData.target.targetId),1)],void 0,!0),_:1},8,["to"])],void 0,!0),_:1})],void 0,!0),_:1}),n(y,null,{default:a(()=>[n(l,null,{default:a(()=>t[5]||(t[5]=[i("Event Date")]),void 0,!0),_:1}),n(l,{class:"tw-text-right"},{default:a(()=>[n(c,{date:e.logEventData.createdAt,showAs:"datetime"},null,8,["date"])],void 0,!0),_:1})],void 0,!0),_:1}),n(y,null,{default:a(()=>[n(l,null,{default:a(()=>t[6]||(t[6]=[i("User IP Address")]),void 0,!0),_:1}),e.logEventData.sourceIpAddress?(d(),f(l,{key:0,class:"tw-text-right"},{default:a(()=>[n(e.MTextButton,{to:`/auditLogs/?sourceIpAddress=${e.logEventData.sourceIpAddress}`,permission:"api.audit_logs.search"},{default:a(()=>[n(D,{ipAddress:e.logEventData.sourceIpAddress},null,8,["ipAddress"])],void 0,!0),_:1},8,["to"])],void 0,!0),_:1})):(d(),f(l,{key:1,class:"tw-text-right"},{default:a(()=>t[7]||(t[7]=[v("span",{class:"text-muted"},"None recorded",-1)]),void 0,!0),_:1}))],void 0,!0),_:1}),n(y,null,{default:a(()=>[n(l,null,{default:a(()=>t[8]||(t[8]=[i("User Country")]),void 0,!0),_:1}),e.logEventData.sourceCountryIsoCode?(d(),f(l,{key:0,class:"tw-text-right"},{default:a(()=>[n(e.MTextButton,{to:`/auditLogs/?sourceCountryIsoCode=${e.logEventData.sourceCountryIsoCode}`,permission:"api.audit_logs.search"},{default:a(()=>[n(M,{isoCode:e.logEventData.sourceCountryIsoCode,showName:""},null,8,["isoCode"])],void 0,!0),_:1},8,["to"])],void 0,!0),_:1})):(d(),f(l,{key:1,class:"tw-text-right"},{default:a(()=>t[9]||(t[9]=[v("span",{class:"text-muted"},"Unknown",-1)]),void 0,!0),_:1}))],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1}),t[11]||(t[11]=v("h6",{class:"tw-mb-2 tw-mt-4"},"Related Audit Log Events",-1)),e.relatedLogEventsData&&e.relatedLogEventsData.length>0?(d(),f(e.MList,{key:0,showBorder:""},{default:a(()=>[(d(!0),_(N,null,h(e.relatedLogEventsData,w=>(d(),_("div",{key:w.eventId},[n(e.AuditLogEntry,{item:w},null,8,["item"])]))),128))],void 0,!0),_:1})):(d(),_("div",$,"None"))],void 0,!0),_:1},8,["title"])):x("",!0)]),default:a(()=>[n(e.MCard,{title:"Event Payload","data-testid":"audit-log-detail-event-payload-card"},{default:a(()=>[e.eventPayload&&Object.keys(e.eventPayload).length>0?(d(),f(e.MList,{key:0,"show-border":""},{default:a(()=>[(d(!0),_(N,null,h(e.eventPayload,(w,k)=>(d(),_("div",{class:"tw-px-5 tw-py-3",key:k},[v("div",ee,m(k),1),w===null?(d(),f(e.MBadge,{key:0},{default:a(()=>t[12]||(t[12]=[i("null")]),void 0,!0),_:1})):(d(),_("pre",te,m(w),1))]))),128))],void 0,!0),_:1})):(d(),_("div",ae,"This event has no payload data."))],void 0,!0),_:1}),n(L,{kvPair:e.logEventData,name:"logEventData"},null,8,["kvPair"]),n(L,{kvPair:e.eventPayload,name:"eventPayload"},null,8,["kvPair"])]),_:1},8,["is-loading","error"])}const de=R(Y,[["render",ne],["__file","AuditLogDetailView.vue"]]);export{de as default};
