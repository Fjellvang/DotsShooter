import{d as G,x as _,c as I,f as L,d_ as A,ad as w,M as q,q as H,v as Y,a8 as $,ae as B,b as C,o as n,a as c,e as O,w as s,k as h,p as f,l as y,t as p,n as u,_ as z}from"./index-B7jvAjdE.js";import{M as J}from"./MActionModalButton-CvWVuTB-.js";import{M as l,a as m,c as b,b as D}from"./metaListUtils-B-xQ0HnD.js";import{c as F}from"./matchmaking-3j4jzqL_.js";import{a as R}from"./players-CydHenLG.js";import"./MActionModal-coQLkvWs.js";import"./index-fVjXqxSF.js";const K=G({__name:"PlayerMatchmakingCard",props:{playerId:{}},setup(P,{expose:r}){r();const d=P,{data:t}=_(R(d.playerId)),M=I(()=>t.value.model.playerName||"n/a"),{data:S,refresh:g}=_(F(d.playerId)),i=L(null),e=["matchmakerId","matchmakerName","matchmakerDescription"],N=[new l("Name","matchmakerName",m.Descending),new l("Name","matchmakerName",m.Ascending),new l("MMR","defenseMmr",m.Ascending),new l("MMR","defenseMmr",m.Descending),new l("Percentile","percentile",m.Ascending),new l("Percentile","percentile",m.Descending)],T=[new D("participating",[new b("Participating",a=>a.isParticipant),new b("Not participating",a=>!a.isParticipant)])],V=A(),{showSuccessNotification:k,showErrorNotification:v}=B();async function E(){if(!i.value)throw new Error("No matchmaker selected");await w().post(`matchmakers/${i.value.matchmakerId}/add/${d.playerId}`).then(a=>{const o=`${M.value} added to ${i.value.matchmakerName} successfully.`;k(o),g()}).catch(a=>{if(a.response.status===409){const o=a.response.data.error.details;v(o)}else console.error(a)})}async function j(){if(!i.value)throw new Error("No matchmaker selected");await w().post(`matchmakers/${i.value.matchmakerId}/remove/${d.playerId}`).then(a=>{const o=`${M.value} removed from ${i.value.matchmakerName} successfully.`;k(o),g()}).catch(a=>{if(a.response.status===409){const o=a.response.data.error.details;v(o)}else console.error(a)})}const x={props:d,playerData:t,playerName:M,matchmakers:S,matchmakersRefresh:g,selectedMatchmaker:i,searchFields:e,sortOptions:N,filterSets:T,vue:V,showSuccessNotification:k,showErrorNotification:v,enterMatchmaker:E,exitMatchmaker:j,computed:I,ref:L,getCurrentInstance:A,get useGameServerApi(){return w},get MetaListFilterOption(){return b},get MetaListFilterSet(){return D},get MetaListSortDirection(){return m},get MetaListSortOption(){return l},get MActionModalButton(){return J},get MBadge(){return q},get MCollapse(){return H},get MListItem(){return Y},get MTextButton(){return $},get useNotifications(){return B},get useSubscription(){return _},get getAllMatchmakersForPlayerSubscriptionOptions(){return F},get getSinglePlayerSubscriptionOptions(){return R}};return Object.defineProperty(x,"__isScriptSetup",{enumerable:!1,value:!0}),x}}),Q={key:0},U={key:1},W={key:0},X={key:1},Z={class:"border rounded-sm bg-light py-2 tw-px-4"},ee={class:"font-weight-bold tw-mb-1"},te={class:"tw-mt-1 tw-inline-flex tw-w-full tw-justify-end"},ae={key:0},re={key:1};function se(P,r,d,t,M,S){const g=C("fa-icon"),i=C("meta-list-card");return n(),c("div",null,[t.playerData?(n(),O(i,{key:0,title:"Matchmaking",icon:"chess",tooltip:`Shows matchmakers that ${t.playerName} belongs to.`,itemList:t.matchmakers,searchFields:t.searchFields,filterSets:t.filterSets,sortOptions:t.sortOptions,emptyMessage:`${t.playerName} isn't registered to any matchmakers.`,permission:"api.matchmakers.view","data-testid":"player-matchmaking-card"},{"item-card":s(({item:e})=>[h(t.MCollapse,{extraMListItemMargin:""},{header:s(()=>[h(t.MListItem,{noLeftPadding:"","data-testid":"player-matchmaking-list-entry"},{badge:s(()=>[e.isParticipant?(n(),O(t.MBadge,{key:0,variant:"success"},{default:s(()=>r[0]||(r[0]=[f("Participant")]),void 0,!0),_:1})):y("",!0)]),"top-right":s(()=>[e.isParticipant?(n(),c("div",Q,"MMR: "+p(e.defenseMmr),1)):(n(),c("div",U,"Not a participant"))]),"bottom-left":s(()=>[f(p(e.matchmakerDescription),1)]),"bottom-right":s(()=>[e.isParticipant?(n(),c("div",W,"Percentile: "+p(Math.round(e.percentile*1e4)/100)+"%",1)):y("",!0),e.isParticipant?(n(),c("div",X,"Bucket: "+p(e.bucketInfo.mmrLow)+" - "+p(e.bucketInfo.mmrHigh),1)):y("",!0),h(t.MTextButton,{to:`/matchmakers/${e.matchmakerId}`},{default:s(()=>r[1]||(r[1]=[f("View matchmaker")]),void 0,!0),_:2},1032,["to"])]),default:s(()=>[f(p(e.matchmakerName),1)],void 0,!0),_:2},1024)]),default:s(()=>[u("div",Z,[u("div",ee,[h(g,{icon:"wrench"}),r[2]||(r[2]=f(" Admin Controls"))]),r[4]||(r[4]=u("div",{class:"small text-muted mb-2"},"You can add or remove this player from the matchmaker. These actions are safe to use in production.",-1)),u("div",te,[h(t.MActionModalButton,{"modal-title":e.isParticipant?"Remove Player from Matchmaker":"Add Player to Matchmaker",action:e.isParticipant?t.exitMatchmaker:t.enterMatchmaker,"trigger-button-label":e.isParticipant?"Remove Player":"Add Player",variant:"warning","ok-button-label":e.isParticipant?"Remove from Matchmaker":"Add to Matchmaker",permission:"api.matchmakers.admin",onShow:N=>t.selectedMatchmaker=e,"data-testid":"add-remove-player-matchmaker"},{default:s(()=>[e.isParticipant?(n(),c("span",ae,"Removing a player from a matchmaker means they will no longer be available for other players to match against.")):(n(),c("span",re,r[3]||(r[3]=[u("p",null,"Adding a player into a matchmaker makes them a valid target for other players to match against.",-1),u("p",{class:"tw-text-xs+ tw-text-neutral-500"},"Players typically get added into matchmakers as a part of normal gameplay. This action is mostly useful for faster testing during development.",-1)])))],void 0,!0),_:2},1032,["modal-title","action","trigger-button-label","ok-button-label","onShow"])])])],void 0,!0),_:2},1024)]),_:1},8,["tooltip","itemList","emptyMessage"])):y("",!0)])}const pe=z(K,[["render",se],["__file","PlayerMatchmakingCard.vue"]]);export{pe as default};
