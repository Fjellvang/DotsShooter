import{ak as M,d as q,f as C,x as T,y as F,c,d$ as oe,C as ie,ac as J,b as se,o as r,e as S,w as b,k as u,n as o,p as Q,t as f,a as i,F as h,r as L,$ as p,l as O,_ as X,a0 as ue,ai as de}from"./index-B7jvAjdE.js";import{a as G,g as E}from"./localization-Z8p1s5Vr.js";import{M as ce}from"./MInputCheckbox-BqateWtE.js";import{M as ge}from"./MInputSingleSelectRadio-BukGu4ZH.js";import{M as we}from"./MInputText-CzhsT8yb.js";import{d as H}from"./debounce-B8gTqdZO.js";import{B as be,c as A}from"./button-group-BUOztpby.js";import"./index-B_QkKjtG.js";import"./MInputHintMessage-DbuBS4Kn.js";import"./index-CDBqmjrS.js";import"./isSymbol-B7ZrWRtH.js";function ve(g){const n={Build:"This error is most likely caused by an issue in the source data."};if(g.errorType==="Exception")return new M("Exception","An exception occurred.","Build",n.Build);if(g.errorType==="StringException"){const v=g;return new M("Exception","An exception occurred.","Build",n.Build,[{title:"Full Exception",content:v.fullException}])}else return g.errorType==="TaskDisappeared"?new M("Task Disappeared","The build task mysteriously disappeared, likely due to the server stopping or crashing.","Build",n.Build):g.errorType==="BlockingMessages"?new M("Task Disappeared","The build or validation logs contain errors. Please resolve them and try building again.","Build",n.Build):new M("Unknown Error","Unknown error type","Build",n.Build,[{title:"Source Error",content:g}])}const V=100,me=q({__name:"LocalizationContentsCard",props:{localizationId:{}},setup(g,{expose:n}){n();const v=g,e=new Intl.Collator("en",{numeric:!0}),y=C(),{data:w}=T(G(v.localizationId)),{data:s}=T(F()),a=c(()=>w.value?.languageIds),d=function(t){if(s.value?.gameConfig.Languages){const l=Object.values(s.value.gameConfig.Languages).find(m=>m.languageId===t);if(l)return`${l.displayName} (${l.languageId})`}return t},K=c(()=>w.value?w.value.table.map(t=>({...t,isAnyLanguageValueMissing:a.value?.some(l=>t.values[l]===void 0||t.values[l]===""||t.values[l].startsWith("#missing"))??!1})):[]),N=C(!1),Y=c(()=>x.value.filter(t=>t.isAnyLanguageValueMissing).length),z=C("unsorted"),Z=[{label:"Unsorted",value:"unsorted"},{label:"Keys alphabetically ↑",value:"alphabeticalAsc"},{label:"Keys alphabetically ↓",value:"alphabeticalDesc"}],x=c(()=>{let t=[...K.value];return N.value&&(t=t.filter(l=>l.isAnyLanguageValueMissing)),_.value&&_.value.length>0&&(t=t.filter(l=>!!(D(l.title)||Object.values(l.values).some(m=>D(m))))),z.value==="alphabeticalAsc"?t=t.slice().sort((l,m)=>e.compare(l.title,m.title)):z.value==="alphabeticalDesc"&&(t=t.slice().sort((l,m)=>e.compare(m.title,l.title))),t});function D(t){return _.value?t.toLowerCase().includes(_.value):!1}function $(t){y.value=t,j()}const _=C(),j=H(()=>{_.value=y.value?.toLowerCase()},200),ee=c(()=>w.value?.info.bestEffortStatus==="Success"?"primary":"danger"),te=c(()=>{const t=w.value?.table.length;return w.value?.info.bestEffortStatus==="Success"?x.value.length===t?t:x.value.length+" / "+t:"Error"}),P=C({});function ae(t){P.value[t]=!P.value[t]}const ne=c(()=>{if(R.value){const t=I.value*V;return x.value.slice(t,t+V).map(m=>({...m,isAnyLanguageValueTruncated:Object.values(m.values).some(W=>!W.startsWith("#missing")&&W.length>37)}))}else return x.value.map(t=>({...t,isAnyLanguageValueTruncated:Object.values(t.values).some(l=>l.length>37)}))}),R=c(()=>k.value>1),k=c(()=>{const t=x.value.length;return Math.ceil(t/V)}),B=C(0),I=c(()=>Math.min(B.value,k.value-1));function re(t){B.value=A(t,0,k.value-1)}function le(t){B.value=A(I.value+t,0,k.value-1)}const U={props:v,collator:e,searchString:y,localizationTableData:w,gameData:s,languageIds:a,languageIdToName:d,decoratedItemList:K,showMissingValuesOnly:N,totalMissingLocalizationValues:Y,sortKeyOption:z,sortKeyOptions:Z,filteredItemList:x,containsSearchTerm:D,updateSearchString:$,lowerCaseSearchString:_,debounceSearchStringToLowerCase:j,badgeVariant:ee,badgeValue:te,expandedLocalizationKeys:P,onLocalizationEntryClicked:ae,pageSize:V,currentPageItemList:ne,showPagingControls:R,totalPageCount:k,desiredCurrentPage:B,currentPage:I,gotoPageAbsolute:re,gotoPageRelative:le,get BButtonGroup(){return be},get BButton(){return oe},get clamp(){return A},get debounce(){return H},computed:c,ref:C,watch:ie,get MCard(){return J},get MInputText(){return we},get MInputCheckbox(){return ce},get MInputSingleSelectRadio(){return ge},get useSubscription(){return T},get getGameDataSubscriptionOptions(){return F},get getSingleLocalizationTableSubscriptionOptions(){return G}};return Object.defineProperty(U,"__isScriptSetup",{enumerable:!1,value:!0}),U}}),pe={class:"tw-mt-2 tw-flex tw-gap-x-10 tw-rounded-md tw-border tw-border-neutral-200 tw-bg-neutral-100 tw-px-5 tw-py-2 tw-text-neutral-600"},fe={class:"tw-overflow-x-auto"},he={key:0,class:"tw-w-full"},ye={class:"tw-border tw-border-neutral-200 tw-text-xs+"},xe={key:0,class:"tw-border-x tw-border-b tw-border-neutral-200"},Ce=["onClick"],_e={style:{"min-width":"14rem"}},Le={style:{"min-width":"14rem"}},Se={key:1,class:"tw-italic tw-text-neutral-500"},ke={key:0,class:"tw-mt-4 tw-text-center"},Me={class:"px-3 bg-secondary text-light pagination-shadow",style:{"padding-top":"0.3rem","min-width":"4rem"}};function Te(g,n,v,e,y,w){const s=se("fa-icon");return r(),S(e.MCard,{title:"Localization Contents",badgeVariant:e.badgeVariant,badge:e.badgeValue,isLoading:!e.localizationTableData,"data-testid":"localization-contents-card"},{icon:b(()=>[u(s,{icon:"language"})]),"header-right":b(()=>[u(e.MInputText,{"model-value":e.searchString,placeholder:"Search...","onUpdate:modelValue":e.updateSearchString},null,8,["model-value"])]),subtitle:b(()=>[o("div",pe,[o("div",null,[u(e.MInputCheckbox,{"model-value":e.showMissingValuesOnly,label:"Filter",name:"Show only keys with missing values",variant:e.totalMissingLocalizationValues>0?"danger":"default",size:"small","onUpdate:modelValue":n[0]||(n[0]=a=>e.showMissingValuesOnly=a)},{default:b(()=>[Q("Keys with missing values ("+f(e.totalMissingLocalizationValues)+")",1)],void 0,!0),_:1},8,["model-value","variant"])]),o("div",null,[u(e.MInputSingleSelectRadio,{"model-value":e.sortKeyOption,label:"Sort",options:e.sortKeyOptions,size:"small","onUpdate:modelValue":n[1]||(n[1]=a=>e.sortKeyOption=a)},null,8,["model-value"])])])]),default:b(()=>[o("div",fe,[!(e.searchString&&e.filteredItemList.length===0)&&(!e.showMissingValuesOnly||e.totalMissingLocalizationValues>0)?(r(),i("table",he,[o("thead",null,[o("tr",ye,[n[6]||(n[6]=o("th",{class:"tw-pl-2"},"Localization Key",-1)),(r(!0),i(h,null,L(e.languageIds,a=>(r(),i("th",{class:"tw-border-l tw-border-neutral-200 tw-pl-2",key:a},f(e.languageIdToName(a)),1))),128))])]),o("tbody",null,[e.localizationTableData?.table.length===0?(r(),i("tr",xe,[(r(!0),i(h,null,L(e.localizationTableData.table.length+2,a=>(r(),i("td",{class:p(["tw-px-2 tw-text-xs tw-italic tw-text-neutral-400 tw-border-neutral-200 tw-border-t",{"tw-border-l":a>1}])},"Library is empty.",2))),256))])):(r(!0),i(h,{key:1},L(e.currentPageItemList,a=>(r(),i("tr",{key:a.title,class:p(["tw-text-xs tw-border-neutral-200 tw-border odd:tw-bg-neutral-100 tw-align-top",{"hover:tw-cursor-pointer hover:tw-bg-neutral-300 active:tw-bg-neutral-400":a.isAnyLanguageValueTruncated}]),onClick:d=>e.onLocalizationEntryClicked(a.title)},[a.isAnyLanguageValueTruncated?(r(),i(h,{key:0},[o("td",{class:p(["tw-pl-2 tw-py-1 tw-font-mono tw-whitespace-nowrap",{"tw-bg-orange-200":e.containsSearchTerm(a.title)}])},[o("div",_e,[u(s,{icon:"angle-right",class:p(["tw-mr-1",{"tw-rotate-90":e.expandedLocalizationKeys[a.title]}])},null,8,["class"]),o("span",null,f(a.title),1),a.isAnyLanguageValueMissing?(r(),S(s,{key:0,class:"tw-relative -tw-bottom-[1px] tw-ml-1 tw-text-red-500",icon:"circle-exclamation"})):O("",!0)])],2),(r(!0),i(h,null,L(e.languageIds,d=>(r(),i("td",{key:d,class:p(["tw-border-l tw-border-neutral-200 tw-pl-2 tw-py-1.5",{"tw-bg-orange-200":e.containsSearchTerm(a.values[d])}])},[o("div",{class:p(["tw-w-56 tw-break-words",{"tw-truncate":!e.expandedLocalizationKeys[a.title],"tw-whitespace-pre-wrap":e.expandedLocalizationKeys[a.title],"tw-text-red-500 tw-italic":a.values[d].startsWith("#missing")}])},f(a.values[d].startsWith("#missing")?"Missing value":a.values[d]),3)],2))),128))],64)):(r(),i(h,{key:1},[o("td",{class:p(["tw-pl-2 tw-py-1 tw-font-mono tw-whitespace-nowrap",{"tw-bg-orange-200":e.containsSearchTerm(a.title)}])},[o("div",Le,[o("span",null,f(a.title),1),a.isAnyLanguageValueMissing?(r(),S(s,{key:0,class:"tw-relative -tw-bottom-[1px] tw-ml-1 tw-text-red-500",icon:"circle-exclamation"})):O("",!0)])],2),(r(!0),i(h,null,L(e.languageIds,d=>(r(),i("td",{key:d,class:p(["tw-border-l tw-border-neutral-200 tw-pl-2 tw-py-1",{"tw-bg-orange-200":e.containsSearchTerm(a.values[d])}])},[o("div",{class:p(["tw-w-56 tw-overflow-x-hidden",{"tw-text-red-500 tw-italic":a.values[d].startsWith("#missing")}])},f(a.values[d].startsWith("#missing")?"Missing value":a.values[d]),3)],2))),128))],64))],10,Ce))),128))])])):(r(),i("div",Se,"No results. Try a different search?"))]),e.showPagingControls?(r(),i("div",ke,[u(e.BButtonGroup,{size:"sm"},{default:b(()=>[u(e.BButton,{disabled:e.currentPage==0,onClick:n[2]||(n[2]=a=>e.gotoPageAbsolute(0))},{default:b(()=>[u(s,{icon:["fas","fast-backward"]})],void 0,!0),_:1},8,["disabled"]),u(e.BButton,{disabled:e.currentPage==0,onClick:n[3]||(n[3]=a=>e.gotoPageRelative(-1))},{default:b(()=>[u(s,{icon:"backward"})],void 0,!0),_:1},8,["disabled"]),o("div",Me,[o("small",null,f(e.currentPage+1)+" / "+f(e.totalPageCount),1)]),u(e.BButton,{disabled:e.currentPage==e.totalPageCount-1,onClick:n[4]||(n[4]=a=>e.gotoPageRelative(1))},{default:b(()=>[u(s,{icon:"forward"})],void 0,!0),_:1},8,["disabled"]),u(e.BButton,{disabled:e.currentPage==e.totalPageCount-1,onClick:n[5]||(n[5]=a=>e.gotoPageAbsolute(e.totalPageCount-1))},{default:b(()=>[u(s,{icon:["fas","fast-forward"]})],void 0,!0),_:1},8,["disabled"])],void 0,!0),_:1})])):O("",!0)],void 0,!0),_:1},8,["badgeVariant","badge","isLoading"])}const Be=X(me,[["render",Te],["__file","LocalizationContentsCard.vue"]]),Ve=q({__name:"LocalizationDetails",props:{localizationId:{}},setup(g,{expose:n}){n();const v=g,{data:e}=T(E()),y=c(()=>(e.value??[]).find(s=>s.id===v.localizationId)),w={props:v,allLocalizationsData:e,localizationData:y,computed:c,get MCallout(){return ue},get MCard(){return J},get MErrorCallout(){return de},get useSubscription(){return T},get localizationErrorToDisplayError(){return ve},get getAllLocalizationsSubscriptionOptions(){return E},LocalizationContentsCard:Be};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}}),ze={key:1},De={class:"tw-space-y-2"};function Pe(g,n,v,e,y,w){return e.localizationData?.bestEffortStatus==="Building"?(r(),S(e.MCallout,{key:0,title:"Building Localizations...",variant:"neutral"},{default:b(()=>n[0]||(n[0]=[Q("This localizations are still building. Check back soon!")]),void 0,!0),_:1})):e.localizationData?.bestEffortStatus==="Failed"?(r(),i("div",ze,[u(e.MCard,{title:"Error Accessing Localizations Data",subtitle:"This localization has one or more errors that are preventing it from being published. Here's what we know:",variant:"danger"},{default:b(()=>[o("div",De,[(r(!0),i(h,null,L(e.localizationData?.publishBlockingErrors,s=>(r(),S(e.MErrorCallout,{error:e.localizationErrorToDisplayError(s)},null,8,["error"]))),256))])],void 0,!0),_:1})])):(r(),S(e.LocalizationContentsCard,{key:2,localizationId:v.localizationId},null,8,["localizationId"]))}const Ee=X(Ve,[["render",Pe],["__file","LocalizationDetails.vue"]]);export{Ee as default};
