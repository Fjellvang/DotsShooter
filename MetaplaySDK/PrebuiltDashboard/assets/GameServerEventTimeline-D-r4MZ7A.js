import{W as Fe,R as Ae,e1 as Ne,e2 as Ve,T as Oe,e3 as Be,e4 as Ge,e5 as We,d as H,o as l,a as r,m as Ce,_ as q,c as S,L as ze,e as R,w as P,p as z,t as h,bd as x,l as D,n as a,k as V,F as L,N,e6 as ee,ck as $,f as F,C as K,h as Y,bf as de,$ as ie,r as O,e7 as ye,e8 as be,ba as je,a2 as ce,O as we,M as xe,b as He,q as qe,bN as Ue,ac as Ke,dA as pe,cI as oe,ad as he}from"./index-B7jvAjdE.js";import{a as Te}from"./numberUtils-CkF0oMe2.js";import{M as Ye}from"./MInputSingleSelectDropdown-D7-YpE7w.js";import{M as Qe}from"./MInputText-CzhsT8yb.js";import{M as Xe}from"./MDateTime-BN0QPwIm.js";import"./index-qTA83-by.js";import"./index-B_QkKjtG.js";import"./MInputHintMessage-DbuBS4Kn.js";import"./debounce-B8gTqdZO.js";import"./isSymbol-B7ZrWRtH.js";var Je="[object Map]",Ze="[object Set]",$e=Object.prototype,et=$e.hasOwnProperty;function tt(i){if(i==null)return!0;if(Fe(i)&&(Ae(i)||typeof i=="string"||typeof i.splice=="function"||Ne(i)||Ve(i)||Oe(i)))return!i.length;var t=Be(i);if(t==Je||t==Ze)return!i.size;if(Ge(i))return!We(i).length;for(var n in i)if(et.call(i,n))return!1;return!0}const nt=H({inheritAttrs:!1,__name:"MEventTimelineItemInstantEvent",props:{renderInfo:{},selected:{type:Boolean}},setup(i,{expose:t}){t();const n={};return Object.defineProperty(n,"__isScriptSetup",{enumerable:!1,value:!0}),n}});function it(i,t,n,e,s,m){return l(),r("div",Ce(i.$attrs,{class:"tw-absolute tw-flex tw-cursor-pointer tw-rounded-full tw-border tw-border-neutral-50 tw-shadow tw-filter hover:tw-brightness-90 active:tw-brightness-75"},{class:{"tw-ring tw-ring-blue-500 tw-ring-offset-1":n.selected},style:n.renderInfo.styles,onClick:t[0]||(t[0]=o=>i.$emit("click"))}),null,16)}const st=q(nt,[["render",it],["__file","MEventTimelineItemInstantEvent.vue"]]),ot=H({__name:"MAbbreviateNumber",props:{number:{},unit:{},roundDown:{type:Boolean},disableTooltip:{type:Boolean}},setup(i,{expose:t}){t();const n=i,e=S(()=>n.roundDown?Math.floor(n.number):n.number),s=S(()=>Te(e.value)),m=S(()=>{if(!(s.value===e.value.toString()||n.disableTooltip))return n.number.toLocaleString()}),o=S(()=>n.unit?`${s.value} ${n.unit}${e.value===1?"":"s"}`:s.value),c={props:n,roundedNumber:e,abbreviatedNumberString:s,tooltipContent:m,numberDisplayString:o,computed:S,get abbreviateNumber(){return Te},MTooltip:ze};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}});function lt(i,t,n,e,s,m){return l(),R(e.MTooltip,{content:e.tooltipContent},{default:P(()=>[z(h(e.numberDisplayString),1)],void 0,!0),_:1},8,["content"])}const Ee=q(ot,[["render",lt],["__file","MAbbreviateNumber.vue"]]),at=H({inheritAttrs:!1,__name:"MEventTimelineItemLiveopsEvent",props:{renderInfo:{},selected:{type:Boolean}},setup(i,{expose:t}){t();const n={MAbbreviateNumber:Ee};return Object.defineProperty(n,"__isScriptSetup",{enumerable:!1,value:!0}),n}}),rt={key:0,class:"tw-absolute tw-inset-0 tw-overflow-clip tw-rounded-md"},dt={key:0,class:"tw-absolute tw-inset-0 tw-overflow-clip tw-rounded-md"},mt={key:0,class:"tw-absolute tw-inset-0 tw-overflow-clip tw-rounded-md"},ct={class:"tw-truncate"},ut={key:0,class:"tw-text-xs tw-italic"},vt={key:0,class:"tw-flex tw-h-3 tw-items-center tw-justify-between tw-space-x-1 tw-overflow-hidden"},wt={class:"tw-flex tw-items-center tw-space-x-1 tw-pl-[1px]"},It={key:0,class:"tw-relative tw-bottom-[1px] tw-size-2"},ft={key:1,class:"tw-size-2.5"},gt={key:2,class:"tw-size-2"},yt={class:"tw-text-xs"},bt={key:0,class:"tw-flex tw-items-center tw-space-x-1"};function pt(i,t,n,e,s,m){return l(),r(L,null,[n.renderInfo.plainTimeContainerStyles?(l(),r("div",{key:0,class:"tw-pointer-events-none tw-absolute tw-rounded-lg",style:x(n.renderInfo.plainTimeContainerStyles)},null,4)):D("",!0),a("div",Ce(i.$attrs,{class:"tw-absolute tw-flex tw-cursor-pointer tw-rounded-lg tw-border tw-border-neutral-50 tw-shadow tw-filter hover:tw-brightness-90 active:tw-brightness-75"},{class:{"tw-ring tw-ring-blue-500 tw-ring-offset-1":n.selected},style:n.renderInfo.containerStyles,onClick:t[0]||(t[0]=o=>i.$emit("click"))}),[n.renderInfo.previewStyles?(l(),r("div",{key:0,class:"tw-relative tw-rounded-l-md tw-bg-neutral-500",style:x(n.renderInfo.previewStyles)},[n.renderInfo.currentPhase==="preview"?(l(),r("div",rt,t[1]||(t[1]=[a("div",{class:"active-event-overlay tw-rounded-l-md"},null,-1)]))):D("",!0)],4)):D("",!0),a("div",{class:"tw-relative tw-grow",style:x(n.renderInfo.activePhasesStyles)},[n.renderInfo.currentPhase==="active"?(l(),r("div",dt,t[2]||(t[2]=[a("div",{class:"active-event-overlay"},null,-1)]))):D("",!0)],4),n.renderInfo.reviewStyles?(l(),r("div",{key:1,class:"tw-relative tw-rounded-r-md tw-bg-neutral-500",style:x(n.renderInfo.reviewStyles)},[n.renderInfo.currentPhase==="review"?(l(),r("div",mt,t[3]||(t[3]=[a("div",{class:"active-event-overlay tw-rounded-r-md"},null,-1)]))):D("",!0)],4)):D("",!0)],16),a("div",{class:"tw-pointer-events-none tw-absolute tw-flex tw-select-none tw-flex-col tw-content-center tw-justify-between tw-px-1.5 tw-text-xs",style:x(n.renderInfo.textContainerStyles)},[a("div",ct,[z(h(n.renderInfo.displayName)+" ",1),n.renderInfo.eventState==="draft"?(l(),r("span",ut,h(n.renderInfo.eventState),1)):D("",!0)]),n.renderInfo.isGroupExpanded?(l(),r("div",vt,[a("div",wt,[n.renderInfo.isLocked?(l(),r("div",It,t[4]||(t[4]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"},[a("path",{d:"M144 144v48H304V144c0-44.2-35.8-80-80-80s-80 35.8-80 80zM80 192V144C80 64.5 144.5 0 224 0s144 64.5 144 144v48h16c35.3 0 64 28.7 64 64V448c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V256c0-35.3 28.7-64 64-64H80z"})],-1)]))):D("",!0),n.renderInfo.isRecurring?(l(),r("div",ft,t[5]||(t[5]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},[a("path",{d:"M0 224c0 17.7 14.3 32 32 32s32-14.3 32-32c0-53 43-96 96-96H320v32c0 12.9 7.8 24.6 19.8 29.6s25.7 2.2 34.9-6.9l64-64c12.5-12.5 12.5-32.8 0-45.3l-64-64c-9.2-9.2-22.9-11.9-34.9-6.9S320 19.1 320 32V64H160C71.6 64 0 135.6 0 224zm512 64c0-17.7-14.3-32-32-32s-32 14.3-32 32c0 53-43 96-96 96H192V352c0-12.9-7.8-24.6-19.8-29.6s-25.7-2.2-34.9 6.9l-64 64c-12.5 12.5-12.5 32.8 0 45.3l64 64c9.2 9.2 22.9 11.9 34.9 6.9s19.8-16.6 19.8-29.6V448H352c88.4 0 160-71.6 160-160z"})],-1)]))):D("",!0),n.renderInfo.isTargeted?(l(),r("div",gt,t[6]||(t[6]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},[a("path",{d:"M448 256A192 192 0 1 0 64 256a192 192 0 1 0 384 0zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm256 80a80 80 0 1 0 0-160 80 80 0 1 0 0 160zm0-224a144 144 0 1 1 0 288 144 144 0 1 1 0-288zM224 256a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"})],-1)]))):D("",!0)]),a("div",yt,[n.renderInfo.participantCount?(l(),r("div",bt,[t[7]||(t[7]=a("div",{class:"tw-relative tw-bottom-[1px] tw-size-2"},[a("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"},[a("path",{d:"M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.8 304 0 383.8 0 482.3C0 498.7 13.3 512 29.7 512H418.3c16.4 0 29.7-13.3 29.7-29.7C448 383.8 368.2 304 269.7 304H178.3z"})])],-1)),V(e.MAbbreviateNumber,{number:n.renderInfo.participantCount,disableTooltip:""},null,8,["number"])])):D("",!0)])])):D("",!0)],4)],64)}const ht=q(at,[["render",pt],["__file","MEventTimelineItemLiveopsEvent.vue"]]);function le(i){for(const t of Object.values(i))if(t.itemType==="root")return t;throw new Error("No root element found in timeline data")}function Ie(i,t){return console.assert(!!t&&t.itemType==="root"),t.hierarchy.childIds.map(n=>{const e=i[n];return console.assert(!!e),console.assert(e.itemType==="section"),[n,e]})}function fe(i,t){return console.assert(!!t&&t.itemType==="section"),t.hierarchy.childIds.map(n=>{const e=i[n];return console.assert(!!e),console.assert(e.itemType==="group"),[n,e]})}function ge(i,t){return console.assert(!!t&&t.itemType==="group"),t.hierarchy.childIds.map(n=>{const e=i[n];return console.assert(!!e),console.assert(e.itemType==="row"),[n,e]})}function _e(i,t){return console.assert(!!t&&t.itemType==="row"),t.hierarchy.childIds.map(n=>{const e=i[n];return console.assert(!!e),[n,e]})}class ae{typeName;constructor(t){this.typeName=t}getAs(t,n){console.assert(!!n,"No items supplied");const e=n[t];return console.assert(!!e,"Item not found"),console.assert(this.typeName===""||e.itemType===this.typeName,"Item is not of the expected type"),e}getParentAs(t,n){console.assert(!!n,"No items supplied");const e=this.getRaw(t,n);console.assert(!!e.hierarchy?.parentId,"Item has no parent");const s=e.hierarchy.parentId,m=this.getAs(s,n);console.assert(!!m.hierarchy.childIds,"Parent has no children");const o=m.hierarchy.childIds.indexOf(t);return console.assert(o>=0,"Item not found in parent"),{parentId:s,parentItem:m,childIndex:o}}getChildAs(t,n,e){console.assert(!!e,"No items supplied");const m=this.getRaw(t,e).hierarchy.childIds;console.assert(!!m,"Item has no children"),console.assert(n>=0&&n<m.length,"Child index out of bounds");const o=m[n],c=this.getAs(o,e);return{childId:o,childItem:c}}getRaw(t,n){console.assert(!!n,"No items supplied");const e=n[t];return console.assert(!!e,"Item not found"),e}}function De(i,t){const n=new ae(""),{parentItem:e}=n.getParentAs(i,t);return!!e.isImmutable}const Me=2,Pe=1.5,Re=2.75;function W(i){return i*parseFloat(getComputedStyle(document.documentElement).fontSize)}function ue(i){return i/parseFloat(getComputedStyle(document.documentElement).fontSize)}function re(i,t=.5){const[n,e,s]=i.match(/\w\w/g).map(u=>parseInt(u,16)),m=Math.round((255-n)*t+n),o=Math.round((255-e)*t+e),c=Math.round((255-s)*t+s);return`rgb(${m}, ${o}, ${c})`}function Se(i,t,n,e,s,m,o){const c={},u=le(i.items);for(const[,b]of Ie(i.items,u))for(const[f,T]of fe(i.items,b)){const I=o.includes(f);for(const[,C]of ge(i.items,T))for(const[g,p]of _e(i.items,C))if(p.itemType==="liveopsEvent"){const v=p,d=Tt(v),k=kt(v,n);if(k<e||d>s)continue;const M=Dt(g,v,d),E=St(g,v,k),B={id:g,eventState:v.renderData.state,eventStartInstant:d,eventPreviewEndInstant:M,eventReviewStartInstant:E,eventEndInstant:k,plainTimeContainerStyles:v.renderData.schedule?.timeMode==="playerLocal"?Ct(v,t,m,d,k,I):void 0,containerStyles:xt(v,t,m,d,k,I),previewStyles:Et(v,t,m,d,M),activePhasesStyles:_t(v,!!E,!!M),textContainerStyles:Mt(v,t,n,N.fromISO(i.endInstantIsoString,{zone:"utc"}),e,s,m,d,M,E,k,I),reviewStyles:Pt(v,t,m,E,k),currentPhase:v.renderData.schedule?.timeMode==="utc"?v.renderData.schedule.currentPhase:void 0,displayName:v.metadata.displayName,colorInHex:v.metadata.color??ee.liveopsEventItem,isLocked:v.renderData.isLocked||v.renderData.isImmutable,isTargeted:!!v.renderData.isTargeted,isRecurring:v.renderData.isRecurring,isGroupExpanded:I,participantCount:v.renderData.participantCount};c[g]=B}else if(p.itemType==="instantEvent"){const v=p,d=Rt(v,t,m,N.fromISO(v.renderData.instantIsoString),I);c[g]=d}}return c}function Tt(i){return i.renderData.timelinePosition.startInstantIsoString?N.fromISO(i.renderData.timelinePosition.startInstantIsoString):N.utc()}function Dt(i,t,n){if(t.renderData.schedule?.previewDurationIsoString){const e=$.fromISO(t.renderData.schedule.previewDurationIsoString);if(!e.isValid)throw new Error(`Invalid preview duration: ${t.renderData.schedule.previewDurationIsoString} for event ${i} (${e.invalidReason} - ${e.invalidExplanation})`);return n.plus(e)}else return}function St(i,t,n){if(t.renderData.schedule?.reviewDurationIsoString){const e=$.fromISO(t.renderData.schedule.reviewDurationIsoString);if(!e.isValid)throw new Error(`Invalid review duration: ${t.renderData.schedule.reviewDurationIsoString} for event ${i} (${e.invalidReason} - ${e.invalidExplanation})`);return n.minus(e)}else return}function kt(i,t){return i.renderData.timelinePosition.endInstantIsoString?N.fromISO(i.renderData.timelinePosition.endInstantIsoString):t}function Ct(i,t,n,e,s,m){const o=e.diff(t,"days").days*W(n),c=s.diff(t,"days").days*W(n);return{left:`${o}px`,width:`${c-o}px`,height:m?"42px":"22px",backgroundColor:re(i.metadata.color??ee.liveopsEventItem),border:"2px dotted rgba(255, 255, 255, 0.7)"}}function xt(i,t,n,e,s,m,o){let c=e.diff(t,"days").days*W(n),u=s.diff(t,"days").days*W(n);i.renderData.schedule?.timeMode==="playerLocal"&&(i.renderData.schedule.plainTimeStartInstantIsoString&&(c=N.fromISO(i.renderData.schedule.plainTimeStartInstantIsoString).diff(t,"days").days*W(n)),i.renderData.schedule.plainTimeEndInstantIsoString&&(u=N.fromISO(i.renderData.schedule.plainTimeEndInstantIsoString).diff(t,"days").days*W(n)));const b=i.renderData.state==="draft"?"3px dashed rgba(255, 255, 255, 0.7)":void 0,f=i.renderData.state==="concluded"?"grayscale(20%) brightness(90%)":i.renderData.state==="draft"?"grayscale(40%)":void 0,T=m?"42px":"22px",I=i.metadata.color??ee.liveopsEventItem;return{left:`${c}px`,width:`${u-c}px`,height:T,border:b,filter:f,zIndex:o,backgroundColor:I}}function Et(i,t,n,e,s){if(!s)return;const m=e.diff(t,"days").days,o=s.diff(t,"days").days,c=re(i.metadata.color??ee.liveopsEventItem),u=i.renderData.schedule?.timeMode==="playerLocal"?`linear-gradient(to right, ${c} 60%, ${c.slice(0,-1)}, 0))`:c;return{flexBasis:`${(o-m)*W(n)}px`,background:u}}function _t(i,t,n){const e=i.metadata.color??ee.liveopsEventItem,s=t?"0":"0.375rem",m=n?"0":"0.375rem";return{backgroundColor:e,borderRadius:`${m} ${s} ${s} ${m}`}}function Mt(i,t,n,e,s,m,o,c,u,b,f,T,I,C){let g=c,p=f;g<s&&(g=s),p>m&&(p=m),p>e&&(p=e);let v=g.diff(t,"days").days*W(o),d=p.diff(t,"days").days*W(o);if(i.renderData.schedule?.timeMode==="playerLocal"){if(i.renderData.schedule.plainTimeStartInstantIsoString){let w=N.fromISO(i.renderData.schedule.plainTimeStartInstantIsoString);w<s&&(w=s),v=w.diff(t,"days").days*W(o)}if(i.renderData.schedule.plainTimeEndInstantIsoString){let w=N.fromISO(i.renderData.schedule.plainTimeEndInstantIsoString);w>m&&(w=m),w>e&&(w=e),d=w.diff(t,"days").days*W(o)}}const[k,M,E]=(i.metadata.color??ee.liveopsEventItem).match(/\w\w/g).map(w=>parseInt(w,16)),A=(k*299+M*587+E*114)/1e3>=128?"black":"white",U=T?"42px":"22px",j=T?"0.25rem":"0.125rem",J=T?"0.25rem":"0.125rem";return{left:`${v}px`,width:`${d-v}px`,height:U,color:A,fill:A,paddingTop:j,paddingBottom:J,zIndex:C}}function Pt(i,t,n,e,s){if(!e)return;const m=e.diff(t,"days").days,o=s.diff(t,"days").days,c=re(i.metadata.color??ee.liveopsEventItem),u=i.renderData.schedule?.timeMode==="playerLocal"?`linear-gradient(to left, ${c} 60%, ${c.slice(0,-1)}, 0))`:c;return{flexBasis:`${(o-m)*W(n)}px`,background:u}}function Rt(i,t,n,e,s){const m=e.diff(t,"days").days*W(n),o=s?42:22;return{styles:{backgroundColor:i.renderData.color??ee.instantItem,left:`${m-o/2}px`,width:`${o}px`,height:`${o}px`}}}const Lt=H({__name:"MEventTimelineContent",props:{visibleTimelineData:{},timelineStartInstant:{},timelineEndInstant:{},timelineLengthInDays:{},timelineFirstVisibleInstant:{},numberOfTimelineBufferDays:{},timelineDayWidthInRem:{},expandedGroups:{},selectedItemIds:{}},emits:["update:timelineFirstVisibleInstant","update:timelineLastVisibleInstant","update:timelineDayWidthInRem","eventClicked"],setup(i,{expose:t,emit:n}){const e=n,s=i,m=S(()=>s.visibleTimelineData===void 0?void 0:le(s.visibleTimelineData.items)),o=F(),c=F(0),u=F(s.timelineDayWidthInRem),b=S(()=>u.value<1?"years":u.value<3?"months":u.value<11?"weeks":u.value<20?"days":"hours"),f=S(()=>s.timelineLengthInDays/7);function T(w){return w===0?7-s.timelineStartInstant.weekday+1:w===f.value-1?s.timelineEndInstant.weekday:7}function I(){if(!o.value)return;const w=o.value.clientWidth,y=ue(w);c.value=y/u.value}K(()=>u.value,I),Y(()=>{I(),window.addEventListener("resize",I)});const C=F();let g;Y(()=>{if(!C.value){console.warn("Timeline element not found.");return}g=new ResizeObserver(()=>{A(s.timelineFirstVisibleInstant),g?.disconnect()}),g.observe(C.value)}),de(()=>{g&&g.disconnect()});const p=S(()=>{if(o.value)return s.timelineFirstVisibleInstant.plus({days:c.value})});K(p,w=>{w&&e("update:timelineLastVisibleInstant",w)}),Y(()=>{o.value&&o.value.addEventListener("scroll",w=>{const _=ue(o.value.scrollLeft)/u.value,G=s.timelineStartInstant.plus({days:_});e("update:timelineFirstVisibleInstant",G)})});const v=S(()=>{const w=N.utc();if(!(w<s.timelineStartInstant||w>s.timelineEndInstant))return w.diff(s.timelineStartInstant,"days").days*100/s.timelineLengthInDays});function d(w){w.shiftKey&&(w.preventDefault(),o.value?.scrollBy(w.deltaX,0))}function k(w){const y=w.deltaY>0?1:-1;let _=u.value+y*u.value*.05;_<.1&&(_=.1),_>40&&(_=40);const G=s.timelineFirstVisibleInstant;u.value=_,e("update:timelineDayWidthInRem",_),A(G)}const M=F(!1);Y(()=>{document.addEventListener("mousemove",w=>{M.value&&o.value.scrollBy(-w.movementX,0)}),document.addEventListener("mouseup",()=>{M.value=!1})}),Y(()=>{document.addEventListener("keydown",w=>{s.visibleTimelineData&&w.key==="e"&&w.ctrlKey&&s.selectedItemIds.length>0})});function E(w=!0){if(!o.value)return;const G=N.utc().diff(s.timelineStartInstant,"days").days*W(u.value);w?o.value.scrollTo({left:G,behavior:"smooth"}):o.value.scrollLeft=G}function B(w,y=!0,_=!0){if(!o.value)return;let G;if(w.itemType==="liveopsEvent"){const Z=w;if(!Z.renderData.timelinePosition.startInstantIsoString)return;G=N.fromISO(Z.renderData.timelinePosition.startInstantIsoString)}else if(w.itemType==="instantEvent"){const Z=w;G=N.fromISO(Z.renderData.instantIsoString)}else return;G=G.minus({days:1});const te=G.diff(s.timelineStartInstant,"days").days;_?o.value.scrollTo({left:te*W(u.value),behavior:"smooth"}):o.value.scrollLeft=te*W(u.value)}function A(w){if(!o.value)return;const _=w.diff(s.timelineStartInstant,"days").days*W(u.value);o.value.scrollLeft=_}t({scrollTimelineToToday:E,scrollTimelineToItem:B,jumpTimelineToInstant:A});const U=F({});K([()=>s.visibleTimelineData,()=>s.timelineStartInstant,()=>s.timelineEndInstant,()=>s.timelineFirstVisibleInstant,p,()=>s.timelineDayWidthInRem,()=>s.expandedGroups],([w,y,_,G,te,Z,Le])=>{w&&te&&(U.value=Se(w,y,_,G,te,Z,Le))}),K([()=>s.timelineStartInstant,()=>s.timelineEndInstant,()=>s.timelineDayWidthInRem],()=>{A(s.timelineFirstVisibleInstant)});function j(w){return s.expandedGroups.includes(w)}const J={emit:e,props:s,timelineRoot:m,timelineContainer:o,timelineVisibleDaysCount:c,internalTimelineDayWidthInRem:u,timelineTimeScale:b,weeksInTimeline:f,getWeekLengthInDays:T,updateTimelineVisibleDaysCount:I,timelineElement:C,get resizeObserver(){return g},set resizeObserver(w){g=w},lastVisibleInstant:p,currentTimeIndicatorPosition:v,onTimelineContentWheel:d,onTimelineHeaderWheel:k,isTimelineMouseDragging:M,scrollTimelineToToday:E,scrollTimelineToItem:B,jumpTimelineToInstant:A,visibleTimelineEventsRenderInfos:U,isGroupExpanded:j,get DateTime(){return N},computed:S,onMounted:Y,onUnmounted:de,ref:F,watch:K,MEventTimelineItemInstantEvent:st,MEventTimelineItemLiveopsEvent:ht,get findRoot(){return le},get calculateSectionsFromRoot(){return Ie},get calculateGroupsFromSection(){return fe},get calculateRowsFromGroup(){return ge},get calculateItemsFromRow(){return _e},get getWashedColor(){return re},get groupHeightInRem(){return Pe},get pixelsToRem(){return ue},get remToPixels(){return W},get rowHeightInRem(){return Re},get sectionHeightInRem(){return Me},get getRenderInfosForVisibleRange(){return Se}};return Object.defineProperty(J,"__isScriptSetup",{enumerable:!1,value:!0}),J}}),Ft={class:"tw-grow tw-overflow-x-scroll",ref:"timelineContainer","data-testid":"timeline-content"},At={key:0,class:"tw-absolute tw-left-0.5 tw-top-0 tw-text-xs tw-text-neutral-400"},Nt={key:1,class:"tw-absolute tw-right-0.5 tw-top-0.5 tw-size-4 tw-rounded-sm tw-bg-neutral-200 tw-text-xs tw-text-neutral-500"},Vt={class:"tw-mt-2 tw-space-x-1"},Ot={class:"tw-text-xs tw-text-neutral-600"},Bt={class:"tw-font-semibold"},Gt={key:2,class:"tw-mt-1 tw-flex tw-justify-between tw-text-xs tw-text-neutral-600"},Wt={key:3,class:"tw-mt-1 tw-flex tw-justify-between tw-text-xs tw-text-neutral-600"},zt={key:0,class:"tw-absolute tw-left-0.5 tw-top-0 tw-text-xs tw-text-neutral-400"},jt={key:1,class:"tw-absolute tw-right-0.5 tw-top-0.5 tw-size-4 tw-rounded-sm tw-bg-neutral-200 tw-text-xs tw-text-neutral-500"},Ht={class:"-tw-mb-1 tw-mt-3 tw-text-xs tw-text-neutral-600"},qt={class:"tw-font-semibold"},Ut={class:"tw-mt-1 tw-flex tw-text-center tw-text-xs tw-text-neutral-600"},Kt={class:"tw-basis-full"},Yt={class:"tw-pointer-events-none tw-absolute tw-inset-0 tw-z-0"},Qt={key:0,class:"tw-pointer-events-none tw-absolute tw-inset-0 tw-z-30"},Xt={key:1},Jt={key:0};function Zt(i,t,n,e,s,m){return l(),r("div",Ft,[a("div",{ref:"timelineElement",class:ie(`tw-relative tw-h-full tw-overflow-x-hidden ${e.isTimelineMouseDragging?"tw-cursor-grabbing":"tw-cursor-grab"}`),style:x({width:`${n.timelineDayWidthInRem*n.timelineLengthInDays}rem`}),onMousedown:t[0]||(t[0]=o=>e.isTimelineMouseDragging=!0)},[a("div",{class:ie(`tw-relative tw-z-10 tw-flex tw-h-14 tw-select-none tw-border-b tw-border-neutral-300 tw-drop-shadow-sm  ${e.isTimelineMouseDragging?"tw-cursor-grabbing":"tw-cursor-grab"}`)},[e.timelineTimeScale==="hours"||e.timelineTimeScale==="days"?(l(!0),r(L,{key:0},O(n.timelineLengthInDays,o=>(l(),r("div",{class:"tw-relative tw-text-center",style:x({width:`${n.timelineDayWidthInRem}rem`})},[n.timelineStartInstant.plus({days:o-1}).day===1?(l(),r("div",At,h(n.timelineStartInstant.plus({days:o-1}).toFormat("LLL")),1)):D("",!0),n.timelineStartInstant.plus({days:o-1}).weekday===1?(l(),r("div",Nt,h(n.timelineStartInstant.plus({days:o-1}).weekNumber),1)):D("",!0),a("div",Vt,[a("span",Ot,h(n.timelineStartInstant.plus({days:o-1}).toFormat("ccc")),1),a("span",Bt,h(n.timelineStartInstant.plus({days:o-1}).toFormat("d")),1)]),e.timelineTimeScale==="days"?(l(),r("div",Gt,[(l(),r(L,null,O(23,c=>(l(),r(L,null,[c%2===0?(l(),r("div",{key:0,style:x({width:`${n.timelineDayWidthInRem/11}rem`})},h(c<10?"0"+c:c),5)):D("",!0)],64))),64))])):(l(),r("div",Wt,[(l(),r(L,null,O(23,c=>a("div",{style:x({width:`${n.timelineDayWidthInRem/23}rem`})},h(c<10?"0"+c:c),5)),64))]))],4))),256)):e.timelineTimeScale==="weeks"?(l(!0),r(L,{key:1},O(n.timelineLengthInDays,o=>(l(),r("div",{class:"tw-relative tw-text-center",style:x({width:`${n.timelineDayWidthInRem}rem`})},[n.timelineStartInstant.plus({days:o-1}).day===1?(l(),r("div",zt,h(n.timelineStartInstant.plus({days:o-1}).toFormat("LLL")),1)):D("",!0),n.timelineStartInstant.plus({days:o-1}).weekday===1?(l(),r("div",jt,h(n.timelineStartInstant.plus({days:o-1}).weekNumber),1)):D("",!0),a("div",Ht,h(n.timelineStartInstant.plus({days:o-1}).toFormat("ccc")),1),a("div",qt,h(n.timelineStartInstant.plus({days:o-1}).toFormat("d")),1)],4))),256)):e.timelineTimeScale==="months"?(l(!0),r(L,{key:2},O(e.weeksInTimeline,o=>(l(),r("div",{class:"tw-relative",style:x({width:`${n.timelineDayWidthInRem*e.getWeekLengthInDays(o-1)}rem`})},[a("div",null,"Week "+h(n.timelineStartInstant.plus({weeks:o-1}).weekNumber),1),a("div",Ut,[(l(!0),r(L,null,O(e.getWeekLengthInDays(o-1),c=>(l(),r("div",Kt,h(n.timelineStartInstant.plus({weeks:o-1,days:c-1-7+e.getWeekLengthInDays(0)}).toFormat("d")),1))),256))])],4))),256)):D("",!0)],2),a("div",Yt,[(l(!0),r(L,null,O(n.timelineLengthInDays,(o,c)=>(l(),r("div",null,[n.timelineStartInstant.plus({days:c}).weekday>5?(l(),r("div",{key:0,class:"tw-pointer-events-none tw-absolute tw-bottom-0 tw-top-0 tw-bg-neutral-500 tw-opacity-10",style:x({left:`${c*100/n.timelineLengthInDays}%`,width:`${100/n.timelineLengthInDays}%`})},null,4)):D("",!0)]))),256)),e.timelineTimeScale==="hours"?(l(!0),r(L,{key:0},O(n.timelineLengthInDays*23,(o,c)=>(l(),r("div",{class:"tw-pointer-events-none tw-absolute tw-bottom-0 tw-top-14 tw-w-[1px] tw-bg-neutral-200",style:x({left:`${c*100/(n.timelineLengthInDays*23)}%`})},null,4))),256)):e.timelineTimeScale==="days"?(l(!0),r(L,{key:1},O(n.timelineLengthInDays*11,(o,c)=>(l(),r("div",{class:"tw-pointer-events-none tw-absolute tw-bottom-0 tw-top-14 tw-w-[1px] tw-bg-neutral-200",style:x({left:`${c*100/(n.timelineLengthInDays*11)}%`})},null,4))),256)):D("",!0),e.timelineTimeScale==="hours"||e.timelineTimeScale==="days"||e.timelineTimeScale==="weeks"?(l(!0),r(L,{key:2},O(n.timelineLengthInDays,(o,c)=>(l(),r("div",{class:"tw-pointer-events-none tw-absolute tw-h-full tw-w-[1px] tw-bg-neutral-300",style:x({left:`${c*100/n.timelineLengthInDays}%`})},null,4))),256)):D("",!0),e.timelineTimeScale==="years"?(l(!0),r(L,{key:3},O(n.timelineLengthInDays,(o,c)=>(l(),r(L,null,[n.timelineStartInstant.plus({days:c-1}).weekday===1?(l(),r("div",{key:0,class:"tw-pointer-events-none tw-absolute tw-h-full tw-w-[1px] tw-bg-neutral-300",style:x({left:`${(c-1)*100/n.timelineLengthInDays}%`})},null,4)):D("",!0)],64))),256)):D("",!0)]),e.currentTimeIndicatorPosition?(l(),r("div",Qt,[a("div",{class:"tw-pointer-events-none tw-absolute tw-h-full tw-w-0.5 tw-bg-red-500",style:x({left:`${e.currentTimeIndicatorPosition}%`})},null,4)])):D("",!0),a("div",{class:"tw-pointer-events-none tw-absolute tw-bottom-0 tw-left-0 tw-top-14 tw-z-20 tw-overflow-clip tw-bg-neutral-300",style:x({width:`${n.numberOfTimelineBufferDays*n.timelineDayWidthInRem}rem`})},t[1]||(t[1]=[a("div",{class:"active-event-overlay"},null,-1)]),4),a("div",{class:"tw-pointer-events-none tw-absolute tw-bottom-0 tw-right-0 tw-top-14 tw-z-20 tw-overflow-clip tw-bg-neutral-300",style:x({width:`${n.numberOfTimelineBufferDays*n.timelineDayWidthInRem}rem`})},t[2]||(t[2]=[a("div",{class:"active-event-overlay"},null,-1)]),4),n.visibleTimelineData&&e.timelineRoot?(l(),r("span",Xt,[(l(!0),r(L,null,O(e.calculateSectionsFromRoot(n.visibleTimelineData.items,e.timelineRoot),([o,c])=>(l(),r("div",null,[a("div",{style:x({height:`${e.sectionHeightInRem}rem`})},null,4),(l(!0),r(L,null,O(e.calculateGroupsFromSection(n.visibleTimelineData.items,c),([u,b])=>(l(),r("div",{class:"tw-border-t tw-border-neutral-300 odd:tw-bg-neutral-100 even:tw-bg-neutral-50",style:x({backgroundColor:b.metadata.color?e.getWashedColor(b.metadata.color,.8):void 0}),onWheel:e.onTimelineContentWheel},[a("div",null,[e.isGroupExpanded(u)?(l(),r("div",{key:0,class:"tw-relative tw-z-10",style:x({height:`${e.groupHeightInRem}rem`})},null,4)):(l(),r("div",{key:1,class:"tw-relative tw-z-10 tw-py-[1px]",style:x({height:`${e.groupHeightInRem}rem`})},[(l(!0),r(L,null,O(e.calculateRowsFromGroup(n.visibleTimelineData.items,b),([f,T])=>(l(),r(L,null,[(l(!0),r(L,null,O(e.calculateItemsFromRow(n.visibleTimelineData.items,T),([I,C])=>(l(),r(L,null,[e.visibleTimelineEventsRenderInfos[I]?(l(),r(L,{key:0},[C.itemType==="liveopsEvent"?(l(),R(e.MEventTimelineItemLiveopsEvent,{key:0,renderInfo:e.visibleTimelineEventsRenderInfos[I],selected:!!n.selectedItemIds?.includes(I),onClick:g=>i.$emit("eventClicked",I)},null,8,["renderInfo","selected","onClick"])):C.itemType==="instantEvent"?(l(),R(e.MEventTimelineItemInstantEvent,{key:1,renderInfo:e.visibleTimelineEventsRenderInfos[I],selected:!!n.selectedItemIds?.includes(I),onClick:g=>i.$emit("eventClicked",I)},null,8,["renderInfo","selected","onClick"])):D("",!0)],64)):D("",!0)],64))),256))],64))),256))],4))]),e.isGroupExpanded(u)?(l(),r("div",Jt,[(l(!0),r(L,null,O(e.calculateRowsFromGroup(n.visibleTimelineData.items,b),([f,T])=>(l(),r("div",{class:"tw-relative tw-z-10 tw-py-[1px]",style:x({height:`${e.rowHeightInRem}rem`})},[(l(!0),r(L,null,O(e.calculateItemsFromRow(n.visibleTimelineData.items,T),([I,C])=>(l(),r("span",null,[e.visibleTimelineEventsRenderInfos[I]?(l(),r(L,{key:0},[C.itemType==="liveopsEvent"?(l(),R(e.MEventTimelineItemLiveopsEvent,{key:0,renderInfo:e.visibleTimelineEventsRenderInfos[I],selected:!!n.selectedItemIds?.includes(I),onClick:g=>i.$emit("eventClicked",I)},null,8,["renderInfo","selected","onClick"])):C.itemType==="instantEvent"?(l(),R(e.MEventTimelineItemInstantEvent,{key:1,renderInfo:e.visibleTimelineEventsRenderInfos[I],selected:!!n.selectedItemIds?.includes(I),onClick:g=>i.$emit("eventClicked",I)},null,8,["renderInfo","selected","onClick"])):D("",!0)],64)):D("",!0)]))),256))],4))),256))])):D("",!0)],36))),256))]))),256))])):D("",!0)],38)],512)}const $t=q(Lt,[["render",Zt],["__file","MEventTimelineContent.vue"]]),en=H({__name:"MEventTimelineInspectorSingle",props:{id:{},version:{},title:{},description:{},showTitleEditor:{type:Boolean},showDescriptionEditor:{type:Boolean},showColorPicker:{type:Boolean},currentColor:{}},emits:{close:()=>({type:"close"}),invokeCommand:i=>({type:"command",command:i})},setup(i,{expose:t,emit:n}){t();const e=n,s=i;function m(f){const T={commandType:"changeMetadata",items:[{targetId:s.id,currentVersion:s.version,changes:[{property:"displayName",newValue:f}]}]};e("invokeCommand",T)}const o=Object.entries(ye).map(([f,T])=>({label:f,value:T}));o.unshift({label:"None",value:void 0});const c=F(be(s.currentColor));function u(f){const T={commandType:"changeMetadata",items:[{targetId:s.id,currentVersion:s.version,changes:[{property:"color",newValue:f}]}]};e("invokeCommand",T)}const b={emit:e,props:s,onChangeName:m,itemColorOptions:o,itemColor:c,onItemColorChange:u,ref:F,MInputSingleSelectDropdown:Ye,MInputText:Qe,MButtonGroupLayout:je,get ColorPickerPalette(){return ye},get findClosestColorFromPicketPalette(){return be}};return Object.defineProperty(b,"__isScriptSetup",{enumerable:!1,value:!0}),b}}),tn={class:"tw-px-4"},nn={class:"tw-items-top tw-flex tw-justify-between tw-space-x-1 tw-pt-4"},sn={class:"tw-font-bold"},on={key:1,class:"tw-mr-1"},ln={class:"tw-text-sm"},an={class:"align-items-center tw-flex"},rn={key:1,class:"tw-h-4 tw-w-4 tw-rounded tw-border tw-border-neutral-300",style:{background:"linear-gradient(to bottom right, white, white 45%, red 45%, red 55%, white 55%, white)"}},dn={class:"tw-ml-1"},mn={class:"align-items-center tw-flex"},cn={key:1,class:"tw-h-4 tw-w-4 tw-rounded tw-border tw-border-neutral-300",style:{background:"linear-gradient(to bottom right, white, white 45%, red 45%, red 55%, white 55%, white)"}},un={class:"tw-ml-1"},vn={class:"tw-mt-2"};function wn(i,t,n,e,s,m){return l(),r("div",tn,[a("div",nn,[a("h2",sn,[n.showTitleEditor?(l(),R(e.MInputText,{key:0,class:"tw-basis-2/3","model-value":n.title,placeholder:"No title.",debounce:1e3,"onUpdate:modelValue":t[0]||(t[0]=o=>e.onChangeName(o))},null,8,["model-value"])):(l(),r("span",on,h(n.title),1)),ce(i.$slots,"title-badge")]),a("button",{class:"tw-relative -tw-top-0.5 tw-inline-flex tw-h-7 tw-w-7 tw-shrink-0 tw-items-center tw-justify-center tw-rounded tw-font-semibold hover:tw-bg-neutral-100 active:tw-bg-neutral-200",onClick:t[1]||(t[1]=o=>i.$emit("close"))},t[2]||(t[2]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"tw-w-6 tw-h-6"},[a("path",{"fill-rule":"evenodd",d:"M5.47 5.47a.75.75 0 011.06 0L12 10.94l5.47-5.47a.75.75 0 111.06 1.06L13.06 12l5.47 5.47a.75.75 0 11-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 01-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 010-1.06z","clip-rule":"evenodd"})],-1)]))]),a("div",ln,h(n.description),1),n.showColorPicker?(l(),R(e.MInputSingleSelectDropdown,{key:0,label:"Color","model-value":e.itemColor,options:e.itemColorOptions,placeholder:"Select a color","onUpdate:modelValue":e.onItemColorChange},{selection:P(({value:o})=>[a("div",an,[o?.value?(l(),r("div",{key:0,class:"tw-h-4 tw-w-4 tw-rounded-sm tw-border tw-border-neutral-800",style:x(`background-color: ${o?.value}`)},null,4)):(l(),r("div",rn)),a("div",dn,h(o?.label),1)])]),option:P(({option:o})=>[a("div",mn,[o?.value?(l(),r("div",{key:0,class:"tw-h-4 tw-w-4 tw-rounded-sm tw-border tw-border-neutral-800",style:x(`background-color: ${o?.value}`)},null,4)):(l(),r("div",cn)),a("div",un,h(o?.label),1)])]),_:1},8,["model-value","options"])):D("",!0),a("div",vn,[ce(i.$slots,"default")]),V(e.MButtonGroupLayout,{class:"tw-mt-4"},{default:P(()=>[ce(i.$slots,"buttons")],void 0,!0),_:3})])}const se=q(en,[["render",wn],["__file","MEventTimelineInspectorSingle.vue"]]),ve=new ae(""),X=new ae("section"),Q=new ae("group"),ne=new ae("row"),In=H({__name:"MEventTimelineItemGroupInspectorSingle",props:{id:{},version:{},visibleTimelineData:{},rawDetails:{}},emits:{close:()=>({type:"close"}),invokeCommand:i=>({type:"command",command:i})},setup(i,{expose:t,emit:n}){t();const e=n,s=i,m=S(()=>s.rawDetails);function o(b){if(De(s.id,s.visibleTimelineData?.items))return"Cannot move. Parent is immutable.";{const{parentItem:f,childIndex:T}=X.getParentAs(s.id,s.visibleTimelineData?.items),I=T+(b==="up"?-1:2);return I<0?"Cannot move. Already at the top.":I>f.hierarchy.childIds.length?"Cannot move. Already at the bottom.":void 0}}function c(b){const{parentId:f,parentItem:T,childIndex:I}=X.getParentAs(s.id,s.visibleTimelineData?.items),C=I+(b==="up"?-1:2),g={commandType:"moveItems",items:[{targetId:s.id,currentVersion:s.version,parentVersion:T.version}],newParent:{targetId:f,currentVersion:T.version,insertIndex:C}};e("invokeCommand",g)}const u={emit:e,props:s,details:m,moveDisabledTooltip:o,onMove:c,computed:S,MButton:we,MEventTimelineInspectorSingle:se,get timelineItemSectionHelper(){return X},get isParentImmutable(){return De}};return Object.defineProperty(u,"__isScriptSetup",{enumerable:!1,value:!0}),u}});function fn(i,t,n,e,s,m){return l(),R(e.MEventTimelineInspectorSingle,{id:n.id,version:n.version,title:e.details.displayName,description:"Groups are used to organize rows in the timeline.","show-title-editor":"","show-color-picker":"","current-color":e.details.details.color,onClose:t[2]||(t[2]=o=>e.emit("close")),onInvokeCommand:t[3]||(t[3]=o=>e.emit("invokeCommand",o))},{buttons:P(()=>[V(e.MButton,{size:"small","disabled-tooltip":e.moveDisabledTooltip("down"),permission:"api.liveops_events.edit",onClick:t[0]||(t[0]=o=>e.onMove("down"))},{default:P(()=>t[4]||(t[4]=[z("Move Down")]),void 0,!0),_:1},8,["disabled-tooltip"]),V(e.MButton,{size:"small","disabled-tooltip":e.moveDisabledTooltip("up"),permission:"api.liveops_events.edit",onClick:t[1]||(t[1]=o=>e.onMove("up"))},{default:P(()=>t[5]||(t[5]=[z("Move Up")]),void 0,!0),_:1},8,["disabled-tooltip"])]),_:1},8,["id","version","title","current-color"])}const gn=q(In,[["render",fn],["__file","MEventTimelineItemGroupInspectorSingle.vue"]]),yn=H({__name:"MEventTimelineItemInstantEventInspectorSingle",props:{id:{},version:{},rawDetails:{}},emits:{close:()=>({type:"close"}),invokeCommand:i=>({type:"command",command:i})},setup(i,{expose:t,emit:n}){t();const e=n,s=i,m=S(()=>s.rawDetails),o={emit:e,props:s,details:m,computed:S,MBadge:xe,MEventTimelineInspectorSingle:se};return Object.defineProperty(o,"__isScriptSetup",{enumerable:!1,value:!0}),o}});function bn(i,t,n,e,s,m){return l(),R(e.MEventTimelineInspectorSingle,{id:n.id,version:n.version,title:"Instant Event",description:e.details.description,onClose:t[0]||(t[0]=o=>e.emit("close")),onInvokeCommand:t[1]||(t[1]=o=>e.emit("invokeCommand",o))},{"title-badge":P(()=>[V(e.MBadge,null,{default:P(()=>t[2]||(t[2]=[z("instant")]),void 0,!0),_:1})]),_:1},8,["id","version","description"])}const pn=q(yn,[["render",bn],["__file","MEventTimelineItemInstantEventInspectorSingle.vue"]]),hn=H({__name:"MEventTimelineItemLiveopsEventInspectorSingle",props:{id:{},version:{},visibleTimelineData:{},rawDetails:{}},emits:{close:()=>({type:"close"}),invokeCommand:i=>({type:"command",command:i})},setup(i,{expose:t,emit:n}){t();const e=n,s=i,m=S(()=>s.rawDetails),o=S(()=>{const v=m.value?.details.eventParams.targetCondition?.requireAnySegment.length??0;if(v)return v;const d=m.value?.details.eventParams.targetCondition?.requireAllSegment.length??0;return d||0});function c(v){const d=m.value?.details.eventParams.schedule;if(!d)return $.fromObject({});const k=v?$.fromISO(d.previewDuration):$.fromObject({}),M=v?$.fromISO(d.reviewDuration):$.fromObject({}),E=N.fromISO(d.enabledStartTime);return N.fromISO(d.enabledEndTime).diff(E).plus(k).plus(M)}const u=S(()=>JSON.stringify(m.value?.details.eventParams.content,null,2).split(`
`).filter(d=>!d.includes('"$type":')).filter(d=>d!=="{"&&d!=="}").map(d=>d.replace(/( *)"(.*)":/,"$1$2:")).map(d=>d.replace(/^ {2}/,"")).map(d=>d.replace(/,$/,"")).join(`
`)),b={NotYetStarted:{displayString:"Scheduled",badgeVariant:"neutral"},InPreview:{displayString:"In Preview",badgeVariant:"primary"},Active:{displayString:"Active",badgeVariant:"success"},EndingSoon:{displayString:"Ending Soon",badgeVariant:"success"},InReview:{displayString:"In Review",badgeVariant:"primary"},Ended:{displayString:"Concluded",badgeVariant:"neutral"}};function f(v){return v==="up"&&!T.value?"Cannot move. Already at the top.":v==="down"&&!I.value?"Cannot move. Already at the bottom.":void 0}const T=S(()=>{if(!s.visibleTimelineData)return;const v=s.visibleTimelineData.items,d=s.id,k=ve.getAs(d,v),{parentId:M,parentItem:E}=ne.getParentAs(d,v),B=C(M,v);if(!B)return;const A=ne.getAs(B,v);return{commandType:"moveItems",items:[{targetId:d,currentVersion:k.version,parentVersion:E.version}],newParent:{targetId:B,currentVersion:A.version,insertIndex:0}}}),I=S(()=>{if(!s.visibleTimelineData)return;const v=s.visibleTimelineData.items,d=s.id,k=ve.getAs(d,v),{parentId:M,parentItem:E}=ne.getParentAs(d,v),B=g(M,v);if(!B)return;const A=ne.getAs(B,v);return{commandType:"moveItems",items:[{targetId:d,currentVersion:k.version,parentVersion:E.version}],newParent:{targetId:B,currentVersion:A.version,insertIndex:0}}});function C(v,d){const k=d[v];if(!k.hierarchy.parentId)return;const M=k.hierarchy.parentId;console.assert(!!M,"Must have parent.");const E=M,A=d[E].hierarchy.childIds,U=A.indexOf(v);if(U-1>=0)return A[U-1];for(let j=C(E,d);j;j=C(j,d)){const w=d[j].hierarchy.childIds;if(w.length>0)return w[w.length-1]}}function g(v,d){const k=d[v];if(!k.hierarchy.parentId)return;const M=k.hierarchy.parentId;console.assert(!!M,"Must have parent.");const E=M,A=d[E].hierarchy.childIds,U=A.indexOf(v);if(U+1<A.length)return A[U+1];for(let j=g(E,d);j;j=g(j,d)){const w=d[j].hierarchy.childIds;if(w.length>0)return w[0]}}const p={emit:e,props:s,details:m,targetConditionsSegmentCount:o,getTotalDurationForEvent:c,humanizedParameters:u,liveOpsEventPhaseInfos:b,moveDisabledTooltip:f,moveUpCommand:T,moveDownCommand:I,tryGetAboveItemId:C,tryGetBelowItemId:g,get DateTime(){return N},get Duration(){return $},computed:S,MAbbreviateNumber:Ee,MBadge:xe,MButton:we,MDateTime:Xe,MEventTimelineInspectorSingle:se,get timelineItemHelper(){return ve},get timelineItemRowHelper(){return ne}};return Object.defineProperty(p,"__isScriptSetup",{enumerable:!1,value:!0}),p}}),Tn={class:"tw-my-2 tw-rounded-md tw-border tw-border-neutral-300 tw-bg-neutral-100 tw-p-2 tw-text-sm"},Dn={key:0},Sn={class:"tw-flex tw-justify-between"},kn={key:0},Cn={key:1},xn={key:2},En={key:3},_n={class:"tw-flex tw-justify-between"},Mn={key:1},Pn={key:1,class:"tw-text-xs tw-text-neutral-600"},Rn={class:"tw-my-2 tw-rounded-md tw-border tw-border-neutral-300 tw-bg-neutral-100 tw-p-2 tw-text-sm"},Ln={class:"tw-mb-1 tw-mr-1 tw-font-bold"},Fn={key:0},An={key:1,class:"tw-ml-1 tw-text-xs tw-font-normal tw-text-neutral-600"},Nn={key:0},Vn={class:"tw-flex tw-justify-between"},On={key:0},Bn={class:"tw-flex tw-justify-between"},Gn={class:"tw-flex tw-justify-between"},Wn={key:0},zn={class:"tw-flex tw-justify-between"},jn={class:"tw-flex tw-justify-between"},Hn={key:0},qn={class:"tw-mt-2 tw-text-xs tw-text-neutral-600"},Un={key:1,class:"tw-text-xs tw-text-neutral-600"},Kn={class:"tw-my-2 tw-rounded-md tw-border tw-border-neutral-300 tw-bg-neutral-100 tw-p-2 tw-text-sm"},Yn={key:0,class:"tw-text-xs"},Qn={key:1,class:"tw-text-xs tw-text-neutral-600"},Xn={class:"tw-my-2 tw-rounded-md tw-border tw-border-neutral-300 tw-bg-neutral-100 tw-p-2 tw-text-sm"},Jn={class:"tw-flex tw-justify-between"},Zn={class:"tw-flex tw-justify-between"};function $n(i,t,n,e,s,m){const o=He("meta-duration");return l(),R(e.MEventTimelineInspectorSingle,{id:n.id,version:n.version,title:e.details.displayName,description:e.details.description,"current-color":e.details.details.eventParams.color,onClose:t[2]||(t[2]=c=>e.emit("close")),onInvokeCommand:t[3]||(t[3]=c=>e.emit("invokeCommand",c))},{"title-badge":P(()=>[V(e.MBadge,{variant:e.liveOpsEventPhaseInfos[e.details.details.currentPhase].badgeVariant},{default:P(()=>[z(h(e.liveOpsEventPhaseInfos[e.details.details.currentPhase].displayString),1)],void 0,!0),_:1},8,["variant"])]),default:P(()=>[a("div",Tn,[t[6]||(t[6]=a("div",{class:"tw-mb-1 tw-mr-1 tw-font-bold"},"Targeting",-1)),e.details.details.eventParams.targetPlayers.length||e.details.details.eventParams.targetCondition?(l(),r("ul",Dn,[a("li",Sn,[t[4]||(t[4]=a("div",null,"Segments",-1)),e.targetConditionsSegmentCount===0?(l(),r("div",kn,"None")):e.targetConditionsSegmentCount===1?(l(),r("div",Cn,"1")):e.details.details.eventParams?.targetCondition?.requireAnySegment?(l(),r("div",xn,"Any of "+h(e.targetConditionsSegmentCount),1)):e.details.details.eventParams?.targetCondition?.requireAllSegment?(l(),r("div",En,"All of "+h(e.targetConditionsSegmentCount),1)):D("",!0)]),a("li",_n,[t[5]||(t[5]=a("div",null,"Selected players",-1)),e.details.details.eventParams.targetPlayers.length?(l(),R(e.MAbbreviateNumber,{key:0,number:e.details.details.eventParams.targetPlayers.length},null,8,["number"])):(l(),r("div",Mn,"None"))])])):(l(),r("div",Pn,"No targeting."))]),a("div",Rn,[a("div",Ln,[t[7]||(t[7]=z("Schedule")),e.details.details.eventParams.useSchedule?(l(),r("span",An,h(e.details.details.eventParams.schedule.isPlayerLocalTime?"Player Local":"UTC"),1)):(l(),r("span",Fn))]),e.details.details.eventParams.useSchedule?(l(),r("ul",Nn,[a("li",Vn,[t[8]||(t[8]=a("div",null,"Preview",-1)),e.details.details.eventParams.schedule.previewDuration==="P0Y0M0DT0H0M0S"?(l(),r("div",On,"None")):(l(),R(o,{key:1,duration:e.details.details.eventParams.schedule.previewDuration,"show-as":"exactDuration",hideMilliseconds:""},null,8,["duration"]))]),a("li",Bn,[t[9]||(t[9]=a("div",null,"Event start",-1)),V(e.MDateTime,{instant:e.DateTime.fromISO(e.details.details.eventParams.schedule.enabledStartTime),"disable-tooltip":e.details.details.eventParams.schedule?.isPlayerLocalTime},null,8,["instant","disable-tooltip"])]),a("li",Gn,[t[10]||(t[10]=a("div",null,"Ending soon",-1)),e.details.details.eventParams.schedule.endingSoonDuration==="P0Y0M0DT0H0M0S"?(l(),r("div",Wn,"None")):(l(),R(o,{key:1,duration:e.details.details.eventParams.schedule.endingSoonDuration,"show-as":"exactDuration",hideMilliseconds:""},null,8,["duration"]))]),a("li",zn,[t[11]||(t[11]=a("div",null,"Event end",-1)),V(e.MDateTime,{instant:e.DateTime.fromISO(e.details.details.eventParams.schedule.enabledEndTime),"disable-tooltip":e.details.details.eventParams.schedule?.isPlayerLocalTime},null,8,["instant","disable-tooltip"])]),a("li",jn,[t[12]||(t[12]=a("div",null,"Review",-1)),e.details.details.eventParams.schedule.reviewDuration==="P0Y0M0DT0H0M0S"?(l(),r("div",Hn,"None")):(l(),R(o,{key:1,duration:e.details.details.eventParams.schedule.reviewDuration,"show-as":"exactDuration",hideMilliseconds:""},null,8,["duration"]))]),a("div",qn,[a("div",null,[t[13]||(t[13]=z("Active for ")),V(o,{duration:e.getTotalDurationForEvent(!1),"show-as":"exactDuration",hideMilliseconds:""},null,8,["duration"]),t[14]||(t[14]=z("."))]),a("div",null,[t[15]||(t[15]=z("Visible for ")),V(o,{duration:e.getTotalDurationForEvent(!0),"show-as":"exactDuration",hideMilliseconds:""},null,8,["duration"]),t[16]||(t[16]=z(" total."))])])])):(l(),r("div",Un,"No schedule."))]),a("div",Kn,[t[17]||(t[17]=a("div",{class:"tw-mb-1 tw-mr-1 tw-font-bold"},"Parameters",-1)),e.details.details.eventParams.content?(l(),r("pre",Yn,h(e.humanizedParameters),1)):(l(),r("div",Qn,"No parameters."))]),a("div",Xn,[t[20]||(t[20]=a("div",{class:"tw-mb-1 tw-mr-1 tw-font-bold"},"Stats",-1)),a("ul",null,[a("li",Jn,[t[18]||(t[18]=a("div",null,"Event Type",-1)),V(e.MBadge,null,{default:P(()=>[z(h(e.details.details.eventTypeName),1)],void 0,!0),_:1})]),a("li",Zn,[t[19]||(t[19]=a("div",null,"Total Participants",-1)),a("div",null,h(e.details.details.participantCount),1)])])])]),buttons:P(()=>[V(e.MButton,{size:"small","disabled-tooltip":e.moveDisabledTooltip("down"),permission:"api.liveops_events.edit",onClick:t[0]||(t[0]=()=>{e.moveDownCommand&&e.emit("invokeCommand",e.moveDownCommand)})},{default:P(()=>t[21]||(t[21]=[z("Move Down")]),void 0,!0),_:1},8,["disabled-tooltip"]),V(e.MButton,{size:"small","disabled-tooltip":e.moveDisabledTooltip("up"),permission:"api.liveops_events.edit",onClick:t[1]||(t[1]=()=>{e.moveUpCommand&&e.emit("invokeCommand",e.moveUpCommand)})},{default:P(()=>t[22]||(t[22]=[z("Move Up")]),void 0,!0),_:1},8,["disabled-tooltip"]),V(e.MButton,{size:"small",to:`/liveOpsEvents/${n.id.split(":")[1]}`,permission:"api.liveops_events.view"},{default:P(()=>t[23]||(t[23]=[z("View Event")]),void 0,!0),_:1},8,["to"])]),_:1},8,["id","version","title","description","current-color"])}const ei=q(hn,[["render",$n],["__file","MEventTimelineItemLiveopsEventInspectorSingle.vue"]]),ti=H({__name:"MEventTimelineItemRowInspectorSingle",props:{id:{},version:{},visibleTimelineData:{},isImmutable:{type:Boolean},rawDetails:{}},emits:{close:()=>({type:"close"}),invokeCommand:i=>({type:"command",command:i})},setup(i,{expose:t,emit:n}){t();const e=n,s=i,m=S(()=>s.rawDetails);function o(f){return f==="up"&&!c.value?"Cannot move. Already at the top.":f==="down"&&!u.value?"Cannot move. Already at the bottom.":void 0}const c=S(()=>{const{parentId:f,parentItem:T,childIndex:I}=Q.getParentAs(s.id,s.visibleTimelineData?.items);if(I>0){const p=I-1;return{commandType:"moveItems",items:[{targetId:s.id,currentVersion:s.version,parentVersion:T.version}],newParent:{targetId:f,currentVersion:T.version,insertIndex:p}}}const{parentItem:C,childIndex:g}=X.getParentAs(f,s.visibleTimelineData?.items);if(g>0){const p=C.hierarchy.childIds[g-1],v=Q.getAs(p,s.visibleTimelineData?.items),d=v.hierarchy.childIds.length;return{commandType:"moveItems",items:[{targetId:s.id,currentVersion:s.version,parentVersion:C.version}],newParent:{targetId:p,currentVersion:v.version,insertIndex:d}}}}),u=S(()=>{const{parentId:f,parentItem:T,childIndex:I}=Q.getParentAs(s.id,s.visibleTimelineData?.items);if(I<T.hierarchy.childIds.length-1){const p=I+2;return{commandType:"moveItems",items:[{targetId:s.id,currentVersion:s.version,parentVersion:T.version}],newParent:{targetId:f,currentVersion:T.version,insertIndex:p}}}const{parentItem:C,childIndex:g}=X.getParentAs(f,s.visibleTimelineData?.items);if(g<C.hierarchy.childIds.length-1){const p=C.hierarchy.childIds[g+1],v=Q.getAs(p,s.visibleTimelineData?.items);return{commandType:"moveItems",items:[{targetId:s.id,currentVersion:s.version,parentVersion:C.version}],newParent:{targetId:p,currentVersion:v.version,insertIndex:0}}}}),b={emit:e,props:s,details:m,moveDisabledTooltip:o,moveUpCommand:c,moveDownCommand:u,computed:S,MButton:we,MEventTimelineInspectorSingle:se,get timelineItemGroupHelper(){return Q},get timelineItemSectionHelper(){return X}};return Object.defineProperty(b,"__isScriptSetup",{enumerable:!1,value:!0}),b}});function ni(i,t,n,e,s,m){return l(),R(e.MEventTimelineInspectorSingle,{id:n.id,version:n.version,title:e.details.displayName,description:"Rows are used to organize items in the timeline.","show-title-editor":!n.isImmutable,onClose:t[2]||(t[2]=o=>e.emit("close")),onInvokeCommand:t[3]||(t[3]=o=>e.emit("invokeCommand",o))},{buttons:P(()=>[V(e.MButton,{size:"small","disabled-tooltip":e.moveDisabledTooltip("down"),permission:"api.liveops_events.edit",onClick:t[0]||(t[0]=()=>{e.moveDownCommand&&e.emit("invokeCommand",e.moveDownCommand)})},{default:P(()=>t[4]||(t[4]=[z("Move Down")]),void 0,!0),_:1},8,["disabled-tooltip"]),V(e.MButton,{size:"small","disabled-tooltip":e.moveDisabledTooltip("up"),permission:"api.liveops_events.edit",onClick:t[1]||(t[1]=()=>{e.moveUpCommand&&e.emit("invokeCommand",e.moveUpCommand)})},{default:P(()=>t[5]||(t[5]=[z("Move Up")]),void 0,!0),_:1},8,["disabled-tooltip"])]),_:1},8,["id","version","title","show-title-editor"])}const ii=q(ti,[["render",ni],["__file","MEventTimelineItemRowInspectorSingle.vue"]]),si=H({__name:"MEventTimelineItemSectionInspectorSingle",props:{id:{},version:{},rawDetails:{}},emits:{close:()=>({type:"close"}),invokeCommand:i=>({type:"command",command:i})},setup(i,{expose:t,emit:n}){t();const e=n,s=i,m=S(()=>s.rawDetails),o={emit:e,props:s,details:m,computed:S,MEventTimelineInspectorSingle:se};return Object.defineProperty(o,"__isScriptSetup",{enumerable:!1,value:!0}),o}});function oi(i,t,n,e,s,m){return l(),R(e.MEventTimelineInspectorSingle,{id:n.id,version:n.version,title:e.details.displayName,description:"Sections are used to organize groups in the timeline.",onClose:t[0]||(t[0]=o=>e.emit("close")),onInvokeCommand:t[1]||(t[1]=o=>e.emit("invokeCommand",o))},null,8,["id","version","title"])}const li=q(si,[["render",oi],["__file","MEventTimelineItemSectionInspectorSingle.vue"]]),ai=H({__name:"MEventTimelineInspector",props:{selectedItemAndDetails:{},visibleTimelineData:{}},emits:{close:()=>({type:"close"}),invokeCommand:i=>({type:"invokeCommand",command:i})},setup(i,{expose:t,emit:n}){t();const e=n,s=i,m=F();Y(()=>{if(!m.value)return;new MutationObserver(()=>{window.dispatchEvent(new Event("resize"))}).observe(m.value,{attributes:!0,attributeFilter:["class"]})});const o=S(()=>{const u=Object.entries(s.selectedItemAndDetails);return u.length===1?{id:u[0][0],data:u[0][1].data,details:u[0][1].details}:void 0});Y(()=>{document.addEventListener("keydown",u=>{u.key==="Escape"&&e("close")})});const c={emit:e,props:s,inspectorRef:m,singleSelectedItem:o,get isEmpty(){return tt},onMounted:Y,ref:F,computed:S,MCollapse:qe,MEventTimelineInspectorSingle:se,MEventTimelineItemGroupInspectorSingle:gn,MEventTimelineItemInstantEventInspectorSingle:pn,MEventTimelineItemLiveopsEventInspectorSingle:ei,MEventTimelineItemRowInspectorSingle:ii,MEventTimelineItemSectionInspectorSingle:li};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}}),ri={key:0},di={key:0,class:"tw-h-32 tw-content-center tw-text-center"},mi={key:1},ci={key:6},ui={key:1},vi={class:"tw-overflow-x-auto tw-rounded tw-border tw-border-neutral-300 tw-bg-neutral-100 tw-p-2 tw-text-xs"};function wi(i,t,n,e,s,m){return l(),r("div",{class:ie(["tw-shrink-0 tw-basis-80 tw-overflow-y-scroll tw-rounded-br-md tw-border-l tw-border-neutral-300 tw-bg-white tw-shadow-[rgba(0,0,0,0.1)_-1px_0px_3px_0px]",e.isEmpty(n.selectedItemAndDetails)?"tw-hidden":"tw-block"]),ref:"inspectorRef"},[Object.keys(n.selectedItemAndDetails).length===1?(l(),r("div",ri,[e.singleSelectedItem?.details?(l(),r("span",mi,[e.singleSelectedItem.data?e.singleSelectedItem.details.itemType==="section"?(l(),R(e.MEventTimelineItemSectionInspectorSingle,{key:1,id:e.singleSelectedItem.id,version:e.singleSelectedItem.data.version,"visible-timeline-data":n.visibleTimelineData,"raw-details":e.singleSelectedItem.details,onClose:t[1]||(t[1]=o=>i.$emit("close")),onInvokeCommand:t[2]||(t[2]=o=>e.emit("invokeCommand",o))},null,8,["id","version","visible-timeline-data","raw-details"])):e.singleSelectedItem.details.itemType==="group"?(l(),R(e.MEventTimelineItemGroupInspectorSingle,{key:2,id:e.singleSelectedItem.id,version:e.singleSelectedItem.data.version,"visible-timeline-data":n.visibleTimelineData,"raw-details":e.singleSelectedItem.details,onClose:t[3]||(t[3]=o=>i.$emit("close")),onInvokeCommand:t[4]||(t[4]=o=>e.emit("invokeCommand",o))},null,8,["id","version","visible-timeline-data","raw-details"])):e.singleSelectedItem.details.itemType==="row"?(l(),R(e.MEventTimelineItemRowInspectorSingle,{key:3,id:e.singleSelectedItem.id,version:e.singleSelectedItem.data.version,"visible-timeline-data":n.visibleTimelineData,"is-immutable":!!e.singleSelectedItem.data.isImmutable,"raw-details":e.singleSelectedItem.details,onClose:t[5]||(t[5]=o=>i.$emit("close")),onInvokeCommand:t[6]||(t[6]=o=>e.emit("invokeCommand",o))},null,8,["id","version","visible-timeline-data","is-immutable","raw-details"])):e.singleSelectedItem.details.itemType==="liveopsEvent"?(l(),R(e.MEventTimelineItemLiveopsEventInspectorSingle,{key:4,id:e.singleSelectedItem.id,version:e.singleSelectedItem.data.version,"visible-timeline-data":n.visibleTimelineData,"raw-details":e.singleSelectedItem.details,onClose:t[7]||(t[7]=o=>i.$emit("close")),onInvokeCommand:t[8]||(t[8]=o=>e.emit("invokeCommand",o))},null,8,["id","version","visible-timeline-data","raw-details"])):e.singleSelectedItem.details.itemType==="instantEvent"?(l(),R(e.MEventTimelineItemInstantEventInspectorSingle,{key:5,id:e.singleSelectedItem.id,version:e.singleSelectedItem.data.version,"raw-details":e.singleSelectedItem.details,onClose:t[9]||(t[9]=o=>i.$emit("close")),onInvokeCommand:t[10]||(t[10]=o=>e.emit("invokeCommand",o))},null,8,["id","version","raw-details"])):(l(),r("div",ci,"No inspector defined..")):(l(),R(e.MEventTimelineInspectorSingle,{key:0,title:"Deleted Item",description:"This item has been deleted.",id:e.singleSelectedItem.id,version:0,onClose:t[0]||(t[0]=o=>i.$emit("close"))},null,8,["id"]))])):(l(),r("div",di,t[11]||(t[11]=[a("div",{class:"tw-animate-bounce tw-italic tw-text-neutral-500"},"Loading...",-1)])))])):(l(),r("div",ui,t[12]||(t[12]=[a("div",null,"TBD",-1)]))),V(e.MCollapse,{class:"tw-mb-2 tw-mt-4 tw-text-neutral-500"},{header:P(()=>t[13]||(t[13]=[a("div",{class:"tw-text-sm"},"Raw Data",-1)])),default:P(()=>[a("pre",vi,[a("div",null,h(n.selectedItemAndDetails),1)])],void 0,!0),_:1})],2)}const Ii=q(ai,[["render",wi],["__file","MEventTimelineInspector.vue"]]),fi=H({__name:"MEventTimelineNavigatorToolbar",props:{id:{},allowInspect:{type:[Boolean,String],default:!1},allowAdd:{type:[Boolean,String],default:!1},allowRemove:{type:[Boolean,String],default:!1},inspectTargetName:{default:"item"},addTargetName:{default:"item"},removeTargetName:{default:"item"},isSelected:{type:Boolean},isLocked:{type:Boolean}},emits:{itemInspected:i=>({type:"itemInspected",id:i}),close:()=>({type:"close"}),add:i=>({type:"add",id:i}),remove:i=>({type:"remove",id:i})},setup(i,{expose:t,emit:n}){t();const m={emit:n,props:i,MIconButton:Ue};return Object.defineProperty(m,"__isScriptSetup",{enumerable:!1,value:!0}),m}}),gi={key:0,class:"tw-flex tw-items-center tw-space-x-0.5 tw-pr-1 tw-opacity-0 tw-transition-opacity group-hover:tw-opacity-100"},yi={key:1,class:"tw-opacity-0 tw-transition-opacity group-hover:tw-opacity-100"};function bi(i,t,n,e,s,m){return n.isLocked?(l(),r("div",gi,[t[5]||(t[5]=a("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",class:"tw-size-3 tw-fill-neutral-300"},[a("path",{d:"M144 144l0 48 160 0 0-48c0-44.2-35.8-80-80-80s-80 35.8-80 80zM80 192l0-48C80 64.5 144.5 0 224 0s144 64.5 144 144l0 48 16 0c35.3 0 64 28.7 64 64l0 192c0 35.3-28.7 64-64 64L64 512c-35.3 0-64-28.7-64-64L0 256c0-35.3 28.7-64 64-64l16 0z"})],-1)),n.allowInspect!==!1?(l(),R(e.MIconButton,{key:0,enabledTooltip:`Inspect ${n.inspectTargetName}.`,"aria-label":`Inspect ${n.inspectTargetName}.`,permission:"api.liveops_events.view",disabledTooltip:typeof n.allowInspect=="string"?n.allowInspect:void 0,variant:"neutral",onClick:t[0]||(t[0]=()=>n.isSelected?i.$emit("close"):i.$emit("itemInspected",n.id))},{default:P(()=>t[4]||(t[4]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor",class:"tw-size-3"},[a("path",{d:"M495.9 166.6c3.2 8.7 .5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6c-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2c-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8c-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4L83.1 425.9c-8.8 2.8-18.6 .3-24.5-6.8c-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3c-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4C64.6 273.1 64 264.6 64 256s.6-17.1 1.7-25.4L22.4 191.2c-6.9-6.2-9.6-15.9-6.4-24.6c4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2c5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8c8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336a80 80 0 1 0 0-160 80 80 0 1 0 0 160z"})],-1)]),void 0,!0),_:1},8,["enabledTooltip","aria-label","disabledTooltip"])):D("",!0)])):n.allowInspect!==!1||n.allowAdd!==!1||n.allowRemove!==!1?(l(),r("div",yi,[n.allowAdd!==!1?(l(),R(e.MIconButton,{key:0,enabledTooltip:`Add ${n.addTargetName}.`,"aria-label":`Add ${n.addTargetName}.`,permission:"api.liveops_events.edit",disabledTooltip:typeof n.allowAdd=="string"?n.allowAdd:void 0,variant:"neutral",onClick:t[1]||(t[1]=o=>i.$emit("add",n.id))},{default:P(()=>t[6]||(t[6]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",fill:"currentColor",class:"tw-size-3"},[a("path",{d:"M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 144L48 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l144 0 0 144c0 17.7 14.3 32 32 32s32-14.3 32-32l0-144 144 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-144 0 0-144z"})],-1)]),void 0,!0),_:1},8,["enabledTooltip","aria-label","disabledTooltip"])):D("",!0),n.allowRemove!==!1?(l(),R(e.MIconButton,{key:1,enabledTooltip:`Remove ${n.removeTargetName}.`,"aria-label":`Remove ${n.removeTargetName}.`,permission:"api.liveops_events.edit",disabledTooltip:typeof n.allowRemove=="string"?n.allowRemove:void 0,variant:"neutral",onClick:t[2]||(t[2]=()=>i.$emit("remove",n.id))},{default:P(()=>t[7]||(t[7]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",fill:"currentColor",class:"tw-size-3"},[a("path",{d:"M135.2 17.7L128 32 32 32C14.3 32 0 46.3 0 64S14.3 96 32 96l384 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0-7.2-14.3C307.4 6.8 296.3 0 284.2 0L163.8 0c-12.1 0-23.2 6.8-28.6 17.7zM416 128L32 128 53.2 467c1.6 25.3 22.6 45 47.9 45l245.8 0c25.3 0 46.3-19.7 47.9-45L416 128z"})],-1)]),void 0,!0),_:1},8,["enabledTooltip","aria-label","disabledTooltip"])):D("",!0),n.allowInspect!==!1?(l(),R(e.MIconButton,{key:2,enabledTooltip:`Inspect ${n.inspectTargetName}.`,"aria-label":`Inspect ${n.inspectTargetName}.`,permission:"api.liveops_events.view",disabledTooltip:typeof n.allowInspect=="string"?n.allowInspect:void 0,variant:"neutral",onClick:t[3]||(t[3]=()=>n.isSelected?i.$emit("close"):i.$emit("itemInspected",n.id))},{default:P(()=>t[8]||(t[8]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor",class:"tw-size-3"},[a("path",{d:"M495.9 166.6c3.2 8.7 .5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6c-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2c-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8c-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4L83.1 425.9c-8.8 2.8-18.6 .3-24.5-6.8c-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3c-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4C64.6 273.1 64 264.6 64 256s.6-17.1 1.7-25.4L22.4 191.2c-6.9-6.2-9.6-15.9-6.4-24.6c4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2c5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8c8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336a80 80 0 1 0 0-160 80 80 0 1 0 0 160z"})],-1)]),void 0,!0),_:1},8,["enabledTooltip","aria-label","disabledTooltip"])):D("",!0)])):D("",!0)}const pi=q(fi,[["render",bi],["__file","MEventTimelineNavigatorToolbar.vue"]]),hi=H({__name:"MEventTimelineNavigator",props:{visibleTimelineData:{},timelineFirstVisibleInstant:{},expandedGroups:{},selectedItemIds:{}},emits:{todayButtonClicked:()=>({type:"todayButtonClicked"}),groupClicked:i=>({type:"groupClicked",id:i}),invokeCommand:i=>({type:"command",command:i}),itemInspected:i=>({type:"itemInspected",id:i}),close:()=>({type:"close"})},setup(i,{expose:t,emit:n}){t();const e=n,s=i,m=S(()=>s.visibleTimelineData===void 0?void 0:le(s.visibleTimelineData.items));function o(d){return s.expandedGroups.includes(d)}function c(d){return s.selectedItemIds.includes(d)}function u(d){return Q.getAs(d,s.visibleTimelineData?.items).renderData.cannotRemoveReason??!0}function b(d){return ne.getAs(d,s.visibleTimelineData?.items).renderData.cannotRemoveReason??!0}function f(d){return!X.getAs(d,s.visibleTimelineData?.items)?.isImmutable||"Cannot add to immutable section."}function T(d){const k={commandType:"createNewItem",itemType:"group",itemConfig:{},parentId:d,parentVersion:s.visibleTimelineData.items[d].version};e("invokeCommand",k)}function I(d){const{parentId:k,parentItem:M}=X.getParentAs(d,s.visibleTimelineData?.items),E={commandType:"deleteItems",items:[{targetId:d,currentVersion:s.visibleTimelineData.items[d].version,parentId:k,parentVersion:M.version}]};e("invokeCommand",E)}function C(d){return!Q.getAs(d,s.visibleTimelineData?.items)?.isImmutable||"Cannot add to immutable group."}function g(d){const k={commandType:"createNewItem",itemType:"row",itemConfig:{},parentId:d,parentVersion:s.visibleTimelineData.items[d].version};e("invokeCommand",k)}function p(d){const{parentId:k,parentItem:M}=Q.getParentAs(d,s.visibleTimelineData?.items),E={commandType:"deleteItems",items:[{targetId:d,currentVersion:s.visibleTimelineData.items[d].version,parentId:k,parentVersion:M.version}]};e("invokeCommand",E)}const v={emit:e,props:s,timelineRoot:m,isGroupExpanded:o,isItemSelected:c,allowRemoveGroup:u,allowRemoveRow:b,allowAddGroupToSection:f,onAddGroupToSection:T,onRemoveGroup:I,allowAddRowToGroup:C,onAddRowToGroup:g,onRemoveRow:p,computed:S,MEventTimelineNavigatorToolbar:pi,get timelineItemGroupHelper(){return Q},get timelineItemRowHelper(){return ne},get timelineItemSectionHelper(){return X},get findRoot(){return le},get calculateSectionsFromRoot(){return Ie},get calculateGroupsFromSection(){return fe},get calculateRowsFromGroup(){return ge},get getWashedColor(){return re},get groupHeightInRem(){return Pe},get rowHeightInRem(){return Re},get sectionHeightInRem(){return Me}};return Object.defineProperty(v,"__isScriptSetup",{enumerable:!1,value:!0}),v}}),Ti={class:"tw-relative tw-z-50 tw-w-64 tw-shrink-0 tw-basis-64 tw-border-r tw-border-neutral-300 tw-shadow-md","data-testid":"timeline-navigator"},Di={class:"tw-flex tw-h-14 tw-items-center tw-justify-between tw-border-b tw-border-neutral-300 tw-bg-white tw-px-4"},Si={class:"tw-font-bold tw-text-neutral-600","data-testid":"current-month-label"},ki={key:0},Ci={class:"tw-relative"},xi={class:"tw-flex tw-items-center tw-justify-between tw-space-x-2 tw-pr-1 tw-group"},Ei=["onClick"],_i={class:"tw-grow tw-inline-flex tw-items-center tw-space-x-2 tw-text-xs tw-whitespace-nowrap tw-overflow-x-hidden"},Mi={class:"tw-grow tw-overflow-x-hidden tw-text-ellipsis tw-pl-3"};function Pi(i,t,n,e,s,m){return l(),r("div",Ti,[a("div",Di,[a("h2",Si,h(n.timelineFirstVisibleInstant?.toFormat("LLLL yyyy")),1)]),n.visibleTimelineData&&e.timelineRoot?(l(),r("span",ki,[(l(!0),r(L,null,O(e.calculateSectionsFromRoot(n.visibleTimelineData.items,e.timelineRoot),([o,c])=>(l(),r("div",Ci,[a("div",xi,[a("div",{class:"tw-whitespace-nowrap tw-grow tw-content-center tw-pl-3 tw-font-mono tw-text-xs tw-text-neutral-400 tw-overflow-hidden tw-overflow-ellipsis",style:x({height:`${e.sectionHeightInRem}rem`})},"// "+h(c.metadata.displayName),5),V(e.MEventTimelineNavigatorToolbar,{class:"tw-shrink-0",isLocked:!!n.visibleTimelineData.items[o].isImmutable,id:o,"allow-inspect":"","allow-add":e.allowAddGroupToSection(o),"inspect-target-name":"section","add-target-name":"group",isSelected:e.isItemSelected(o),onItemInspected:t[0]||(t[0]=u=>i.$emit("itemInspected",u)),onClose:t[1]||(t[1]=u=>i.$emit("close")),onAdd:()=>e.onAddGroupToSection(o)},null,8,["isLocked","id","allow-add","isSelected","onAdd"])]),(l(!0),r(L,null,O(e.calculateGroupsFromSection(n.visibleTimelineData.items,c),([u,b])=>(l(),r("div",{class:ie(["tw-relative tw-select-none tw-text-nowrap tw-border-t tw-border-neutral-300 odd:tw-bg-neutral-100 even:tw-bg-neutral-50",{"tw-border-l-4":!!b.metadata.color}]),style:x({borderLeftColor:b.metadata.color,backgroundColor:b.metadata.color?e.getWashedColor(b.metadata.color,.8):void 0})},[a("div",{class:ie(["tw-flex tw-cursor-pointer tw-items-center tw-space-x-2 tw-pr-1 hover:tw-backdrop-brightness-95 active:tw-backdrop-brightness-90 tw-group",{"tw-pl-3":!!b.metadata.color,"tw-pl-4":!b.metadata.color}]),onClick:f=>i.$emit("groupClicked",u)},[a("div",_i,[a("div",{class:ie(["tw-shrink-0",{"tw-rotate-90":e.isGroupExpanded(u)}])},t[6]||(t[6]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512",class:"tw-size-3"},[a("path",{d:"M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"})],-1)]),2),a("span",{class:"tw-overflow-x-hidden tw-text-ellipsis tw-grow tw-content-center",style:x({height:`${e.groupHeightInRem}rem`})},h(b.metadata.displayName),5)]),V(e.MEventTimelineNavigatorToolbar,{class:"tw-shrink-0",isLocked:!!n.visibleTimelineData.items[u].isImmutable,id:u,"allow-inspect":"","allow-add":e.allowAddRowToGroup(u),"allow-remove":e.allowRemoveGroup(u),"inspect-target-name":"group","add-target-name":"row","remove-target-name":"group",isSelected:e.isItemSelected(u),onItemInspected:t[2]||(t[2]=f=>i.$emit("itemInspected",f)),onClose:t[3]||(t[3]=f=>i.$emit("close")),onAdd:()=>e.onAddRowToGroup(u),onRemove:()=>e.onRemoveGroup(u)},null,8,["isLocked","id","allow-add","allow-remove","isSelected","onAdd","onRemove"])],10,Ei),e.isGroupExpanded(u)?(l(!0),r(L,{key:0},O(e.calculateRowsFromGroup(n.visibleTimelineData.items,b),([f,T])=>(l(),r("div",{class:"tw-flex tw-items-center tw-justify-between tw-space-x-2 tw-pr-1 tw-group",style:x({height:`${e.rowHeightInRem}rem`})},[a("div",Mi,h(T.metadata.displayName),1),V(e.MEventTimelineNavigatorToolbar,{class:"tw-shrink-0",isLocked:!!n.visibleTimelineData.items[f].isImmutable,id:f,"allow-inspect":"","allow-remove":e.allowRemoveRow(f),"inspect-target-name":"row","remove-target-name":"row",isSelected:e.isItemSelected(f),onItemInspected:t[4]||(t[4]=I=>i.$emit("itemInspected",I)),onClose:t[5]||(t[5]=I=>i.$emit("close")),onRemove:()=>e.onRemoveRow(f)},null,8,["isLocked","id","allow-remove","isSelected","onRemove"])],4))),256)):D("",!0)],6))),256))]))),256))])):D("",!0)])}const Ri=q(hi,[["render",Pi],["__file","MEventTimelineNavigator.vue"]]),Li=H({__name:"MEventTimeline",props:{timelineData:{},loadingError:{},startExpanded:{type:Boolean},initialVisibleTimelineStartInstant:{},initialZoomLevel:{},preselectedItemId:{},selectedItemDetails:{},debug:{type:Boolean}},emits:["update:visibleRange","update:selectedItemIds","invokeCommand"],setup(i,{expose:t,emit:n}){t();const e=i,s=n,m=F(),o=F(e.initialVisibleTimelineStartInstant??N.utc().minus({days:2})),c=F(),u=F(3);K(()=>e.initialZoomLevel,y=>{y==="hours"?u.value=30:y==="days"?u.value=12:y==="weeks"?u.value=3:y==="months"?u.value=1:y==="years"&&(u.value=.1)},{immediate:!0});const b=S(()=>e.timelineData?N.fromISO(e.timelineData.startInstantIsoString,{zone:"utc"}):N.utc()),f=S(()=>e.timelineData?N.fromISO(e.timelineData.endInstantIsoString,{zone:"utc"}):N.utc()),T=F(7),I=S(()=>b.value.minus({days:T.value})),C=S(()=>f.value.plus({days:T.value})),g=S(()=>Math.ceil(C.value.diff(I.value,"days").days)),p=S(()=>({startInstant:o.value.startOf("day"),endInstant:(c.value??o.value.plus({days:7})).endOf("day"),bufferInDays:7}));K(p,y=>{s("update:visibleRange",y)},{immediate:!0});const v=F(),d=F([]);K(()=>e.timelineData,(y,_)=>{e.startExpanded&&y&&!_&&E()},{immediate:!0});function k(y){return d.value.includes(y)}function M(y){k(y)?d.value=d.value.filter(_=>_!==y):d.value=[...d.value,y]}function E(){d.value=Object.entries(e.timelineData?.items??{}).filter(([y,_])=>_?.itemType==="group").map(([y,_])=>y)}function B(){d.value=[]}K([()=>e.timelineData,c],([y,_])=>{!_||!y||(v.value=y)});const A=F([]);K(A,y=>{s("update:selectedItemIds",y)},{immediate:!0}),K(()=>e.timelineData,(y,_)=>{e.preselectedItemId&&y&&!_&&y.items[e.preselectedItemId]&&(A.value=[e.preselectedItemId])},{immediate:!0});function U(){A.value=[]}const j=S(()=>{const y=Object.keys(e.selectedItemDetails??{}),_={};return y.forEach(G=>{const te=e.timelineData.items[G],Z=e.selectedItemDetails?.[G];_[G]={data:te,details:Z}}),_});function J(y){s("invokeCommand",y)}Y(()=>{document.addEventListener("keydown",y=>{v.value&&(y.key==="o"&&y.ctrlKey&&(y.preventDefault(),E()),(y.key==="O"||y.key==="o")&&y.shiftKey&&y.ctrlKey&&(y.preventDefault(),B()))})});const w={props:e,emits:s,timelineContentRef:m,timelineFirstVisibleInstant:o,timelineLastVisibleInstant:c,timelineDayWidthInRem:u,timelineDataStartInstant:b,timelineDataEndInstant:f,numberOfTimelineBufferDays:T,timelineStartInstant:I,timelineEndInstant:C,timelineLengthInDays:g,visibleRange:p,visibleTimelineData:v,expandedGroups:d,isGroupExpanded:k,toggleGroupExpansion:M,openAllEventGroups:E,closeAllEventGroups:B,selectedItemIds:A,clearCurrentlySelectedItem:U,selectedItemAndDetails:j,invokeCommand:J,get DateTime(){return N},computed:S,onMounted:Y,ref:F,watch:K,MCard:Ke,MEventTimelineContent:$t,MEventTimelineInspector:Ii,MEventTimelineNavigator:Ri};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}}),Fi={key:0,class:"tw-min-h-64 tw-content-center tw-border-t tw-border-neutral-300 tw-text-center tw-@container","data-testid":"loading-message"},Ai={key:1,class:"tw-min-h-64 tw-content-center tw-border-t tw-border-neutral-300 tw-text-center tw-@container","data-testid":"empty-message"},Ni={key:2,class:"tw-flex tw-min-h-64 tw-border-t tw-border-neutral-300 tw-@container","data-testid":"timeline-container"},Vi={key:3,class:"tw-space-y-2 tw-overflow-x-auto tw-bg-neutral-100 tw-p-2 tw-text-xs"},Oi={key:0},Bi={key:1};function Gi(i,t,n,e,s,m){return l(),R(e.MCard,{title:"Event Timeline",noBodyPadding:"",variant:n.timelineData&&Object.keys(n.timelineData.items).length===0?"neutral":"primary",error:n.loadingError,"data-testid":"timeline"},{"header-right":P(()=>t[8]||(t[8]=[])),default:P(()=>[n.timelineData?Object.keys(n.timelineData.items).length===0?(l(),r("div",Ai,t[10]||(t[10]=[a("div",{class:"tw-p-4 tw-text-center tw-text-neutral-500"},"No events to display.",-1)]))):(l(),r("div",Ni,[V(e.MEventTimelineNavigator,{visibleTimelineData:e.visibleTimelineData,expandedGroups:e.expandedGroups,timelineFirstVisibleInstant:e.timelineFirstVisibleInstant,selectedItemIds:e.selectedItemIds,onTodayButtonClicked:t[0]||(t[0]=o=>e.timelineContentRef?.scrollTimelineToToday()),onGroupClicked:e.toggleGroupExpansion,onInvokeCommand:t[1]||(t[1]=o=>e.invokeCommand(o)),onItemInspected:t[2]||(t[2]=o=>e.selectedItemIds=[o]),onClose:e.clearCurrentlySelectedItem},null,8,["visibleTimelineData","expandedGroups","timelineFirstVisibleInstant","selectedItemIds"]),V(e.MEventTimelineContent,{ref:"timelineContentRef",visibleTimelineData:e.visibleTimelineData,timelineStartInstant:e.timelineStartInstant,timelineEndInstant:e.timelineEndInstant,timelineLengthInDays:e.timelineLengthInDays,timelineFirstVisibleInstant:e.timelineFirstVisibleInstant,numberOfTimelineBufferDays:e.numberOfTimelineBufferDays,timelineDayWidthInRem:e.timelineDayWidthInRem,expandedGroups:e.expandedGroups,selectedItemIds:e.selectedItemIds,"onUpdate:timelineFirstVisibleInstant":t[3]||(t[3]=o=>e.timelineFirstVisibleInstant=o),"onUpdate:timelineLastVisibleInstant":t[4]||(t[4]=o=>e.timelineLastVisibleInstant=o),"onUpdate:timelineDayWidthInRem":t[5]||(t[5]=o=>e.timelineDayWidthInRem=o),onEventClicked:t[6]||(t[6]=o=>e.selectedItemIds=[o])},null,8,["visibleTimelineData","timelineStartInstant","timelineEndInstant","timelineLengthInDays","timelineFirstVisibleInstant","numberOfTimelineBufferDays","timelineDayWidthInRem","expandedGroups","selectedItemIds"]),V(e.MEventTimelineInspector,{selectedItemAndDetails:e.selectedItemAndDetails,visibleTimelineData:e.visibleTimelineData,onClose:e.clearCurrentlySelectedItem,onInvokeCommand:t[7]||(t[7]=o=>e.invokeCommand(o))},null,8,["selectedItemAndDetails","visibleTimelineData"])])):(l(),r("div",Fi,t[9]||(t[9]=[a("div",{class:"tw-animate-bounce tw-italic tw-text-neutral-500"},"Loading...",-1)]))),e.props.debug?(l(),r("pre",Vi,[t[17]||(t[17]=a("div",{class:"tw-font-bold"},"MEventTimeline Debug Info",-1)),a("div",null,[t[11]||(t[11]=a("div",{class:"tw-font-bold"},"TIMELINE",-1)),a("div",null,"Day width: "+h(e.timelineDayWidthInRem)+"rem",1),a("div",null,"First visible instant: "+h(e.timelineFirstVisibleInstant),1),a("div",null,"Last visible instant: "+h(e.timelineLastVisibleInstant),1)]),a("div",null,[t[12]||(t[12]=a("div",{class:"tw-font-bold"},"TIMELINE DISPLAY OPTIONS",-1)),a("div",null,"Timeline start: "+h(e.timelineStartInstant)+" ("+h(e.numberOfTimelineBufferDays)+" not fetched)",1),a("div",null,"Total days: "+h(e.timelineLengthInDays),1),a("div",null,"Timeline end: "+h(e.timelineEndInstant)+" ("+h(e.numberOfTimelineBufferDays)+" not fetched)",1)]),a("div",null,[t[13]||(t[13]=a("div",{class:"tw-font-bold"},"VISIBLE RANGE (for data fetching)",-1)),a("div",null,"Data range to fetch start: "+h(e.visibleRange.startInstant),1),a("div",null,"Total days: "+h(e.visibleRange.endInstant.diff(e.visibleRange.startInstant,"days").days)+" days",1),a("div",null,"Data range to fetch end: "+h(e.visibleRange.endInstant),1)]),n.timelineData?(l(),r("div",Oi,[t[14]||(t[14]=a("div",{class:"tw-font-bold"},"FETCHED DATA",-1)),a("div",null,"Data start: "+h(n.timelineData.startInstantIsoString),1),a("div",null,"Total days: "+h(e.DateTime.fromISO(n.timelineData.endInstantIsoString).diff(e.DateTime.fromISO(n.timelineData.startInstantIsoString),"days").days)+" days",1),a("div",null,"Data end: "+h(n.timelineData.endInstantIsoString),1)])):(l(),r("div",Bi,t[15]||(t[15]=[a("div",{class:"tw-font-bold"},"FETCHED DATA",-1),a("div",null,"Empty",-1)]))),a("div",null,[t[16]||(t[16]=a("div",{class:"tw-font-bold"},"SELECTED ITEM",-1)),a("div",null,"Selected items: "+h(e.selectedItemIds.join(", ")||"none"),1)])])):D("",!0)],void 0,!0),_:1},8,["variant","error"])}const Wi=q(Li,[["render",Gi],["__file","MEventTimeline.vue"]]);class ke{register(t,n){if(this.updateDataCallback??this.updateItemDetailsCallback)throw new Error("Register called twice");this.updateDataCallback=t,this.updateItemDetailsCallback=n}updateDataCallback;updateItemDetailsCallback;setTimelineData(t){if(this.updateDataCallback)this.cachedTimelineData=pe(t),this.updateDataCallback(this.cachedTimelineData);else throw new Error("No updateData callback was registered.")}updateItemData(t){if(console.assert(!!this.cachedTimelineData,"No timeline data exists to update!"),Object.keys(t).length>0){for(const[n,e]of Object.entries(t))e?this.cachedTimelineData.items[n]=pe(e):delete this.cachedTimelineData.items[n];this.setTimelineData(this.cachedTimelineData)}}updateItemDetails(t){if(this.updateItemDetailsCallback)this.updateItemDetailsCallback(t);else throw new Error("No updateItemDetails callback was registered.")}cachedTimelineData}class me{constructor(t,n,e,s){this.hasReceivedFirstRequest=!1,this.options={largestAllowedTotalWindowInDays:void 0,debounceTimeInMs:1e3,...s},t.register(n,e),this.fetchHandler=t,this.onUpdateItemDetails=e}options;fetchHandler;hasReceivedFirstRequest;onUpdateItemDetails;pollerId;nextRequestWindow;fetchedWindow;totalFetchedWindow;requestTimelineData(t,n,e,s){s=s??!this.hasReceivedFirstRequest,this.hasReceivedFirstRequest=!0,this.nextRequestWindow={firstVisibleInstant:t,lastVisibleInstant:n,bufferInDays:e},clearTimeout(this.pollerId),s?this._requestTimelineData():this.pollerId=setTimeout(()=>{this._requestTimelineData()},this.options.debounceTimeInMs)}refreshTimelineData(t){this.totalFetchedWindow&&this.requestTimelineData(this.totalFetchedWindow.startInstant,this.totalFetchedWindow.endInstant,0,t)}requestItemDetails(t){this.onUpdateItemDetails(Object.fromEntries(t.map(n=>[n,void 0]))),this.fetchHandler.requestItemDetails(t)}_requestTimelineData(){if(!this.nextRequestWindow)throw new Error("Expected nextRequestWindow to be set.");const t=this.nextRequestWindow.firstVisibleInstant.minus({days:this.nextRequestWindow.bufferInDays}),n=this.nextRequestWindow.lastVisibleInstant.plus({days:this.nextRequestWindow.bufferInDays});if(!this.fetchedWindow||!me.doesWindowContainQuery(this.fetchedWindow.startInstant,this.fetchedWindow.endInstant,t,n)){const s=t.minus({days:this.nextRequestWindow.bufferInDays}),m=n.plus({days:this.nextRequestWindow.bufferInDays}),o=m.diff(s).as("days"),c=this.totalFetchedWindow?.startInstant??s,u=this.totalFetchedWindow?.endInstant??m;let b=s<c?s:c,f=m>u?m:u;if(this.options.largestAllowedTotalWindowInDays!==void 0&&f.diff(b).as("days")>this.options.largestAllowedTotalWindowInDays)if(o>this.options.largestAllowedTotalWindowInDays)b=s,f=m,console.warn('"largestAllowedTotalWindowInDays" is not big enough to honour the request. Forcing request to be honoured.');else{let I=!1;if(s<c&&(f=b.plus({days:this.options.largestAllowedTotalWindowInDays}),I=!0),m&&(b=f.minus({days:this.options.largestAllowedTotalWindowInDays}),I=!0),!I)throw new Error("Not sure how we got here..")}this.fetchedWindow={startInstant:s,endInstant:m},this.totalFetchedWindow={startInstant:b,endInstant:f},this.fetchHandler.requestTimelineData(b,f)}this.nextRequestWindow=void 0}static doesWindowContainQuery(t,n,e,s){return e>t&&s<n}}const zi=H({__name:"GameServerEventTimeline",props:{preselectedItemId:{},initialVisibleTimelineStartInstant:{},startExpanded:{type:Boolean}},setup(i,{expose:t}){t();const n=F([]),e=F(),s=F({}),m=he();class o extends ke{requestTimelineData(p,v){this.initialFetchCancelTokenSource&&this.initialFetchCancelTokenSource.cancel(),this.cancelPoll(),this.firstInstant=p,this.lastInstant=v,this.initialFetchCancelTokenSource=oe.CancelToken.source(),m.request({method:"GET",url:"liveOpsTimelineData",params:{firstInstant:p.toISO()??"??",lastInstant:v.toISO()??"??"},cancelToken:this.initialFetchCancelTokenSource.token}).then(d=>{this.initialFetchCancelTokenSource=void 0,this.setTimelineData(d.data.timelineData),this.continuationCursor=d.data.updateCursor,this.pollForUpdates()}).catch(d=>{if(!oe.isCancel(d)){if(d.response)throw d}})}requestItemDetails(p){const v={itemIds:p};m.post("liveOpsTimelineItemDetails",v).then(d=>{this.updateItemDetails(d.data.items)})}triggerFullRefreshNow(){this.firstInstant&&this.lastInstant&&this.requestTimelineData(this.firstInstant,this.lastInstant)}triggerUpdatePollNow(){this.pollForUpdates()}pollForUpdates(){this.cancelPoll(),!b.value&&(this.updateCancelTokenSource=oe.CancelToken.source(),m.post("getLiveOpsTimelineDataUpdates",{cursor:this.continuationCursor},{cancelToken:this.updateCancelTokenSource.token}).then(p=>{this.updateCancelTokenSource=void 0,p.data.isSuccess?(Object.keys(p.data.itemUpdates).length&&this.updateItemData(p.data.itemUpdates),this.continuationCursor=p.data.continuationCursor,this.updatePollId=setTimeout(()=>{this.pollForUpdates()},2e3)):this.triggerFullRefreshNow()}).catch(p=>{if(!oe.isCancel(p)){if(p.response)throw p}}))}cancelPoll(){this.updatePollId&&(clearTimeout(this.updatePollId),this.updatePollId=void 0),this.updateCancelTokenSource&&(this.updateCancelTokenSource.cancel(),this.updateCancelTokenSource=void 0)}firstInstant;lastInstant;continuationCursor;initialFetchCancelTokenSource;updateCancelTokenSource;updatePollId}const c=new o,u=new me(c,g=>{e.value=g},g=>{s.value=g},{largestAllowedTotalWindowInDays:100,debounceTimeInMs:1e3}),b=F(!1);de(()=>{c.cancelPoll(),b.value=!0});function f(g){u.requestTimelineData(g.startInstant,g.endInstant,g.bufferInDays)}function T(g){n.value=g,u.requestItemDetails(g)}async function I(g){const p={command:g};await m.post("invokeLiveOpsTimelineCommand",p),c.triggerUpdatePollNow()}const C={selectedItemIds:n,fetchedTimelineData:e,fetchedTimelineItemDetails:s,gameServerApi:m,TimelineDataFetchHandlerFromServer:o,timelineDataFetchHandlerFromServer:c,timelineDataFetcher:u,stopPolling:b,onVisibleRangeUpdated:f,onSelectedItemIdsUpdated:T,onInvokeCommand:I,get axios(){return oe},get DateTime(){return N},onUnmounted:de,ref:F,get useGameServerApi(){return he},get MEventTimeline(){return Wi},get TimelineDataFetcher(){return me},get TimelineDataFetchHandler(){return ke}};return Object.defineProperty(C,"__isScriptSetup",{enumerable:!1,value:!0}),C}});function ji(i,t,n,e,s,m){return l(),R(e.MEventTimeline,{timelineData:e.fetchedTimelineData,initialVisibleTimelineStartInstant:n.initialVisibleTimelineStartInstant,preselectedItemId:n.preselectedItemId,selectedItemIds:e.selectedItemIds,selectedItemDetails:e.fetchedTimelineItemDetails,startExpanded:n.startExpanded,"onUpdate:visibleRange":e.onVisibleRangeUpdated,"onUpdate:selectedItemIds":e.onSelectedItemIdsUpdated,onInvokeCommand:e.onInvokeCommand},null,8,["timelineData","initialVisibleTimelineStartInstant","preselectedItemId","selectedItemIds","selectedItemDetails","startExpanded"])}const es=q(zi,[["render",ji],["__file","GameServerEventTimeline.vue"]]);export{es as default};
