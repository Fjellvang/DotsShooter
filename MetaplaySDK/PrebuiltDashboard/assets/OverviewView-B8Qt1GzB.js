import{d as R,x as b,a3 as k,a4 as _,a5 as D,z as p,a6 as x,a7 as I,c as S,M as z,a0 as F,a8 as H,a9 as j,b as O,o as n,e as m,w as a,n as r,p as o,k as s,l as E,t as l,a as u,r as B,F as N,$ as q,_ as W}from"./index-B7jvAjdE.js";import Y from"./MetaAbbreviateNumber-BSjpGLV9.js";import{M as J,a as K}from"./MViewContainer-BTeE2xDT.js";import Q from"./MetaRawData-CedjqGjJ.js";import{C as X}from"./CoreUiPlacement-CPf1fwrN.js";import"./numberUtils-CkF0oMe2.js";import"./utils-Dwlepb3M.js";const Z=R({__name:"OverviewView",setup(h,{expose:t}){t();const{data:C,error:e}=b(k()),{data:c,error:M}=b(_()),{data:v,error:f}=b(D()),i=p();function P(g){return c.value?.totalItemCounts?.[g+"s"]||0}const d=x(),{data:V,error:T}=b(I()),L=S(()=>!!d.environmentInfo.grafanaUri),A=S(()=>{if(d.environmentInfo.grafanaUri){const g=d.environmentInfo.kubernetesNamespace?`,namespace=\\"${d.environmentInfo.kubernetesNamespace}\\"`:"";return`${d.environmentInfo.grafanaUri}/explore?orgId=1&left={"datasource": "Loki", "queries":[{"expr":"{app=\\"metaplay-server\\"${g}}"}],"range":{"from":"now-1h","to":"now"}}`}else return});function U(g){const y=g.map(G=>G.level);return y.includes("Error")?"danger":y.includes("Warning")?"warning":"primary"}const w={backendStatusData:C,backendStatusError:e,databaseItemCountsData:c,databaseItemCountsError:M,telemetryMessagesData:v,telemetryMessagesError:f,coreStore:i,databaseItemCount:P,staticInfos:d,errorCountsData:V,errorCountsError:T,grafanaEnabled:L,grafanaLogsLink:A,getHighestTelemetryMessageVariant:U,computed:S,get useStaticInfos(){return x},get MetaAbbreviateNumber(){return Y},get MetaRawData(){return Q},get MBadge(){return z},get MPageOverviewCard(){return J},get MViewContainer(){return K},get MCallout(){return F},get MTextButton(){return H},get maybePluralString(){return j},get useSubscription(){return b},CoreUiPlacement:X,get useCoreStore(){return p},get getBackendStatusSubscriptionOptions(){return k},get getDatabaseItemCountsSubscriptionOptions(){return _},get getServerErrorsSubscriptionOptions(){return I},get getTelemetryMessagesSubscriptionOptions(){return D}};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}}),$={class:"tw-space-y-2"},ee={class:"table table-sm tw-mt-1"},te={class:"text-right"},re={class:"text-right"},ae={class:"text-right"},ne={class:"tw-text-right"},se={key:0,class:"tw-italic tw-text-neutral-500"},oe={key:1},ie={key:2,class:"tw-text-red-500"},le={key:3,class:"tw-text-red-500"},ue={class:"table table-sm tw-mt-1"},de={class:"text-right text-right"},me={class:"text-right text-right"},ge={class:"text-right"};function be(h,t,C,e,c,M){const v=O("b-col"),f=O("b-row");return n(),m(e.MViewContainer,{"is-loading":!e.backendStatusData||!e.databaseItemCountsData,error:e.backendStatusError||e.databaseItemCountsError||e.errorCountsError},{alerts:a(()=>[r("div",$,[e.errorCountsData&&e.errorCountsData.errorCount>0?(n(),m(e.MCallout,{key:0,variant:"danger",title:e.maybePluralString(e.errorCountsData.errorCount,"Game Server Error")},{default:a(()=>[t[1]||(t[1]=o("Server errors may indicate a problem with your game. Please investigate by looking at the ")),s(e.MTextButton,{to:"/serverErrors",permission:"api.system.view_error_logs"},{default:a(()=>t[0]||(t[0]=[o("message center page")]),void 0,!0),_:1}),t[2]||(t[2]=o("."))],void 0,!0),_:1},8,["title"])):E("",!0),e.telemetryMessagesData?.messages&&e.telemetryMessagesData.messages.length>0?(n(),m(e.MCallout,{key:1,variant:e.getHighestTelemetryMessageVariant(e.telemetryMessagesData.messages),title:e.maybePluralString(e.telemetryMessagesData.messages.length,"Telemetry Message")},{default:a(()=>[t[4]||(t[4]=o("One or more game server components have newer versions available. You can view them on the ")),s(e.MTextButton,{to:"/serverErrors",permission:"api.system.view_telemetry_messages"},{default:a(()=>t[3]||(t[3]=[o("message center page")]),void 0,!0),_:1}),t[5]||(t[5]=o("."))],void 0,!0),_:1},8,["variant","title"])):E("",!0)])]),overview:a(()=>[s(e.MPageOverviewCard,{title:"Game Server Status",subtitle:`Build: ${e.staticInfos.gameServerInfo.buildNumber}`,"data-testid":"overview-card"},{caption:a(()=>[o("Commit ID: "+l(e.staticInfos.gameServerInfo.commitId),1)]),default:a(()=>[s(f,null,{default:a(()=>[s(v,{class:"border-right-md",sm:""},{default:a(()=>[t[11]||(t[11]=r("span",{class:"font-weight-bold"},"Game Server",-1)),r("table",ee,[r("tbody",null,[r("tr",null,[t[6]||(t[6]=r("td",null,"Live Concurrents",-1)),r("td",te,[s(e.MetaAbbreviateNumber,{value:e.backendStatusData.numConcurrents},null,8,["value"])])]),(n(!0),u(N,null,B(e.coreStore.actorOverviews.overviewListEntries,i=>(n(),u("tr",{key:i.key},[r("td",null,l(i.displayName),1),r("td",re,[s(e.MetaAbbreviateNumber,{value:e.backendStatusData.liveEntityCounts[i.key]},null,8,["value"])])]))),128)),r("tr",null,[t[10]||(t[10]=r("td",null,"Maintenance Mode",-1)),r("td",ae,[e.backendStatusData.maintenanceStatus.isInMaintenance?(n(),m(e.MBadge,{key:0,variant:"danger"},{default:a(()=>t[7]||(t[7]=[o("On")]),void 0,!0),_:1})):e.backendStatusData.maintenanceStatus.scheduledMaintenanceMode?(n(),m(e.MBadge,{key:1,variant:"warning"},{default:a(()=>t[8]||(t[8]=[o("Scheduled")]),void 0,!0),_:1})):(n(),m(e.MBadge,{key:2},{default:a(()=>t[9]||(t[9]=[o("Off")]),void 0,!0),_:1}))])]),r("tr",null,[r("td",{class:q({"tw-text-red-500":e.errorCountsData&&e.errorCountsData.errorCount>0})},"Server Errors",2),r("td",ne,[e.errorCountsData?e.errorCountsData.errorCount===0?(n(),u("span",oe,"0")):e.errorCountsData.overMaxErrorCount?(n(),u("span",le,l(e.errorCountsData.errorCount)+"+",1)):(n(),u("span",ie,l(e.errorCountsData.errorCount),1)):(n(),u("span",se,"Loading..."))])])])])],void 0,!0),_:1}),s(v,{sm:""},{default:a(()=>[t[14]||(t[14]=r("span",{class:"font-weight-bold"},"Database",-1)),r("table",ue,[r("tbody",null,[r("tr",null,[t[12]||(t[12]=r("td",null,"Type",-1)),r("td",de,[s(e.MBadge,null,{default:a(()=>[o(l(e.backendStatusData.databaseStatus.backend),1)],void 0,!0),_:1})])]),r("tr",null,[t[13]||(t[13]=r("td",null,"Active Shards",-1)),r("td",me,l(e.backendStatusData.databaseStatus.activeShards)+"/"+l(e.backendStatusData.databaseStatus.totalShards),1)]),(n(!0),u(N,null,B(e.coreStore.actorOverviews.databaseListEntries,i=>(n(),u("tr",{key:i.key},[r("td",null,l(i.displayName),1),r("td",ge,[s(e.MetaAbbreviateNumber,{value:e.databaseItemCount(i.key)},null,8,["value"])])]))),128))])])],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1},8,["subtitle"])]),default:a(()=>[s(e.CoreUiPlacement,{placementId:"OverviewView"}),s(e.MetaRawData,{kvPair:e.backendStatusData,name:"backendStatusData"},null,8,["kvPair"])]),_:1},8,["is-loading","error"])}const ye=W(Z,[["render",be],["__file","OverviewView.vue"]]);export{ye as default};
