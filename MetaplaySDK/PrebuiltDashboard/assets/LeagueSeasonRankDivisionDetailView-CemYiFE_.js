import{d as X,aj as Y,al as S,x,c as m,f,C as j,co as E,ad as z,M as Z,a0 as $,a8 as ee,ae as G,b as u,o as b,e as B,w as t,k as n,n as r,p as a,t as g,a as U,l as ie,_ as ne}from"./index-B7jvAjdE.js";import{M as te}from"./MActionModalButton-CvWVuTB-.js";import{M as ae,a as oe}from"./MViewContainer-BTeE2xDT.js";import{M as se}from"./MSingleColumnLayout-B4K0ZAFA.js";import{C as re}from"./CoreUiPlacement-CPf1fwrN.js";import{a as q,c as F,b as H}from"./leagues-DnPkib1L.js";import"./MActionModal-coQLkvWs.js";import"./index-fVjXqxSF.js";const de=X({__name:"LeagueSeasonRankDivisionDetailView",setup(J,{expose:i}){i();const p=z(),e=Y(),P=S(e.params.divisionId),l=S(e.params.leagueId),o=parseInt(S(e.params.seasonId)),{data:d}=x(q(l)),{data:s}=x(F(P)),{data:c}=x(H(l,o)),M=m(()=>s.value?.model.divisionIndex.rank),k=m(()=>Object.keys(s.value.model.participants).length),C=m(()=>s.value?.model.isConcluded===!0?[{title:"Past Division",message:"You are currently viewing a division from a past season.",variant:"neutral"}]:[]),I=m(()=>{if(!w.value)return"Select a player to proceed.";if(s.value?.model.isConcluded)return"You can only add a participant to a division in an active season."}),D=m(()=>{const v=s.value.model.divisionIndex.rank;return c.value?.ranks[v].numDivisions||0}),_=f(),L=f(),A=f(),O=f(),T=j([s],async()=>{if(s.value){const v=s.value.model.divisionIndex.rank,y=s.value.model.divisionIndex.division;if(y>0){const h=await p.get(`/divisions/id/${l}/${o}/${v}/${y-1}/`);_.value=`/leagues/${l}/${o}/${h.data}`}else A.value="You are in the first division.";if(y<D.value-1){const h=await p.get(`/divisions/id/${l}/${o}/${v}/${y+1}/`);L.value=`/leagues/${l}/${o}/${h.data}`}else O.value="You are in the last division.";E(()=>{T()})}},{immediate:!0}),K=m(()=>s.value?.seasonPhase||"NoDivision"),w=f();function Q(){w.value=void 0}const{showSuccessNotification:V,showErrorNotification:N}=G();async function W(){if(w.value){const v=await p.post(`/leagues/${l}/participant/${w.value?.id}/add/${P}`);v.data.success?V("Participant successfully added!"):N(v.data.errorMessage)}}const R={gameServerApi:p,route:e,divisionId:P,leagueId:l,seasonId:o,singleLeagueData:d,singleDivisionData:s,singleLeagueSeasonData:c,rankId:M,currentParticipantCount:k,alerts:C,okButtonDisabledReason:I,numDivisions:D,previousDivisionLink:_,nextDivisionLink:L,previousDivisionTooltip:A,nextDivisionTooltip:O,unwatchSingleDivisionData:T,currentPhase:K,chosenPlayer:w,resetParticipantModal:Q,showSuccessNotification:V,showErrorNotification:N,forceAddParticipant:W,computed:m,nextTick:E,ref:f,watch:j,get useRoute(){return Y},get useGameServerApi(){return z},get MActionModalButton(){return te},get MBadge(){return Z},get MCallout(){return $},get MPageOverviewCard(){return ae},get MSingleColumnLayout(){return se},get MTextButton(){return ee},get MViewContainer(){return oe},get useNotifications(){return G},get useSubscription(){return x},CoreUiPlacement:re,get routeParamToSingleValue(){return S},get getSingleLeagueSubscriptionOptions(){return q},get getSingleDivisionSubscriptionOptions(){return F},get getSingleLeagueSeasonSubscriptionOptions(){return H}};return Object.defineProperty(R,"__isScriptSetup",{enumerable:!1,value:!0}),R}}),le={class:"d-md-flex justify-content-around mt-5 mb-5 d-none",style:{"font-size":"130%"}},ue={class:"mt-5 mb-5 d-md-none tw-text-center",style:{"font-size":"130%"}},ge={class:"font-weight-bold tw-mb-1"},ve={key:0},me={class:"font-weight-bold"},ce={class:"font-weight-bold"},fe={key:1},pe={class:"font-weight-bold"},De={class:"d-flex justify-content-between tw-mt-4"};function we(J,i,p,e,P,l){const o=u("fa-icon"),d=u("b-td"),s=u("b-tr"),c=u("meta-time"),M=u("b-tbody"),k=u("b-table-simple"),C=u("meta-input-player-select"),I=u("meta-no-seatbelts"),D=u("meta-raw-data");return b(),B(e.MViewContainer,{"is-loading":!e.singleDivisionData||!e.singleLeagueData||!e.singleLeagueSeasonData,alerts:e.alerts,permission:"api.leagues.view"},{overview:t(()=>[n(e.MPageOverviewCard,{id:e.divisionId,title:`Division ${e.singleDivisionData.model.divisionIndex.division}`,"data-testid":"league-season-rank-division-overview"},{subtitle:t(()=>[r("span",null,[n(e.MTextButton,{to:`/leagues/${e.leagueId}`},{default:t(()=>[a(g(e.singleLeagueData.details.leagueDisplayName),1)],void 0,!0),_:1},8,["to"]),i[1]||(i[1]=a(" / ")),n(e.MTextButton,{to:`/leagues/${e.leagueId}/${e.seasonId}`},{default:t(()=>[a(g(e.singleLeagueSeasonData.displayName),1)],void 0,!0),_:1},8,["to"]),a(" / Division "+g(e.singleDivisionData.model.divisionIndex.division)+" of "+g(e.singleLeagueSeasonData?.ranks[e.rankId].rankName),1)])]),buttons:t(()=>[n(e.MActionModalButton,{"modal-title":"Add Participant",action:e.forceAddParticipant,"trigger-button-label":"Add Participant","trigger-button-disabled-tooltip":e.singleDivisionData.model.isConcluded?"You can only add a participant to a division in an active season.":void 0,"ok-button-label":"Add Participant","ok-button-disabled-tooltip":e.okButtonDisabledReason,variant:"warning",permission:"api.leagues.participant_edit",onShow:e.resetParticipantModal,"data-testid":"action-add-participant"},{default:t(()=>[i[21]||(i[21]=r("p",null,"You can manually add new participants to this division.",-1)),n(e.MCallout,{class:"tw-my-2",title:"Participant limit reached",show:e.currentParticipantCount>=e.singleDivisionData.desiredParticipants,variant:"danger"},{default:t(()=>[e.currentParticipantCount>e.singleDivisionData.desiredParticipants?(b(),U("p",ve,[i[15]||(i[15]=a("This division already has ")),r("span",me,g(e.currentParticipantCount)+" participants",1),i[16]||(i[16]=a(", which exceeds the recommended limit of ")),r("span",ce,g(e.singleDivisionData.desiredParticipants)+" participants",1),i[17]||(i[17]=a(". Check with your game team if adding another participant might cause issues."))])):e.currentParticipantCount===e.singleDivisionData.desiredParticipants?(b(),U("p",fe,[i[18]||(i[18]=a("You are about to exceed the recommended number of ")),r("span",pe,g(e.singleDivisionData.desiredParticipants)+" participants",1),i[19]||(i[19]=a(" for this division. Check with your game team if this might cause issues."))])):ie("",!0)],void 0,!0),_:1},8,["show"]),i[22]||(i[22]=r("span",{class:"font-weight-bold"},"Select Player",-1)),n(C,{class:"tw-mt-1",value:e.chosenPlayer,ignorePlayerIds:Object.keys(e.singleDivisionData.model.participants),onInput:i[0]||(i[0]=_=>e.chosenPlayer=_)},null,8,["value","ignorePlayerIds"]),e.singleDivisionData.model.isConcluded?(b(),B(e.MCallout,{key:0,class:"mt-2",title:"Season concluded",show:"",variant:"danger"},{default:t(()=>i[20]||(i[20]=[a("The season has now concluded. You can no longer add participants to this division.")]),void 0,!0),_:1})):(b(),B(I,{key:1,class:"mt-2",message:"If the player is participating in a another division, their progress will be reset.",name:e.chosenPlayer?.name},null,8,["name"]))],void 0,!0),_:1},8,["trigger-button-disabled-tooltip","ok-button-disabled-tooltip"])]),default:t(()=>[r("div",le,[n(e.MBadge,{class:"mx-md-2",variant:e.currentPhase==="Preview"?"primary":"neutral"},{default:t(()=>i[2]||(i[2]=[a("Preview")]),void 0,!0),_:1},8,["variant"]),n(o,{class:"mt-2",icon:"arrow-right"}),n(e.MBadge,{class:"mx-md-2",variant:e.currentPhase==="Ongoing"?"primary":"neutral"},{default:t(()=>i[3]||(i[3]=[a("Ongoing")]),void 0,!0),_:1},8,["variant"]),n(o,{class:"mt-2",icon:"arrow-right"}),n(e.MBadge,{class:"mx-md-2",variant:e.currentPhase==="Resolving"?"primary":"neutral"},{default:t(()=>i[4]||(i[4]=[a("Resolving")]),void 0,!0),_:1},8,["variant"]),n(o,{class:"mt-2",icon:"arrow-right"}),n(e.MBadge,{class:"mx-md-2",variant:e.currentPhase==="Concluded"?"primary":"neutral"},{default:t(()=>i[5]||(i[5]=[a("Concluded")]),void 0,!0),_:1},8,["variant"])]),r("div",ue,[n(e.MBadge,{class:"mx-md-2",variant:e.currentPhase==="Preview"?"primary":"neutral"},{default:t(()=>i[6]||(i[6]=[a("Preview")]),void 0,!0),_:1},8,["variant"]),r("div",null,[n(o,{icon:"arrow-down"})]),n(e.MBadge,{class:"mx-md-2",variant:e.currentPhase==="Ongoing"?"primary":"neutral"},{default:t(()=>i[7]||(i[7]=[a("Ongoing")]),void 0,!0),_:1},8,["variant"]),r("div",null,[n(o,{icon:"arrow-down"})]),n(e.MBadge,{class:"mx-md-2",variant:e.currentPhase==="Resolving"?"primary":"neutral"},{default:t(()=>i[8]||(i[8]=[a("Resolving")]),void 0,!0),_:1},8,["variant"]),r("div",null,[n(o,{icon:"arrow-down"})]),n(e.MBadge,{class:"mx-md-2",variant:e.currentPhase==="Concluded"?"primary":"neutral"},{default:t(()=>i[9]||(i[9]=[a("Concluded")]),void 0,!0),_:1},8,["variant"])]),r("div",ge,[n(o,{icon:"chart-bar"}),i[10]||(i[10]=a(" Overview"))]),n(k,{small:""},{default:t(()=>[n(M,null,{default:t(()=>[n(s,null,{default:t(()=>[n(d,null,{default:t(()=>i[11]||(i[11]=[a("Total participants")]),void 0,!0),_:1}),n(d,{class:"text-right"},{default:t(()=>[a(g(e.currentParticipantCount)+" / "+g(e.singleDivisionData.desiredParticipants),1)],void 0,!0),_:1})],void 0,!0),_:1}),n(s,null,{default:t(()=>[n(d,null,{default:t(()=>i[12]||(i[12]=[a("Created at")]),void 0,!0),_:1}),n(d,{class:"text-right"},{default:t(()=>[n(c,{date:e.singleDivisionData.model.createdAt,showAs:"datetime"},null,8,["date"])],void 0,!0),_:1})],void 0,!0),_:1}),n(s,null,{default:t(()=>[n(d,null,{default:t(()=>i[13]||(i[13]=[a("Start time")]),void 0,!0),_:1}),n(d,{class:"text-right"},{default:t(()=>[n(c,{date:e.singleDivisionData.model.startsAt,showAs:"timeagoSentenceCase"},null,8,["date"])],void 0,!0),_:1})],void 0,!0),_:1}),n(s,null,{default:t(()=>[n(d,null,{default:t(()=>i[14]||(i[14]=[a("End time")]),void 0,!0),_:1}),n(d,{class:"text-right"},{default:t(()=>[n(c,{date:e.singleDivisionData.model.endsAt,showAs:"timeagoSentenceCase"},null,8,["date"])],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1},8,["id","title"]),r("div",De,[n(e.MTextButton,{to:e.previousDivisionLink,"disabled-tooltip":e.previousDivisionTooltip},{default:t(()=>[n(o,{class:"tw-mr-1",icon:"arrow-left"}),i[23]||(i[23]=a(" View previous division"))],void 0,!0),_:1},8,["to","disabled-tooltip"]),n(e.MTextButton,{to:e.nextDivisionLink,"disabled-tooltip":e.nextDivisionTooltip},{default:t(()=>[i[24]||(i[24]=a("View next division ")),n(o,{class:"tw-ml-1",icon:"arrow-right"})],void 0,!0),_:1},8,["to","disabled-tooltip"])])]),default:t(()=>[n(e.MSingleColumnLayout,null,{default:t(()=>[n(e.CoreUiPlacement,{placementId:"Leagues/Season/RankDivision/Details",leagueId:e.leagueId,divisionId:e.divisionId},null,8,["leagueId","divisionId"])],void 0,!0),_:1}),n(D,{kvPair:e.singleLeagueSeasonData,name:"seasonData"},null,8,["kvPair"]),n(D,{kvPair:e.singleDivisionData,name:"divisionData"},null,8,["kvPair"])],void 0,!0),_:1},8,["is-loading","alerts"])}const Ce=ne(de,[["render",we],["__file","LeagueSeasonRankDivisionDetailView.vue"]]);export{Ce as default};
