import{d as V,x as S,a6 as B,f as c,ad as k,M as P,O as A,s as D,v as F,a8 as O,b as y,o as n,a as d,k as o,w as a,p as r,n as l,t as i,e as w,F as C,r as I,l as f,_ as E}from"./index-B7jvAjdE.js";import{M as j}from"./MModal-CihxrIfO.js";import{a as T}from"./players-CydHenLG.js";import{M as z}from"./MetaGeneratedForm-BcVgOIy3.js";import"./index-fVjXqxSF.js";import"./MInputMultiSelectCheckbox-D_9f7ub1.js";import"./MInputCheckbox-BqateWtE.js";import"./index-B_QkKjtG.js";import"./MInputHintMessage-DbuBS4Kn.js";import"./GeneratedUiFormDynamicComponent-DrqrTIRR.js";const Y=V({__name:"PlayerActionGuildTools",props:{playerId:{}},setup(M,{expose:t}){t();const h=M,e=k(),{data:g}=S(T(h.playerId)),_=B(),u=c(),m=c({}),p=c(!1),s=c([]),N=c();async function G(){m.value={},p.value=!1,s.value=[],await b()}async function R(x){s.value=null;const L=await e.post(`/players/${g.value.id}/guildSearch`,m.value);s.value=L.data}async function b(){u.value=null;const x=await e.post(`/players/${g.value.id}/guildRecommendations`);u.value=x.data}const v={props:h,gameServerApi:e,playerData:g,staticInfos:_,recommendations:u,searchContents:m,searchContentsValid:p,searchResults:s,guildToolsModal:N,resetModal:G,search:R,refresh:b,ref:c,get useGameServerApi(){return k},get useStaticInfos(){return B},get MBadge(){return P},get MButton(){return A},get MList(){return D},get MListItem(){return F},get MModal(){return j},get MTextButton(){return O},get useSubscription(){return S},get getSinglePlayerSubscriptionOptions(){return T},MetaGeneratedForm:z};return Object.defineProperty(v,"__isScriptSetup",{enumerable:!1,value:!0}),v}}),U={key:0},q={class:"!tw-overflow-x-hidden"},H={class:"tw-mb-2 tw-text-sm"},J={class:"tw-mb-2 tw-mt-3"},K={key:0,class:"tw-my-2 tw-flex tw-flex-wrap"},Q={key:2,class:"small tw-italic tw-text-neutral-500"},W={class:"tw-end-0 tw-mt-2"},X={class:"!tw-overflow-x-hidden"},Z={class:"tw-mb-2"},$={class:"tw-mb-2 tw-mt-3"},ee={class:"tw-end-0 tw-mt-2"},te={key:0,class:"tw-justify-center"},se={key:1},ae={key:2};function le(M,t,h,e,g,_){const u=y("fa-icon"),m=y("b-spinner"),p=y("meta-plural-label");return e.staticInfos.featureFlags.guilds&&e.playerData?(n(),d("div",U,[o(e.MButton,{permission:"api.players.guild_tools",onClick:e.guildToolsModal?.open},{default:a(()=>t[2]||(t[2]=[r("Guild Tools")]),void 0,!0),_:1},8,["onClick"]),o(e.MModal,{ref:"guildToolsModal",title:`Guild Tools for ${e.playerData.model.playerName||"n/a"}`,onShow:e.resetModal},{"action-button-icon":a(()=>[o(u,{class:"tw-mr-1 tw-h-4 tw-w-4",icon:"chess-rook"})]),default:a(()=>[l("div",q,[t[6]||(t[6]=l("h6",{class:"tw-mb-1"},"Guild Recommendations",-1)),l("p",H,[t[3]||(t[3]=r("An example list of guilds that could be recommended for ")),o(e.MBadge,null,{default:a(()=>[r(i(e.playerData.model.playerName||"n/a"),1)],void 0,!0),_:1}),t[4]||(t[4]=r("."))]),t[7]||(t[7]=l("p",{class:"tw-text-sm+ tw-text-neutral-500"},"Note: This is not the exact list shown in the game at the moment, but rather an example of what recommendations the current game logic produces.",-1)),l("div",J,[e.recommendations==null?(n(),d("div",K,[o(m,{class:"tw-my-5",label:"Loading..."})])):e.recommendations&&e.recommendations.length>0?(n(),w(e.MList,{key:1,showBorder:""},{default:a(()=>[(n(!0),d(C,null,I(e.recommendations,s=>(n(),w(e.MListItem,{class:"tw-px-5",key:s.guildId,striped:""},{"top-right":a(()=>[o(e.MTextButton,{to:`/guilds/${s.guildId}`},{default:a(()=>[r(i(s.guildId),1)],void 0,!0),_:2},1032,["to"])]),"bottom-left":a(()=>[l("span",null,i(s.numMembers)+" / "+i(s.maxNumMembers)+" members",1)]),default:a(()=>[l("span",null,i(s.displayName),1)],void 0,!0),_:2},1024))),128))],void 0,!0),_:1})):(n(),d("div",Q,"No guilds found. This could be because you have no guilds, or because the guild search failed. You can refresh to try again.")),l("div",W,[o(e.MButton,{size:"small",onClick:e.refresh},{icon:a(()=>[o(u,{class:"tw-mr-1 tw-h-4 tw-w-3",icon:"sync-alt"})]),default:a(()=>[t[5]||(t[5]=r("Refresh"))],void 0,!0),_:1})])])])]),"right-panel":a(()=>[l("div",X,[t[12]||(t[12]=l("h6",{class:"tw-mb-1"},"Guild Search",-1)),l("p",Z,[t[8]||(t[8]=r("Perform a guild search as ")),o(e.MBadge,null,{default:a(()=>[r(i(e.playerData.model.playerName||"n/a"),1)],void 0,!0),_:1}),t[9]||(t[9]=r(" would see it."))]),t[13]||(t[13]=l("span",{class:"tw-text-sm+ tw-text-neutral-500"},"You can use this tool to preview how particular players are shown guild search results in the game.",-1)),l("div",$,[o(e.MetaGeneratedForm,{modelValue:e.searchContents,"onUpdate:modelValue":t[0]||(t[0]=s=>e.searchContents=s),typeName:"Metaplay.Core.Guild.GuildSearchParamsBase","logic-version":e.playerData.model.logicVersion,onStatus:t[1]||(t[1]=s=>e.searchContentsValid=s)},null,8,["modelValue","logic-version"]),l("div",ee,[o(e.MButton,{"disabled-tooltip":e.searchContentsValid?void 0:"Please complete the search form before searching.",size:"small",onClick:e.search},{default:a(()=>t[10]||(t[10]=[r("Search")]),void 0,!0),_:1},8,["disabled-tooltip"])]),e.searchResults==null?(n(),d("div",te,[o(m,{class:"tw-my-5",label:"Loading..."})])):f("",!0),e.searchResults!==null&&e.searchResults.isError===!0?(n(),d("p",se,"Search failed")):f("",!0),e.searchResults!==null&&e.searchResults.isError===!1?(n(),d("div",ae,[l("p",null,[o(p,{value:e.searchResults.guildInfos.length,label:"result"},null,8,["value"]),t[11]||(t[11]=r("."))]),e.searchResults.guildInfos&&e.searchResults.guildInfos.length>0?(n(),w(e.MList,{key:0,showBorder:""},{default:a(()=>[(n(!0),d(C,null,I(e.searchResults.guildInfos,s=>(n(),w(e.MListItem,{class:"tw-px-5",key:s.guildId,striped:""},{"top-right":a(()=>[o(e.MTextButton,{to:`/guilds/${s.guildId}`},{default:a(()=>[r(i(s.guildId),1)],void 0,!0),_:2},1032,["to"])]),"bottom-left":a(()=>[l("span",null,i(s.numMembers)+" / "+i(s.maxNumMembers)+" members",1)]),default:a(()=>[l("span",null,i(s.displayName),1)],void 0,!0),_:2},1024))),128))],void 0,!0),_:1})):f("",!0)])):f("",!0)])])]),_:1},8,["title"])])):f("",!0)}const pe=E(Y,[["render",le],["__file","PlayerActionGuildTools.vue"]]);export{pe as default};
