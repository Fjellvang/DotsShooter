import{d as k,x as p,f as s,C as v,c as g,ad as f,ae as N,o as x,e as D,w as V,n as y,t as P,k as I,l as B,_ as C}from"./index-B7jvAjdE.js";import{m as b}from"./actionDebouncer-CJRtFyZn.js";import{m as w}from"./axiosActionHandler-rx_q8iFy.js";import{M as T}from"./MActionModalButton-CvWVuTB-.js";import{M as E}from"./MInputText-CzhsT8yb.js";import{a as S}from"./players-CydHenLG.js";import"./MActionModal-coQLkvWs.js";import"./index-fVjXqxSF.js";import"./MInputHintMessage-DbuBS4Kn.js";import"./debounce-B8gTqdZO.js";import"./isSymbol-B7ZrWRtH.js";const O=k({__name:"PlayerActionEditName",props:{playerId:{}},setup(d,{expose:o}){o();const r=d,e=f(),{data:t,refresh:l}=p(S(r.playerId)),a=s(""),i=s("valid");function h(){a.value=t.value?.model.playerName??""}function A(n){return n==="no-change"?"Change the name to proceed.":n==="validating"?"Validating name...":n==="invalid"?"The chosen name is not valid. Fill in a valid name to proceed.":void 0}const m=b(w(),n=>{n.data.nameWasValid?a.value===t.value?.model.playerName?i.value="no-change":i.value="valid":i.value="invalid"},()=>{},500);v(a,()=>{a.value===t.value?.model.playerName?i.value="no-change":i.value="validating",m.requestAction({url:`/players/${t.value.id}/validateName`,method:"post",data:{newName:a.value}})});const _=g(()=>({valid:"success",invalid:"danger","no-change":"default",validating:"loading"})[i.value]??"danger"),{showSuccessNotification:u}=N();async function M(){try{await e.post(`/players/${t.value.id}/changeName`,{NewName:a.value});const n=`Player '${t.value.id}' is now '${a.value}'.`;u(n)}finally{l()}}const c={props:r,gameServerApi:e,playerData:t,playerRefresh:l,newName:a,validationState:i,resetModal:h,getDisabledReason:A,validationDebouncedAction:m,newNameInputVariant:_,showSuccessNotification:u,updateName:M,computed:g,ref:s,watch:v,get useGameServerApi(){return f},get makeAxiosActionHandler(){return w},get makeActionDebouncer(){return b},get MInputText(){return E},get MActionModalButton(){return T},get useNotifications(){return N},get useSubscription(){return p},get getSinglePlayerSubscriptionOptions(){return S}};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}}),R={class:"tw-mb-4"};function G(d,o,r,e,t,l){return e.playerData?(x(),D(e.MActionModalButton,{key:0,"modal-title":"Edit Player Name",action:e.updateName,"trigger-button-label":"Edit Name",variant:"warning","ok-button-disabled-tooltip":e.getDisabledReason(e.validationState),permission:"api.players.edit_name",onShow:e.resetModal,"data-testid":"action-edit-name"},{default:V(()=>[o[1]||(o[1]=y("h6",{class:"tw-mb-1 tw-font-semibold"},"Current Name",-1)),y("p",R,P(e.playerData.model.playerName??"n/a"),1),I(e.MInputText,{label:"New Name","model-value":e.newName,variant:e.newNameInputVariant,"hint-message":"Same rules are applied to name validation as changing it in-game.",placeholder:"DarkAngel87","onUpdate:modelValue":o[0]||(o[0]=a=>e.newName=a),"data-testid":"name-input"},null,8,["model-value","variant"])]),_:1},8,["ok-button-disabled-tooltip"])):B("",!0)}const Y=C(O,[["render",G],["__file","PlayerActionEditName.vue"]]);export{Y as default};
