import{d as j,aj as k,ab as T,x as B,al as V,c as b,N as w,ad as x,M as z,O as G,a0 as J,ae as R,cq as U,b as d,o as l,e as s,w as e,k as t,p as o,t as u,n as p,l as D,a as Y,_ as q}from"./index-B7jvAjdE.js";import{a as H}from"./numberUtils-CkF0oMe2.js";import{M as K}from"./MActionModalButton-CvWVuTB-.js";import{M as Q,a as W}from"./MViewContainer-BTeE2xDT.js";import{M as X}from"./MetaAudienceSizeEstimate-CCTh_xY2.js";import Z from"./AuditLogCard-DZ2AYrj2.js";import{M as $}from"./MetaGeneratedSection-C0Qyh3tH.js";import{P as aa}from"./PlayerListCard-CmEr-veR.js";import{T as ea}from"./TargetingCard-DNNkYW_r.js";import{a as E,N as ta}from"./NotificationFormButton-Hovph82t.js";import{g as O}from"./scanJobs-A4fyB_UL.js";import{B as na}from"./progress-GKvrz8Gh.js";import"./MActionModal-coQLkvWs.js";import"./index-fVjXqxSF.js";import"./MetaEventStreamCard-D_xDm3jw.js";import"./MInputMultiSelectCheckbox-D_9f7ub1.js";import"./MInputCheckbox-BqateWtE.js";import"./index-B_QkKjtG.js";import"./MInputHintMessage-DbuBS4Kn.js";import"./MInputSingleSelectSwitch-CuptGC6e.js";import"./index-CDBqmjrS.js";import"./MInputSimpleSelectDropdown-DIlBEFcs.js";import"./index-qTA83-by.js";import"./MInputText-CzhsT8yb.js";import"./debounce-B8gTqdZO.js";import"./isSymbol-B7ZrWRtH.js";import"./auditLogs-Cml5ZKP5.js";import"./utils-Dwlepb3M.js";import"./metaListUtils-B-xQ0HnD.js";import"./MInputDateTime-DL6Zd7-d.js";import"./MInputSwitch-C-Z-JJsG.js";import"./index-DZuvHjnn.js";import"./MInputNumber-BOzPEn49.js";import"./MetaGeneratedForm-BcVgOIy3.js";import"./GeneratedUiFormDynamicComponent-DrqrTIRR.js";import"./MessageAudienceForm-Bn0DOLdW.js";import"./actionDebouncer-CJRtFyZn.js";import"./MInputTextArea-BMdoSBpm.js";import"./_arrayIncludes-B3ShBz6l.js";const ia=j({__name:"NotificationDetailView",setup(F,{expose:i}){i();const _=x(),a=k(),y=T(),{data:C,refresh:m,error:N}=B(E(V(a.params.id))),{data:r}=B(O()),n=b(()=>C.value?.campaignInfo),S=b(()=>{if(n.value){if(n.value?.campaignPhase==="Running")return"success";if(n.value?.campaignPhase==="Cancelling")return"warning";if(n.value?.campaignPhase==="Scheduled")return"primary"}return"neutral"}),h=b(()=>{const f=w.fromISO(n.value?.stats.startTime);return(n.value?.stats.stopTime?w.fromISO(n.value?.stats.stopTime):w.now()).diff(f).toISO()});function P(){return n.value?.campaignParams?.targetPlayers?.length||n.value?.campaignParams?.targetCondition}const I=b(()=>{if(n.value)return{id:n.value?.id,name:n.value?.campaignParams.name,targetTime:n.value?.campaignParams.targetTime,content:n.value?.campaignParams.content,debugEntityIdValueUpperBound:n.value?.campaignParams.debugEntityIdValueUpperBound,debugFakeNotificationMode:n.value?.campaignParams.debugFakeNotificationMode,firebaseAnalyticsLabel:n.value?.campaignParams.firebaseAnalyticsLabel,targetPlayers:n.value?.campaignParams.targetPlayers,targetCondition:n.value?.campaignParams.targetCondition}});function c(){return["Scheduled","Sent","Cancelled","DidNotRun"].includes(n.value.campaignPhase)}const{showSuccessNotification:v}=R();async function g(){await _.delete(`/notifications/${a.params.id.toString()}`),v("Notification campaign deleted."),await y.push("/notifications")}async function M(){await _.put(`/notifications/${a.params.id.toString()}/cancel`),v("Notification campaign cancellation started."),m()}const L=b(()=>{const f=[];return r.value?.globalPauseIsEnabled&&f.push({title:"Push Notifications Paused",message:"All database scan jobs are currently paused - this includes the job that sends push notifications. You can resume them from the scan jobs page.",variant:"warning"}),n.value?.campaignPhase==="DidNotRun"&&f.push({title:"Campaign did not run",message:`${n.value.campaignParams?.name} did not run because push notifications
      are disabled for this deployment. Contact your game team to set them up.`,variant:"warning"}),f}),A={gameServerApi:_,route:a,router:y,singleNotificationCampaignsData:C,singleNotificationCampaignsRefresh:m,singleNotificationCampaignsError:N,databaseScanJobsData:r,campaignInfo:n,phaseVariant:S,jobDuration:h,isTargeted:P,campaignFormInfo:I,canDeleteCampaign:c,showSuccessNotification:v,deleteCampaign:g,cancelCampaign:M,pageAlerts:L,get BProgress(){return na},get DateTime(){return w},computed:b,get useRoute(){return k},get useRouter(){return T},get useGameServerApi(){return x},get MActionModalButton(){return K},get MBadge(){return z},get MButton(){return G},get MCallout(){return J},get MPageOverviewCard(){return Q},get MViewContainer(){return W},get useNotifications(){return R},get abbreviateNumber(){return H},get useSubscription(){return B},MetaAudienceSizeEstimate:X,AuditLogCard:Z,MetaGeneratedSection:$,PlayerListCard:aa,TargetingCard:ea,NotificationFormButton:ta,get routeParamToSingleValue(){return V},get notificationPhaseDisplayString(){return U},get getSingleNotificationSubscriptionOptions(){return E},get getAllScanJobsSubscriptionOptions(){return O}};return Object.defineProperty(A,"__isScriptSetup",{enumerable:!1,value:!0}),A}}),oa={class:"tw-inline-flex tw-gap-x-2"},ra={class:"font-weight-bold"},la={key:0},sa={class:"font-weight-bold"};function da(F,i,_,a,y,C){const m=d("fa-icon"),N=d("meta-no-seatbelts"),r=d("b-td"),n=d("b-tr"),S=d("meta-time"),h=d("b-tbody"),P=d("b-table-simple"),I=d("b-alert"),c=d("b-col"),v=d("meta-duration"),g=d("b-row"),M=d("meta-raw-data");return l(),s(a.MViewContainer,{permission:"api.notifications.view","is-loading":!a.singleNotificationCampaignsData,"meta-api-error":a.singleNotificationCampaignsError,alerts:a.pageAlerts},{overview:e(()=>[t(a.MPageOverviewCard,{id:`${a.campaignInfo.id}`,title:a.campaignInfo.campaignParams.name},{badge:e(()=>[a.campaignInfo.campaignPhase=="Running"?(l(),s(a.MBadge,{key:0,class:"ml-2",variant:a.phaseVariant},{icon:e(()=>[t(m,{icon:"broadcast-tower"})]),default:e(()=>[o(u(a.campaignInfo.campaignPhase),1)],void 0,!0),_:1},8,["variant"])):a.campaignInfo.campaignPhase=="Cancelling"?(l(),s(a.MBadge,{key:1,class:"ml-2",variant:a.phaseVariant},{icon:e(()=>[t(m,{icon:"broadcast-tower"})]),default:e(()=>[o(u(a.campaignInfo.campaignPhase),1)],void 0,!0),_:1},8,["variant"])):a.campaignInfo.campaignPhase=="Scheduled"?(l(),s(a.MBadge,{key:2,class:"ml-2",variant:a.phaseVariant},{icon:e(()=>[t(m,{icon:"calendar-alt"})]),default:e(()=>[o(u(a.campaignInfo.campaignPhase),1)],void 0,!0),_:1},8,["variant"])):a.campaignInfo.campaignPhase=="Cancelled"?(l(),s(a.MBadge,{key:3,class:"ml-2",variant:a.phaseVariant},{icon:e(()=>[t(m,{icon:"times"})]),default:e(()=>[o(u(a.campaignInfo.campaignPhase),1)],void 0,!0),_:1},8,["variant"])):a.campaignInfo.campaignPhase=="DidNotRun"?(l(),s(a.MBadge,{key:4,class:"ml-2",variant:a.phaseVariant},{icon:e(()=>[t(m,{icon:"bell-slash"})]),default:e(()=>[o(u(a.notificationPhaseDisplayString(a.campaignInfo.campaignPhase)),1)],void 0,!0),_:1},8,["variant"])):(l(),s(a.MBadge,{key:5,class:"ml-2"},{icon:e(()=>[t(m,{icon:"paper-plane"})]),default:e(()=>[o(u(a.campaignInfo.campaignPhase),1)],void 0,!0),_:1}))]),buttons:e(()=>[p("div",oa,[t(a.NotificationFormButton,{"modal-title":"Duplicate Campaign","button-text":"Duplicate",oldNotification:a.campaignFormInfo,update:!1,onRefresh:a.singleNotificationCampaignsRefresh},null,8,["oldNotification","onRefresh"]),a.campaignInfo.campaignPhase==="Scheduled"?(l(),s(a.NotificationFormButton,{key:0,"modal-title":"Edit Campaign","button-text":"Edit",oldNotification:a.campaignFormInfo,update:!0,onRefresh:a.singleNotificationCampaignsRefresh},null,8,["oldNotification","onRefresh"])):D("",!0),a.campaignInfo.campaignPhase=="Running"?(l(),s(a.MButton,{key:1,variant:"danger",permission:"api.notifications.edit",onClick:a.cancelCampaign},{default:e(()=>i[0]||(i[0]=[o("Cancel")]),void 0,!0),_:1})):D("",!0),t(a.MActionModalButton,{"modal-title":"Delete Campaign",action:a.deleteCampaign,"trigger-button-label":"Delete","trigger-button-disabled-tooltip":a.canDeleteCampaign()?void 0:"You cannot delete this campaign in its current phase.","ok-button-label":"Delete campaign",variant:"danger",permission:"api.notifications.edit"},{default:e(()=>[i[1]||(i[1]=p("div",null,"Deleting this Campaign will prevent any more players from receiving it. However, it will not be removed from the devices of those who have already received it.",-1)),t(N,{class:"tw-mt-2"})],void 0,!0),_:1},8,["trigger-button-disabled-tooltip"])])]),alerts:e(()=>[t(a.MCallout,{class:"tw-pb-4",title:"Progress",variant:"neutral"},{default:e(()=>[a.campaignInfo.stats?(l(),s(a.BProgress,{key:0,value:a.campaignInfo.stats.scanStats.scannedRatioEstimate,max:1,"show-progress":"",animated:a.campaignInfo.campaignPhase=="Running",variant:a.phaseVariant},null,8,["value","animated","variant"])):(l(),s(a.BProgress,{key:1,value:0,max:1,"show-progress":"",variant:a.phaseVariant},null,8,["variant"]))],void 0,!0),_:1})]),default:e(()=>[p("span",ra,[t(m,{icon:"chart-bar"}),i[2]||(i[2]=o(" Overview"))]),t(P,{class:"tw-mt-1",small:"",responsive:""},{default:e(()=>[t(h,null,{default:e(()=>[t(n,null,{default:e(()=>[t(r,null,{default:e(()=>i[3]||(i[3]=[o("Audience Size Estimate")]),void 0,!0),_:1}),t(r,{class:"text-right"},{default:e(()=>[t(a.MetaAudienceSizeEstimate,{sizeEstimate:a.isTargeted()?a.singleNotificationCampaignsData.audienceSizeEstimate:void 0},null,8,["sizeEstimate"])],void 0,!0),_:1})],void 0,!0),_:1}),t(n,null,{default:e(()=>[t(r,null,{default:e(()=>i[4]||(i[4]=[o("Start Time")]),void 0,!0),_:1}),t(r,{class:"text-right"},{default:e(()=>[t(S,{date:a.campaignInfo.campaignParams.targetTime,showAs:"datetime"},null,8,["date"])],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1}),a.campaignInfo.campaignPhase!=="DidNotRun"?(l(),Y("div",la,[p("span",sa,[t(m,{icon:"chart-line"}),i[5]||(i[5]=o(" Statistics"))]),t(g,{class:"tw-mt-1","align-h":"center"},{default:e(()=>[a.campaignInfo.stats?(l(),s(c,{key:1},{default:e(()=>[t(P,{small:"",responsive:""},{default:e(()=>[t(h,null,{default:e(()=>[t(n,null,{default:e(()=>[t(r,null,{default:e(()=>i[7]||(i[7]=[o("Duration")]),void 0,!0),_:1}),t(r,{class:"text-right"},{default:e(()=>[t(v,{duration:a.jobDuration,showAs:"humanizedSentenceCase"},null,8,["duration"])],void 0,!0),_:1})],void 0,!0),_:1}),t(n,null,{default:e(()=>[t(r,null,{default:e(()=>i[8]||(i[8]=[o("Players Notified")]),void 0,!0),_:1}),t(r,{class:"text-right"},{default:e(()=>[o(u(a.abbreviateNumber(a.campaignInfo.stats.notificationStats.numPlayersNotified)),1)],void 0,!0),_:1})],void 0,!0),_:1}),t(n,null,{default:e(()=>[t(r,null,{default:e(()=>i[9]||(i[9]=[o("Players Notifications Failed")]),void 0,!0),_:1}),t(r,{class:"text-right"},{default:e(()=>[o(u(a.abbreviateNumber(a.campaignInfo.stats.notificationStats.notificationFailedPlayers.count)),1)],void 0,!0),_:1})],void 0,!0),_:1}),t(n,null,{default:e(()=>[t(r,null,{default:e(()=>i[10]||(i[10]=[o("Firebase Analytics Label")]),void 0,!0),_:1}),t(r,{class:"text-right"},{default:e(()=>[o(u(a.campaignInfo.campaignParams.firebaseAnalyticsLabel),1)],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})):(l(),s(c,{key:0,class:"tw-text-center",xl:"9"},{default:e(()=>[t(I,{class:"tw-mt-1",show:"",variant:"secondary"},{default:e(()=>i[6]||(i[6]=[o("Stats will be collected after the campaign sending starts.")]),void 0,!0),_:1})],void 0,!0),_:1}))],void 0,!0),_:1})])):D("",!0)],void 0,!0),_:1},8,["id","title"])]),default:e(()=>[t(a.MetaGeneratedSection,{title:"Content",value:a.campaignInfo.campaignParams.content,"is-targeting-multiple-players":""},null,8,["value"]),t(g,{class:"mb-2 tw-mt-4","no-gutters":"","align-v":"center"},{default:e(()=>[i[11]||(i[11]=p("h3",null,"Targeting",-1)),p("h4",null,[t(a.MBadge,{class:"ml-2",variant:a.isTargeted()?"success":"neutral"},{default:e(()=>[o(u(a.isTargeted()?"On":"Off"),1)],void 0,!0),_:1},8,["variant"])])],void 0,!0),_:1}),t(g,{"align-h":"center"},{default:e(()=>[t(c,{class:"tw-mb-4",md:"6"},{default:e(()=>[t(a.TargetingCard,{ownerTitle:"This notification",targetCondition:a.campaignInfo.campaignParams.targetCondition},null,8,["targetCondition"])],void 0,!0),_:1}),t(c,{class:"tw-mb-4",md:"6"},{default:e(()=>[t(a.PlayerListCard,{playerIds:a.campaignInfo.campaignParams.targetPlayers??[],title:"Individual Players",emptyMessage:"No individual players targeted."},null,8,["playerIds"])],void 0,!0),_:1})],void 0,!0),_:1}),t(g,{class:"mb-2 tw-mt-4","no-gutters":"","align-v":"center"},{default:e(()=>i[12]||(i[12]=[p("h3",null,"Admin",-1)]),void 0,!0),_:1}),t(g,{class:"tw-mb-4","align-h":"center"},{default:e(()=>[t(c,{md:"6"},{default:e(()=>[t(a.AuditLogCard,{targetType:"$Notification",targetId:String(a.campaignInfo.id)},null,8,["targetId"])],void 0,!0),_:1})],void 0,!0),_:1}),t(M,{kvPair:a.campaignInfo,name:"campaign"},null,8,["kvPair"])],void 0,!0),_:1},8,["is-loading","meta-api-error","alerts"])}const Wa=q(ia,[["render",da],["__file","NotificationDetailView.vue"]]);export{Wa as default};
