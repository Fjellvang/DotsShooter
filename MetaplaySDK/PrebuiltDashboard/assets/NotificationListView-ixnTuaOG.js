import{d as T,a6 as x,x as v,f as b,c as y,M as F,v as I,a8 as R,a9 as N,cq as E,b as p,o,e as D,w as i,k as r,l as j,n as C,p as c,t as g,a as s,_ as J}from"./index-B7jvAjdE.js";import{a as q,M as z}from"./MViewContainer-BTeE2xDT.js";import{M as Y}from"./MSingleColumnLayout-B4K0ZAFA.js";import{M as m,a as d,c as l,b as L}from"./metaListUtils-B-xQ0HnD.js";import{g as B,N as G}from"./NotificationFormButton-Hovph82t.js";import{g as O}from"./scanJobs-A4fyB_UL.js";import{B as H}from"./progress-GKvrz8Gh.js";import"./MActionModalButton-CvWVuTB-.js";import"./MActionModal-coQLkvWs.js";import"./index-fVjXqxSF.js";import"./MInputDateTime-DL6Zd7-d.js";import"./MInputHintMessage-DbuBS4Kn.js";import"./MInputSwitch-C-Z-JJsG.js";import"./index-B_QkKjtG.js";import"./index-DZuvHjnn.js";import"./MInputNumber-BOzPEn49.js";import"./MInputText-CzhsT8yb.js";import"./debounce-B8gTqdZO.js";import"./isSymbol-B7ZrWRtH.js";import"./MetaGeneratedForm-BcVgOIy3.js";import"./MInputMultiSelectCheckbox-D_9f7ub1.js";import"./MInputCheckbox-BqateWtE.js";import"./GeneratedUiFormDynamicComponent-DrqrTIRR.js";import"./MessageAudienceForm-Bn0DOLdW.js";import"./actionDebouncer-CJRtFyZn.js";import"./numberUtils-CkF0oMe2.js";import"./MInputSingleSelectSwitch-CuptGC6e.js";import"./index-CDBqmjrS.js";import"./MInputSimpleSelectDropdown-DIlBEFcs.js";import"./index-qTA83-by.js";import"./MInputTextArea-BMdoSBpm.js";import"./_arrayIncludes-B3ShBz6l.js";const K=T({__name:"NotificationListView",setup(k,{expose:n}){n();const f=x(),{data:e,error:P}=v(B()),{data:h}=v(O());function S(t){return["Sent","Cancelled","Cancelling","DidNotRun"].includes(t)?"neutral":t==="Scheduled"?"primary":"success"}function u(t){return t==="Sent"?"paper-plane":t==="Scheduled"?"calendar-alt":t==="Cancelled"?"times":t==="DidNotRun"?"bell-slash":"paper-plane"}function w(t){if(!t.targetPlayers?.length&&!t.targetCondition)return"everyone";if(t.targetPlayers?.length&&t.targetCondition)return`Segment based and ${N(t.targetPlayers.length,"player")}`;if(t.targetPlayers?.length)return N(t.targetPlayers.length,"player");if(t.targetCondition)return"Segment based"}const _=b([new m("Time","params.targetTime",d.Ascending),new m("Time","params.targetTime",d.Descending),new m("Name","params.name",d.Ascending),new m("Name","params.name",d.Descending)]),a=b([new L("status",[new l("Scheduled",t=>t.phase==="Scheduled"),new l("Running",t=>t.phase==="Running"),new l("Sent",t=>t.phase==="Sent"),new l("Cancelled",t=>t.phase==="Cancelled"||t.phase==="Cancelling"),new l("Did Not Run",t=>t.phase==="DidNotRun")])]),A=y(()=>{const t=[];return h.value?.globalPauseIsEnabled&&t.push({title:"Push Notifications Paused",message:"All database scan jobs are currently paused - this includes the job that sends push notifications. You can resume them from the scan jobs page.",variant:"warning"}),t}),V=y(()=>{const t=[];return f.featureFlags.pushNotifications||t.push({title:"Push Notifications Not Enabled",message:"Push notifications have not been configured for this deployment. Set them up in your",variant:"neutral",linkText:"runtime options",link:"/environment?tab=2"}),t}),M={staticInfos:f,allNotificationCampaignsData:e,allNotificationCampaignsError:P,databaseScanJobsData:h,getPhaseVariant:S,getPhaseIcon:u,audienceSummary:w,sortOptions:_,filterSets:a,pageAlerts:A,overviewAlerts:V,get BProgress(){return H},computed:y,ref:b,get useStaticInfos(){return x},get MetaListFilterOption(){return l},get MetaListFilterSet(){return L},get MetaListSortDirection(){return d},get MetaListSortOption(){return m},get MBadge(){return F},get MListItem(){return I},get MTextButton(){return R},get MViewContainer(){return q},get MPageOverviewCard(){return z},get MSingleColumnLayout(){return Y},get maybePluralString(){return N},get useSubscription(){return v},NotificationFormButton:G,get notificationPhaseDisplayString(){return E},get getAllNotificationsSubscriptionOptions(){return B},get getAllScanJobsSubscriptionOptions(){return O}};return Object.defineProperty(M,"__isScriptSetup",{enumerable:!1,value:!0}),M}}),Q={class:"tw-text-xs+ tw-font-normal tw-text-neutral-500"},U={key:0},W={key:1},X={key:2},Z={key:3},$={key:4},tt={key:5};function et(k,n,f,e,P,h){const S=p("fa-icon"),u=p("meta-time"),w=p("meta-list-card"),_=p("meta-raw-data");return o(),D(e.MViewContainer,{permission:"api.notifications.view","is-loading":!e.allNotificationCampaignsData,error:e.allNotificationCampaignsError,alerts:e.pageAlerts},{overview:i(()=>[r(e.MPageOverviewCard,{title:"Create a New Notification Campaign",alerts:e.overviewAlerts,"data-testid":"notification-list-overview-card"},{buttons:i(()=>[e.staticInfos.featureFlags.pushNotifications?(o(),D(e.NotificationFormButton,{key:0,"modal-title":"New Notification Campaign","button-text":"New Campaign","button-icon":"plus-square"})):j("",!0)]),default:i(()=>[n[0]||(n[0]=C("p",{class:"tw-mb-1"},"Notification campaigns are scheduled and localised push notifications that you can send to the players.",-1)),n[1]||(n[1]=C("div",{class:"tw-text-xs+ tw-text-neutral-500"},"Players who match the targeting criteria of a campaign will be sent a push notification in their selected language if they have enabled notifications on their device. Notifications are processed in batches by Firebase, so sending large campaigns may take up to a few hours to complete.",-1))],void 0,!0),_:1},8,["alerts"])]),default:i(()=>[r(e.MSingleColumnLayout,null,{default:i(()=>[r(w,{id:"broadcasts-list",title:"All Notification Campaigns",itemList:e.allNotificationCampaignsData,searchFields:["id","params.name"],filterSets:e.filterSets,sortOptions:e.sortOptions,defaultSortOption:1,pageSize:20,icon:"comment-alt","data-testid":"all-notifications-list-card"},{"item-card":i(({item:a})=>[r(e.MListItem,null,{"top-right":i(()=>[r(e.MBadge,{variant:e.getPhaseVariant(a.phase)},{icon:i(()=>[r(S,{class:"tw-mr-1",icon:e.getPhaseIcon(a.phase)},null,8,["icon"])]),default:i(()=>[c(g(e.notificationPhaseDisplayString(a.phase)),1)],void 0,!0),_:2},1032,["variant"])]),"bottom-left":i(()=>[a.phase==="Scheduled"?(o(),s("div",U,[n[2]||(n[2]=c("Start time: ")),r(u,{date:a.params.targetTime},null,8,["date"])])):a.phase==="Sent"?(o(),s("div",W,[n[3]||(n[3]=c("Sent at: ")),r(u,{date:a.params.targetTime},null,8,["date"])])):a.phase==="Cancelled"?(o(),s("div",X,"Cancelled")):a.phase==="DidNotRun"?(o(),s("div",Z,g(e.notificationPhaseDisplayString(a.phase)),1)):a.phase==="Cancelling"?(o(),s("div",$,[r(e.BProgress,{class:"font-weight-bold",value:1,max:1,animated:"",variant:"secondary"})])):(o(),s("div",tt,[r(e.BProgress,{class:"font-weight-bold",value:a.scannedRatioEstimate,max:1,animated:"",variant:"success"},null,8,["value"])]))]),"bottom-right":i(()=>[r(e.MTextButton,{to:`/notifications/${a.id}`},{default:i(()=>n[4]||(n[4]=[c("View campaign")]),void 0,!0),_:2},1032,["to"])]),default:i(()=>[c(g(a.params.name)+" ",1),C("span",Q,"for "+g(e.audienceSummary(a.params)),1)],void 0,!0),_:2},1024)]),_:1},8,["itemList","filterSets","sortOptions"])],void 0,!0),_:1}),r(_,{kvPair:e.allNotificationCampaignsData,name:"campaigns"},null,8,["kvPair"])],void 0,!0),_:1},8,["is-loading","error","alerts"])}const Vt=J(K,[["render",et],["__file","NotificationListView.vue"]]);export{Vt as default};
