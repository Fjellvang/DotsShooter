import{d as E,x as M,f as w,c,h as N,ad as k,a8 as C,ae as D,o as _,e as b,w as i,p as m,t as u,k as f,n as S,l as P,_ as V,M as L,v as j,b as R,a as O}from"./index-B7jvAjdE.js";import{e as F}from"./utils-Dwlepb3M.js";import{M as v,a as I}from"./metaListUtils-B-xQ0HnD.js";import{g as B}from"./experiments-phlJ4_07.js";import{a as h}from"./players-CydHenLG.js";import{M as G}from"./MActionModal-coQLkvWs.js";import{M as U}from"./MInputSwitch-C-Z-JJsG.js";import"./index-fVjXqxSF.js";import"./index-B_QkKjtG.js";const q=E({__name:"PlayerActionSetTester",props:{playerId:{},experimentId:{}},setup(x,{expose:t}){t();const r=x,e=k(),{data:a,refresh:d}=M(h(r.playerId)),n=w(!1),s=w(),l=c(()=>{if(a)return a.value.experiments[r.experimentId]}),T=c(()=>n.value!==l.value?.isPlayerTester);N(()=>{n.value=l.value?.isPlayerTester??!1});const A=c(()=>n.value?`${a.value.model.playerName} is now a tester in ${r.experimentId}`:`${a.value.model.playerName} is no longer a tester in ${r.experimentId}`),{showSuccessNotification:p}=D();async function o(){let y;n.value?y=`${a.value.model.playerName} is now a tester in ${r.experimentId}`:y=`${a.value.model.playerName} is no longer a tester in ${r.experimentId}`,await e.post(`/players/${a.value.id}/changeExperiment`,{ExperimentId:r.experimentId,VariantId:l.value.enrolledVariant,IsTester:n.value}),p(y),d()}const g={props:r,gameServerApi:e,playerData:a,playerRefresh:d,isTester:n,setTesterModal:s,experiments:l,isStatusChanged:T,toastMessage:A,showSuccessNotification:p,updateTesterStatus:o,computed:c,ref:w,onMounted:N,get useGameServerApi(){return k},get MActionModal(){return G},get MInputSwitch(){return U},get MTextButton(){return C},get useNotifications(){return D},get useSubscription(){return M},get getSinglePlayerSubscriptionOptions(){return h}};return Object.defineProperty(g,"__isScriptSetup",{enumerable:!1,value:!0}),g}}),z={class:"tw-flex tw-justify-between"};function H(x,t,r,e,a,d){return e.playerData?(_(),b(e.MTextButton,{key:0,variant:e.experiments.isPlayerTester?"warning":void 0,permission:"api.players.edit_experiment_groups",onClick:t[1]||(t[1]=n=>e.setTesterModal?.open()),"data-testid":`set-action-tester-${r.experimentId}`},{default:i(()=>[m(u(e.experiments.isPlayerTester?"Remove as tester":"Mark as tester"),1),f(e.MActionModal,{ref:"setTesterModal",title:"Manage Tester status",action:e.updateTesterStatus,"ok-button-label":"Save Settings","ok-button-disabled-tooltip":e.isStatusChanged?void 0:`Toggle the switch to ${e.isTester?"remove":"assign"} this player as a tester.`,"data-testid":`set-action-tester-modal-${r.experimentId}`},{default:i(()=>[S("div",z,[t[2]||(t[2]=S("span",{class:"tw-font-bold"},"Tester status",-1)),f(e.MInputSwitch,{class:"tw-relative tw-top-1 tw-mr-3","model-value":e.isTester,name:"isPlayerTester",size:"small","onUpdate:modelValue":t[0]||(t[0]=n=>e.isTester=n),"data-testid":"tester-status-toggle"},null,8,["model-value"])]),t[3]||(t[3]=S("span",{class:"tw-text-sm tw-text-neutral-500"},"As a tester, this player can try out the experiment before it is enabled for everyone. This is a great way to test variants before rolling them out!",-1))],void 0,!0),_:1},8,["ok-button-disabled-tooltip","data-testid"])],void 0,!0),_:1},8,["variant","data-testid"])):P("",!0)}const J=V(q,[["render",H],["__file","PlayerActionSetTester.vue"]]),K=E({__name:"PlayerExperimentsCard",props:{playerId:{type:String,required:!0}},setup(x,{expose:t}){t();const r=x,{data:e}=M(B()),{data:a}=M(h(r.playerId)),d=["experimentId","variantId","description"],n=[new v("Name","experimentId",I.Ascending),new v("Name","experimentId",I.Descending),new v("Phase","experimentPhase",I.Ascending),new v("Phase","experimentPhase",I.Descending)],s=c(()=>{if(e.value?.experiments){const T=a.value.experiments;return Object.entries(T).filter(([p,o])=>o.isPlayerEnrolled).map(([p,o])=>{const g=e.value.experiments.find(y=>y.experimentId===p);return{experimentId:p,name:g?.displayName||"",description:g?.description||"",variantId:o.enrolledVariant,isTester:o.isPlayerTester,phase:o.experimentPhase==="Ongoing"?"Active":o.experimentPhase,notActiveReason:o.whyNotActive}})}else return[]}),l={props:r,experimentInfos:e,playerData:a,searchFields:d,sortOptions:n,items:s,computed:c,get MetaListSortDirection(){return I},get MetaListSortOption(){return v},get experimentPhaseDetails(){return F},get MBadge(){return L},get MListItem(){return j},get MTextButton(){return C},get useSubscription(){return M},get getAllExperimentsSubscriptionOptions(){return B},get getSinglePlayerSubscriptionOptions(){return h},PlayerActionSetTester:J};return Object.defineProperty(l,"__isScriptSetup",{enumerable:!1,value:!0}),l}}),Q={key:0},W={key:1},X={class:"tw-flex tw-flex-col"};function Y(x,t,r,e,a,d){const n=R("meta-list-card");return e.playerData?(_(),b(n,{key:0,title:"Experiments",icon:"flask",tooltip:`Shows experiments that this ${e.playerData.model.playerName||"n/a"} belongs to.`,itemList:e.items,searchFields:e.searchFields,sortOptions:e.sortOptions,emptyMessage:`${e.playerData.model.playerName||"n/a"} isn't involved in any experiments.`,moreInfoUri:"/experiments",moreInfoLabel:"experiments",moreInfoPermission:"api.experiments.view",permission:"api.experiments.view","data-testid":"player-experiments-card"},{"item-card":i(({item:s})=>[f(e.MListItem,null,{badge:i(()=>[s.isTester?(_(),b(e.MBadge,{key:0},{default:i(()=>t[0]||(t[0]=[m("Tester")]),void 0,!0),_:1})):P("",!0)]),"top-right":i(()=>[f(e.MBadge,{tooltip:e.experimentPhaseDetails(s.phase),variant:s.notActiveReason?"neutral":"success"},{default:i(()=>[m(u(s.phase),1)],void 0,!0),_:2},1032,["tooltip","variant"])]),"bottom-left":i(()=>[m(u(s.description),1)]),"bottom-right":i(()=>[s.variantId?(_(),O("div",Q,"Variant: "+u(s.variantId),1)):(_(),O("div",W,"Variant: Control")),S("div",X,[f(e.PlayerActionSetTester,{playerId:r.playerId,experimentId:s.experimentId},null,8,["playerId","experimentId"]),f(e.MTextButton,{to:`/experiments/${s.experimentId}`},{default:i(()=>t[1]||(t[1]=[m("View experiment")]),void 0,!0),_:2},1032,["to"])])]),default:i(()=>[m(u(s.name)+" / "+u(s.experimentId),1)],void 0,!0),_:2},1024)]),_:1},8,["tooltip","itemList","emptyMessage"])):P("",!0)}const oe=V(K,[["render",Y],["__file","PlayerExperimentsCard.vue"]]);export{oe as default};
