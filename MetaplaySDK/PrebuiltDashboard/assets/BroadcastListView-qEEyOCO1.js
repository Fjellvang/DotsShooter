import{d as I,aj as O,c as M,x as D,N as p,M as N,v as E,a8 as F,a9 as b,b as m,o as h,e as j,w as r,k as n,n as g,p as l,t as x,a as P,_ as q}from"./index-B7jvAjdE.js";import{M as z,a as K}from"./MViewContainer-BTeE2xDT.js";import{M as W}from"./MSingleColumnLayout-B4K0ZAFA.js";import{M as s,a as d,b as R,c as f}from"./metaListUtils-B-xQ0HnD.js";import{B as G}from"./BroadcastFormButton-B5PTqemK.js";import{g as V}from"./broadcasts-BpyehJtv.js";import"./MActionModalButton-CvWVuTB-.js";import"./MActionModal-coQLkvWs.js";import"./index-fVjXqxSF.js";import"./MInputDateTime-DL6Zd7-d.js";import"./MInputHintMessage-DbuBS4Kn.js";import"./MInputSwitch-C-Z-JJsG.js";import"./index-B_QkKjtG.js";import"./index-DZuvHjnn.js";import"./MInputDurationOrEndDateTime-CP-rRAVP.js";import"./MInputDuration-C704TlZG.js";import"./MInputNumber-BOzPEn49.js";import"./MInputText-CzhsT8yb.js";import"./debounce-B8gTqdZO.js";import"./isSymbol-B7ZrWRtH.js";import"./MetaGeneratedForm-BcVgOIy3.js";import"./MInputMultiSelectCheckbox-D_9f7ub1.js";import"./MInputCheckbox-BqateWtE.js";import"./GeneratedUiFormDynamicComponent-DrqrTIRR.js";import"./MessageAudienceForm-Bn0DOLdW.js";import"./actionDebouncer-CJRtFyZn.js";import"./numberUtils-CkF0oMe2.js";import"./MInputSingleSelectSwitch-CuptGC6e.js";import"./index-CDBqmjrS.js";import"./MInputSimpleSelectDropdown-DIlBEFcs.js";import"./index-qTA83-by.js";import"./MInputTextArea-BMdoSBpm.js";import"./_arrayIncludes-B3ShBz6l.js";import"./analyticsEvents-CRLHbRhO.js";const H=I({__name:"BroadcastListView",setup(T,{expose:a}){a();const v=O(),e=M(()=>v.path),{data:c,error:C,refresh:w}=D(V()),u=M(()=>{if(!c.value)return;const t=p.now();return c.value.map(o=>{const y=p.fromISO(o.params.startAt),A=p.fromISO(o.params.endAt);return A>t&&y<t?{...o,decoration:{status:"Active",variant:"success",icon:"broadcast-tower"}}:A>t?{...o,decoration:{status:"Scheduled",variant:"primary",icon:"calendar-alt"}}:{...o,decoration:{status:"Expired",variant:"neutral",icon:"times"}}})}),_=[new s("Time","params.startAt",d.Ascending),new s("Time","params.startAt",d.Descending),new s("Name","params.name",d.Ascending),new s("Name","params.name",d.Descending),new s("Received by","stats.receivedCount",d.Ascending),new s("Received by","stats.receivedCount",d.Descending)],S=[new R("status",[new f("Scheduled",t=>t.decoration.status==="Scheduled"),new f("Active",t=>t.decoration.status==="Active"),new f("Expired",t=>t.decoration.status==="Expired")])];function B(t){return t.params.id}function i(t){const o=e.value,y=o.endsWith("/")?"":"/";return o+y+t}function k(t){if(t.isTargeted){if(t.targetPlayers?.length&&t.targetCondition)return`Segment based and ${b(t.targetPlayers.length,"player")}`;if(t.targetPlayers?.length)return b(t.targetPlayers.length,"player");if(t.targetCondition)return"Segment based"}else return"everyone"}const L={route:v,detailsRoute:e,allBroadcastsData:c,allBroadcastsError:C,allBroadcastsRefresh:w,decoratedBroadcasts:u,sortOptions:_,filterSets:S,getBroadcastId:B,getDetailPagePath:i,audienceSummary:k,get DateTime(){return p},computed:M,get useRoute(){return O},get MetaListSortOption(){return s},get MetaListSortDirection(){return d},get MetaListFilterSet(){return R},get MetaListFilterOption(){return f},get MBadge(){return N},get MListItem(){return E},get MPageOverviewCard(){return z},get MSingleColumnLayout(){return W},get MTextButton(){return F},get MViewContainer(){return K},get maybePluralString(){return b},get useSubscription(){return D},BroadcastFormButton:G,get getAllBroadcastsSubscriptionOptions(){return V}};return Object.defineProperty(L,"__isScriptSetup",{enumerable:!1,value:!0}),L}}),J={class:"tw-text-xs+ tw-font-normal tw-text-neutral-500"},Q={key:0},U={key:1};function X(T,a,v,e,c,C){const w=m("fa-icon"),u=m("meta-time"),_=m("meta-plural-label"),S=m("meta-list-card"),B=m("meta-raw-data");return h(),j(e.MViewContainer,{permission:"api.broadcasts.view","is-loading":!e.allBroadcastsData,error:e.allBroadcastsError},{overview:r(()=>[n(e.MPageOverviewCard,{title:"Create a New Broadcast","data-testid":"broadcast-list-overview-card"},{buttons:r(()=>[n(e.BroadcastFormButton,{class:"mr-2 tw-mt-1","button-text":"Create New","button-icon":"plus-square",onRefresh:e.allBroadcastsRefresh,"data-testid":"create-new-broadcast"},null,8,["onRefresh"])]),default:r(()=>[a[0]||(a[0]=g("p",{class:"tw-mb-1"},"Broadcasts are scheduled in-game mail campaigns.",-1)),a[1]||(a[1]=g("div",{class:"small text-muted"},"Players who match the targeting criteria of an active broadcast will get an in-game mail generated into their inbox when they login. A player can receive every broadcast only once to prevent duplicate mails.",-1))],void 0,!0),_:1})]),default:r(()=>[n(e.MSingleColumnLayout,null,{default:r(()=>[n(S,{id:"broadcasts-list",title:"All broadcasts",getItemKey:e.getBroadcastId,itemList:e.decoratedBroadcasts,searchFields:["params.id","params.name"],filterSets:e.filterSets,sortOptions:e.sortOptions,defaultSortOption:1,pageSize:20,icon:"broadcast-tower","data-testid":"all-broadcasts-list-card"},{"item-card":r(i=>[n(e.MListItem,null,{"top-right":r(()=>[n(e.MBadge,{variant:i.item.decoration.variant},{icon:r(()=>[n(w,{icon:i.item.decoration.icon},null,8,["icon"])]),default:r(()=>[l(x(i.item.decoration.status),1)],void 0,!0),_:2},1032,["variant"])]),"bottom-left":r(()=>[i.item.decoration.status==="Scheduled"?(h(),P("div",Q,[a[2]||(a[2]=l("Start time: ")),n(u,{date:i.item.params.startAt},null,8,["date"])])):(h(),P("div",U,[a[3]||(a[3]=l("End time: ")),n(u,{date:i.item.params.endAt},null,8,["date"])]))]),"bottom-right":r(()=>[g("div",null,[a[4]||(a[4]=l("Received by ")),n(_,{value:i.item.stats.receivedCount,label:"player"},null,8,["value"])]),n(e.MTextButton,{to:e.getDetailPagePath(i.item.params.id),"data-testid":"view-broadcast"},{default:r(()=>a[5]||(a[5]=[l("View broadcast")]),void 0,!0),_:2},1032,["to"])]),default:r(()=>[l(x(i.item.params.name)+" ",1),g("span",J,"for "+x(e.audienceSummary(i.item.params)),1)],void 0,!0),_:2},1024)]),_:1},8,["itemList"])],void 0,!0),_:1}),n(B,{kvPair:e.decoratedBroadcasts,name:"decoratedBroadcasts"},null,8,["kvPair"])],void 0,!0),_:1},8,["is-loading","error"])}const Pt=q(H,[["render",X],["__file","BroadcastListView.vue"]]);export{Pt as default};
