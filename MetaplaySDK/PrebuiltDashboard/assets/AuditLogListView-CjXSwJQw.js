import{d as se,a6 as D,aj as z,ab as q,f as d,dD as E,c as l,bf as U,C as G,dE as O,O as re,L as ne,b as f,o as v,e as b,w as s,k as n,n as o,$ as oe,a as j,t as L,p as M,l as H,_ as le}from"./index-B7jvAjdE.js";import{M as ie,a as ue}from"./MViewContainer-BTeE2xDT.js";import{M as de}from"./MInputText-CzhsT8yb.js";import{i as Q}from"./utils-Dwlepb3M.js";import{a as Y,g as J}from"./auditLogs-Cml5ZKP5.js";import"./MInputHintMessage-DbuBS4Kn.js";import"./debounce-B8gTqdZO.js";import"./isSymbol-B7ZrWRtH.js";const S=10,ce=se({__name:"AuditLogListView",setup(K,{expose:a}){a();const h=D(),e=z(),_=q(),g=d(E(e.query,"targetType","")),m=d(E(e.query,"targetId","")),i=d(E(e.query,"sourceId","")),c=d(E(e.query,"sourceIpAddress","")),p=d(E(e.query,"sourceCountryIsoCode","")),A=l(()=>{const r=[{value:"Player",id:"Player"},{value:"$GameServer",id:"GameServer"},{value:"$GameConfig",id:"GameConfig"},{value:"$Broadcast",id:"Broadcast"},{value:"$Notification",id:"Notification"},{value:"$Experiment",id:"Experiment"},{value:"AsyncMatchmaker",id:"AsyncMatchmaker"}];return h.featureFlags.guilds&&r.push({value:"Guild",id:"Guild"}),h.featureFlags.web3&&r.push({value:"$Nft",id:"NFT"},{value:"$NftCollection",id:"NFT Collection"}),h.featureFlags.playerLeagues&&r.push({value:"LeagueManager",id:"League"}),h.featureFlags.localization&&r.push({value:"$Localization",id:"Localization"}),h.featureFlags.liveOpsEvents&&(r.push({value:"$LiveOpsEventOccurrence",id:"LiveOps Event"}),r.push({value:"$LiveOpsTimelineNode",id:"LiveOps Timeline Node"})),r}),u=d(),w=d(S),I=l(()=>N.value??V.value??B.value??F.value??R.value!==null),t=l(()=>u.value?.data?.entries||[]),W=l(()=>!!u.value?.data?.hasMore);function X(){w.value+=S,C()}function C(){u.value&&u.value.unsubscribe(),u.value=O(Y({targetType:g.value,targetId:g.value?m.value:void 0,sourceId:i.value?"$AdminApi:"+i.value:"",sourceIpAddress:c.value,sourceCountryIsoCode:p.value,limit:w.value}))}C(),U(()=>{u.value.unsubscribe()}),G([g,m,i,c,p,w],async()=>{const r={};g.value&&(r.targetType=g.value,m.value&&(r.targetId=m.value)),i.value&&(r.sourceId=i.value),c.value&&(r.sourceIpAddress=c.value),T.value&&(r.sourceCountryIsoCode=T.value),await _.replace({path:"/auditLogs",query:r}),C()});const T=l(()=>p.value?p.value.toUpperCase():null),N=l(()=>g.value?!0:null),V=l(()=>m.value?!0:null),B=l(()=>i.value?!0:null),F=l(()=>c.value?!0:null),R=l(()=>{const r=T.value;return r?Q(r)!==r:null}),y=d(),x=d(S),Z=l(()=>y.value?.data?.entries||[]),$=l(()=>!!y.value?.data?.hasMore);function ee(){x.value+=S,k()}function k(){y.value&&y.value.unsubscribe(),y.value=O(J("","",x.value))}k(),U(()=>{y.value.unsubscribe()});const te=[{key:"target",label:"Event"},{key:"displayTitle",label:"Title"},{key:"source",label:"User"},{key:"createdAt",label:"Date"}];async function ae(r){await _.push(`/auditLogs/${r.eventId}`)}const P={staticInfos:h,route:e,router:_,pageSize:S,searchAuditLogEventsTargetType:g,searchAuditLogEventsTargetId:m,searchAuditLogEventsSourceId:i,searchAuditLogEventsSourceIpAddress:c,searchAuditLogEventsSourceCountryIsoCode:p,targetTypes:A,searchEventsSubscription:u,searchEventsLimit:w,showSearchResults:I,searchEvents:t,searchEventsHasMore:W,showMoreSearch:X,subscribeShowSearch:C,upperCasedSearchAuditLogEventsSourceCountryIsoCode:T,searchAuditLogEventTypeUiState:N,searchAuditLogEventIdUiState:V,searchAuditLogEventUserAccountUiState:B,searchAuditLogEventUserIpAddressUiState:F,searchAuditLogEventUserCountryIsoCodeUiState:R,latestEventsSubscription:y,latestEventsLimit:x,latestEvents:Z,latestEventsHasMore:$,showMoreLatest:ee,subscribeShowLatest:k,tableFields:te,clickOnEventRow:ae,computed:l,onUnmounted:U,ref:d,watch:G,get useRoute(){return z},get useRouter(){return q},get useStaticInfos(){return D},get isoCodeToCountryName(){return Q},get MButton(){return re},get MInputText(){return de},get MPageOverviewCard(){return ie},get MTooltip(){return ne},get MViewContainer(){return ue},get useManuallyManagedStaticSubscription(){return O},get extractSingleValueFromQueryStringOrDefault(){return E},get getAllAuditLogEventsSubscriptionOptions(){return J},get getAuditLogEventsSearchSubscriptionOptions(){return Y}};return Object.defineProperty(P,"__isScriptSetup",{enumerable:!1,value:!0}),P}}),ve={class:"tw-mb-2"},ge={class:"tw-flex tw-gap-2"},me={class:"tw-basis-1/2"},pe={class:"tw-flex tw-flex-wrap tw-gap-2"},fe={key:0},he={class:"text-nowrap"},we={class:"text-nowrap"},ye={class:"tw-mt-2 tw-flex tw-w-full tw-justify-center"},be={key:1},Ae={class:"text-nowrap"},Ee={class:"text-nowrap"},Le={class:"tw-mt-2 tw-flex tw-w-full tw-justify-center"};function Se(K,a,h,e,_,g){const m=f("meta-input-select"),i=f("meta-username"),c=f("meta-time"),p=f("b-table"),A=f("b-row"),u=f("b-card"),w=f("b-col"),I=f("meta-raw-data");return v(),b(e.MViewContainer,{permission:"api.audit_logs.search"},{overview:s(()=>[n(e.MPageOverviewCard,{title:"Audit Log Events","data-testid":"audit-log-list-overview-search-card"},{default:s(()=>[a[7]||(a[7]=o("p",{class:"tw-mb-4"},"Audit log events are a record of all actions taken by users and the system. You can use them to see who has done what and when.",-1)),o("div",ve,[a[6]||(a[6]=o("h6",null,"Search",-1)),o("div",ge,[o("span",me,[a[5]||(a[5]=o("label",{class:oe(["tw-block tw-text-sm tw-font-bold tw-leading-6 tw-mb-1 tw-text-neutral-900"])},"Type",-1)),n(m,{value:e.searchAuditLogEventsTargetType,options:e.targetTypes,placeholder:"Select type",onInput:a[0]||(a[0]=t=>e.searchAuditLogEventsTargetType=t)},null,8,["value","options"])]),n(e.MInputText,{class:"tw-grow",label:"ID","model-value":e.searchAuditLogEventsTargetId,disabled:!e.searchAuditLogEventsTargetType,variant:e.searchAuditLogEventIdUiState!==null?e.searchAuditLogEventIdUiState?"success":"danger":"default","hint-message":e.searchAuditLogEventsTargetType?void 0:"Select a type first.",placeholder:"000000000R","show-clear-button":"","onBlur:modelValue":a[1]||(a[1]=t=>e.searchAuditLogEventsTargetId=t)},null,8,["model-value","disabled","variant","hint-message"])])]),o("div",null,[o("div",pe,[n(e.MInputText,{class:"tw-basis-full sm:tw-basis-1/2",label:"Account","model-value":e.searchAuditLogEventsSourceId,variant:e.searchAuditLogEventUserAccountUiState!==null?e.searchAuditLogEventUserAccountUiState?"success":"danger":"default",placeholder:"john.doe@example.org","show-clear-button":"","onBlur:modelValue":a[2]||(a[2]=t=>e.searchAuditLogEventsSourceId=t)},null,8,["model-value","variant"]),n(e.MInputText,{class:"tw-grow",label:"IP Address","model-value":e.searchAuditLogEventsSourceIpAddress,variant:e.searchAuditLogEventUserIpAddressUiState!==null?e.searchAuditLogEventUserIpAddressUiState?"success":"danger":"default",placeholder:"192.168.0.1","show-clear-button":"","onBlur:modelValue":a[3]||(a[3]=t=>e.searchAuditLogEventsSourceIpAddress=t)},null,8,["model-value","variant"]),n(e.MInputText,{class:"tw-basis-full sm:tw-basis-24",label:"Country Code","model-value":e.searchAuditLogEventsSourceCountryIsoCode,variant:e.searchAuditLogEventUserCountryIsoCodeUiState!==null?e.searchAuditLogEventUserCountryIsoCodeUiState?"success":"danger":"default","hint-message":e.searchAuditLogEventUserCountryIsoCodeUiState===!1?"Invalid ISO code.":void 0,placeholder:"FI","show-clear-button":"","onBlur:modelValue":a[4]||(a[4]=t=>e.searchAuditLogEventsSourceCountryIsoCode=t)},null,8,["model-value","variant","hint-message"])])])],void 0,!0),_:1})]),default:s(()=>[e.showSearchResults?(v(),j("div",fe,[n(w,{class:"tw-mb-4"},{default:s(()=>[n(u,{class:"shadow-sm",title:"Search Results","data-testid":"audit-log-list-search-results-card"},{default:s(()=>[e.searchEvents.length>0?(v(),b(A,{key:0,"no-gutters":""},{default:s(()=>[n(p,{small:"",striped:"",hover:"",responsive:"",items:e.searchEvents,fields:e.tableFields,"primary-key":"eventId","sort-by":"startAt","sort-desc":"","tbody-tr-class":"table-row-link",onRowClicked:e.clickOnEventRow},{"cell(target)":s(t=>[o("span",he,L(t.item.target.targetType.replace(/\$/,""))+":"+L(t.item.target.targetId),1)]),"cell(displayTitle)":s(t=>[n(e.MTooltip,{class:"text-nowrap",content:t.item.displayDescription,noUnderline:""},{default:s(()=>[M(L(t.item.displayTitle),1)],void 0,!0),_:2},1032,["content"])]),"cell(source)":s(t=>[o("span",we,[n(i,{username:t.item.source.sourceId,"render-as":"text"},null,8,["username"])])]),"cell(createdAt)":s(t=>[n(c,{class:"text-nowrap",date:t.item.createdAt},null,8,["date"])]),_:1},8,["items"]),o("div",ye,[e.searchEventsHasMore?(v(),b(e.MButton,{key:0,size:"small",onClick:e.showMoreSearch},{default:s(()=>a[8]||(a[8]=[M("Load More")]),void 0,!0),_:1})):H("",!0)])],void 0,!0),_:1})):(v(),b(A,{key:1,class:"mt-4 mb-3","no-gutters":"","align-h":"center"},{default:s(()=>a[9]||(a[9]=[o("p",{class:"m-0 text-muted"},"No search results.",-1)]),void 0,!0),_:1}))],void 0,!0),_:1})],void 0,!0),_:1}),n(I,{kvPair:e.searchEvents,name:"Search results"},null,8,["kvPair"])])):(v(),j("div",be,[n(w,{class:"tw-mb-4"},{default:s(()=>[n(u,{class:"shadow-sm",title:"Latest Audit Log Events","data-testid":"audit-log-list-latest-events-card"},{default:s(()=>[e.latestEvents.length>0?(v(),b(A,{key:0,"no-gutters":""},{default:s(()=>[n(p,{class:"table-fixed-column",small:"",striped:"",hover:"",responsive:"",items:e.latestEvents,fields:e.tableFields,"primary-key":"eventId","sort-by":"startAt","sort-desc":"","tbody-tr-class":"table-row-link",onRowClicked:e.clickOnEventRow},{"cell(target)":s(t=>[o("span",Ae,L(t.item.target.targetType.replace(/\$/,""))+":"+L(t.item.target.targetId),1)]),"cell(displayTitle)":s(t=>[n(e.MTooltip,{class:"text-nowrap",content:t.item.displayDescription,noUnderline:""},{default:s(()=>[M(L(t.item.displayTitle),1)],void 0,!0),_:2},1032,["content"])]),"cell(source)":s(t=>[o("span",Ee,[n(i,{username:t.item.source.sourceId,"render-as":"text"},null,8,["username"])])]),"cell(createdAt)":s(t=>[n(c,{class:"text-nowrap",date:t.item.createdAt},null,8,["date"])]),_:1},8,["items"]),o("div",Le,[e.latestEventsHasMore?(v(),b(e.MButton,{key:0,size:"small",onClick:e.showMoreLatest},{default:s(()=>a[10]||(a[10]=[M("Load More")]),void 0,!0),_:1})):H("",!0)])],void 0,!0),_:1})):(v(),b(A,{key:1,class:"mt-4 mb-3","no-gutters":"","align-h":"center"},{default:s(()=>a[11]||(a[11]=[o("p",{class:"m-0 text-muted"},"No events.",-1)]),void 0,!0),_:1}))],void 0,!0),_:1})],void 0,!0),_:1}),n(I,{kvPair:e.latestEvents,name:"Latest events"},null,8,["kvPair"])]))]),_:1})}const Oe=le(ce,[["render",Se],["__file","AuditLogListView.vue"]]);export{Oe as default};
