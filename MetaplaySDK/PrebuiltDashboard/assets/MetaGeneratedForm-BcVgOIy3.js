import{d as Q,f as d,x as V,y as I,A as w,c as g,C as L,h as k,cb as O,E as x,cc as G,ad as D,cd as P,b as j,o as p,a as b,k as T,n as A,l as B,e as W,t as X,_ as Y}from"./index-B7jvAjdE.js";import{M as Z}from"./MInputMultiSelectCheckbox-D_9f7ub1.js";import{G as $}from"./GeneratedUiFormDynamicComponent-DrqrTIRR.js";const ee=Q({__name:"MetaGeneratedForm",props:{typeName:{type:String,required:!0},value:{type:null,required:!1,default:void 0},page:{type:String,default:void 0},addTypeSpecifier:{type:Boolean,default:!1},forcedLocalization:{type:String,default:void 0},abstractTypeFilter:{type:Function,default:void 0},logicVersion:{type:Number,default:void 0},isTargetingMultiplePlayers:{type:Boolean,default:!1}},emits:["input","status"],setup(C,{expose:r,emit:l}){r();const e=C,n=d(),i=d(),u=d(null),h=d(),{data:s}=V(I()),{data:c}=V(w()),M=D(),m=l;function S(){e.typeName!==""&&O(e.typeName).then(a=>{n.value=a}).catch(a=>{console.error(a)})}async function E(a){if(n.value){e.addTypeSpecifier&&(a.$type=n.value.jsonType);const t=await P(a,n.value);m("input",t)}}const U=g(()=>({fieldName:void 0,fieldType:e.typeName,typeKind:n.value?.typeKind??x.Class,isLocalized:n.value?.isLocalized,addedInVersion:n.value?.addedInVersion,removedInVersion:void 0})),y=d(""),f=d([]);function K(a){f.value=a,a.includes(y.value)||(y.value=a[0])}function _(){let a=[];if(!s.value||!c.value)return a;const t=c.value.defaultLanguage;t&&!a.includes(t)&&a.push(t);const o=G(e.value,s.value);for(const v of o)a.includes(v)||a.push(v);if(o.length===0)for(const v in s.value.gameConfig.Languages)a.includes(v)||a.push(v);return e.forcedLocalization&&(a=[e.forcedLocalization]),y.value=e.forcedLocalization??c.value.defaultLanguage,a}const N=g(()=>s.value?.gameConfig.Languages??{}),R=g(()=>Object.values(N.value).sort((t,o)=>t.languageId===c.value?.defaultLanguage?-1:o.languageId===c.value?.defaultLanguage?1:0).filter(t=>!e.forcedLocalization||t.languageId===e.forcedLocalization).map(t=>({label:t.displayName,value:t.languageId,disabled:t.languageId===c.value?.defaultLanguage||!!e.forcedLocalization}))),q=g(()=>{const a=f.value.map(t=>({id:s.value.gameConfig.Languages[t].displayName,value:t}));return a.unshift({id:"Show all",value:"all"}),a});L([s,c],a=>{f.value=_()},{deep:!1});const H=g(()=>i.value?i.value.length===0:void 0),J=g(()=>i.value?.length>0?i.value[0].path+": "+i.value[0].reason:"");async function z(a){if(typeof a=="object"&&Object.keys(a).length===0)return;let t=`forms/schema/${e.typeName}/validate`;e.logicVersion!==void 0&&(t+=`/${e.logicVersion}`);const o=await M.post(t,a);o.status===200?(i.value=o.data,m("status",i.value.length===0)):(console.error("Server validation failed: ",o),m("status",!1))}L(()=>e.value,(a,t)=>{u.value!==null&&clearTimeout(u.value),u.value=setTimeout(()=>{z(a).then(()=>{u.value=null}).catch(o=>{console.error(o)})},200)}),L(()=>e.typeName,(a,t)=>{S()}),k(()=>{S(),f.value=_()});const F={props:e,schema:n,validationResults:i,validationTimeout:u,showAllLocales:h,gameData:s,staticConfigData:c,gameServerApi:M,emit:m,initializeSchema:S,update:E,rootField:U,currentLocale:y,selectedLocales:f,updateLocalizations:K,initialSelectedLocalizations:_,allLanguages:N,localeOptions:R,selectedLocaleOptions:q,isServerValid:H,serverValidationError:J,validate:z,computed:g,onMounted:k,ref:d,watch:L,get useGameServerApi(){return D},get MInputMultiSelectCheckbox(){return Z},get useSubscription(){return V},get getGameDataSubscriptionOptions(){return I},get getStaticConfigSubscriptionOptions(){return w},GeneratedUiFormDynamicComponent:$,get EGeneratedUiTypeKind(){return x},get findLanguages(){return G},get PreloadAllSchemasForTypeName(){return O},get stripNonMetaFields(){return P}};return Object.defineProperty(F,"__isScriptSetup",{enumerable:!1,value:!0}),F}}),ae={key:0,class:"pt-5 tw-w-full tw-text-center"},te={key:1},le={key:0},oe={key:1,class:"tw-text-red-500"};function ne(C,r,l,e,n,i){const u=j("b-spinner"),h=j("meta-input-select");return!e.schema||!e.gameData||!e.staticConfigData?(p(),b("div",ae,[T(u,{class:"mt-5",label:"Loading..."})])):(p(),b("div",te,[e.schema.isLocalized&&!l.forcedLocalization?(p(),b("div",le,[r[1]||(r[1]=A("div",{class:"font-weight-bold tw-mb-1"},"Selected Locales",-1)),T(e.MInputMultiSelectCheckbox,{class:"mb-2","model-value":e.selectedLocales,options:e.localeOptions,variant:e.selectedLocales.length===0?"danger":"default","logic-version":l.logicVersion,"onUpdate:modelValue":e.updateLocalizations,"data-testid":"localizations-selection-input"},null,8,["model-value","options","variant","logic-version"]),r[2]||(r[2]=A("div",{class:"font-weight-bold tw-mb-1"},"Current Locale",-1)),T(h,{class:"mb-2",value:e.currentLocale,options:e.selectedLocaleOptions,seachable:"","no-clear":"",onInput:r[0]||(r[0]=s=>e.currentLocale=s),"data-testid":"currentlocale-input"},null,8,["value","options"])])):B("",!0),(p(),W(e.GeneratedUiFormDynamicComponent,{key:l.typeName,fieldInfo:e.rootField,value:l.value,editLocales:e.selectedLocales,previewLocale:e.currentLocale==="all"?void 0:e.currentLocale,fieldPath:"",serverValidationResults:e.validationResults,page:l.page,abstractTypeFilter:l.abstractTypeFilter,contextObj:l.value,logicVersion:e.props.logicVersion,isTargetingMultiplePlayers:l.isTargetingMultiplePlayers,onInput:e.update},null,8,["fieldInfo","value","editLocales","previewLocale","serverValidationResults","page","abstractTypeFilter","contextObj","logicVersion","isTargetingMultiplePlayers"])),e.isServerValid?B("",!0):(p(),b("div",oe,X(e.serverValidationError),1))]))}const ce=Y(ee,[["render",ne],["__file","MetaGeneratedForm.vue"]]);export{ce as M};
