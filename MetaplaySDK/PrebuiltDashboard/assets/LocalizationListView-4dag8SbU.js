import{d as q,x as z,A as T,f as c,c as n,aU as x,ad as N,a0 as H,a8 as Q,ae as D,a9 as J,o as p,e as h,w as e,n as o,t as w,k as r,l as M,a as K,p as L,_ as W}from"./index-B7jvAjdE.js";import{M as X}from"./MActionModalButton-CvWVuTB-.js";import{a as Z,M as $}from"./MViewContainer-BTeE2xDT.js";import{M as aa}from"./MInputText-CzhsT8yb.js";import{M as ta}from"./MInputTextArea-BMdoSBpm.js";import ia from"./MetaRawData-CedjqGjJ.js";import{M as ea}from"./MetaGeneratedForm-BcVgOIy3.js";import{C as oa}from"./CoreUiPlacement-CPf1fwrN.js";import{g as I}from"./localization-Z8p1s5Vr.js";import"./MActionModal-coQLkvWs.js";import"./index-fVjXqxSF.js";import"./MInputHintMessage-DbuBS4Kn.js";import"./debounce-B8gTqdZO.js";import"./isSymbol-B7ZrWRtH.js";import"./utils-Dwlepb3M.js";import"./MInputMultiSelectCheckbox-D_9f7ub1.js";import"./MInputCheckbox-BqateWtE.js";import"./index-B_QkKjtG.js";import"./GeneratedUiFormDynamicComponent-DrqrTIRR.js";const la=q({__name:"LocalizationListView",setup(k,{expose:t}){t();const m=N(),a=x(),{data:v}=z(T()),{data:s,error:l,refresh:y}=z(I()),u=c(),d=c(),b=c();function U(){b.value=null,u.value="",d.value=""}const C=n(()=>!!(u.value&&u.value.length>0)),P=n(()=>d.value&&d.value.length>0?!0:null),A=c(),_=n(()=>C.value===!0&&P.value!==!1&&A.value);function O(i){return i==="Metaplay.Core.Config.LocalizationsBuildParameters"&&v.value!=null&&v.value.localizationsBuildInfo.buildParametersNamespaceQualifiedName!=="Metaplay.Core.Config.DefaultLocalizationsBuildParameters"?E=>E.typeName!=="Metaplay.Core.Config.DefaultLocalizationsBuildParameters":()=>!0}const{showSuccessNotification:g}=D();async function F(){const i={Properties:{Name:u.value,Description:d.value},BuildParams:b.value};await m.post("/localization/build",i),g("Localizations build started."),y()}const f=n(()=>(s.value??[]).filter(i=>!i.isArchived&&!(i.publishedAt!==null||i.unpublishedAt!==null||i.isActive)).map(i=>i.id)),R=n(()=>f.value.length>100);async function Y(){await m.post("/localization/archive",f.value),g(`Archived ${f.value.length} unpublished localizations.`)}const S=n(()=>{if(s.value)return s.value.reduce((i,V)=>V.isArchived?i+1:i,0)}),G=n(()=>(S.value??0)>200),j=n(()=>a.doesHavePermission("api.localization.delete")),B={gameServerApi:m,permissions:a,staticConfigData:v,allLocalizationData:s,allLocalizationError:l,allLocalizationsTriggerRefresh:y,localizationsName:u,localizationsDescription:d,buildParams:b,resetBuildNewConfigModal:U,nameValidationState:C,descriptionValidationState:P,buildParamsValidationState:A,formValidationState:_,buildParamsTypeFilter:O,showSuccessNotification:g,buildLocalizations:F,archivableLocaliationIds:f,hasTooManyUnpublishedLocalizations:R,archiveAllUnpublished:Y,archivedLocalizationCount:S,hasTooManyArchivedLocalizations:G,hasPermissionToDelete:j,computed:n,ref:c,get useGameServerApi(){return N},get MetaRawData(){return ia},get MActionModalButton(){return X},get MCallout(){return H},get MInputText(){return aa},get MInputTextArea(){return ta},get MTextButton(){return Q},get MViewContainer(){return Z},get MPageOverviewCard(){return $},get usePermissions(){return x},get useNotifications(){return D},get maybePluralString(){return J},get useSubscription(){return z},MetaGeneratedForm:ea,CoreUiPlacement:oa,get getStaticConfigSubscriptionOptions(){return T},get getAllLocalizationsSubscriptionOptions(){return I}};return Object.defineProperty(B,"__isScriptSetup",{enumerable:!1,value:!0}),B}}),na={class:"tw-mt-4 tw-flex tw-justify-end"},ra={class:"tw-mb-3"},sa={key:0},ua={class:"tw-rounded-md tw-border tw-border-neutral-200 tw-bg-neutral-100 tw-p-4"};function da(k,t,m,a,v,s){return p(),h(a.MViewContainer,{"is-loading":!a.allLocalizationData,error:a.allLocalizationError,variant:a.hasTooManyUnpublishedLocalizations||a.hasTooManyArchivedLocalizations?"warning":void 0,permission:"api.localization.view"},{alerts:e(()=>[a.hasTooManyUnpublishedLocalizations?(p(),h(a.MCallout,{key:0,class:"tw-mb-3",title:"Many Unpublished Localizations",variant:"warning"},{default:e(()=>[o("div",null,"You have "+w(a.maybePluralString(a.archivableLocaliationIds.length,"unpublished localization"))+". Consider archiving or publishing them to reduce clutter.",1),o("div",na,[r(a.MActionModalButton,{"modal-title":"Archive All Unpublished localizations",action:a.archiveAllUnpublished,"trigger-button-label":"Archive All Unpublished","trigger-button-size":"small"},{default:e(()=>[o("div",null,"You are about to archive "+w(a.archivableLocaliationIds.length)+" unpublished localizations. Archiving a localization will hide it from the list of available localizations. An archived localization can be unarchived at any time.",1)]),_:1})])],void 0,!0),_:1})):M("",!0),a.hasTooManyArchivedLocalizations?(p(),h(a.MCallout,{key:1,title:"Many Archived Localizations",variant:"warning"},{default:e(()=>[o("div",ra,"You have "+w(a.archivedLocalizationCount)+" archived localizations. These localizations are not being used and can be safely removed. Removing these localizations will improve your server performance.",1),a.hasPermissionToDelete?(p(),K("div",sa,[t[5]||(t[5]=L("Archived localizations can be removed from the ")),r(a.MTextButton,{to:"/system"},{default:e(()=>t[4]||(t[4]=[L("settings")]),void 0,!0),_:1}),t[6]||(t[6]=L(" page."))])):M("",!0)],void 0,!0),_:1})):M("",!0)]),overview:e(()=>[r(a.MPageOverviewCard,{title:"View Localizations","data-testid":"localization-list-overview-card"},{buttons:e(()=>[r(a.MActionModalButton,{"modal-title":"Build New Localizations",action:a.buildLocalizations,"trigger-button-label":"New Build","trigger-button-disabled-tooltip":a.staticConfigData?.localizationsBuildInfo.buildSupported?void 0:"Localization builds have not been enabled for this environment.","ok-button-label":"Build Localizations","ok-button-disabled-tooltip":a.formValidationState?void 0:"Please fill in all required fields to proceed.",permission:"api.localization.edit",onShow:a.resetBuildNewConfigModal,"data-testid":"build-localization-form"},{default:e(()=>[t[7]||(t[7]=o("p",null,"You can configure and trigger a new localizations build to happen directly on the game server. It may take a few minutes for large projects.",-1)),r(a.MInputText,{class:"tw-mb-1",label:"Localizations Build Name","model-value":a.localizationsName,variant:a.nameValidationState!==null?a.nameValidationState?"success":"danger":"default",placeholder:"For example: 1.3.2","onUpdate:modelValue":t[0]||(t[0]=l=>a.localizationsName=l)},null,8,["model-value","variant"]),r(a.MInputTextArea,{class:"tw-mb-1",label:"Localizations Build Description","model-value":a.localizationsDescription,variant:a.descriptionValidationState!==null?a.descriptionValidationState?"success":"danger":"default",placeholder:"For example: Reduced the difficulty of levels between 5 and 10.",rows:3,"onUpdate:modelValue":t[1]||(t[1]=l=>a.localizationsDescription=l)},null,8,["model-value","variant"])]),"right-panel":e(()=>[o("div",ua,[t[8]||(t[8]=o("div",{class:"tw-mb-2 tw-font-semibold"},"Build Parameters",-1)),t[9]||(t[9]=o("div",{class:"small"},"Optional configuration for how the localizations should be built. You can, for example, pull data from a different sources.",-1)),o("div",null,[r(a.MetaGeneratedForm,{class:"tw-mt-2",typeName:"Metaplay.Core.Config.LocalizationsBuildParameters",value:a.buildParams,page:"LocalizationsBuildCard","abstract-type-filter":a.buildParamsTypeFilter,onInput:t[2]||(t[2]=l=>a.buildParams=l),onStatus:t[3]||(t[3]=l=>a.buildParamsValidationState=l)},null,8,["value"])])])]),_:1},8,["trigger-button-disabled-tooltip","ok-button-disabled-tooltip"])]),default:e(()=>[t[10]||(t[10]=o("p",{class:"tw-mb-1"},"Localizations are a way to deliver localized text content to your players.",-1)),t[11]||(t[11]=o("div",{class:"tw-text-sm tw-text-neutral-500"},"You can upload new localization builds and review them before publishing. Published localizations will be delivered over-the-air and do not require players to update their clients.",-1))],void 0,!0),_:1})]),default:e(()=>[r(a.CoreUiPlacement,{placementId:"Localizations/List"}),r(a.MetaRawData,{"kv-pair":a.allLocalizationData,name:"allLocalizationData"},null,8,["kv-pair"])]),_:1},8,["is-loading","error","variant"])}const Ta=W(la,[["render",da],["__file","LocalizationListView.vue"]]);export{Ta as default};
