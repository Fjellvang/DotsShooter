import{d as T,x as S,f as G,c as g,a9 as r,ci as n,ad as y,ac as N,ae as k,e0 as A,b as B,o as c,e as P,w as v,a as h,p as I,t as p,l as U,n as s,k as b,_ as V}from"./index-B7jvAjdE.js";import{M as D}from"./MActionModalButton-CvWVuTB-.js";import{M as O}from"./MInputSwitch-C-Z-JJsG.js";import{g as M}from"./gameConfigs-DlpfRS5r.js";import"./MActionModal-coQLkvWs.js";import"./index-fVjXqxSF.js";import"./index-B_QkKjtG.js";const Y=T({__name:"RemoveArchivedGameConfigs",setup(R,{expose:t}){t();const{data:l,refresh:e}=S(M()),m=y(),d=G(!1);function u(){d.value=!1}const{showSuccessNotification:a,showErrorNotification:f}=k();async function x(){const o=await m.delete("gameConfig/deleteArchived");let i;do await A(1e3),i=(await m.get("backgroundTasks?taskId="+o.data)).data;while(i!=null&&!i.completed);i!=null?i.failure===void 0||i.failure==null?a(w.value.removed):(console.error(i.failure),f("Failed to remove archived game configs, see logs for more information.")):f("We lost track of the archived game config removal, likely due to the server restarting."),e()}const C=g(()=>{if(l.value)return l.value.reduce((o,i)=>i.isArchived?o+1:o,0)}),w=g(()=>{const o=C.value??0;return{subtitle:`You have ${r(o,"archived game config",!0)} that ${n(o,"is","are")} not being used.`,prune:`You can prune ${n(o,"it","them")} here to keep your server running smoothly.`,modalDescription:`You currently have ${r(o,"archived game config",!0)}. ${n(o,"This config is","These configs are")} not being used and can be safely removed. Removing ${n(o,"this config","these configs")} will improve your server performance.`,noSeatbelts:`Removing ${n(o,"this","these")} ${r(o,"archived game config",!0)} from the server is permanent - ${n(o,"it","they")} can not be recovered.`,removed:`Removed ${r(o,"archived game config",!0)}.`}}),_={allGameConfigsData:l,allGameConfigsTriggerRefresh:e,gameServerApi:m,confirmRemoval:d,onShow:u,showSuccessNotification:a,showErrorNotification:f,removeArchived:x,archivedGameConfigCount:C,archivedGameConfigUiTexts:w,computed:g,ref:G,get useGameServerApi(){return y},get MActionModalButton(){return D},get MCard(){return N},get MInputSwitch(){return O},get useNotifications(){return k},get maybePluralPrefixString(){return n},get maybePluralString(){return r},get useSubscription(){return S},get sleep(){return A},get getAllGameConfigsSubscriptionOptions(){return M}};return Object.defineProperty(_,"__isScriptSetup",{enumerable:!1,value:!0}),_}}),j={key:0},E={key:1},z={key:0,class:"tw-ml-1"},F={class:"tw-flex tw-justify-end"},W={class:"tw-flex tw-justify-between"};function q(R,t,l,e,m,d){const u=B("MetaNoSeatbelts");return c(),P(e.MCard,{title:"Remove Archived Configs","is-loading":e.archivedGameConfigCount===void 0},{subtitle:v(()=>[e.archivedGameConfigCount===0?(c(),h("p",j,"You have no archived game configs to remove.")):(c(),h("p",E,[I(p(e.archivedGameConfigUiTexts.subtitle),1),e.archivedGameConfigCount&&e.archivedGameConfigCount>0?(c(),h("span",z,p(e.archivedGameConfigUiTexts.prune),1)):U("",!0)]))]),default:v(()=>[s("div",F,[b(e.MActionModalButton,{"modal-title":"Remove Archived Configs",action:e.removeArchived,"trigger-button-label":"Open Removal Menu","trigger-button-disabled-tooltip":e.archivedGameConfigCount===0?"There are no archived game configs to remove.":void 0,"ok-button-label":"Remove","ok-button-disabled-tooltip":e.confirmRemoval?void 0:"Toggle the confirmation switch to enable.",permission:"api.game_config.delete",onShow:t[1]||(t[1]=a=>e.onShow())},{default:v(()=>[s("p",null,p(e.archivedGameConfigUiTexts.modalDescription),1),t[3]||(t[3]=s("h6",{class:"tw-mt-4"},"Confirm",-1)),s("div",W,[t[2]||(t[2]=s("span",null,"I know what I am doing",-1)),b(e.MInputSwitch,{"model-value":e.confirmRemoval,name:"confirmRemoval",size:"small","onUpdate:modelValue":t[0]||(t[0]=a=>e.confirmRemoval=a)},null,8,["model-value"])]),b(u,{class:"tw-mt-4",message:e.archivedGameConfigUiTexts.noSeatbelts},null,8,["message"])]),_:1},8,["trigger-button-disabled-tooltip","ok-button-disabled-tooltip"])])],void 0,!0),_:1},8,["is-loading"])}const $=V(Y,[["render",q],["__file","RemoveArchivedGameConfigs.vue"]]);export{$ as default};
