import{d as H,x,dV as I,c as N,q as j,M as G,v as z,a8 as Y,b as P,o as y,e as k,w as n,k as f,l as J,p as V,t as T,a as F,_ as K}from"./index-B7jvAjdE.js";import{M as h,a as S,c as i,b as B}from"./metaListUtils-B-xQ0HnD.js";import{a as q}from"./players-CydHenLG.js";import{M as Q}from"./MetaGeneratedContent-DU2kF4fJ.js";const U=1,W=H({__name:"PlayerBroadcastsCard",props:{playerId:{}},setup(O,{expose:b}){b();const v=O,{data:e,hasPermission:L}=x(I()),{data:s}=x(q(v.playerId)),M=["name","statusText"],_=[new B("status",[new i("Scheduled",t=>t.statusText==="Scheduled"),new i("Pending",t=>t.statusText==="Pending"),new i("Received",t=>t.statusText==="Received"),new i("Not eligible",t=>t.statusText==="Not eligible"),new i("Expired",t=>t.statusText==="Expired")]),new B("attachments",[new i("Has attachments",t=>t.attachments!==null&&t.attachments.length>0),new i("No attachments",t=>t.attachments===null||t.attachments.length===0)])],a=[new h("Start time","startAt",S.Ascending),new h("Start time","startAt",S.Descending),new h("Status","statusSortOrder",S.Ascending),new h("Status","statusSortOrder",S.Descending)],E=N(()=>{if(!s.value)return;const t=[];return(e.value||[]).forEach(r=>{const c=r.params.id,d=r.params;let l,u,m,p,g;if((s.value.model.receivedBroadcastIds||[]).includes(c))l="Received",u=!1,m="success",p=`${s.value.model.playerName||"The player"} has received this broadcast.`,g=2;else{const w=new Date,R=new Date(d.startAt),D=new Date(d.endAt);D>w&&R<w?C(s.value,d)?(l="Pending",u=!1,m="neutral",p=`${s.value.model.playerName||"The player"} will receive this broadcast the next time they connect.`,g=1):(l="Not eligible",u=!0,m="neutral",p=`${s.value.model.playerName||"The player"} is not eligible to receive this broadcast.`,g=3):D>w?(l="Scheduled",u=!0,m="neutral",p="This broadcast has not yet started.",g=0):(l="Expired",u=!0,m="neutral",p=`This broadcast has expired and ${s.value.model.playerName||"the player"} did not receive it.`,g=4)}t.push({id:c,name:d.name,contents:d.contents,startAt:d.startAt,attachments:d.contents.contents?.consumableRewards??[],statusText:l,statusMuted:u,statusBadgeVariant:m,statusTooltip:p,statusSortOrder:g})}),t});function C(t,o){let r=!1;return o.isTargeted?o.targetPlayers?.includes(t.id)?r=!0:o.targetCondition?.requireAllSegments?o.targetCondition.requireAllSegments.every(c=>t.matchingSegments.includes(c))&&(r=!0):o.targetCondition?.requireAnySegment&&o.targetCondition.requireAnySegment.some(c=>t.matchingSegments?.includes(c))&&(r=!0):r=!0,r}const A={props:v,broadcastsData:e,broadcastsHasPermission:L,playerData:s,searchFields:M,filterSets:_,sortOptions:a,defaultSortOption:U,broadcastListItems:E,isPlayerTargeted:C,computed:N,get MetaListFilterOption(){return i},get MetaListFilterSet(){return B},get MetaListSortDirection(){return S},get MetaListSortOption(){return h},get MCollapse(){return j},get MBadge(){return G},get MListItem(){return z},get MTextButton(){return Y},get useSubscription(){return x},get getBroadcastsSubscriptionOptions(){return I},get getSinglePlayerSubscriptionOptions(){return q},MetaGeneratedContent:Q};return Object.defineProperty(A,"__isScriptSetup",{enumerable:!1,value:!0}),A}}),X={key:0},Z={key:1,class:"tw-italic tw-text-neutral-500"};function $(O,b,v,e,L,s){const M=P("fa-icon"),_=P("meta-list-card");return y(),k(_,{title:"Broadcast Log",icon:"broadcast-tower",itemList:e.broadcastListItems,tooltip:"All broadcasts in the game.",searchFields:e.searchFields,filterSets:e.filterSets,sortOptions:e.sortOptions,defaultSortOption:e.defaultSortOption,emptyMessage:`${e.broadcastsHasPermission?"No broadcasts sent yet!":"You do not have permissions to view broadcasts."}`,"data-testid":"player-broadcasts-card"},{"item-card":n(a=>[f(e.MCollapse,{extraMListItemMargin:""},{header:n(()=>[f(e.MListItem,{noLeftPadding:""},{badge:n(()=>[Object.keys(a.item.attachments).length>0?(y(),k(M,{key:0,class:"tw-mt-1 tw-text-neutral-500",icon:"paperclip",size:"sm"})):J("",!0)]),"top-right":n(()=>[f(e.MBadge,{tooltip:a.item.statusTooltip,variant:a.item.statusBadgeVariant},{default:n(()=>[V(T(a.item.statusText),1)],void 0,!0),_:2},1032,["tooltip","variant"])]),"bottom-right":n(()=>[f(e.MTextButton,{to:`/broadcasts/${a.item.id}`},{default:n(()=>b[0]||(b[0]=[V("View broadcast")]),void 0,!0),_:2},1032,["to"])]),default:n(()=>[a.item.statusMuted?(y(),F("span",Z,T(a.item.name),1)):(y(),F("span",X,T(a.item.name),1))],void 0,!0),_:2},1024)]),default:n(()=>[f(e.MetaGeneratedContent,{value:a.item.contents,"is-targeting-multiple-players":"","logic-version":e.playerData.model.logicVersion},null,8,["value","logic-version"])],void 0,!0),_:2},1024)]),_:1},8,["itemList","emptyMessage"])}const rt=K(W,[["render",$],["__file","PlayerBroadcastsCard.vue"]]);export{rt as default};
