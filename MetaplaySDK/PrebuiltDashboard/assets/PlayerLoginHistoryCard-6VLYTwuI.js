import{d as A,x as M,c as m,a6 as k,v as P,a8 as U,cK as B,b as s,o as i,e as V,w as a,k as r,n as L,t as u,a as p,l as h,p as f,_ as H}from"./index-B7jvAjdE.js";import{i as T,b as D}from"./utils-Dwlepb3M.js";import{M as x,a as C,b}from"./metaListUtils-B-xQ0HnD.js";import{a as N}from"./players-CydHenLG.js";const K=1,E=A({__name:"PlayerLoginHistoryCard",props:{playerId:{}},setup(I,{expose:o}){o();const d=I,{data:t}=M(N(d.playerId)),c=m(()=>t.value.model.loginHistory.map(e=>({...e,countryName:e.location?T(e.location.country.isoCode):"Unknown",countryFlag:e.location?D(e.location.country.isoCode):void 0}))),n=k(),y=m(()=>!!n.environmentInfo.grafanaUri);function _(e){if(n.environmentInfo.grafanaUri){const w=new Date(e.timestamp),O=new Date(+w+15*6e4),F=n.environmentInfo.kubernetesNamespace?`,namespace=\\"${n.environmentInfo.kubernetesNamespace}\\"`:"";return`${n.environmentInfo.grafanaUri}/explore?orgId=1&left={"datasource": "Loki", "queries":[{"expr":"{app=\\"metaplay-server\\"${F}} |= \\"${d.playerId}\\""}],"range":{"from":"${+w-3e3}","to":"${+O+3e3}"}}`}else return}const g=["deviceModel","countryName","countryFlag"],S=[new x("Time","timestamp",C.Ascending),new x("Time","timestamp",C.Descending)],v=m(()=>[b.asDynamicFilterSet(c.value,"device-model",e=>e.deviceModel),b.asDynamicFilterSet(c.value,"country-name",e=>e.countryName)]),l={props:d,playerData:t,decoratedItems:c,staticInfos:n,grafanaEnabled:y,getGrafanaLogsUrl:_,searchFields:g,sortOptions:S,defaultSortOption:K,filterSets:v,computed:m,get useStaticInfos(){return k},get MetaListSortOption(){return x},get MetaListSortDirection(){return C},get MetaListFilterSet(){return b},get isoCodeToCountryName(){return T},get isoCodeToCountryFlag(){return D},get MListItem(){return P},get MTextButton(){return U},get useSubscription(){return M},get parseDotnetTimeSpanToLuxon(){return B},get getSinglePlayerSubscriptionOptions(){return N}};return Object.defineProperty(l,"__isScriptSetup",{enumerable:!1,value:!0}),l}}),G={class:"tw-mt-0.5 tw-text-xs+ tw-text-neutral-500"},j={key:0},q={key:1},z={key:0},J={key:1};function Q(I,o,d,t,c,n){const y=s("meta-country-code"),_=s("meta-time"),g=s("meta-ip-address"),S=s("meta-duration"),v=s("fa-icon"),l=s("meta-list-card");return t.playerData?(i(),V(l,{key:0,title:"Latest Logins",icon:"clipboard-list",tooltip:"Shows 20 latest logins and their source.",itemList:t.decoratedItems,searchFields:t.searchFields,filterSets:t.filterSets,sortOptions:t.sortOptions,defaultSortOption:t.defaultSortOption,emptyMessage:"No logins yet!","data-testid":"player-login-history-card"},{"item-card":a(({item:e})=>[r(t.MListItem,null,{badge:a(()=>[L("span",G,"(client "+u(e.clientVersion)+")",1)]),"top-right":a(()=>[r(_,{date:e.timestamp,showAs:"timeagoSentenceCase"},null,8,["date"])]),"bottom-left":a(()=>[L("div",null,[e.authenticationKey?(i(),p("span",j,"Authentication: "+u(e.authenticationKey.platform==="DeviceId"?"Client token":e.authenticationKey.platform),1)):h("",!0),e.ipAddress?(i(),p("span",q,[o[0]||(o[0]=f("| IP: ")),r(g,{"ip-address":e.ipAddress},null,8,["ip-address"])])):h("",!0)]),L("div",null,"OS: "+u(e.operatingSystem??"Unknown"),1)]),"bottom-right":a(()=>[e.sessionLengthApprox?(i(),p("div",z,[o[1]||(o[1]=f("Session length: ")),r(S,{duration:t.parseDotnetTimeSpanToLuxon(e.sessionLengthApprox),showAs:"exactDuration",hideMilliseconds:""},null,8,["duration"])])):(i(),p("div",J,"Session length: Unknown")),r(t.MTextButton,{permission:"dashboard.grafana.view","disabled-tooltip":t.grafanaEnabled?void 0:"Grafana is not configured for this environment",to:t.getGrafanaLogsUrl(e)},{default:a(()=>[r(v,{class:"tw-mr-1",icon:"external-link-alt",size:"sm"}),o[2]||(o[2]=f(" View logs"))],void 0,!0),_:2},1032,["disabled-tooltip","to"])]),default:a(()=>[r(y,{isoCode:"slotProps.item.location ? slotProps.item.location.country.isoCode : null"}),f(" "+u(e.deviceModel),1)],void 0,!0),_:2},1024)]),_:1},8,["itemList","filterSets"])):h("",!0)}const Z=H(E,[["render",Q],["__file","PlayerLoginHistoryCard.vue"]]);export{Z as default};
