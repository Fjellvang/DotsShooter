import{d as V,aj as S,ab as C,ad as M,ae as E,b as l,o as y,e as A,w as a,n as v,k as t,_ as P,x,al as h,c as _,N as w,M as R,p as d,t as N,l as z}from"./index-B7jvAjdE.js";import{M as k,a as F}from"./MViewContainer-BTeE2xDT.js";import{M as I}from"./MetaAudienceSizeEstimate-CCTh_xY2.js";import{M as j}from"./MActionModalButton-CvWVuTB-.js";import{B as U}from"./BroadcastFormButton-B5PTqemK.js";import{C as G}from"./CoreUiPlacement-CPf1fwrN.js";import{g as O}from"./analyticsEvents-CRLHbRhO.js";import{a as T}from"./broadcasts-BpyehJtv.js";import"./MActionModal-coQLkvWs.js";import"./index-fVjXqxSF.js";import"./MInputDateTime-DL6Zd7-d.js";import"./MInputHintMessage-DbuBS4Kn.js";import"./MInputSwitch-C-Z-JJsG.js";import"./index-B_QkKjtG.js";import"./index-DZuvHjnn.js";import"./MInputDurationOrEndDateTime-CP-rRAVP.js";import"./MInputDuration-C704TlZG.js";import"./MInputNumber-BOzPEn49.js";import"./MInputText-CzhsT8yb.js";import"./debounce-B8gTqdZO.js";import"./isSymbol-B7ZrWRtH.js";import"./MetaGeneratedForm-BcVgOIy3.js";import"./MInputMultiSelectCheckbox-D_9f7ub1.js";import"./MInputCheckbox-BqateWtE.js";import"./GeneratedUiFormDynamicComponent-DrqrTIRR.js";import"./MessageAudienceForm-Bn0DOLdW.js";import"./actionDebouncer-CJRtFyZn.js";import"./numberUtils-CkF0oMe2.js";import"./MInputSingleSelectSwitch-CuptGC6e.js";import"./index-CDBqmjrS.js";import"./MInputSimpleSelectDropdown-DIlBEFcs.js";import"./index-qTA83-by.js";import"./MInputTextArea-BMdoSBpm.js";import"./_arrayIncludes-B3ShBz6l.js";const H=V({__name:"BroadcastDeleteFormButton",props:{id:{}},emits:["refresh"],setup(B,{expose:r,emit:c}){r();const e=B,n=M(),m=S(),s=C(),o=c,{showSuccessNotification:i}=E();async function p(){await n.delete(`/broadcasts/${e.id}`);const g=`Broadcast with id ${e.id} deleted.`;i(g),m.path.includes(e.id)&&await s.push("/broadcasts"),o("refresh")}const f={props:e,gameServerApi:n,route:m,router:s,emits:o,showSuccessNotification:i,deleteBroadcast:p,get useRoute(){return S},get useRouter(){return C},get useGameServerApi(){return M},get MActionModalButton(){return j},get useNotifications(){return E}};return Object.defineProperty(f,"__isScriptSetup",{enumerable:!1,value:!0}),f}}),K={class:"tw-flex tw-flex-col tw-space-y-2"};function W(B,r,c,e,n,m){const s=l("meta-no-seatbelts");return y(),A(e.MActionModalButton,{"modal-title":"Delete broadcast",action:e.deleteBroadcast,"trigger-button-label":"Delete","ok-button-label":"Delete",variant:"danger",permission:"api.broadcasts.edit","data-testid":"action-delete-broadcast"},{default:a(()=>[v("div",K,[r[0]||(r[0]=v("p",null,"Deleting this broadcast will prevent any more players from receiving it. However, it will not be removed from the inbox of those who have already received it.",-1)),t(s,{class:"tw-mx-auto tw-w-3/4"})])],void 0,!0),_:1})}const q=P(H,[["render",W],["__file","BroadcastDeleteFormButton.vue"]]),J=V({__name:"BroadcastDetailView",setup(B,{expose:r}){r();const c=S(),{data:e}=x(O()),{data:n,refresh:m,error:s}=x(T(h(c.params.id)||"")),o=_(()=>{if(!n.value)return;const u=w.now(),D=w.fromISO(n.value.message.params.startAt),b=w.fromISO(n.value.message.params.endAt);return b>u&&D<u?{...n.value,decoration:{status:"Active",variant:"success",icon:"broadcast-tower"}}:b>u?{...n.value,decoration:{status:"Scheduled",variant:"primary",icon:"calendar-alt"}}:{...n.value,decoration:{status:"Expired",variant:"neutral",icon:"times"}}}),i=_(()=>o.value?.audienceSizeEstimate),p=_(()=>o.value?.message.params),f=_(()=>o.value.message.params.triggerCondition==null?void 0:e.value?.find(u=>u.typeCode===o.value.message?.params.triggerCondition.eventTypeCode)?.displayName??"UNKNOWN"),g={route:c,analyticsEvents:e,singleBroadcastData:n,singleBroadcastRefresh:m,singleBroadcastError:s,decoratedBroadcasts:o,audienceSizeEstimate:i,updatedBroadcast:p,triggerConditionDisplayName:f,get DateTime(){return w},computed:_,get useRoute(){return S},get MBadge(){return R},get MPageOverviewCard(){return k},get MViewContainer(){return F},get useSubscription(){return x},MetaAudienceSizeEstimate:I,BroadcastDeleteFormButton:q,BroadcastFormButton:U,CoreUiPlacement:G,get routeParamToSingleValue(){return h},get getAllAnalyticsEventsSubscriptionOptions(){return O},get getSingleBroadcastSubscriptionOptions(){return T}};return Object.defineProperty(g,"__isScriptSetup",{enumerable:!1,value:!0}),g}}),L={class:"font-weight-bold"},Q={class:"tw-inline-flex tw-space-x-2"};function X(B,r,c,e,n,m){const s=l("fa-icon"),o=l("b-td"),i=l("b-tr"),p=l("meta-time"),f=l("meta-abbreviate-number"),g=l("b-tbody"),u=l("b-table-simple"),D=l("meta-raw-data");return y(),A(e.MViewContainer,{permission:"api.broadcasts.view","is-loading":!e.singleBroadcastData,error:e.singleBroadcastError},{overview:a(()=>[t(e.MPageOverviewCard,{id:`${e.decoratedBroadcasts.message.params.id}`,title:e.decoratedBroadcasts.message.params.name},{badge:a(()=>[t(e.MBadge,{class:"ml-2",variant:e.decoratedBroadcasts.decoration.variant},{icon:a(()=>[t(s,{icon:e.decoratedBroadcasts.decoration.icon},null,8,["icon"])]),default:a(()=>[d(N(e.decoratedBroadcasts.decoration.status),1)],void 0,!0),_:1},8,["variant"])]),buttons:a(()=>[v("div",Q,[e.updatedBroadcast?(y(),A(e.BroadcastFormButton,{key:0,class:"mr-2","button-text":"Duplicate",prefillData:e.updatedBroadcast,editBroadcast:!1,onRefresh:r[0]||(r[0]=b=>e.singleBroadcastRefresh())},null,8,["prefillData"])):z("",!0),t(e.BroadcastFormButton,{class:"mr-2","button-text":"Edit",prefillData:e.updatedBroadcast,disabledTooltip:e.decoratedBroadcasts.decoration.status==="Expired"?"The broadcast has expired and can not be edited.":void 0,editBroadcast:!0,onRefresh:r[1]||(r[1]=b=>e.singleBroadcastRefresh())},null,8,["prefillData","disabledTooltip"]),t(e.BroadcastDeleteFormButton,{id:`${e.route.params.id}`},{default:a(()=>r[8]||(r[8]=[d("Delete")]),void 0,!0),_:1},8,["id"])])]),default:a(()=>[v("div",null,[v("span",L,[t(s,{icon:"chart-bar"}),r[2]||(r[2]=d(" Overview"))]),t(u,{class:"tw-mt-1",small:"",responsive:""},{default:a(()=>[t(g,null,{default:a(()=>[t(i,null,{default:a(()=>[t(o,null,{default:a(()=>r[3]||(r[3]=[d("Audience Size Estimate")]),void 0,!0),_:1}),t(o,{class:"tw-text-right"},{default:a(()=>[t(e.MetaAudienceSizeEstimate,{sizeEstimate:e.decoratedBroadcasts.message.params.isTargeted?e.audienceSizeEstimate:void 0},null,8,["sizeEstimate"])],void 0,!0),_:1})],void 0,!0),_:1}),t(i,null,{default:a(()=>[t(o,null,{default:a(()=>r[4]||(r[4]=[d("Start Time")]),void 0,!0),_:1}),t(o,{class:"tw-text-right"},{default:a(()=>[t(p,{date:e.decoratedBroadcasts.message.params.startAt,showAs:"datetime"},null,8,["date"])],void 0,!0),_:1})],void 0,!0),_:1}),t(i,null,{default:a(()=>[t(o,null,{default:a(()=>r[5]||(r[5]=[d("Expiry Time")]),void 0,!0),_:1}),t(o,{class:"tw-text-right"},{default:a(()=>[t(p,{date:e.decoratedBroadcasts.message.params.endAt,showAs:"datetime"},null,8,["date"])],void 0,!0),_:1})],void 0,!0),_:1}),t(i,null,{default:a(()=>[t(o,null,{default:a(()=>r[6]||(r[6]=[d("Received By")]),void 0,!0),_:1}),t(o,{class:"tw-text-right"},{default:a(()=>[t(f,{value:e.decoratedBroadcasts.message.stats.receivedCount,unit:"player"},null,8,["value"])],void 0,!0),_:1})],void 0,!0),_:1}),t(i,null,{default:a(()=>[t(o,null,{default:a(()=>r[7]||(r[7]=[d("Trigger")]),void 0,!0),_:1}),t(o,{class:"tw-text-right"},{default:a(()=>[d(N(e.triggerConditionDisplayName?`On ${e.triggerConditionDisplayName}`:"Immediate"),1)],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})])],void 0,!0),_:1},8,["id","title"])]),default:a(()=>[t(e.CoreUiPlacement,{placementId:"Broadcasts/Details",broadcastId:String(e.decoratedBroadcasts.message.params.id)},null,8,["broadcastId"]),t(D,{kvPair:e.singleBroadcastData,name:"broadcast"},null,8,["kvPair"])],void 0,!0),_:1},8,["is-loading","error"])}const Oe=P(J,[["render",X],["__file","BroadcastDetailView.vue"]]);export{Oe as default};
