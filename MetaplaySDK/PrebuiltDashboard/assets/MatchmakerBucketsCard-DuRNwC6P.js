import{d as T,x as P,c as x,f as _,ad as D,M as A,s as N,v as E,a8 as G,b as I,o as r,e as m,w as a,k as p,p as s,t as i,a as o,F as y,r as w,l as C,n as B,_ as j}from"./index-B7jvAjdE.js";import{M as H}from"./MModal-CihxrIfO.js";import{M as d,a as k,c as b,b as F}from"./metaListUtils-B-xQ0HnD.js";import{a as O}from"./matchmaking-3j4jzqL_.js";import"./index-fVjXqxSF.js";const U=T({__name:"MatchmakerBucketsCard",props:{matchmakerId:{}},setup(h,{expose:l}){l();const f=h,{data:e}=P(O(f.matchmakerId)),L=x(()=>e.value?.data.bucketInfos);function S(n){g.value?.open(),t(n.labelHash)}const u=_(null),g=_(),c=[d.asUnsorted(),new d("Fill rate","fillPercentage",k.Descending),new d("Fill rate","fillPercentage",k.Ascending),new d("Participants","numPlayers",k.Descending),new d("Participants","numPlayers",k.Ascending)],M=[new F("participants",[new b("Full",n=>n.numPlayers===n.capacity,!0),new b("Partially full",n=>n.numPlayers>0&&n.numPlayers<n.capacity,!0),new b("Empty",n=>n.numPlayers===0)])];async function t(n){u.value=null;const V=await D().get(`matchmakers/${f.matchmakerId}/bucket/${n}`);u.value=V.data}const v={props:f,singleMatchmakerData:e,allBuckets:L,onViewBucketClicked:S,selectedBucketData:u,inspectBucketModal:g,bucketSortOptions:c,bucketFilterSets:M,getBucketData:t,computed:x,ref:_,get useGameServerApi(){return D},get MetaListSortDirection(){return k},get MetaListSortOption(){return d},get MetaListFilterOption(){return b},get MetaListFilterSet(){return F},get MModal(){return H},get MBadge(){return A},get MList(){return N},get MListItem(){return E},get MTextButton(){return G},get useSubscription(){return P},get getSingleMatchmakerSubscriptionOptions(){return O}};return Object.defineProperty(v,"__isScriptSetup",{enumerable:!1,value:!0}),v}}),q={key:0,class:"tw-w-full tw-pt-4 tw-text-center"},z={key:1},J={key:1,class:"tw-text-xs+ tw-italic tw-text-red-500"};function K(h,l,f,e,L,S){const u=I("b-spinner"),g=I("meta-list-card");return r(),m(g,{title:"All Buckets",itemList:e.allBuckets,sortOptions:e.bucketSortOptions,filterSets:e.bucketFilterSets,"data-testid":"matchmaker-buckets-list-card"},{"item-card":a(({item:c,index:M})=>[p(e.MListItem,null,{"top-right":a(()=>[s(i(c.numPlayers)+" participants",1)]),"bottom-left":a(()=>[(r(!0),o(y,null,w(c.labels,t=>(r(),o("span",{key:t.dashboardLabel},[t.dashboardLabel?(r(),m(e.MBadge,{key:0,class:"tw-mr-1"},{default:a(()=>[s(i(t.dashboardLabel),1)],void 0,!0),_:2},1024)):C("",!0)]))),128))]),"bottom-right":a(()=>[B("div",null,i(Math.round(c.fillPercentage*1e4)/100)+"% full",1),p(e.MTextButton,{onClick:t=>e.onViewBucketClicked(c)},{default:a(()=>l[0]||(l[0]=[s("View bucket")]),void 0,!0),_:2},1032,["onClick"])]),default:a(()=>[s("Bucket #"+i(M),1)],void 0,!0),_:2},1024),p(e.MModal,{ref:"inspectBucketModal",title:"Inspect Bucket"},{default:a(()=>[e.selectedBucketData?(r(),o("div",z,[B("p",null,"Top 20 players of the bucket #"+i(M),1),(r(!0),o(y,null,w(c.labels,t=>(r(),o("span",{key:t.dashboardLabel},[t.dashboardLabel?(r(),m(e.MBadge,{key:0,class:"tw-mr-1"},{default:a(()=>[s(i(t.dashboardLabel),1)],void 0,!0),_:2},1024)):C("",!0)]))),128)),e.selectedBucketData.players&&e.selectedBucketData.players.length>0?(r(),m(e.MList,{key:0,class:"tw-mt-2","show-border":""},{default:a(()=>[(r(!0),o(y,null,w(e.selectedBucketData.players,t=>(r(),m(e.MListItem,{class:"tw-px-3",key:t.model.playerId,striped:""},{"top-right":a(()=>[s(i(t.model.playerId),1)]),"bottom-left":a(()=>[s(i(t.summary),1)]),"bottom-right":a(()=>[p(e.MTextButton,{permission:"api.players.view",to:`/players/${t.model.playerId}`},{default:a(()=>l[1]||(l[1]=[s("View player")]),void 0,!0),_:2},1032,["to"])]),default:a(()=>[s(i(t.name),1)],void 0,!0),_:2},1024))),128))],void 0,!0),_:1})):(r(),o("div",J,l[2]||(l[2]=[s("Something went wrong when loading this bucket's players list."),B("div",null,"Please close the modal and try opening it again.",-1)])))])):(r(),o("div",q,[p(u,{label:"Loading..."})]))],void 0,!0),_:2},1536)]),_:1},8,["itemList"])}const Z=j(U,[["render",K],["__file","MatchmakerBucketsCard.vue"]]);export{Z as default};
