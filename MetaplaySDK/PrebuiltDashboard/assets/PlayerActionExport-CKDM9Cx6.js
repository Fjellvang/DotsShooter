import{d as D,x as f,f as g,c as v,ad as _,M as z,a0 as C,bb as B,bn as S,b as y,o as s,a as d,k as o,w as p,n as i,p as a,t as h,l as k,e as O,_ as P}from"./index-B7jvAjdE.js";import{M as N}from"./MActionModalButton-CvWVuTB-.js";import{r as A}from"./utils-Dwlepb3M.js";import{a as M}from"./players-CydHenLG.js";import"./MActionModal-coQLkvWs.js";import"./index-fVjXqxSF.js";const I=3e5,L=D({__name:"PlayerActionExport",props:{playerId:{},allowDebugExport:{type:Boolean}},setup(x,{expose:t}){t();const r=x,e=_(),{data:u}=f(M(r.playerId)),l=g(),n=v(()=>A(l.value));async function b(){l.value=void 0;const c={player:[r.playerId]};u.value?.guild&&(c.guild=[u.value.guild.id]);const E={entities:c,allowExportOnFailure:r.allowDebugExport};l.value=JSON.stringify((await e.post("/entityArchive/export",E)).data)}async function m(){const c=`${r.playerId.replace(":","_")}.export`;S(l.value,c)}const w={props:r,gameServerApi:e,playerData:u,exportArchive:l,exportSize:n,sizeLimit:I,fetchExportData:b,downloadOk:m,computed:v,ref:g,get useGameServerApi(){return _},get roughSizeOfObject(){return A},get MActionModalButton(){return N},get MBadge(){return z},get MCallout(){return C},get MClipboardCopy(){return B},get useSubscription(){return f},get downloadDataAsJson(){return S},get getSinglePlayerSubscriptionOptions(){return M}};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}}),V={key:0},j={class:"tw-mb-1"},J={class:"tw-mb-1"},F={key:0},G={class:"code-box tw-h-[10rem] tw-text-wrap tw-rounded-md tw-border tw-border-neutral-200 tw-bg-neutral-100 tw-text-neutral-600"},T={key:0,"data-testid":"export-payload"},Y={key:1},q={key:0,class:"tw-mb-4 tw-mt-2 tw-w-full tw-text-right tw-text-xs tw-text-neutral-500"};function H(x,t,r,e,u,l){const n=y("b-skeleton"),b=y("meta-abbreviate-number"),m=y("fa-icon");return e.playerData||r.allowDebugExport?(s(),d("div",V,[o(e.MActionModalButton,{"modal-title":"Export Player",action:e.downloadOk,"trigger-button-label":"Export Player",variant:"danger","ok-button-label":"Download","ok-button-disabled-tooltip":e.exportArchive?void 0:"No data to export.","disable-safety-lock":"",permission:"api.entity_archive.export",onShow:t[0]||(t[0]=w=>e.fetchExportData()),"data-testid":"export-player"},{default:p(()=>[i("p",j,[t[2]||(t[2]=a("This is the persisted player data for ")),o(e.MBadge,null,{default:p(()=>[a(h(e.playerData?.model.playerName||"n/a"),1)],void 0,!0),_:1}),t[3]||(t[3]=a(" as an ")),o(e.MBadge,null,{default:p(()=>t[1]||(t[1]=[a("entity archive")]),void 0,!0),_:1}),t[4]||(t[4]=a(". You can use it for raw debugging as well as copying players between deployments."))]),t[10]||(t[10]=i("p",{class:"tw-mb-4 tw-text-sm tw-text-neutral-500"},"Please note that you are taking a copy of a player's personally identifiable information (PII) and you should only do this if you have a legitimate reason or the player's consent.",-1)),i("h6",J,[t[5]||(t[5]=a("Serialized Player Data")),o(e.MClipboardCopy,{class:"tw-ml-1",contents:e.exportArchive,disabled:e.exportSize>=e.sizeLimit,"data-testid":"copy-player-to-clipboard"},null,8,["contents","disabled"])]),e.exportSize<e.sizeLimit?(s(),d("div",F,[i("pre",G,[e.exportArchive?(s(),d("span",T,h(e.exportArchive),1)):(s(),d("span",Y,[o(n,{width:"85%"}),o(n,{width:"55%"}),o(n,{width:"70%"}),o(n,{class:"tw-mt-4",width:"80%"}),o(n,{width:"65%"})]))]),e.exportArchive?(s(),d("div",q,[t[6]||(t[6]=i("span",null,"Export archive size: ",-1)),o(b,{value:e.exportSize},null,8,["value"])])):k("",!0)])):(s(),O(e.MCallout,{key:1,title:"Export Preview Disabled"},{default:p(()=>[i("p",null,[t[7]||(t[7]=a("Export preview and copying disabled because of its large size of ")),o(b,{value:e.exportSize},null,8,["value"]),t[8]||(t[8]=a("b! You can still download the data 👍"))]),t[9]||(t[9]=i("p",{class:"tw-text-sm tw-text-orange-800"},"Some OS & browser combinations are known to have performance issues parsing large blobs of data. Let us know if you are one of them and we'll figure it out!",-1))],void 0,!0),_:1}))]),"ok-button-icon":p(()=>[o(m,{class:"tw-mb-[0.05rem] tw-h-3.5 tw-w-4",icon:"file-download"})]),_:1},8,["ok-button-disabled-tooltip"])])):k("",!0)}const Z=P(L,[["render",H],["__file","PlayerActionExport.vue"]]);export{Z as default};
