import{d as V,x as h,f as _,c as I,ad as D,M as G,q as R,bN as K,v as j,ae as C,b as c,o as L,e as O,w as n,k as a,l as H,n as A,t as m,p as s,_ as q}from"./index-B7jvAjdE.js";import{M as z}from"./MActionModal-coQLkvWs.js";import{M as y,a as b,b as N,c as S}from"./metaListUtils-B-xQ0HnD.js";import{a as B}from"./players-CydHenLG.js";import{M as E}from"./MetaGeneratedContent-DU2kF4fJ.js";import"./index-fVjXqxSF.js";const J=1,Q=V({__name:"PlayerInboxCard",props:{playerId:{}},setup(x,{expose:i}){i();const u=x,e=D(),{data:l,refresh:p}=h(B(u.playerId)),d=["contents.description"],f=[new N("attachments",[new S("Has attachments",t=>t.contents.consumableRewards.length>0),new S("No attachments",t=>t.contents.consumableRewards.length===0)])],g=[new y("Time","sentAt",b.Ascending),new y("Time","sentAt",b.Descending)],r=_(null),o=_();function M(t){r.value=t,o.value?.open(t)}const T=I(()=>r.value?r.value.contents.description:"");function k(t){return t.id}const{showSuccessNotification:v}=C();async function F(t){await e.delete(`/players/${l.value.id}/deleteMail/${t.id}`);const P=`${t.contents.description}' deleted from ${l.value.model.playerName||"n/a"}.`;v(P),p()}const w={props:u,gameServerApi:e,playerData:l,playerRefresh:p,searchFields:d,filterSets:f,sortOptions:g,defaultSortOption:J,mailToDelete:r,deleteInboxModal:o,onMailDeleteClick:M,mailToDeleteTitle:T,getItemKey:k,showSuccessNotification:v,deleteMail:F,computed:I,ref:_,get useGameServerApi(){return D},get MetaListFilterSet(){return N},get MetaListFilterOption(){return S},get MetaListSortDirection(){return b},get MetaListSortOption(){return y},get MActionModal(){return z},get MBadge(){return G},get MCollapse(){return R},get MIconButton(){return K},get MListItem(){return j},get useNotifications(){return C},get useSubscription(){return h},get getSinglePlayerSubscriptionOptions(){return B},MetaGeneratedContent:E};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}}),U={class:"tw-text-sm tw-text-neutral-500"},W={class:"tw-mb-4"};function X(x,i,u,e,l,p){const d=c("fa-icon"),f=c("meta-time"),g=c("meta-no-seatbelts"),r=c("meta-list-card");return L(),O(r,{title:"Inbox",icon:"inbox",itemList:e.playerData.model.mailInbox,getItemKey:e.getItemKey,tooltip:"Messages currently waiting in the player's inbox.",searchFields:e.searchFields,filterSets:e.filterSets,sortOptions:e.sortOptions,defaultSortOption:e.defaultSortOption,emptyMessage:"Inbox empty.","data-testid":"player-inbox-list-card"},{"item-card":n(({item:o})=>[a(e.MCollapse,{extraMListItemMargin:""},{header:n(()=>[a(e.MListItem,{noLeftPadding:"","data-testid":"player-inbox-mail-item"},{badge:n(()=>[Object.keys(o.contents.consumableRewards).length>0?(L(),O(d,{key:0,class:"tw-mt-1 tw-text-neutral-500",icon:"paperclip",size:"sm"})):H("",!0)]),"top-right":n(()=>[A("span",U,m(o.id),1),a(e.MIconButton,{permission:"api.players.mail",variant:"danger","aria-label":"Delete this mail.",onClick:M=>e.onMailDeleteClick(o),"data-testid":"confirm-mail-delete"},{default:n(()=>[a(d,{icon:"trash-alt"})],void 0,!0),_:2},1032,["onClick"])]),"bottom-right":n(()=>[a(f,{date:o.sentAt,showAs:"timeagoSentenceCase"},null,8,["date"])]),default:n(()=>[s(m(o.contents.description),1)],void 0,!0),_:2},1024)]),default:n(()=>[a(e.MetaGeneratedContent,{value:o.contents,previewLocale:e.playerData.model.language,"logic-version":e.playerData.model.logicVersion,"data-testid":"player-inbox-mail-content"},null,8,["value","previewLocale","logic-version"])],void 0,!0),_:2},1024),a(e.MActionModal,{ref:"deleteInboxModal",title:"Delete Mail",action:()=>e.deleteMail(e.mailToDelete),onHidden:i[0]||(i[0]=M=>e.mailToDelete=null),"data-testid":"confirm-mail-delete"},{default:n(()=>[A("p",W,[a(e.MBadge,null,{default:n(()=>[s(m(e.playerData.model.playerName||"n/a"),1)],void 0,!0),_:1}),i[1]||(i[1]=s(" has not claimed this mail yet. Are you sure that you want to delete the mail ")),a(e.MBadge,null,{default:n(()=>[s(m(e.mailToDeleteTitle),1)],void 0,!0),_:1}),i[2]||(i[2]=s("?"))]),a(g)],void 0,!0),_:1},8,["action"])]),_:1},8,["itemList"])}const ae=q(Q,[["render",X],["__file","PlayerInboxCard.vue"]]);export{ae as default};
